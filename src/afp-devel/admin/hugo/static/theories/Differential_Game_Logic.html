<div id="Lib">
<div class="head">
<h1>Theory Lib</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Lib"</span>
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Generic Mathematical Background Lemmas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_subset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">M</span> <span class="main">⟹</span> finite <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="free">M</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_powerset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">M</span> <span class="main">⟹</span> finite <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span><span class="free">M</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fst_proj</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">*</span><span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fst_proj</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">snd_proj</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">*</span><span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">snd_proj</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fst_proj_mem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∈</span> fst_proj <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span><span class="main">∈</span><span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fst_proj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> snd_proj_mem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span> <span class="main">∈</span> snd_proj <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span><span class="main">∈</span><span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> snd_proj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fst_proj_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst_proj <span class="main">{</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span><span class="main">|</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">∧</span> <span class="free">R</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fst_proj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> snd_proj_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>snd_proj <span class="main">{</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">|</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">B</span> <span class="main">∧</span> <span class="free">R</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> snd_proj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> map_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">(</span>Cons <span class="free">x</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> Cons <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> List.list.map<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> map_append<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">(</span>append <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> append <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lockstep induction schema for two simultaneous least fixpoints.
  If the successor step and supremum step of two least fixpoint inflations
  preserve a relation, then that relation holds of the two respective least fixpoints.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lfp_lockstep_induct <span class="main">[</span><span class="operator">case_names</span> monof monog step union<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>complete_lattice <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>complete_lattice <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> monof<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">f</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> monog<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> R_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≤</span> lfp<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">B</span> <span class="main">≤</span> lfp<span class="main">(</span><span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">A</span> <span class="bound">B</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> R_Union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">*</span><span class="tfree">'b</span><span class="main">)</span> set<span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span><span class="main">∈</span><span class="bound">M</span><span class="main">.</span> <span class="free">R</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">(</span>Sup <span class="main">(</span>fst_proj <span class="bound">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Sup <span class="main">(</span>snd_proj <span class="bound">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">(</span>lfp <span class="free">f</span><span class="main">)</span> <span class="main">(</span>lfp <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="comment1">(*using idea of proof of "Inductive.thy:lfp_ordinal_induct"*)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≤</span> lfp <span class="free">f</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">≤</span> lfp <span class="free">g</span> <span class="main">∧</span> <span class="free">R</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> R_Union <span class="keyword1"><span class="command">have</span></span> supdoes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">(</span>Sup <span class="main">(</span>fst_proj <span class="var">?M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Sup <span class="main">(</span>snd_proj <span class="var">?M</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sup <span class="main">(</span>fst_proj <span class="var">?M</span><span class="main">)</span> <span class="main">=</span> lfp <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Sup <span class="main">(</span>snd_proj <span class="var">?M</span><span class="main">)</span> <span class="main">=</span> lfp <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> fle<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup <span class="main">(</span>fst_proj <span class="var">?M</span><span class="main">)</span> <span class="main">≤</span> lfp <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fst_proj_prop Sup_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Sup <span class="main">(</span>fst_proj <span class="var">?M</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>lfp <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monof <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> monoD<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fsup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Sup <span class="main">(</span>fst_proj <span class="var">?M</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> lfp <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> monof <span class="main">[</span><span class="operator">THEN</span> lfp_unfold<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> gle<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup <span class="main">(</span>snd_proj <span class="var">?M</span><span class="main">)</span> <span class="main">≤</span> lfp <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> snd_proj_prop Sup_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>Sup <span class="main">(</span>snd_proj <span class="var">?M</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="main">(</span>lfp <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monog <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> monoD<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gsup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>Sup <span class="main">(</span>snd_proj <span class="var">?M</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> lfp <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> monog <span class="main">[</span><span class="operator">THEN</span> lfp_unfold<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> fsup <span class="keyword2"><span class="keyword">and</span></span> gsup <span class="keyword1"><span class="command">have</span></span> fgsup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">(</span>Sup<span class="main">(</span>fst_proj <span class="var">?M</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">g</span><span class="main">(</span>Sup<span class="main">(</span>snd_proj <span class="var">?M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?M</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> R_Union R_step Sup_le_iff
      <span class="keyword1"><span class="command">using</span></span> calculation fle gle <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

    <span class="keyword1"><span class="command">from</span></span> fgsup <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Sup <span class="main">(</span>fst_proj <span class="var">?M</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Sup <span class="main">(</span>fst_proj <span class="var">?M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Sup_upper <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fst_proj_def mem_Collect_eq<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> fge<span class="main">:</span> <span class="quoted"><span class="quoted">"lfp <span class="free">f</span> <span class="main">≤</span> Sup <span class="main">(</span>fst_proj <span class="var">?M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lfp_lowerbound<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Sup <span class="main">(</span>snd_proj <span class="var">?M</span><span class="main">)</span> <span class="main">=</span> lfp <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Sup <span class="main">(</span>snd_proj <span class="var">?M</span><span class="main">)</span> <span class="main">≤</span> lfp <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gle<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> fgsup <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>Sup <span class="main">(</span>snd_proj <span class="var">?M</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Sup <span class="main">(</span>snd_proj <span class="var">?M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Sup_upper <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> snd_proj_def mem_Collect_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> gge<span class="main">:</span> <span class="quoted"><span class="quoted">"lfp <span class="free">g</span> <span class="main">≤</span> Sup <span class="main">(</span>snd_proj <span class="var">?M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lfp_lowerbound<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> supdoes <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> sup_eq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">A</span><span class="main">∈</span><span class="free">M</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="bound">A</span><span class="main">)</span><span class="main">=</span><span class="free">g</span><span class="main">(</span><span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> Sup <span class="main">{</span><span class="free">f</span><span class="main">(</span><span class="bound">A</span><span class="main">)</span> <span class="main">|</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span><span class="free">M</span><span class="main">}</span> <span class="main">=</span> Sup <span class="main">{</span><span class="free">g</span><span class="main">(</span><span class="bound">A</span><span class="main">)</span> <span class="main">|</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span><span class="free">M</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> sup_corr_eq_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>complete_lattice<span class="main">*</span><span class="tfree">'a</span><span class="main">)</span> set<span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span><span class="main">∈</span><span class="bound">M</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">A</span><span class="main">)</span><span class="main">=</span><span class="free">g</span><span class="main">(</span><span class="bound">B</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>Sup <span class="main">{</span><span class="free">f</span><span class="main">(</span><span class="bound">A</span><span class="main">)</span> <span class="main">|</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span>fst_proj <span class="bound">M</span><span class="main">}</span> <span class="main">=</span> Sup <span class="main">{</span><span class="free">g</span><span class="main">(</span><span class="bound">B</span><span class="main">)</span> <span class="main">|</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span><span class="main">∈</span>snd_proj <span class="bound">M</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> case_prod_conv fst_proj_mem snd_proj_mem<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Identifiers">
<div class="head">
<h1>Theory Identifiers</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Identifiers"</span>
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Identifier Namespace Configuration›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Different configurations are possible for the namespace of identifiers. Finite support is the only important aspect of it.›</span></span>

<span class="comment1">(* Identifiers, easiest finite case *)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> ident <span class="main">=</span> <span class="quoted">char</span>

<span class="comment1">(* Identifiers, bigger finite case with longer identifiers *)</span>
<span class="comment1">(*
definition max_str:"MAX_STR = 1"
typedef ident = "{s::string. size s ≤ MAX_STR}"
  morphisms Rep_ident Abs_ident
  apply(auto)
  apply(rule exI[where x=Nil])
  by(auto simp add: max_str)

setup_lifting  ident.type_definition_ident 

lift_definition ilength::"ident ⇒ nat" is size done

lemma ident_bounded_length: "ilength x ≤ MAX_STR"
  apply (transfer fixing: s)
  apply (auto)
  done 

lemma finite_identifiers [simp]: "finite {x:ident . True}"
using ident_bounded_length 
  
lifting_update ident.lifting
lifting_forget ident.lifting
*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The identifier used for the replacement marker in uniform substitutions›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">dotid</span><span class="main">::</span> <span class="quoted"><span class="quoted">"ident"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dotid</span> <span class="main">≡</span> <span class="keyword1">CHR</span> <span class="inner_quoted">''.''</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Syntax">
<div class="head">
<h1>Theory Syntax</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Syntax"</span>
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <span class="quoted">"<a href="Identifiers.html">Identifiers</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Syntax›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Defines the syntax of Differential Game Logic as inductively defined data types.
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://doi.org/10.1145/2817824›</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://doi.org/10.1007/978-3-319-94205-6_15›</span></span>
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Terms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Numeric literals›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> lit <span class="main">=</span> <span class="quoted">real</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹the set of all real variables›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">allidents</span><span class="main">::</span> <span class="quoted"><span class="quoted">"ident set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">allidents</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Variables and differential variables›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> variable <span class="main">=</span>
  RVar <span class="quoted">ident</span>
<span class="main">|</span> DVar <span class="quoted">ident</span>  

<span class="keyword1"><span class="command">datatype</span></span> trm <span class="main">=</span>
  Var <span class="quoted">variable</span>
<span class="main">|</span> Number <span class="quoted">lit</span>
<span class="main">|</span> Const <span class="quoted">ident</span>
<span class="main">|</span> Func <span class="quoted">ident</span> <span class="quoted">trm</span>
<span class="main">|</span> Plus <span class="quoted">trm</span> <span class="quoted">trm</span>
<span class="main">|</span> Times <span class="quoted">trm</span> <span class="quoted">trm</span>
<span class="main">|</span> Differential <span class="quoted">trm</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Formulas and Hybrid Games›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> fml <span class="main">=</span>
  Pred <span class="quoted">ident</span> <span class="quoted">trm</span>
<span class="main">|</span> Geq <span class="quoted">trm</span> <span class="quoted">trm</span>
<span class="main">|</span> Not <span class="quoted">fml</span>                 <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">!</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
<span class="main">|</span> And <span class="quoted">fml</span> <span class="quoted">fml</span>             <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">&amp;&amp;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 8<span class="main">)</span>
<span class="main">|</span> Exists <span class="quoted">variable</span> <span class="quoted">fml</span>
<span class="main">|</span> Diamond <span class="quoted">game</span> <span class="quoted">fml</span>        <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⟨</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⟩</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 20<span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span> game <span class="main">=</span>
  Game <span class="quoted">ident</span>
<span class="main">|</span> Assign <span class="quoted">variable</span> <span class="quoted">trm</span>     <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">:=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 20<span class="main">)</span>
<span class="main">|</span> Test <span class="quoted">fml</span>                <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">?</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
<span class="main">|</span> Choice <span class="quoted">game</span> <span class="quoted">game</span>        <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">∪∪</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 10<span class="main">)</span>
<span class="main">|</span> Compose <span class="quoted">game</span> <span class="quoted">game</span>       <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 8<span class="main">)</span>
<span class="main">|</span> Loop <span class="quoted">game</span>               <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">**</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
<span class="main">|</span> Dual <span class="quoted">game</span>               <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">^d</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
<span class="main">|</span> ODE <span class="quoted">ident</span> <span class="quoted">trm</span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Derived operators›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Neg</span> <span class="main">::</span><span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> trm"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Neg</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="main">=</span> Times <span class="main">(</span>Number <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Minus</span> <span class="main">::</span><span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> trm <span class="main">⇒</span> trm"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Minus</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span> <span class="main">=</span> Plus <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Or</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml <span class="main">⇒</span> fml <span class="main">⇒</span> fml"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">||</span>"</span> 7<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Or</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> Not <span class="main">(</span>And <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Implies</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml <span class="main">⇒</span> fml <span class="main">⇒</span> fml"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">→</span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Implies</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> Or <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Equiv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml <span class="main">⇒</span> fml <span class="main">⇒</span> fml"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">↔</span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Equiv</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> Or <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">(</span>And <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Forall</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"variable <span class="main">⇒</span> fml <span class="main">⇒</span> fml"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Forall</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> Not <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Equals</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> trm <span class="main">⇒</span> fml"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Equals</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">θ'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">θ'</span></span></span><span class="main">)</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ'</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Greater</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> trm <span class="main">⇒</span> fml"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Greater</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">θ'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">θ'</span></span></span><span class="main">)</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>Not <span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ'</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Justification: determinacy theorem justifies this equivalent syntactic abbreviation for box modalities from diamond modalities
  Theorem 3.1 <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://doi.org/10.1145/2817824›</span></span>›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Box</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"game <span class="main">⇒</span> fml <span class="main">⇒</span> fml"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[[</span>_<span class="keyword1">]]</span>_<span class="keyword3">)</span>"</span> 20<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Box</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> Not <span class="main">(</span>Diamond <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">TT</span> <span class="main">::</span><span class="quoted"><span class="quoted">"fml"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">TT</span> <span class="main">=</span> Geq <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FF</span> <span class="main">::</span><span class="quoted"><span class="quoted">"fml"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">FF</span> <span class="main">=</span> Geq <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Skip</span> <span class="main">::</span><span class="quoted"><span class="quoted">"game"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Skip</span> <span class="main">=</span> Test TT"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Inference: premises, then conclusion›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> inference <span class="main">=</span> <span class="quoted"><span class="quoted">"fml list <span class="main">*</span> fml"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> sequent <span class="main">=</span> <span class="quoted"><span class="quoted">"fml list <span class="main">*</span> fml list"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rule: premises, then conclusion›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> rule <span class="main">=</span> <span class="quoted"><span class="quoted">"sequent list <span class="main">*</span> sequent"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Structural Induction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Induction principles for hybrid games owing to their mutually recursive definition with formulas ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> game_induct <span class="main">[</span><span class="operator">case_names</span> Game Assign ODE Test Choice Compose Loop Dual<span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>Game <span class="bound">a</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">θ</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>Assign <span class="bound">x</span> <span class="bound">θ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">θ</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>ODE <span class="bound">x</span> <span class="bound">θ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">?</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="free">P</span> <span class="bound">α</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">β</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">α</span> <span class="main">∪∪</span> <span class="bound">β</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="free">P</span> <span class="bound">α</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">β</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">α</span> <span class="main">;;</span> <span class="bound">β</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">α</span><span class="main">.</span> <span class="free">P</span> <span class="bound">α</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">α</span><span class="main">**</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">α</span><span class="main">.</span> <span class="free">P</span> <span class="bound">α</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">α</span><span class="keyword1">^d</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="free">P</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> game.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fml_induct <span class="main">[</span><span class="operator">case_names</span> Pred Geq Not And Exists Diamond<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">θ</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>Pred <span class="bound">x</span> <span class="bound">θ</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">θ</span> <span class="bound">η</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>Geq <span class="bound">θ</span> <span class="bound">η</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Not <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">φ</span> <span class="bound">ψ</span><span class="main">.</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>And <span class="bound">φ</span> <span class="bound">ψ</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">φ</span><span class="main">.</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Exists <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">α</span> <span class="bound">φ</span><span class="main">.</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Diamond <span class="bound">α</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="free">P</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fml.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹the set of all variables›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">allvars</span><span class="main">::</span> <span class="quoted"><span class="quoted">"variable set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">allvars</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span>variable<span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Denotational_Semantics">
<div class="head">
<h1>Theory Denotational_Semantics</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Denotational_Semantics"</span> 
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Analysis/Derivative.html">HOL-Analysis.Derivative</a>"</span>
  <span class="quoted">"<a href="Syntax.html">Syntax</a>"</span>         
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Denotational Semantics›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Defines the denotational semantics of Differential Game Logic. <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://doi.org/10.1145/2817824›</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://doi.org/10.1007/978-3-319-94205-6_15›</span></span>›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹States›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Vector of reals over ident›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Rvec <span class="main">=</span> <span class="quoted"><span class="quoted">"variable <span class="main">⇒</span> real"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> state <span class="main">=</span> <span class="quoted"><span class="quoted">"Rvec"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹the set of all worlds›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">worlds</span><span class="main">::</span> <span class="quoted"><span class="quoted">"state set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">worlds</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ν</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹the set of all variables›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">allvars</span><span class="main">::</span> <span class="quoted"><span class="quoted">"variable set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">allvars</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span>variable<span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹the set of all real variables›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">allrvars</span><span class="main">::</span> <span class="quoted"><span class="quoted">"variable set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">allrvars</span> <span class="main">≡</span> <span class="main">{</span>RVar <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹the set of all differential variables›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">alldvars</span><span class="main">::</span> <span class="quoted"><span class="quoted">"variable set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">alldvars</span> <span class="main">≡</span> <span class="main">{</span>DVar <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

  
<span class="keyword1"><span class="command">lemma</span></span> ident_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">::</span>ident<span class="main">.</span> True<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> allvar_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"allvars <span class="main">=</span> allrvars <span class="main">∪</span> alldvars"</span></span>
  <span class="keyword1"><span class="command">using</span></span> variable.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">lemma</span></span> rvar_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite allrvars"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_imageI<span class="main">[</span><span class="operator">OF</span> ident_finite<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> h<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> RVar <span class="bound">x</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> full_SetCompr_eq<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> dvar_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite alldvars"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_imageI<span class="main">[</span><span class="operator">OF</span> ident_finite<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> h<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> DVar <span class="bound">x</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> full_SetCompr_eq<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> allvars_finite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>allvars<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> allvar_cases dvar_finite rvar_finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_Un<span class="main">)</span> 
  
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Vagree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> state <span class="main">⇒</span> variable set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Vagree</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Uvariation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> state <span class="main">⇒</span> variable set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Uvariation</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">~</span><span class="main">(</span><span class="bound">i</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Uvariation_Vagree <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ν</span> <span class="free">ν'</span> <span class="main">(</span><span class="main">-</span><span class="free">V</span><span class="main">)</span> <span class="main">=</span> Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Vagree_def Uvariation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  
<span class="keyword1"><span class="command">lemma</span></span> Vagree_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">V</span> <span class="main">=</span> Vagree <span class="free">ν'</span> <span class="free">ν</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_sym_rel <span class="main">[</span><span class="operator">sym</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">V</span> <span class="main">⟹</span> Vagree <span class="free">ν'</span> <span class="free">ν</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Vagree_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_union <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">V</span> <span class="main">⟹</span> Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">W</span> <span class="main">⟹</span> Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="main">(</span><span class="free">V</span><span class="main">∪</span><span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">V</span> <span class="main">⟹</span> Vagree  <span class="free">ν'</span> <span class="free">ν''</span> <span class="free">W</span> <span class="main">⟹</span> Vagree <span class="free">ν</span> <span class="free">ν''</span> <span class="main">(</span><span class="free">V</span><span class="main">∩</span><span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_antimon <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">V</span> <span class="main">∧</span> <span class="free">W</span><span class="main">⊆</span><span class="free">V</span> <span class="main">⟶</span> Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Uvariation_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ν</span> <span class="free">ν'</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν</span><span class="main">=</span><span class="free">ν'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Uvariation_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_univ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν'</span> allvars <span class="main">=</span> <span class="main">(</span><span class="free">ν</span><span class="main">=</span><span class="free">ν'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Uvariation_univ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ν</span> <span class="free">ν'</span> allvars"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Uvariation_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_and <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">V</span> <span class="main">∧</span> Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">W</span> <span class="main">⟷</span> Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="main">(</span><span class="free">V</span><span class="main">∪</span><span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_or<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">V</span> <span class="main">∨</span> Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="free">W</span> <span class="main">⟶</span> Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="main">(</span><span class="free">V</span><span class="main">∩</span><span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Uvariation_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ν</span> <span class="free">ν</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Uvariation_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Uvariation_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ω</span> <span class="free">ν</span> <span class="free">U</span> <span class="main">=</span> Uvariation <span class="free">ν</span> <span class="free">ω</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Uvariation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Uvariation_sym_rel <span class="main">[</span><span class="operator">sym</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ω</span> <span class="free">ν</span> <span class="free">U</span> <span class="main">⟹</span> Uvariation <span class="free">ν</span> <span class="free">ω</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Uvariation_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Uvariation_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ω</span> <span class="free">ν</span> <span class="free">U</span> <span class="main">⟹</span> Uvariation <span class="free">ν</span> <span class="free">μ</span> <span class="free">V</span> <span class="main">⟹</span> Uvariation <span class="free">ω</span> <span class="free">μ</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Uvariation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Uvariation_mon <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊇</span> <span class="free">U</span> <span class="main">⟹</span> Uvariation <span class="free">ω</span> <span class="free">ν</span> <span class="free">U</span> <span class="main">⟹</span> Uvariation <span class="free">ω</span> <span class="free">ν</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Uvariation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


  
<span class="keyword1"><span class="command">subsection</span></span> <span class="plain_text">Interpretations</span>

<span class="keyword1"><span class="command">lemma</span></span> mon_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">X</span><span class="main">⊆</span><span class="bound">Y</span> <span class="main">⟶</span> <span class="free">r</span><span class="main">(</span><span class="bound">X</span><span class="main">)</span><span class="main">⊆</span><span class="free">r</span><span class="main">(</span><span class="bound">Y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹interpretations of symbols in ident›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> interp_rep <span class="main">=</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>ident <span class="main">⇒</span> real<span class="main">)</span> <span class="main">×</span> <span class="main">(</span>ident <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>ident <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> bool<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>ident <span class="main">⇒</span> <span class="main">(</span>state set <span class="main">⇒</span> state set<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_interp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"interp_rep <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_interp</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">G</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> mono <span class="main">(</span><span class="bound">G</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> interp <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">I</span><span class="main">::</span> interp_rep<span class="main">.</span> is_interp <span class="bound">I</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">morphisms</span></span> raw_interp well_interp
<span class="keyword1"><span class="command">proof</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">0</span><span class="main">,</span> <span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">,</span> <span class="main">λ</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> True<span class="main">,</span> <span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">I</span><span class="main">.</span> is_interp <span class="bound">I</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_interp_def mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_interp

<span class="keyword1"><span class="command">lift_definition</span></span> Consts<span class="main">::</span><span class="quoted"><span class="quoted">"interp <span class="main">⇒</span> ident <span class="main">⇒</span> <span class="main">(</span>real<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">F0</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">F0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> Funcs<span class="main">::</span> <span class="quoted"><span class="quoted">"interp <span class="main">⇒</span> ident <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">F</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> Preds<span class="main">::</span> <span class="quoted"><span class="quoted">"interp <span class="main">⇒</span> ident <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> bool<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">P</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">P</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> Games<span class="main">::</span> <span class="quoted"><span class="quoted">"interp <span class="main">⇒</span> ident <span class="main">⇒</span> <span class="main">(</span>state set <span class="main">⇒</span> state set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">G</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹make interpretations›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mkinterp<span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ident <span class="main">⇒</span> real<span class="main">)</span> <span class="main">×</span> <span class="main">(</span>ident <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>ident <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> bool<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>ident <span class="main">⇒</span> <span class="main">(</span>state set <span class="main">⇒</span> state set<span class="main">)</span><span class="main">)</span>
<span class="main">⇒</span> interp"</span></span> 
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="bound">F</span><span class="main">,</span> <span class="bound">P</span><span class="main">,</span> <span class="bound">G</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> mono <span class="main">(</span><span class="bound">G</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="bound">F</span><span class="main">,</span> <span class="bound">P</span><span class="main">,</span> <span class="bound">G</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="bound">F</span><span class="main">,</span> <span class="bound">P</span><span class="main">,</span> <span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def is_interp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Consts_mkinterp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Consts <span class="main">(</span>mkinterp<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">F</span><span class="main">,</span><span class="free">P</span><span class="main">,</span><span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_interp_def mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Funcs_mkinterp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Funcs <span class="main">(</span>mkinterp<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">F</span><span class="main">,</span><span class="free">P</span><span class="main">,</span><span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_interp_def mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Preds_mkinterp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Preds <span class="main">(</span>mkinterp<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">F</span><span class="main">,</span><span class="free">P</span><span class="main">,</span><span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_interp_def mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Games_mkinterp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> mono <span class="main">(</span><span class="free">G</span> <span class="bound">a</span><span class="main">)</span> <span class="main">)</span> <span class="main">⟹</span> Games <span class="main">(</span>mkinterp<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">F</span><span class="main">,</span><span class="free">P</span><span class="main">,</span><span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_interp_def mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mkinterp_eq <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Consts <span class="free">I</span> <span class="main">=</span> Consts <span class="free">J</span> <span class="main">∧</span> Funcs <span class="free">I</span> <span class="main">=</span> Funcs <span class="free">J</span> <span class="main">∧</span> Preds <span class="free">I</span> <span class="main">=</span> Preds <span class="free">J</span> <span class="main">∧</span> Games <span class="free">I</span> <span class="main">=</span> Games <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span><span class="main">=</span><span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_interp_def mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">Y</span> <span class="main">⟹</span> <span class="main">(</span>Games <span class="free">I</span> <span class="free">a</span><span class="main">)</span><span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">⊆</span><span class="main">(</span>Games <span class="free">I</span> <span class="free">a</span><span class="main">)</span><span class="main">(</span><span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_interp_def mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lifting_update</span></span> interp.lifting
<span class="keyword1"><span class="command">lifting_forget</span></span> interp.lifting


<span class="keyword1"><span class="command">subsection</span></span> <span class="plain_text">Semantics</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Semantic modification <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>repv ω x r›</span></span></span></span> replaces the value of variable <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> in the state <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ω›</span></span></span></span> with r›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">repv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> variable <span class="main">⇒</span> real <span class="main">⇒</span> state"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">repv</span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> fun_upd <span class="free"><span class="bound"><span class="entity">ω</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> repv_def_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"repv <span class="free">ω</span> <span class="free">x</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">then</span> <span class="free">r</span> <span class="keyword1">else</span> <span class="free">ω</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">lemma</span></span> repv_access <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">r</span><span class="main">)</span><span class="main">(</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">x</span><span class="main">=</span><span class="free">y</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">r</span> <span class="keyword1">else</span> <span class="free">ω</span><span class="main">(</span><span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> repv_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"repv <span class="free">ω</span> <span class="free">x</span> <span class="main">(</span><span class="free">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">ω</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_repv<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ω</span> <span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repv_def Vagree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_repv_self<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ω</span> <span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span><span class="main">=</span><span class="free">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repv_def Vagree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Uvariation_repv<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ω</span> <span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repv_def Uvariation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Semantics of Terms›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">term_sem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"interp <span class="main">⇒</span> trm <span class="main">⇒</span> <span class="main">(</span>state <span class="main">⇒</span> real<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ω</span><span class="main">.</span> <span class="bound">ω</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Number <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ω</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ω</span><span class="main">.</span> <span class="main">(</span>Consts <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Func <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ω</span><span class="main">.</span> <span class="main">(</span>Funcs <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">(</span><span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="bound">ω</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ω</span><span class="main">.</span> <span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="bound">ω</span> <span class="main">+</span> <span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span> <span class="bound">ω</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ω</span><span class="main">.</span> <span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="bound">ω</span> <span class="main">*</span> <span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span> <span class="bound">ω</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Differential <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ω</span><span class="main">.</span> sum<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">ω</span><span class="main">(</span>DVar <span class="bound">x</span><span class="main">)</span><span class="main">*</span>deriv<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">term_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="main">(</span>repv <span class="bound">ω</span> <span class="main">(</span>RVar <span class="bound">x</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="bound">ω</span><span class="main">(</span>RVar <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">(</span>allidents<span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Solutions of Differential Equations›</span></span>

<span class="comment1">(*@note For simplicity, solutions are not limited to a smaller interval of existence*)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> solution <span class="main">=</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> state"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">solves_ODE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"interp <span class="main">⇒</span> solution <span class="main">⇒</span> ident <span class="main">⇒</span> trm <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">solves_ODE</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ζ</span><span class="main">::</span>real<span class="main">.</span>
     Vagree <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span>RVar <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> DVar <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">)</span>
   <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span><span class="main">(</span>DVar <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> deriv<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span><span class="bound">t</span><span class="main">)</span><span class="main">(</span>RVar <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span>
   <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span><span class="main">(</span>DVar <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> term_sem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Semantics of Formulas and Games›</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fml_sem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"interp <span class="main">⇒</span> fml <span class="main">⇒</span> <span class="main">(</span>state set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="entity">game_sem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"interp <span class="main">⇒</span> game <span class="main">⇒</span> <span class="main">(</span>state set <span class="main">⇒</span> state set<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ω</span><span class="main">.</span> <span class="main">(</span>Preds <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">(</span>term_sem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="bound">ω</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ω</span><span class="main">.</span> term_sem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="bound">ω</span> <span class="main">≥</span> term_sem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span> <span class="bound">ω</span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ω</span><span class="main">.</span> <span class="bound">ω</span> <span class="main">∉</span> <span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∩</span> <span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ω</span><span class="main">.</span> <span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>repv <span class="bound">ω</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Diamond <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">(</span><span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Game <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span>Games <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">(</span><span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Assign <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="main">{</span><span class="bound">ω</span><span class="main">.</span> <span class="main">(</span>repv <span class="bound">ω</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>term_sem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="bound">ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">fml_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Choice <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="bound">X</span> <span class="main">∪</span> <span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="bound">X</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Compose <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">(</span><span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Loop <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="main">⋂</span><span class="main">{</span><span class="bound">Z</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∪</span> <span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="bound">Z</span> <span class="main">⊆</span> <span class="bound">Z</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Dual <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">(</span><span class="main">-</span><span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">game_sem</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>ODE <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="main">{</span><span class="bound">ω</span><span class="main">.</span> <span class="main">∃</span><span class="bound">F</span> <span class="bound">T</span><span class="main">.</span> Vagree <span class="bound">ω</span> <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span>DVar <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">(</span><span class="bound">T</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> solves_ODE <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">F</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Validity›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">valid_in</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"interp <span class="main">⇒</span> fml <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">valid_in</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ω</span><span class="main">.</span> <span class="bound">ω</span> <span class="main">∈</span> fml_sem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">valid</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span><span class="main">.</span><span class="main">∀</span><span class="bound">ω</span><span class="main">.</span> <span class="bound">ω</span> <span class="main">∈</span> fml_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_is_valid_in_all<span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="free">φ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span><span class="main">.</span> valid_in <span class="bound">I</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def valid_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">locally_sound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"inference <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">locally_sound</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">I</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span><span class="main">≤</span><span class="bound">k</span> <span class="main">⟶</span> <span class="bound">k</span><span class="main">&lt;</span>length <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">⟶</span> valid_in <span class="bound">I</span> <span class="main">(</span>nth <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> valid_in <span class="bound">I</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"inference <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sound</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span><span class="main">≤</span><span class="bound">k</span> <span class="main">⟶</span> <span class="bound">k</span><span class="main">&lt;</span>length <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">⟶</span> valid <span class="main">(</span>nth <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> valid <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> locally_sound_is_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"locally_sound <span class="free">R</span> <span class="main">⟹</span> sound <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> locally_sound_def sound_def <span class="keyword1"><span class="command">using</span></span> valid_is_valid_in_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Monotone Semantics›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monotone_Test <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">Y</span> <span class="main">⟹</span> game_sem <span class="free">I</span> <span class="main">(</span>Test <span class="free">φ</span><span class="main">)</span> <span class="free">X</span> <span class="main">⊆</span> game_sem <span class="free">I</span> <span class="main">(</span>Test <span class="free">φ</span><span class="main">)</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> monotone <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">Y</span> <span class="main">⟹</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span> <span class="main">⊆</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">Y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> game_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Game <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Test <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Choice <span class="skolem">α1</span> <span class="skolem">α2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_mono game_sem.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Compose <span class="skolem">α1</span> <span class="skolem">α2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dual <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ODE <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> game_sem_mono <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mon_mono<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> game_union<span class="main">:</span> <span class="quoted"><span class="quoted">"game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span><span class="free">X</span><span class="main">∪</span><span class="free">Y</span><span class="main">)</span> <span class="main">⊇</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> game_sem_union <span class="main">=</span> game_union


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Fixpoint Semantics Alternative for Loops›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> game_sem_loop_fixpoint_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">Z</span><span class="main">.</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="bound">Z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> game_sem_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_mono mon_mono order_refl<span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Consequence of Knaster-Tarski Theorem 3.5 of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://doi.org/10.1145/2817824›</span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> game_sem_loop<span class="main">:</span> <span class="quoted"><span class="quoted">"game_sem <span class="free">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> lfp<span class="main">(</span><span class="main">λ</span><span class="bound">Z</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="bound">Z</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋂</span><span class="main">{</span><span class="bound">Z</span><span class="main">.</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="bound">Z</span> <span class="main">⊆</span> <span class="bound">Z</span><span class="main">}</span> <span class="main">=</span> lfp<span class="main">(</span><span class="main">λ</span><span class="bound">Z</span><span class="main">.</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="bound">Z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> game_sem_loop_back<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> lfp<span class="main">(</span><span class="main">λ</span><span class="bound">Z</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="bound">Z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> game_sem <span class="free">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> game_sem_loop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> game_sem_loop_iterate<span class="main">:</span> <span class="quoted"><span class="quoted">"game_sem <span class="free">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>game_sem <span class="free">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> game_sem_loop game_sem_loop_fixpoint_mono lfp_fixpoint<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> game_sem_loop_unwind<span class="main">:</span> <span class="quoted"><span class="quoted">"game_sem <span class="free">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="main">(</span>Compose <span class="free">α</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> game_sem_loop_iterate <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> game_sem.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> game_sem_loop_unwind_reduce<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="main">(</span>Compose <span class="free">α</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> game_sem <span class="free">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> game_sem_loop_unwind <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> lfp_ordinal_induct_set_cases <span class="main">=</span> lfp_ordinal_induct_set <span class="main">[</span><span class="operator">case_names</span> mono step union<span class="main">]</span>

<span class="comment1">(* Read off a fixpoint induction scheme from the fact that loops have a least fixpoint semantics *)</span>
<span class="keyword1"><span class="command">lemma</span></span> game_loop_induct <span class="main">[</span><span class="operator">case_names</span> step union<span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">Z</span><span class="main">.</span> <span class="bound">Z</span> <span class="main">⊆</span> game_sem <span class="free">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="bound">Z</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="bound">Z</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Z</span><span class="main">∈</span><span class="bound">M</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">Z</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span>Sup <span class="bound">M</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span>game_sem <span class="free">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> loopstep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Z</span><span class="main">.</span> <span class="bound">Z</span> <span class="main">⊆</span> game_sem <span class="free">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="bound">Z</span><span class="main">)</span> <span class="main">⟹</span>  <span class="free">P</span><span class="main">(</span><span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="bound">Z</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> loopsup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Z</span><span class="main">∈</span><span class="bound">M</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">Z</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span>Sup <span class="bound">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span>lfp<span class="main">(</span><span class="main">λ</span><span class="bound">Z</span><span class="main">.</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="bound">Z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lfp_ordinal_induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">Z</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">X</span></span> <span class="main"><span class="main">∪</span></span> game_sem <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">α</span></span> <span class="bound"><span class="bound">Z</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> mono
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> game_sem_loop_fixpoint_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> loopstep<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Z<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> game_sem_loop<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> α<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">α</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> loopstep<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>union <span class="skolem">M</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> loopsup game_sem_loop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span>game_sem <span class="free">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> game_sem_loop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="comment1">(*proof (induction rule: lfp_ordinal_induct_set_cases[where f=‹λZ. X ∪ game_sem I α Z›])
    case mono
    then show ?case using game_sem_loop_fixpoint_mono by simp
  next
    case (step S)
    then show ?case using loopstep by auto
  next
    case (union M)
    then show ?case using loopsup game_sem_loop by auto
  qed*)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Some Simple Obvious Observations›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fml_sem_not <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fml_sem <span class="free">I</span> <span class="main">(</span>Not <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fml_sem <span class="free">I</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fml_sem_not_not <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fml_sem <span class="free">I</span> <span class="main">(</span>Not <span class="main">(</span>Not <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fml_sem <span class="free">I</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fml_sem_or <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fml_sem <span class="free">I</span> <span class="main">(</span>Or <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> fml_sem <span class="free">I</span> <span class="free">φ</span> <span class="main">∪</span> fml_sem <span class="free">I</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Or_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fml_sem_implies <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fml_sem <span class="free">I</span> <span class="main">(</span>Implies <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span>fml_sem <span class="free">I</span> <span class="free">φ</span><span class="main">)</span> <span class="main">∪</span> fml_sem <span class="free">I</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Implies_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> TT_valid <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid TT"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def TT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Semantic equivalence of formulas›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fml_equiv</span><span class="main">::</span> <span class="quoted"><span class="quoted">"fml <span class="main">=&gt;</span> fml <span class="main">=&gt;</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fml_equiv</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span><span class="main">.</span> fml_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> fml_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Substitutionality for Equivalent Formulas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fml_equiv_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"fml_equiv <span class="free">φ</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>fml_sem <span class="free">I</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>fml_sem <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"fml_equiv <span class="free">φ</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>fml_sem <span class="free">I</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fml_sem <span class="free">I</span> <span class="free">φ</span> <span class="main">=</span> fml_sem <span class="free">I</span> <span class="free">ψ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fml_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> forw_subst a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> valid_fml_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="main">(</span><span class="free">φ</span> <span class="main">↔</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> fml_equiv <span class="free">φ</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def Equiv_def Or_def fml_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_in_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_in <span class="free">I</span> <span class="main">(</span><span class="free">φ</span> <span class="main">↔</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>fml_sem <span class="free">I</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fml_sem <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_in_def Equiv_def Or_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_in_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_in <span class="free">I</span> <span class="main">(</span><span class="free">φ</span> <span class="main">→</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>fml_sem <span class="free">I</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>fml_sem <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_in_def Implies_def Or_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="main">(</span><span class="free">φ</span> <span class="main">↔</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span><span class="main">.</span> fml_sem <span class="bound">I</span> <span class="free">φ</span> <span class="main">=</span> fml_sem <span class="bound">I</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_fml_equiv fml_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="main">(</span><span class="free">φ</span> <span class="main">→</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span><span class="main">.</span> <span class="main">(</span>fml_sem <span class="bound">I</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>fml_sem <span class="bound">I</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def Implies_def Or_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fml_sem_equals <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ω</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>Equals <span class="free">θ</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>term_sem <span class="free">I</span> <span class="free">θ</span> <span class="free">ω</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="free">η</span> <span class="free">ω</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def Equals_def Or_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_refl_valid <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="main">(</span><span class="free">φ</span> <span class="main">↔</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def Equiv_def Or_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> equal_refl_valid <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="main">(</span>Equals <span class="free">θ</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def Equals_def Or_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> solves_ODE_alt <span class="main">:</span> <span class="quoted"><span class="quoted">"solves_ODE <span class="free">I</span> <span class="free">F</span> <span class="free">x</span> <span class="free">θ</span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ζ</span><span class="main">::</span>real<span class="main">.</span>
     Vagree <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span>
   <span class="main">∧</span> <span class="free">F</span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span><span class="main">(</span>DVar <span class="free">x</span><span class="main">)</span> <span class="main">=</span> deriv<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">t</span><span class="main">)</span><span class="main">(</span>RVar <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span>
   <span class="main">∧</span> <span class="free">F</span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>Equals <span class="main">(</span>Var <span class="main">(</span>DVar <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> solves_ODE_def <span class="keyword1"><span class="command">using</span></span> fml_sem_equals <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Semantic equivalence of games›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">game_equiv</span><span class="main">::</span> <span class="quoted"><span class="quoted">"game <span class="main">=&gt;</span> game <span class="main">=&gt;</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">game_equiv</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span> <span class="bound">X</span><span class="main">.</span> game_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="bound">X</span> <span class="main">=</span> game_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="bound">X</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Substitutionality for Equivalent Games›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> game_equiv_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"game_equiv <span class="free">α</span> <span class="free">β</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">β</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"game_equiv <span class="free">α</span> <span class="free">β</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span> <span class="main">=</span> game_sem <span class="free">I</span> <span class="free">β</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> game_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> forw_subst a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> game_equiv_subst_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"game_equiv <span class="free">α</span> <span class="free">β</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span><span class="main">)</span> <span class="main">==</span> <span class="free">P</span> <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">β</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> game_equiv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> skip_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"game_sem <span class="free">I</span> Skip <span class="free">X</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Skip_def TT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> loop_iterate_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"game_equiv <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="main">(</span>Choice Skip <span class="main">(</span>Compose <span class="free">α</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> game_equiv_def  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">X</span>
  <span class="keyword1"><span class="command">from</span></span> game_sem_loop_unwind_reduce <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∪</span> game_sem <span class="skolem">I</span> <span class="main">(</span>Compose <span class="free">α</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span> game_sem <span class="skolem">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"game_sem <span class="skolem">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span> game_sem <span class="skolem">I</span> <span class="main">(</span>Choice Skip <span class="main">(</span>Compose <span class="free">α</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> skip_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> fml_equiv_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"fml_equiv <span class="free">φ</span> <span class="free">ψ</span> <span class="main">⟹</span> valid <span class="free">φ</span> <span class="main">=</span> valid <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def <span class="keyword1"><span class="command">using</span></span> fml_equiv_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> solves_Vagree<span class="main">:</span> <span class="quoted"><span class="quoted">"solves_ODE <span class="free">I</span> <span class="free">F</span> <span class="free">x</span> <span class="free">θ</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">ζ</span><span class="main">.</span> Vagree <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> solves_ODE_def Vagree_sym_rel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">lemma</span></span> solves_Vagree_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">ω</span> <span class="free">U</span> <span class="main">⟹</span> solves_ODE <span class="free">I</span> <span class="free">F</span> <span class="free">x</span> <span class="free">θ</span> <span class="main">⟹</span> Uvariation <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="free">ζ</span><span class="main">)</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> solves_Vagree Uvariation_Vagree solves_ODE_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Uvariation_sym_rel Uvariation_trans double_complement<span class="main">)</span>  

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Static_Semantics">
<div class="head">
<h1>Theory Static_Semantics</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Static_Semantics"</span>
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="Syntax.html">Syntax</a>"</span>
  <span class="quoted">"<a href="Denotational_Semantics.html">Denotational_Semantics</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Static Semantics›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Semantically-defined Static Semantics›</span></span>
<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary notions of projection of winning conditions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹upward projection: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>restrictto X V›</span></span></span></span> is extends X to the states that agree on V with some state in X,
so variables outside V can assume arbitrary values.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">restrictto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state set <span class="main">⇒</span> variable set <span class="main">⇒</span> state set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">restrictto</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">ν</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ω</span><span class="main">.</span> <span class="bound">ω</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> Vagree <span class="bound">ω</span> <span class="bound">ν</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹downward projection: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>selectlike X ν V›</span></span></span></span> selects state <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ν›</span></span></span></span> on V in X,
so all variables of V are required to remain constant›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">selectlike</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state set <span class="main">⇒</span> state <span class="main">⇒</span> variable set <span class="main">⇒</span> state set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">selectlike</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">ω</span></span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> Vagree <span class="bound">ω</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Free variables, semantically characterized.›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Free variables of a term›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FVT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> variable set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FVT</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">I</span><span class="main">.</span><span class="main">∃</span><span class="bound">ν</span><span class="main">.</span><span class="main">∃</span><span class="bound">ω</span><span class="main">.</span> Vagree <span class="bound">ν</span> <span class="bound">ω</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>term_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">ν</span> <span class="main">=</span> term_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">ω</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Free variables of a formula›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FVF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml <span class="main">⇒</span> variable set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FVF</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">I</span><span class="main">.</span><span class="main">∃</span><span class="bound">ν</span><span class="main">.</span><span class="main">∃</span><span class="bound">ω</span><span class="main">.</span> Vagree <span class="bound">ν</span> <span class="bound">ω</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">ν</span> <span class="main">∈</span> fml_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="bound">ω</span> <span class="main">∉</span> fml_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Free variables of a hybrid game›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FVG</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"game <span class="main">⇒</span> variable set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FVG</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">I</span><span class="main">.</span><span class="main">∃</span><span class="bound">ν</span><span class="main">.</span><span class="main">∃</span><span class="bound">ω</span><span class="main">.</span><span class="main">∃</span><span class="bound">X</span><span class="main">.</span> Vagree <span class="bound">ν</span> <span class="bound">ω</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">ν</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">(</span>restrictto <span class="bound">X</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">ω</span> <span class="main">∉</span> game_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">(</span>restrictto <span class="bound">X</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Bound variables, semantically characterized.›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Bound variables of a hybrid game›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BVG</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"game <span class="main">⇒</span> variable set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">BVG</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">I</span><span class="main">.</span><span class="main">∃</span><span class="bound">ω</span><span class="main">.</span><span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">ω</span> <span class="main">∉</span> game_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simple Observations›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> BVG_elem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">∈</span>BVG <span class="free">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">ω</span> <span class="main">∉</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> BVG_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> nonBVG_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="free">x</span><span class="main">∉</span>BVG <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> BVG_elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> nonBVG_inc_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="free">x</span><span class="main">∉</span>BVG <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> BVG_elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
<span class="keyword1"><span class="command">lemma</span></span> FVT_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>FVT <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> allvars_finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_subset mem_Collect_eq subsetI<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> FVF_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>FVF <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> allvars_finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_subset mem_Collect_eq subsetI<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> FVG_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>FVG <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> allvars_finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_subset mem_Collect_eq subsetI<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Coincidence">
<div class="head">
<h1>Theory Coincidence</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Coincidence"</span> 
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="Lib.html">Lib</a>"</span>
  <span class="quoted">"<a href="Syntax.html">Syntax</a>"</span>
  <span class="quoted">"<a href="Denotational_Semantics.html">Denotational_Semantics</a>"</span>
  <span class="quoted">"<a href="Static_Semantics.html">Static_Semantics</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL/Finite_Set.html">HOL.Finite_Set</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Static Semantics Properties›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="plain_text">Auxiliaries</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The state interpolating <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>stateinterpol ν ω S›</span></span></span></span> between <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ν›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ω›</span></span></span></span> that is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ν›</span></span></span></span> on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ω›</span></span></span></span> elsewhere›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stateinterpol</span><span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> state <span class="main">⇒</span> variable set <span class="main">⇒</span> state"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stateinterpol</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">statediff</span><span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> state <span class="main">⇒</span> variable set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">statediff</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nostatediff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∉</span>statediff <span class="free">ν</span> <span class="free">ω</span> <span class="main">⟹</span> <span class="free">ν</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">=</span><span class="free">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> statediff_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> stateinterpol_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"stateinterpol <span class="free">ν</span> <span class="free">ω</span> <span class="main">{}</span> <span class="main">=</span> <span class="free">ω</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="bound">x</span><span class="main">∈</span><span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> stateinterpol <span class="free">ν</span> <span class="free">ω</span> <span class="main">{}</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ω</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> empty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateinterpol_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stateinterpol_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span>stateinterpol <span class="free">ν</span> <span class="free">ω</span> <span class="free">S</span><span class="main">)</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">=</span><span class="free">ν</span><span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateinterpol_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> stateinterpol_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∉</span><span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span>stateinterpol <span class="free">ν</span> <span class="free">ω</span> <span class="free">S</span><span class="main">)</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">=</span><span class="free">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateinterpol_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_stateinterpol <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="main">(</span>stateinterpol <span class="free">ν</span> <span class="free">ω</span> <span class="free">S</span><span class="main">)</span> <span class="free">ν</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Vagree <span class="main">(</span>stateinterpol <span class="free">ν</span> <span class="free">ω</span> <span class="free">S</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span><span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Vagree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_ror<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="main">(</span><span class="free">V</span><span class="main">∩</span><span class="free">W</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ω</span><span class="main">.</span> <span class="main">(</span>Vagree <span class="free">ν</span> <span class="bound">ω</span> <span class="free">V</span> <span class="main">∧</span> Vagree <span class="bound">ω</span> <span class="free">ν'</span> <span class="free">W</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ν'</span> <span class="main">(</span><span class="free">V</span><span class="main">∩</span><span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">V</span><span class="main">∩</span><span class="free">W</span> <span class="main">⟶</span> <span class="free">ν</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">=</span><span class="free">ν'</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"stateinterpol <span class="free">ν</span> <span class="free">ν'</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="var">?w</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="var">?w</span> <span class="free">ν'</span> <span class="free">W</span> <span class="main">∧</span> Vagree <span class="var">?w</span> <span class="free">ν'</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def stateinterpol_def <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">V</span><span class="main">∩</span><span class="free">W</span> <span class="main">⟶</span> <span class="free">ν</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ν'</span> <span class="bound">x</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="var">?w</span> <span class="free">V</span> <span class="main">∧</span> Vagree <span class="var">?w</span> <span class="free">ν'</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword2"><span class="keyword">and</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Remark 8 <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://doi.org/10.1007/978-3-319-94205-6_15›</span></span> about simple properties of projections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> restrictto_extends <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"restrictto <span class="free">X</span> <span class="free">V</span> <span class="main">⊇</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrictto_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> restrictto_compose <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"restrictto <span class="main">(</span>restrictto <span class="free">X</span> <span class="free">V</span><span class="main">)</span> <span class="free">W</span> <span class="main">=</span> restrictto <span class="free">X</span> <span class="main">(</span><span class="free">V</span><span class="main">∩</span><span class="free">W</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"restrictto <span class="main">(</span>restrictto <span class="free">X</span> <span class="free">V</span><span class="main">)</span> <span class="free">W</span> <span class="main">⊆</span> restrictto <span class="free">X</span> <span class="main">(</span><span class="free">V</span><span class="main">∩</span><span class="free">W</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrictto_def Vagree_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"restrictto <span class="free">X</span> <span class="main">(</span><span class="free">V</span><span class="main">∩</span><span class="free">W</span><span class="main">)</span> <span class="main">⊆</span> restrictto <span class="main">(</span>restrictto <span class="free">X</span> <span class="free">V</span><span class="main">)</span> <span class="free">W</span>"</span></span> 
  <span class="comment1">(*by (smt Vagree_ror mem_Collect_eq restrictto_def subsetI)*)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(* sledgehammer *)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>variable <span class="main">⇒</span> real<span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span>variable <span class="main">⇒</span> real<span class="main">)</span> set <span class="main">⇒</span> variable <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v2</span><span class="main">.</span> <span class="bound">v2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="bound">v2</span> <span class="main">∉</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rr</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="skolem">rr</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∉</span> <span class="bound">x0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="bound">Fa</span><span class="main">.</span> <span class="skolem">rr</span> <span class="bound">Fa</span> <span class="bound">F</span> <span class="main">∈</span> <span class="bound">F</span> <span class="main">∧</span> <span class="skolem">rr</span> <span class="bound">Fa</span> <span class="bound">F</span> <span class="main">∉</span> <span class="bound">Fa</span> <span class="main">∨</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">Fa</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rra</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>variable <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> variable set <span class="main">⇒</span> <span class="main">(</span>variable <span class="main">⇒</span> real<span class="main">)</span> set <span class="main">⇒</span> variable <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v3</span><span class="main">.</span> <span class="bound">v3</span> <span class="main">∈</span> <span class="bound">x2</span> <span class="main">∧</span> Vagree <span class="bound">v3</span> <span class="bound">x0</span> <span class="bound">x1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rra</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x2</span> <span class="main">∧</span> Vagree <span class="main">(</span><span class="skolem">rra</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="bound">x0</span> <span class="bound">x1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="bound">V</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="bound">F</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">rra</span> <span class="bound">f</span> <span class="bound">V</span> <span class="bound">F</span> <span class="main">∈</span> <span class="bound">F</span> <span class="main">∧</span> Vagree <span class="main">(</span><span class="skolem">rra</span> <span class="bound">f</span> <span class="bound">V</span> <span class="bound">F</span><span class="main">)</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="bound">F</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∉</span> <span class="bound">F</span> <span class="main">∨</span> <span class="main">¬</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">f</span> <span class="main">(</span><span class="free">v4_1</span> <span class="free">W</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rra</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">f</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">rr</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> Vagree <span class="main">(</span><span class="skolem">rra</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span><span class="free">v4_1</span> <span class="free">W</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rra</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span> <span class="main">∨</span> <span class="main">¬</span> Vagree <span class="main">(</span><span class="free">v4_1</span> <span class="free">W</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rra</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="free">W</span><span class="main">)</span> <span class="main">∨</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="bound">fa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">V</span><span class="main">}</span> <span class="main">∧</span> Vagree <span class="bound">fa</span> <span class="bound">f</span> <span class="free">W</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Vagree_ror<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> restrictto_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> restrictto_antimon <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">⊇</span><span class="free">V</span> <span class="main">⟹</span> restrictto <span class="free">X</span> <span class="free">W</span> <span class="main">⊆</span> restrictto <span class="free">X</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">⊇</span><span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">U</span><span class="main">.</span> <span class="free">V</span><span class="main">=</span><span class="free">W</span><span class="main">∩</span><span class="bound">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">=</span><span class="free">W</span><span class="main">∩</span><span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"restrictto <span class="free">X</span> <span class="free">V</span> <span class="main">=</span> restrictto <span class="main">(</span>restrictto <span class="free">X</span> <span class="free">W</span><span class="main">)</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"restrictto <span class="free">X</span> <span class="free">V</span> <span class="main">⊇</span> restrictto <span class="free">X</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> restrictto_extends <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> restrictto_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> restrictto <span class="free">X</span> <span class="main">{}</span> <span class="main">=</span> worlds"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrictto_def worlds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_shrinks <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> selectlike_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_compose <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">V</span><span class="main">)</span> <span class="free">ν</span> <span class="free">W</span> <span class="main">=</span> selectlike <span class="free">X</span> <span class="free">ν</span> <span class="main">(</span><span class="free">V</span><span class="main">∪</span><span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> selectlike_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_antimon <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">⊇</span><span class="free">V</span> <span class="main">⟹</span> selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">W</span> <span class="main">⊆</span> selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> selectlike_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="free">X</span> <span class="free">ν</span> <span class="main">{}</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> selectlike_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">V</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν</span><span class="main">∈</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> selectlike_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_complement <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span><span class="main">-</span><span class="free">X</span><span class="main">)</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">⊆</span> <span class="main">-</span>selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> selectlike_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_union<span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span><span class="free">X</span><span class="main">∪</span><span class="free">Y</span><span class="main">)</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">=</span> selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">∪</span> selectlike <span class="free">Y</span> <span class="free">ν</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> selectlike_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span>Sup <span class="free">M</span><span class="main">)</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">=</span> Sup <span class="main">{</span>selectlike <span class="bound">X</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">|</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">X</span><span class="main">∈</span><span class="free">M</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> selectlike_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_equal_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">=</span> selectlike <span class="free">Y</span> <span class="free">ν</span> <span class="free">V</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">μ</span><span class="main">.</span> Uvariation <span class="bound">μ</span> <span class="free">ν</span> <span class="main">(</span><span class="main">-</span><span class="free">V</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">μ</span><span class="main">∈</span><span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">μ</span><span class="main">∈</span><span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> selectlike_def <span class="keyword1"><span class="command">using</span></span> Uvariation_Vagree <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_equal_cocond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ν</span> <span class="main">(</span><span class="main">-</span><span class="free">V</span><span class="main">)</span> <span class="main">=</span> selectlike <span class="free">Y</span> <span class="free">ν</span> <span class="main">(</span><span class="main">-</span><span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">μ</span><span class="main">.</span> Uvariation <span class="bound">μ</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">μ</span><span class="main">∈</span><span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">μ</span><span class="main">∈</span><span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> selectlike_equal_cond<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="free">V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_equal_cocond_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">μ</span><span class="main">.</span> Uvariation <span class="bound">μ</span> <span class="free">ν</span> <span class="main">(</span><span class="main">-</span><span class="free">V</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">μ</span><span class="main">∈</span><span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">μ</span><span class="main">∈</span><span class="free">Y</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">=</span> selectlike <span class="free">Y</span> <span class="free">ν</span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> selectlike_equal_cond<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="free">V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_equal_cocond_corule<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">μ</span><span class="main">.</span> Uvariation <span class="bound">μ</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">μ</span><span class="main">∈</span><span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">μ</span><span class="main">∈</span><span class="free">Y</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ν</span> <span class="main">(</span><span class="main">-</span><span class="free">V</span><span class="main">)</span> <span class="main">=</span> selectlike <span class="free">Y</span> <span class="free">ν</span> <span class="main">(</span><span class="main">-</span><span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> selectlike_equal_cond<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="free">V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> co_selectlike<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">V</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">X</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">ω</span><span class="main">.</span> <span class="main">¬</span>Vagree <span class="bound">ω</span> <span class="free">ν</span> <span class="free">V</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> selectlike_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_co_selectlike<span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span><span class="main">-</span><span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">=</span> selectlike <span class="main">(</span><span class="main">-</span><span class="free">X</span><span class="main">)</span> <span class="free">ν</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> selectlike_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> selectlike_Vagree<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ω</span> <span class="free">V</span> <span class="main">⟹</span> selectlike <span class="free">X</span> <span class="free">ν</span> <span class="free">V</span> <span class="main">=</span> selectlike <span class="free">X</span> <span class="free">ω</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Vagree_def selectlike_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

<span class="keyword1"><span class="command">lemma</span></span> similar_selectlike_mem<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ω</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ν</span><span class="main">∈</span>selectlike <span class="free">X</span> <span class="free">ω</span> <span class="free">V</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν</span><span class="main">∈</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> selectlike_def <span class="keyword1"><span class="command">using</span></span> Vagree_sym_rel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  

<span class="comment1">(* also see nonBVG_rule *)</span>
<span class="keyword1"><span class="command">lemma</span></span> BVG_nonelem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">∉</span>BVG <span class="free">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> BVG_elem monotone selectlike_shrinks
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subset_iff<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>statediff›</span></span></span></span> interoperability›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Vagree_statediff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ω</span> <span class="free">ω'</span> <span class="free">S</span> <span class="main">⟹</span> statediff <span class="free">ω</span> <span class="free">ω'</span> <span class="main">⊆</span> <span class="main">-</span><span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def statediff_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> stateinterpol_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"stateinterpol <span class="free">ν</span> <span class="free">ω</span> <span class="main">(</span>statediff <span class="free">ν</span> <span class="free">ω</span><span class="main">)</span> <span class="main">=</span> <span class="free">ν</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> sp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stateinterpol <span class="free">ν</span> <span class="free">ω</span> <span class="main">(</span>statediff <span class="free">ν</span> <span class="free">ω</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">ν</span><span class="main">(</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>statediff <span class="free">ν</span> <span class="free">ω</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateinterpol_def nostatediff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stateinterpol_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="main">(</span>stateinterpol <span class="free">v</span> <span class="free">w</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>stateinterpol <span class="free">v</span> <span class="free">w</span> <span class="main">(</span>insert <span class="free">z</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">z</span><span class="main">}</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def stateinterpol_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> stateinterpol_FVT <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∉</span>FVT<span class="main">(</span><span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> term_sem <span class="free">I</span> <span class="free">t</span> <span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="free">t</span> <span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="main">(</span>insert <span class="free">z</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∉</span>FVT<span class="main">(</span><span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fvc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> Vagree <span class="bound">v</span> <span class="bound">w</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">z</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>term_sem <span class="free">I</span> <span class="free">t</span> <span class="bound">v</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="free">t</span> <span class="bound">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FVT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="free">t</span> <span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="free">t</span> <span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="main">(</span>insert <span class="free">z</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fvc <span class="keyword2"><span class="keyword">and</span></span> stateinterpol_insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Coincidence Lemmas›</span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Coincidence for Terms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 10 <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://doi.org/10.1007/978-3-319-94205-6_15›</span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> coincidence_term<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ω</span> <span class="free">ω'</span> <span class="main">(</span>FVT <span class="free">θ</span><span class="main">)</span> <span class="main">⟹</span> term_sem <span class="free">I</span> <span class="free">θ</span> <span class="free">ω</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="free">θ</span> <span class="free">ω'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ω</span> <span class="free">ω'</span> <span class="main">(</span>FVT <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> isS<span class="main">:</span> <span class="quoted"><span class="quoted">"statediff <span class="free">ω</span> <span class="free">ω'</span> <span class="main">⊆</span> <span class="main">-</span>FVT<span class="main">(</span><span class="free">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword2"><span class="keyword">and</span></span> Vagree_statediff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> gen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">⊆</span><span class="main">-</span>FVT<span class="main">(</span><span class="free">θ</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>term_sem <span class="free">I</span> <span class="free">θ</span> <span class="free">ω'</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="free">θ</span> <span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">S</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateinterpol_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">z</span> <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> isS <span class="keyword1"><span class="command">have</span></span> finS<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>statediff <span class="free">ω</span> <span class="free">ω'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> allvars_finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FVT_finite UNIV_def finite_compl rev_finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> gen<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹statediff <span class="free">ω</span> <span class="free">ω'</span>›</span></span><span class="main">,</span> <span class="operator">OF</span> finS<span class="main">,</span> <span class="operator">OF</span> isS<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> coincidence_term_cor<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ω</span> <span class="free">ω'</span> <span class="free">U</span> <span class="main">⟹</span> <span class="main">(</span>FVT <span class="free">θ</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">=</span><span class="main">{}</span> <span class="main">⟹</span> term_sem <span class="free">I</span> <span class="free">θ</span> <span class="free">ω</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="free">θ</span> <span class="free">ω'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> coincidence_term Uvariation_Vagree
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vagree_antimon disjoint_eq_subset_Compl double_compl<span class="main">)</span>

  
<span class="keyword1"><span class="command">lemma</span></span> stateinterpol_FVF <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∉</span>FVF<span class="main">(</span><span class="free">e</span><span class="main">)</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="free">e</span> <span class="main">⟷</span> <span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="main">(</span>insert <span class="free">z</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∉</span>FVF<span class="main">(</span><span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> agr<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="main">(</span>insert <span class="free">z</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">z</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def stateinterpol_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fvc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="main">(</span>Vagree <span class="bound">v</span> <span class="bound">w</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">z</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">v</span><span class="main">∈</span>fml_sem <span class="free">I</span> <span class="free">e</span> <span class="main">⟹</span> <span class="bound">w</span><span class="main">∈</span>fml_sem <span class="free">I</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FVF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fvce<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="main">(</span>Vagree <span class="bound">v</span> <span class="bound">w</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">z</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="bound">v</span><span class="main">∈</span>fml_sem <span class="free">I</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">w</span><span class="main">∈</span>fml_sem <span class="free">I</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> Vagree_sym_rel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="free">e</span> <span class="main">⟷</span> <span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="main">(</span>insert <span class="free">z</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> agr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Coincidence for Formulas›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 11 <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://doi.org/10.1007/978-3-319-94205-6_15›</span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> coincidence_formula<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ω</span> <span class="free">ω'</span> <span class="main">(</span>FVF <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ω</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="free">φ</span> <span class="main">⟷</span> <span class="free">ω'</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ω</span> <span class="free">ω'</span> <span class="main">(</span>FVF <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> isS<span class="main">:</span> <span class="quoted"><span class="quoted">"statediff <span class="free">ω</span> <span class="free">ω'</span> <span class="main">⊆</span> <span class="main">-</span>FVF<span class="main">(</span><span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword2"><span class="keyword">and</span></span> Vagree_statediff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> gen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">⊆</span><span class="main">-</span>FVF<span class="main">(</span><span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ω'</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="free">φ</span> <span class="main">⟷</span> <span class="main">(</span>stateinterpol <span class="free">ω</span> <span class="free">ω'</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">S</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateinterpol_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">z</span> <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> isS <span class="keyword1"><span class="command">have</span></span> finS<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>statediff <span class="free">ω</span> <span class="free">ω'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> allvars_finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FVF_finite UNIV_def finite_compl rev_finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> gen<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹statediff <span class="free">ω</span> <span class="free">ω'</span>›</span></span><span class="main">,</span> <span class="operator">OF</span> finS<span class="main">,</span> <span class="operator">OF</span> isS<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> coincidence_formula_cor<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ω</span> <span class="free">ω'</span> <span class="free">U</span> <span class="main">⟹</span> <span class="main">(</span>FVF <span class="free">φ</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">=</span><span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ω</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="free">φ</span> <span class="main">⟷</span> <span class="free">ω'</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> coincidence_formula Uvariation_Vagree 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Uvariation_def disjoint_eq_subset_Compl inf.commute subsetCE<span class="main">)</span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Coincidence for Games›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Cignorabimus α V›</span></span></span></span> is the set of all sets of variables that can be ignored for the coincidence game lemma›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Cignorabimus</span><span class="main">::</span> <span class="quoted"><span class="quoted">"game <span class="main">⇒</span> variable set <span class="main">⇒</span> variable set set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Cignorabimus</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">I</span><span class="main">.</span><span class="main">∀</span><span class="bound">ω</span><span class="main">.</span><span class="main">∀</span><span class="bound">ω'</span><span class="main">.</span><span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span>Vagree <span class="bound">ω</span> <span class="bound">ω'</span> <span class="main">(</span><span class="main">-</span><span class="bound">M</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">(</span>restrictto <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">ω'</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">(</span>restrictto <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Cignorabimus_finite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Cignorabimus <span class="free">α</span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Cignorabimus_def <span class="keyword1"><span class="command">using</span></span> finite_powerset<span class="main">[</span><span class="operator">OF</span> allvars_finite<span class="main">]</span> finite_subset <span class="keyword1"><span class="command">using</span></span> Finite_Set.finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 

<span class="keyword1"><span class="command">lemma</span></span> Cignorabimus_equiv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Cignorabimus <span class="free">α</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">I</span><span class="main">.</span><span class="main">∀</span><span class="bound">ω</span><span class="main">.</span><span class="main">∀</span><span class="bound">ω'</span><span class="main">.</span><span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span>Vagree <span class="bound">ω</span> <span class="bound">ω'</span> <span class="main">(</span><span class="main">-</span><span class="bound">M</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="bound">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ω'</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="bound">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Cignorabimus_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Vagree_sym_rel<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Cignorabimus_antimon <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∈</span> Cignorabimus <span class="free">α</span> <span class="free">V</span> <span class="main">∧</span> <span class="free">N</span><span class="main">⊆</span><span class="free">M</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main">∈</span> Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Cignorabimus_def
  <span class="keyword1"><span class="command">using</span></span> Vagree_antimon <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">lemma</span></span> coempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">{}</span><span class="main">=</span>allvars"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Cignorabimus_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Cignorabimus_def <span class="keyword1"><span class="command">using</span></span> coempty Vagree_univ
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Cignorabimus contains nonfree variables›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Cignorabimus_init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">⊇</span>FVG<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">∉</span><span class="free">V</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">⊇</span>FVG<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∉</span><span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∉</span>FVG<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹FVG <span class="free">α</span> <span class="main">⊆</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> Vagree <span class="bound">v</span> <span class="bound">w</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">v</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="free">X</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="bound">w</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="free">X</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectI FVG_def Vagree_sym_rel<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">ω</span> <span class="skolem">ω'</span> <span class="skolem">X</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Vagree <span class="skolem">ω</span> <span class="skolem">ω'</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">ω</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">ω'</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="skolem">ω</span> <span class="skolem">ω'</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ω</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">ω'</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_absorb2 <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">∉</span><span class="free">V</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω'</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FVG_def a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω'</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="main">(</span><span class="free">V</span><span class="main">∩</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω'</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a0
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb2 <span class="quoted"><span class="quoted">‹<span class="skolem">ω'</span> <span class="main">∈</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>›</span></span> subset_Compl_singleton<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Cignorabimus_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Cignorabimus is closed under union›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Cignorabimus_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">N</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">M</span><span class="main">∪</span><span class="free">N</span><span class="main">)</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main">∪</span><span class="free">N</span><span class="main">)</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span> <span class="comment1">(*using a1 a2 unfolding Cignorabimus_def *)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">ω</span> <span class="skolem">ω'</span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="skolem">ω</span> <span class="skolem">ω'</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">M</span><span class="main">∪</span><span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">ω'</span><span class="main">.</span><span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span>Vagree <span class="bound">ω</span> <span class="bound">ω'</span> <span class="main">(</span><span class="main">-</span><span class="free">M</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="bound">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">ω'</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="bound">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">ω'</span><span class="main">.</span><span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span>Vagree <span class="bound">ω</span> <span class="bound">ω'</span> <span class="main">(</span><span class="main">-</span><span class="free">N</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="bound">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">ω'</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="bound">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"stateinterpol <span class="skolem">ω'</span> <span class="skolem">ω</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="skolem">ω</span> <span class="var">?s</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">M</span><span class="main">∪</span><span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="var">?s</span> <span class="skolem">ω'</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">M</span><span class="main">∪</span><span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vagree_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?s</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ComplD Vagree_def h1 stateinterpol_right<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">ω'</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vagree_ror compl_sup h1 h2 v2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">ω'</span><span class="main">∈</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="skolem">X</span> <span class="free">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r1 r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Cignorabimus_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> powersetup_induct <span class="main">[</span><span class="operator">case_names</span> Base Cup<span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span><span class="main">∈</span><span class="bound">C</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">M</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span><span class="main">∈</span><span class="bound">S</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">M</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
     <span class="free">P</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Union_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>insert <span class="free">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">∪</span><span class="main">⋃</span><span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> powerset2up_induct <span class="main">[</span><span class="operator">case_names</span> Finite Nonempty Base Cup<span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">C</span><span class="main">≠</span><span class="main">{}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span><span class="main">∈</span><span class="free">C</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">M</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">M</span> <span class="bound">N</span><span class="main">.</span> <span class="free">P</span> <span class="bound">M</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">N</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">M</span><span class="main">∪</span><span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
     <span class="free">P</span> <span class="main">(</span><span class="main">⋃</span><span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Cignorabimus_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span><span class="main">∈</span><span class="free">S</span> <span class="main">⟹</span> <span class="bound">M</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cignorabimus_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> nonem<span class="main">:</span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="skolem">S</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span><span class="main">∈</span><span class="skolem">S</span> <span class="main">⟹</span> <span class="bound">M</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nonemp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> powerset2up_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Finite                                                   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cignorabimus_finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> infinite_super subset_eq that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Nonempty
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> nonemp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Base <span class="skolem">M</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cup <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> that Cignorabimus_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 12 <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://doi.org/10.1007/978-3-319-94205-6_15›</span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> coincidence_game<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ω</span> <span class="free">ω'</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">V</span><span class="main">⊇</span>FVG<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ω</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="free">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ω'</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="free">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ω</span> <span class="free">ω'</span> <span class="free">V</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊇</span> FVG <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="skolem">V</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="skolem">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊇</span> FVG <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">V</span>
    <span class="keyword1"><span class="command">using</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> Cignorabimus_init <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">V</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="bound">xx</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">xx</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∉</span><span class="free">V</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="comment1">(* finite *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">V</span><span class="main">)</span><span class="main">∈</span>Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 base h <span class="keyword1"><span class="command">using</span></span> Cignorabimus_step
  <span class="comment1">(*by (smt Cignorabimus_step mem_Collect_eq)*)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">V</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∨</span> <span class="main">¬</span> FVG <span class="free">α</span> <span class="main">⊆</span> <span class="bound">V</span> <span class="main">∨</span> <span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">∈</span> Cignorabimus <span class="free">α</span> <span class="bound">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> base <span class="keyword1"><span class="command">by</span></span> <span class="operator">satx</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">VV</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"variable set <span class="main">⇒</span> game <span class="main">⇒</span> variable set set <span class="main">⇒</span> variable set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v3</span><span class="main">.</span> <span class="bound">v3</span> <span class="main">∈</span> <span class="bound">x2</span> <span class="main">∧</span> <span class="bound">v3</span> <span class="main">∉</span> Cignorabimus <span class="bound">x1</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">VV</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x2</span> <span class="main">∧</span> <span class="skolem">VV</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">∉</span> Cignorabimus <span class="bound">x1</span> <span class="bound">x0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vv</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"variable set <span class="main">⇒</span> variable"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∄</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">vv</span> <span class="main">(</span><span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">vv</span> <span class="main">(</span><span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span><span class="main">)</span> <span class="main">∉</span> <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">vv</span> <span class="main">(</span><span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="skolem">vv</span> <span class="main">(</span><span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span><span class="main">)</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">vv</span> <span class="main">(</span><span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">∉</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">∈</span> Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">∉</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">∈</span> Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">∉</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">VV</span> <span class="free">V</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">∈</span> Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span><span class="main">}</span> <span class="main">∈</span> Cignorabimus <span class="free">α</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Cignorabimus_step<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> coincidence_game_cor<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ω</span> <span class="free">ω'</span> <span class="free">U</span> <span class="main">⟹</span> <span class="free">U</span><span class="main">∩</span>FVG<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ω</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="free">X</span> <span class="main">(</span><span class="main">-</span><span class="free">U</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ω'</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>restrictto <span class="free">X</span> <span class="main">(</span><span class="main">-</span><span class="free">U</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> coincidence_game Uvariation_Vagree 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Uvariation_Vagree coincidence_game compl_le_swap1 disjoint_eq_subset_Compl double_compl<span class="main">)</span>

  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bound Effect Lemmas›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Bignorabimus α V›</span></span></span></span> is the set of all sets of variables that can be ignored for boundeffect›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Bignorabimus</span><span class="main">::</span> <span class="quoted"><span class="quoted">"game <span class="main">⇒</span> variable set set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Bignorabimus</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">I</span><span class="main">.</span><span class="main">∀</span><span class="bound">ω</span><span class="main">.</span><span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="bound">X</span> <span class="main">⟷</span> <span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="bound">M</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Bignorabimus_finite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Bignorabimus <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Bignorabimus_def <span class="keyword1"><span class="command">using</span></span> finite_powerset<span class="main">[</span><span class="operator">OF</span> allvars_finite<span class="main">]</span> finite_subset <span class="keyword1"><span class="command">using</span></span> Finite_Set.finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 

<span class="keyword1"><span class="command">lemma</span></span> Bignorabimus_single <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ω</span> <span class="free">M</span><span class="main">)</span> <span class="main">⊆</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> monotone selectlike_shrinks subsetCE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Bignorabimus_equiv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Bignorabimus <span class="free">α</span> <span class="main">=</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">I</span><span class="main">.</span><span class="main">∀</span><span class="bound">ω</span><span class="main">.</span><span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="bound">M</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="comment1">(*by (smt Bignorabimus_def Bignorabimus_single Collect_cong subsetCE)*)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer transformed*)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">VV</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>variable set <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>variable set <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> variable set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">pa</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="bound">p</span> <span class="main">(</span><span class="skolem">VV</span> <span class="bound">pa</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">pa</span> <span class="main">(</span><span class="skolem">VV</span> <span class="bound">pa</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∨</span> Collect <span class="bound">p</span> <span class="main">=</span> Collect <span class="bound">pa</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Collect_cong<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"variable set <span class="main">⇒</span> game <span class="main">⇒</span> variable <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ii</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"variable set <span class="main">⇒</span> game <span class="main">⇒</span> interp"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">FF</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"variable set <span class="main">⇒</span> game <span class="main">⇒</span> <span class="main">(</span>variable <span class="main">⇒</span> real<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v2</span> <span class="bound">v3</span> <span class="bound">v4</span><span class="main">.</span> <span class="main">(</span><span class="bound">v3</span> <span class="main">∈</span> game_sem <span class="bound">v2</span> <span class="bound">x1</span> <span class="bound">v4</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="bound">v3</span> <span class="main">∈</span> game_sem <span class="bound">v2</span> <span class="bound">x1</span> <span class="main">(</span>selectlike <span class="bound">v4</span> <span class="bound">v3</span> <span class="bound">x0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rr</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∈</span> game_sem <span class="main">(</span><span class="skolem">ii</span> <span class="bound">x0</span> <span class="bound">x1</span><span class="main">)</span> <span class="bound">x1</span> <span class="main">(</span><span class="skolem">FF</span> <span class="bound">x0</span> <span class="bound">x1</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">rr</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∈</span> game_sem <span class="main">(</span><span class="skolem">ii</span> <span class="bound">x0</span> <span class="bound">x1</span><span class="main">)</span> <span class="bound">x1</span> <span class="main">(</span>selectlike <span class="main">(</span><span class="skolem">FF</span> <span class="bound">x0</span> <span class="bound">x1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rr</span> <span class="bound">x0</span> <span class="bound">x1</span><span class="main">)</span> <span class="bound">x0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">have</span></span> fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Bignorabimus_single subsetCE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span> <span class="main">∉</span> game_sem <span class="main">(</span><span class="skolem">ii</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="main">(</span><span class="skolem">FF</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">rr</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span> <span class="main">∈</span> game_sem <span class="main">(</span><span class="skolem">ii</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="free">α</span> <span class="main">(</span><span class="skolem">FF</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Bignorabimus_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span> <span class="main">∉</span> game_sem <span class="main">(</span><span class="skolem">ii</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="free">α</span> <span class="main">(</span><span class="skolem">FF</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span> <span class="main">∈</span> game_sem <span class="main">(</span><span class="skolem">ii</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="main">(</span><span class="skolem">FF</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span> <span class="main">∈</span> game_sem <span class="main">(</span><span class="skolem">ii</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="free">α</span> <span class="main">(</span><span class="skolem">FF</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∉</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">rr</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span> <span class="main">∈</span> game_sem <span class="main">(</span><span class="skolem">ii</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="main">(</span><span class="skolem">FF</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∉</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fact <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">satx</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">VV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fact <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> game_sem <span class="bound">i</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">F</span> <span class="bound">f</span> <span class="bound">V</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f4 f3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">satx</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Bignorabimus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> Bignorabimus_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> Bignorabimus <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Bignorabimus_def <span class="keyword1"><span class="command">using</span></span> coempty selectlike_empty
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Bignorabimus_init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∉</span>BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">∈</span>Bignorabimus <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Bignorabimus_def BVG_def
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">ω</span> <span class="main">∉</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">ω</span> <span class="main">∉</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bignorabimus_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="bound">M</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Bignorabimus is closed under union›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Bignorabimus_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span><span class="main">∈</span>Bignorabimus <span class="free">α</span> <span class="main">⟹</span> <span class="free">N</span><span class="main">∈</span>Bignorabimus <span class="free">α</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">M</span><span class="main">∪</span><span class="free">N</span><span class="main">)</span><span class="main">∈</span>Bignorabimus <span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span><span class="main">∈</span>Bignorabimus <span class="free">α</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">∈</span>Bignorabimus <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">I</span><span class="main">.</span><span class="main">∀</span><span class="bound">ω</span><span class="main">.</span><span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a1
    <span class="keyword1"><span class="command">using</span></span> Bignorabimus_equiv Bignorabimus_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">I</span><span class="main">.</span><span class="main">∀</span><span class="bound">ω</span><span class="main">.</span><span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2
    <span class="keyword1"><span class="command">using</span></span> Bignorabimus_equiv Bignorabimus_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">I</span><span class="main">.</span><span class="main">∀</span><span class="bound">ω</span><span class="main">.</span><span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">ω</span><span class="main">∈</span>game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">(</span><span class="free">M</span><span class="main">∪</span><span class="free">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> h1 h2 selectlike_compose<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main">∪</span><span class="free">N</span><span class="main">)</span><span class="main">∈</span>Bignorabimus <span class="free">α</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bignorabimus_def <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Bignorabimus_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span><span class="main">∈</span><span class="free">S</span> <span class="main">⟹</span> <span class="bound">M</span><span class="main">∈</span>Bignorabimus <span class="free">α</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span><span class="main">∈</span>Bignorabimus <span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Bignorabimus_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> nonem<span class="main">:</span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="skolem">S</span><span class="main">∈</span>Bignorabimus <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span><span class="main">∈</span><span class="skolem">S</span> <span class="main">⟹</span> <span class="bound">M</span><span class="main">∈</span>Bignorabimus <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nonemp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> powerset2up_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Finite
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Bignorabimus_finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> infinite_super subset_eq that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Nonempty
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> nonemp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Base <span class="skolem">M</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cup <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> that Bignorabimus_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 13 <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://doi.org/10.1007/978-3-319-94205-6_15›</span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> boundeffect<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ω</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ω</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">∈</span>Bignorabimus <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span>BVG <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> Bignorabimus_init <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>BVG <span class="free">α</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="bound">xx</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">xx</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∉</span>BVG <span class="free">α</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="comment1">(* finite *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span>BVG <span class="free">α</span><span class="main">)</span><span class="main">∈</span>Bignorabimus <span class="free">α</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> base h
  <span class="comment1">(*by (smt Bignorabimus_step mem_Collect_eq)*)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">VV</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"game <span class="main">⇒</span> variable set set <span class="main">⇒</span> variable set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v2</span><span class="main">.</span> <span class="bound">v2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="bound">v2</span> <span class="main">∉</span> Bignorabimus <span class="bound">x0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">VV</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="skolem">VV</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∉</span> Bignorabimus <span class="bound">x0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">VV</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> BVG <span class="free">α</span><span class="main">}</span> <span class="main">∉</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> BVG <span class="free">α</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">VV</span> <span class="free">α</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> BVG <span class="free">α</span><span class="main">}</span> <span class="main">∈</span> Bignorabimus <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> BVG <span class="free">α</span><span class="main">}</span> <span class="main">∈</span> Bignorabimus <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Bignorabimus_step<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Bignorabimus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> boundeffect_cor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">∩</span>BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ω</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ω</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ω</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> boundeffect
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_eq_subset_Compl selectlike_compose sup.absorb_iff2<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Static Analysis Observations›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> BVG_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"game_equiv <span class="free">α</span> <span class="free">β</span> <span class="main">⟹</span> BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">=</span> BVG<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"game_equiv <span class="free">α</span> <span class="free">β</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">=</span> BVG<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> BVG_def <span class="keyword1"><span class="command">using</span></span> game_equiv_subst_eq<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> union_or <span class="main">=</span> Set.Un_iff

<span class="keyword1"><span class="command">lemma</span></span> not_union_or<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">∉</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">∉</span><span class="free">A</span> <span class="main">∧</span> <span class="free">x</span><span class="main">∉</span><span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> repv_selectlike_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span> <span class="main">∈</span> selectlike <span class="free">X</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span><span class="main">=</span><span class="free">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">ω</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> selectlike_def <span class="keyword1"><span class="command">using</span></span> Vagree_repv_self Vagree_sym
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq repv_self<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> repv_selectlike_other<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span> <span class="main">∈</span> selectlike <span class="free">X</span> <span class="free">ω</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">⊆</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span> <span class="main">∈</span> selectlike <span class="free">X</span> <span class="free">ω</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a selectlike_def Vagree_repv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ω</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">d</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span> <span class="main">∈</span> selectlike <span class="free">X</span> <span class="free">ω</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> selectlike_def<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ω</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span>›</span></span><span class="main">]</span> Vagree_repv<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ω<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ω</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span><span class="main">]</span>
  selectlike_antimon<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ω</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">y</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> W<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span>›</span></span><span class="main">,</span> <span class="operator">OF</span> h<span class="main">]</span> Vagree_sym<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> repv_selectlike_other_converse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>repv <span class="free">ω</span> <span class="free">x</span> <span class="free">d</span> <span class="main">∈</span> selectlike <span class="free">X</span> <span class="free">ω</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> repv_selectlike_other HOL.eq_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> BVG_assign_other<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span><span class="main">∉</span>BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> repv_selectlike_other_converse<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> BVG_assign_meta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">I</span> <span class="bound">ω</span><span class="main">.</span> term_sem <span class="bound">I</span> <span class="free">θ</span> <span class="bound">ω</span> <span class="main">=</span> <span class="bound">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="free">θ</span> <span class="free">ω</span> <span class="main">≠</span> <span class="free">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="comment1">(*using repv_selectlike_self BVG_assign_other BVG_def BVG_elem*)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fact<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BVG_assign_other <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> singleton_iff subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fact <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">I</span> <span class="bound">ω</span><span class="main">.</span> term_sem <span class="bound">I</span> <span class="free">θ</span> <span class="bound">ω</span> <span class="main">=</span> <span class="bound">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BVG_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">I</span> <span class="bound">ω</span><span class="main">.</span> term_sem <span class="bound">I</span> <span class="free">θ</span> <span class="bound">ω</span> <span class="main">≠</span> <span class="bound">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> repv_selectlike_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fact <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="free">θ</span> <span class="free">ω</span> <span class="main">≠</span> <span class="free">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BVG_elem h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> BVG_assign<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span> <span class="bound">ω</span><span class="main">.</span> term_sem <span class="bound">I</span> <span class="free">θ</span> <span class="bound">ω</span> <span class="main">=</span> <span class="bound">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> repv_selectlike_self repv_selectlike_other BVG_assign_other 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BVG_assign_other <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> singletonI subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">I</span> <span class="bound">ω</span><span class="main">.</span> term_sem <span class="bound">I</span> <span class="free">θ</span> <span class="bound">ω</span> <span class="main">=</span> <span class="bound">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BVG_assign_other <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">I</span> <span class="bound">ω</span><span class="main">.</span> term_sem <span class="bound">I</span> <span class="free">θ</span> <span class="bound">ω</span> <span class="main">≠</span> <span class="bound">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> repv_selectlike_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">I</span> <span class="bound">ω</span><span class="main">.</span> term_sem <span class="bound">I</span> <span class="free">θ</span> <span class="bound">ω</span> <span class="main">≠</span> <span class="bound">ω</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> c1 <span class="keyword2"><span class="keyword">and</span></span> c2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> BVG_ODE_other<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">≠</span>RVar <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span><span class="main">≠</span>DVar <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span><span class="main">∉</span>BVG<span class="main">(</span>ODE <span class="free">x</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="comment1">(*using nonBVG_rule selectlike_equal_cocond_rule solves_ODE_def*)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">≠</span>RVar <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> yxp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">≠</span>DVar <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∉</span>BVG<span class="main">(</span>ODE <span class="free">x</span> <span class="free">θ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nonBVG_inc_rule<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">ω</span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∈</span> game_sem <span class="skolem">I</span> <span class="main">(</span>ODE <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F</span> <span class="bound">T</span><span class="main">.</span> Vagree <span class="skolem">ω</span> <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">(</span><span class="bound">T</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> solves_ODE <span class="skolem">I</span> <span class="bound">F</span> <span class="free">x</span> <span class="free">θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Vagree <span class="skolem">ω</span> <span class="main">(</span><span class="skolem">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">F</span><span class="main">(</span><span class="skolem">T</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> solves_ODE <span class="skolem">I</span> <span class="skolem">F</span> <span class="free">x</span> <span class="free">θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Vagree <span class="skolem">ω</span> <span class="main">(</span><span class="skolem">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">F</span><span class="main">(</span><span class="skolem">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> solves_ODE <span class="skolem">I</span> <span class="skolem">F</span> <span class="free">x</span> <span class="free">θ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> yx yxp solves_Vagree Vagree_def similar_selectlike_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F</span> <span class="bound">T</span><span class="main">.</span> Vagree <span class="skolem">ω</span> <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">(</span><span class="bound">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> solves_ODE <span class="skolem">I</span> <span class="bound">F</span> <span class="free">x</span> <span class="free">θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∈</span> game_sem <span class="skolem">I</span> <span class="main">(</span>ODE <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This result could be strengthened to a conditional equality based on the RHS values›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> BVG_ODE<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>ODE <span class="free">x</span> <span class="free">θ</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> BVG_ODE_other <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> BVG_test<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>Test <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> BVG_def game_sem.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> BVG_choice<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>Choice <span class="free">α</span> <span class="free">β</span><span class="main">)</span> <span class="main">⊆</span> BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">∪</span> BVG<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> BVG_def game_sem.simps <span class="keyword1"><span class="command">using</span></span> not_union_or <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="comment1">(*proof-
  have f1: "⋀ω I X. (ω ∈ game_sem I α X ∪ game_sem I β X) = 
  (ω ∈ game_sem I α X ∨ ω ∈ game_sem I β X)" by (rule union_or)
  have f2: "⋀ω I X. (ω ∉ game_sem I α (selectlike X ω {x}) ∪ game_sem I β (selectlike X ω {x})) =
  (ω ∉ game_sem I α (selectlike X ω {x}) ∧ ω ∉ game_sem I β (selectlike X ω {x}))" by (rule not_union_or)
  let ?lhs = "{x. ∃I ω X.
           ω ∈ game_sem I α X ∪ game_sem I β X ∧
           ω ∉ game_sem I α (selectlike X ω {x}) ∪ game_sem I β (selectlike X ω {x})}"
  let ?rhs = "{x. ∃I ω X. ω ∈ game_sem I α X ∧ ω ∉ game_sem I α (selectlike X ω {x})} ∪
       {x. ∃I ω X. ω ∈ game_sem I β X ∧ ω ∉ game_sem I β (selectlike X ω {x})}"
  show "?lhs⊆?rhs" using f1 f2 by auto
qed*)</span>

<span class="keyword1"><span class="command">lemma</span></span> select_nonBV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∉</span>BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">⟹</span> selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span><span class="main">)</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span><span class="main">)</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> game_sem_mono selectlike_shrinks selectlike_antimon Bignorabimus_single
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> selectlike_union sup.absorb_iff1<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nonbound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∉</span>BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">∩</span>BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span><span class="main">)</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">μ</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">∈</span> selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="free">X</span><span class="main">)</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="comment1">(* "V∩BVG(α)={} ⟹ (ω ∈ game_sem I α X) = (ω ∈ game_sem I α (selectlike X ω V))" *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">∈</span> selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="free">X</span> <span class="skolem">μ</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boundeffect_cor<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ω<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">μ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="free">x</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> α<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">α</span></span><span class="main">,</span> <span class="operator">OF</span> fact<span class="main">]</span> nonbound
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ComplD ComplI co_selectlike not_union_or<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">∈</span> selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="free">X</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">ω</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> selectlike_Vagree selectlike_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> BVG_compose<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>Compose <span class="free">α</span> <span class="free">β</span><span class="main">)</span> <span class="main">⊆</span> BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">∪</span> BVG<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
  <span class="comment1">(*unfolding BVG_def game_sem.simps using game_union union_or not_union_or selectlike_shrinks monotone selectlike_compose*)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>BVG<span class="main">(</span>Compose <span class="free">α</span> <span class="free">β</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> BVG <span class="free">α</span> <span class="main">∪</span> BVG <span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span>BVG <span class="free">α</span> <span class="main">∪</span> BVG<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nβ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span>BVG<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nα<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span>BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">I</span><span class="main">.</span><span class="main">∃</span><span class="bound">ω</span><span class="main">.</span><span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="main">(</span>Compose <span class="free">α</span> <span class="free">β</span><span class="main">)</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">ω</span> <span class="main">∉</span> game_sem <span class="bound">I</span> <span class="main">(</span>Compose <span class="free">α</span> <span class="free">β</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="skolem"><span class="skolem">ω</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> adef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∈</span> game_sem <span class="skolem">I</span> <span class="main">(</span>Compose <span class="free">α</span> <span class="free">β</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="skolem">ω</span> <span class="main">∉</span> game_sem <span class="skolem">I</span> <span class="main">(</span>Compose <span class="free">α</span> <span class="free">β</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> adef <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∈</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>game_sem <span class="skolem">I</span> <span class="free">β</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> adef <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∉</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>game_sem <span class="skolem">I</span> <span class="free">β</span> <span class="main">(</span>selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> nα <span class="keyword1"><span class="command">have</span></span> nαc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BVG_nonelem <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> nβ <span class="keyword1"><span class="command">have</span></span> nβc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">β</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">β</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BVG_nonelem <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∈</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="main">(</span>game_sem <span class="skolem">I</span> <span class="free">β</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a1 nαc<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ω<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ω</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹game_sem <span class="skolem">I</span> <span class="free">β</span> <span class="skolem">X</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∉</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="main">(</span>game_sem <span class="skolem">I</span> <span class="free">β</span> <span class="var">?Y</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 nαc<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ω<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ω</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹game_sem <span class="skolem">I</span> <span class="free">β</span> <span class="var">?Y</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> c2 <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∉</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="main">(</span>game_sem <span class="skolem">I</span> <span class="free">β</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nβ selectlike_Vagree
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span>game_sem <span class="skolem">I</span> <span class="free">β</span> <span class="var">?Y</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> selectlike <span class="main">(</span>game_sem <span class="skolem">I</span> <span class="free">β</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nβ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> select_nonBV<span class="main">)</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 c3 nβc<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">I</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The converse inclusion does not hold generally, because
   <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>BVG(x := x+1; x:= x-1) = {} ≠ BVG(x := x+1) ∪ BVG(x := x-1) = {x}›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>Compose <span class="main">(</span>Assign <span class="free">x</span> <span class="main">(</span>Plus <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Assign <span class="free">x</span> <span class="main">(</span>Plus <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">≠</span> BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="main">(</span>Plus <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> BVG<span class="main">(</span>Assign <span class="free">x</span> <span class="main">(</span>Plus <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> BVG_def selectlike_def repv_def Vagree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> BVG_loop<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="main">⊆</span> BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>BVG<span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nα<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span>BVG <span class="free">α</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> nα <span class="keyword1"><span class="command">have</span></span> nαc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BVG_nonelem <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span>BVG<span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span>"</span></span> <span class="comment1">(*using BVG_nonelem*)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nonBVG_rule<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">ω</span> <span class="skolem">X</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">Z</span><span class="main">.</span> <span class="skolem">X</span> <span class="main">∪</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="bound">Z</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span>selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="bound">Y</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">Z</span> <span class="bound">Y</span><span class="main">.</span> selectlike <span class="bound">Z</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> selectlike <span class="bound">Y</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">(</span>lfp <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>lfp <span class="var">?g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lfp_lockstep_induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="var"><span class="var">?f</span></span>›</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="var"><span class="var">?g</span></span>›</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> R<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="var"><span class="var">?R</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> monof
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> game_sem_loop_fixpoint_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> monog
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> game_sem_loop_fixpoint_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="skolem">A</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> selectlike <span class="skolem">B</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="comment1">(* using selectlike_union nα select_nonBV IH by (smt insert_absorb2 insert_def selectlike_compose singleton_conv smt_solver=cvc4)  *)</span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="skolem">A</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> selectlike <span class="main">(</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="skolem">A</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> selectlike_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> selectlike <span class="main">(</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="skolem">A</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nα select_nonBV <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> selectlike <span class="main">(</span>game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="skolem">B</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> selectlike <span class="main">(</span>selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="skolem">B</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> selectlike_union nα select_nonBV <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="skolem">A</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> selectlike <span class="main">(</span>selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="skolem">B</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>union <span class="skolem">M</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span><span class="main">∈</span><span class="skolem">M</span><span class="main">.</span> selectlike <span class="bound">A</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> selectlike <span class="bound">B</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> fst_proj_mem<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> M<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">M</span></span><span class="main">]</span> snd_proj_mem<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> M<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">M</span></span><span class="main">]</span> 
        selectlike_Sup<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ω</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>›</span></span><span class="main">]</span> sup_corr_eq_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="comment1">(*proof-
          have "selectlike (⋃fst_proj M) ω {x} = ⋃{selectlike A ω {x} | A. A∈fst_proj M}" using selectlike_Sup by simp
          also have "... = ⋃{selectlike B ω {x} | B. B∈snd_proj M}" using sup_corr_eq_chain[OF IH] by simp
          also have "... = selectlike (⋃snd_proj M) ω {x}" using selectlike_Sup by simp
          finally show "selectlike (⋃fst_proj M) ω {x} = selectlike (⋃snd_proj M) ω {x}" .
        qed*)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ω</span> <span class="main">∈</span> game_sem <span class="skolem">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ω</span> <span class="main">∈</span> game_sem <span class="skolem">I</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> game_sem.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> lfp_def selectlike_self<span class="main">)</span> 
      <span class="comment1">(*by (simp add: selectlike_self game_sem_loop_back)*)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> BVG_dual<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>Dual <span class="free">α</span><span class="main">)</span> <span class="main">⊆</span> BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="comment1">(*unfolding game_sem.simps using BVG_elem selectlike_co_selectlike co_selectlike selectlike_complement selectlike_antimon*)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>BVG<span class="main">(</span>Dual <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>BVG <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">I</span><span class="main">.</span><span class="main">∃</span><span class="bound">ω</span><span class="main">.</span><span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="bound">ω</span> <span class="main">∈</span> game_sem <span class="bound">I</span> <span class="main">(</span>Dual <span class="free">α</span><span class="main">)</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">ω</span> <span class="main">∉</span> game_sem <span class="bound">I</span> <span class="main">(</span>Dual <span class="free">α</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="bound">X</span> <span class="bound">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="skolem"><span class="skolem">ω</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> adef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∈</span> game_sem <span class="skolem">I</span> <span class="main">(</span>Dual <span class="free">α</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="skolem">ω</span> <span class="main">∉</span> game_sem <span class="skolem">I</span> <span class="main">(</span>Dual <span class="free">α</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> adef <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∉</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> adef <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∈</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span><span class="main">-</span> selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> selectlike <span class="skolem">X</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∈</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="var">?Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> a2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∉</span> game_sem <span class="skolem">I</span> <span class="free">α</span> <span class="main">(</span>selectlike <span class="var">?Y</span> <span class="skolem">ω</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a1 selectlike_co_selectlike
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> selectlike_shrinks monotone dual_order.trans subset_Compl_singleton<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>BVG<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="USubst">
<div class="head">
<h1>Theory USubst</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"USubst"</span>
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <span class="quoted">"<a href="Syntax.html">Syntax</a>"</span>          
  <span class="quoted">"<a href="Static_Semantics.html">Static_Semantics</a>"</span>
  <span class="quoted">"<a href="Coincidence.html">Coincidence</a>"</span>
  <span class="quoted">"<a href="Denotational_Semantics.html">Denotational_Semantics</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Uniform Substitution›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹uniform substitution representation as tuple of partial maps from identifiers to type-compatible replacements.›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> usubst <span class="main">=</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>ident <span class="main">⇀</span> trm<span class="main">)</span> <span class="main">×</span> <span class="main">(</span>ident <span class="main">⇀</span> trm<span class="main">)</span> <span class="main">×</span> <span class="main">(</span>ident <span class="main">⇀</span> fml<span class="main">)</span> <span class="main">×</span> <span class="main">(</span>ident <span class="main">⇀</span> game<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SConst</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> <span class="main">(</span>ident <span class="main">⇀</span> trm<span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">SConst</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">F0</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">F0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SFuncs</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> <span class="main">(</span>ident <span class="main">⇀</span> trm<span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">SFuncs</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">F</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SPreds</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> <span class="main">(</span>ident <span class="main">⇀</span> fml<span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">SPreds</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">P</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SGames</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> <span class="main">(</span>ident <span class="main">⇀</span> game<span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">SGames</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹crude approximation of size which is enough for termination arguments›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">usubstsize</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">usubstsize</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>dom <span class="main">(</span>SFuncs <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> dom <span class="main">(</span>SPreds <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹dot is some fixed constant function symbol that is reserved for the purposes of the substitution›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dot</span><span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dot</span> <span class="main">=</span> Const <span class="main">(</span>dotid<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Strict Mechanism for Handling Substitution Partiality in Isabelle›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Optional terms that result from a substitution, either actually a term or just none to indicate that the substitution clashed›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> trmo <span class="main">=</span> <span class="quoted"><span class="quoted">"trm option"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">undeft</span><span class="main">::</span> <span class="quoted">trmo</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">undeft</span> <span class="main">≡</span> None"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Aterm</span><span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> trmo"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Aterm</span> <span class="main">≡</span> Some"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> undeft_None<span class="main">:</span> <span class="quoted"><span class="quoted">"undeft<span class="main">=</span>None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> Aterm_Some<span class="main">:</span> <span class="quoted"><span class="quoted">"Aterm <span class="free">θ</span><span class="main">=</span>Some <span class="free">θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> undeft_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">θ</span><span class="main">≠</span>undeft<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">θ</span><span class="main">=</span>Aterm <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Plus on defined terms, strict undeft otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Pluso</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trmo <span class="main">⇒</span> trmo <span class="main">⇒</span> trmo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Pluso</span> <span class="main">(</span>Aterm <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">(</span>Aterm <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span> <span class="main">=</span> Aterm<span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Pluso</span> undeft <span class="free"><span class="bound"><span class="entity">η</span></span></span> <span class="main">=</span> undeft"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Pluso</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> undeft <span class="main">=</span> undeft"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Times on defined terms, strict undeft otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Timeso</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trmo <span class="main">⇒</span> trmo <span class="main">⇒</span> trmo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Timeso</span> <span class="main">(</span>Aterm <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">(</span>Aterm <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span> <span class="main">=</span> Aterm<span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Timeso</span> undeft <span class="free"><span class="bound"><span class="entity">η</span></span></span> <span class="main">=</span> undeft"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Timeso</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> undeft <span class="main">=</span> undeft"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Differentialo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trmo <span class="main">⇒</span> trmo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Differentialo</span> <span class="main">(</span>Aterm <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">=</span> Aterm<span class="main">(</span>Differential <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Differentialo</span> undeft <span class="main">=</span> undeft"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Pluso_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Pluso <span class="free">θ</span> <span class="free">η</span> <span class="main">=</span> undeft<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">θ</span><span class="main">=</span>undeft <span class="main">∨</span> <span class="free">η</span><span class="main">=</span>undeft<span class="main">)</span>"</span></span>    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Pluso.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> Timeso_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Timeso <span class="free">θ</span> <span class="free">η</span> <span class="main">=</span> undeft<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">θ</span><span class="main">=</span>undeft <span class="main">∨</span> <span class="free">η</span><span class="main">=</span>undeft<span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Timeso.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">lemma</span></span> Differentialo_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Differentialo <span class="free">θ</span> <span class="main">=</span> undeft<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">θ</span><span class="main">=</span>undeft<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Differentialo.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 


<span class="keyword1"><span class="command">type_synonym</span></span> fmlo <span class="main">=</span> <span class="quoted"><span class="quoted">"fml option"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">undeff</span><span class="main">::</span> <span class="quoted">fmlo</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">undeff</span> <span class="main">≡</span> None"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Afml</span><span class="main">::</span> <span class="quoted"><span class="quoted">"fml <span class="main">⇒</span> fmlo"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Afml</span> <span class="main">≡</span> Some"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> gameo <span class="main">=</span> <span class="quoted"><span class="quoted">"game option"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">undefg</span><span class="main">::</span> <span class="quoted">gameo</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">undefg</span> <span class="main">≡</span> None"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Agame</span><span class="main">::</span> <span class="quoted"><span class="quoted">"game <span class="main">⇒</span> gameo"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Agame</span> <span class="main">≡</span> Some"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> undeff_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span><span class="main">≠</span>undeff<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="free">φ</span><span class="main">=</span>Afml <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> undefg_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">α</span><span class="main">≠</span>undefg<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="free">α</span><span class="main">=</span>Agame <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Geq on defined terms, strict undeft otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Geqo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trmo <span class="main">⇒</span> trmo <span class="main">⇒</span> fmlo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Geqo</span> <span class="main">(</span>Aterm <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">(</span>Aterm <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span> <span class="main">=</span> Afml<span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Geqo</span> undeft <span class="free"><span class="bound"><span class="entity">η</span></span></span> <span class="main">=</span> undeff"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Geqo</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> undeft <span class="main">=</span> undeff"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Not on defined formulas, strict undeft otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Noto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fmlo <span class="main">⇒</span> fmlo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Noto</span> <span class="main">(</span>Afml <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> Afml<span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Noto</span> undeff <span class="main">=</span> undeff"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹And on defined formulas, strict undeft otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Ando</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fmlo <span class="main">⇒</span> fmlo <span class="main">⇒</span> fmlo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Ando</span> <span class="main">(</span>Afml <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span>Afml <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> Afml<span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Ando</span> undeff <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> undeff"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Ando</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> undeff <span class="main">=</span> undeff"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Exists on defined formulas, strict undeft otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Existso</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"variable <span class="main">⇒</span> fmlo <span class="main">⇒</span> fmlo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Existso</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Afml <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> Afml<span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Existso</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> undeff <span class="main">=</span> undeff"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Diamond on defined games/formulas, strict undeft otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Diamondo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gameo <span class="main">⇒</span> fmlo <span class="main">⇒</span> fmlo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Diamondo</span> <span class="main">(</span>Agame <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">(</span>Afml <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> Afml<span class="main">(</span>Diamond <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Diamondo</span> undefg <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> undeff"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Diamondo</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> undeff <span class="main">=</span> undeff"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Geqo_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Geqo <span class="free">θ</span> <span class="free">η</span> <span class="main">=</span> undeff<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">θ</span><span class="main">=</span>undeft <span class="main">∨</span> <span class="free">η</span><span class="main">=</span>undeft<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Geqo.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">lemma</span></span> Noto_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Noto <span class="free">φ</span> <span class="main">=</span> undeff<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">φ</span><span class="main">=</span>undeff<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Noto.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">lemma</span></span> Ando_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Ando <span class="free">φ</span> <span class="free">ψ</span> <span class="main">=</span> undeff<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">φ</span><span class="main">=</span>undeff <span class="main">∨</span> <span class="free">ψ</span><span class="main">=</span>undeff<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ando.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">lemma</span></span> Existso_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Existso <span class="free">x</span> <span class="free">φ</span> <span class="main">=</span> undeff<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">φ</span><span class="main">=</span>undeff<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Existso.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">lemma</span></span> Diamondo_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Diamondo <span class="free">α</span> <span class="free">φ</span> <span class="main">=</span> undeff<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">α</span><span class="main">=</span>undefg <span class="main">∨</span> <span class="free">φ</span><span class="main">=</span>undeff<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diamondo.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Assign on defined terms, strict undefg otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Assigno</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"variable <span class="main">⇒</span> trmo <span class="main">⇒</span> gameo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Assigno</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Aterm <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">=</span> Agame<span class="main">(</span>Assign <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Assigno</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> undeft <span class="main">=</span> undefg"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ODEo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ident <span class="main">⇒</span> trmo <span class="main">⇒</span> gameo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ODEo</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Aterm <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">=</span> Agame<span class="main">(</span>ODE <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ODEo</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> undeft <span class="main">=</span> undefg"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Test on defined formulas, strict undefg otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Testo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fmlo <span class="main">⇒</span> gameo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Testo</span> <span class="main">(</span>Afml <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> Agame<span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Testo</span> undeff <span class="main">=</span> undefg"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Choice on defined games, strict undefg otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Choiceo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gameo <span class="main">⇒</span> gameo <span class="main">⇒</span> gameo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Choiceo</span> <span class="main">(</span>Agame <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">(</span>Agame <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span> Agame<span class="main">(</span>Choice <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Choiceo</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> undefg <span class="main">=</span> undefg"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Choiceo</span> undefg <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">=</span> undefg"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Compose on defined games, strict undefg otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Composeo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gameo <span class="main">⇒</span> gameo <span class="main">⇒</span> gameo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Composeo</span> <span class="main">(</span>Agame <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">(</span>Agame <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span> Agame<span class="main">(</span>Compose <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Composeo</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> undefg <span class="main">=</span> undefg"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Composeo</span> undefg <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">=</span> undefg"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Loop on defined games, strict undefg otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Loopo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gameo <span class="main">⇒</span> gameo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Loopo</span> <span class="main">(</span>Agame <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">=</span> Agame<span class="main">(</span>Loop <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Loopo</span> undefg <span class="main">=</span> undefg"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Dual on defined games, strict undefg otherwise ›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Dualo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gameo <span class="main">⇒</span> gameo"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Dualo</span> <span class="main">(</span>Agame <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">=</span> Agame<span class="main">(</span>Dual <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Dualo</span> undefg <span class="main">=</span> undefg"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Assigno_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Assigno <span class="free">x</span> <span class="free">θ</span> <span class="main">=</span> undefg<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">θ</span><span class="main">=</span>undeft<span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Assigno.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">lemma</span></span> ODEo_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ODEo <span class="free">x</span> <span class="free">θ</span> <span class="main">=</span> undefg<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">θ</span><span class="main">=</span>undeft<span class="main">)</span>"</span></span>        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ODEo.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">lemma</span></span> Testo_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Testo <span class="free">φ</span> <span class="main">=</span> undefg<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">φ</span><span class="main">=</span>undeff<span class="main">)</span>"</span></span>        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Testo.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">lemma</span></span> Choiceo_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Choiceo <span class="free">α</span> <span class="free">β</span> <span class="main">=</span> undefg<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">α</span><span class="main">=</span>undefg <span class="main">∨</span> <span class="free">β</span><span class="main">=</span>undefg<span class="main">)</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Choiceo.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> Composeo_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Composeo <span class="free">α</span> <span class="free">β</span> <span class="main">=</span> undefg<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">α</span><span class="main">=</span>undefg <span class="main">∨</span> <span class="free">β</span><span class="main">=</span>undefg<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Composeo.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> Loopo_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Loopo <span class="free">α</span> <span class="main">=</span> undefg<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">α</span><span class="main">=</span>undefg<span class="main">)</span>"</span></span>        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Loopo.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> Dualo_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Dualo <span class="free">α</span> <span class="main">=</span> undefg<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">α</span><span class="main">=</span>undefg<span class="main">)</span>"</span></span>        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Dualo.elims option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Recursive Application of One-Pass Uniform Substitution›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>dotsubstt θ›</span></span></span></span> is the dot substitution <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>{. ~&gt; θ}›</span></span></span></span> substituting a term for the . function symbol›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dotsubstt</span><span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> usubst"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dotsubstt</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="main">=</span> <span class="main">(</span>
         <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">f</span><span class="main">=</span>dotid <span class="keyword1">then</span> <span class="main">(</span>Some<span class="main">(</span><span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
         <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> None<span class="main">)</span><span class="main">,</span>
         <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> None<span class="main">)</span><span class="main">,</span>
         <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> None<span class="main">)</span>
  <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">usappconst</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> variable set <span class="main">⇒</span> ident <span class="main">⇒</span> <span class="main">(</span>trmo<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">usappconst</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> SConst <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">of</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT<span class="main">(</span><span class="bound">r</span><span class="main">)</span><span class="main">∩</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">=</span><span class="main">{}</span> <span class="keyword1">then</span> Aterm<span class="main">(</span><span class="bound">r</span><span class="main">)</span> <span class="keyword1">else</span> undeft <span class="main">|</span> None <span class="main">⇒</span> Aterm<span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">usubstappt</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> variable set <span class="main">⇒</span> <span class="main">(</span>trm <span class="main">⇒</span> trmo<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>     <span class="main">=</span> Aterm <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Number <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>  <span class="main">=</span> Aterm <span class="main">(</span>Number <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>   <span class="main">=</span> usappconst <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Func <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span>  <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="keyword1">of</span> undeft   <span class="main">⇒</span> undeft
                          <span class="main">|</span> Aterm <span class="bound">σθ</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">of</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT<span class="main">(</span><span class="bound">r</span><span class="main">)</span><span class="main">∩</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">=</span><span class="main">{}</span> <span class="keyword1">then</span> <span class="free">usubstappt</span><span class="main">(</span>dotsubstt <span class="bound">σθ</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">r</span> <span class="keyword1">else</span> undeft <span class="main">|</span> None <span class="main">⇒</span> Aterm<span class="main">(</span>Func <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">σθ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span>  <span class="main">=</span> Pluso <span class="main">(</span><span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span> <span class="main">=</span> Timeso <span class="main">(</span><span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Differential <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">=</span> Differentialo <span class="main">(</span><span class="free">usubstappt</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> allvars <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measures <span class="main">[</span><span class="main">λ</span><span class="main">(</span><span class="bound">σ</span><span class="main">,</span><span class="bound">U</span><span class="main">,</span><span class="bound">θ</span><span class="main">)</span><span class="main">.</span> usubstsize <span class="bound">σ</span> <span class="main">,</span> <span class="main">λ</span><span class="main">(</span><span class="bound">σ</span><span class="main">,</span><span class="bound">U</span><span class="main">,</span><span class="bound">θ</span><span class="main">)</span><span class="main">.</span> size <span class="bound">θ</span><span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usubstsize_def dotsubstt_def<span class="main">)</span>
  
<span class="comment1">(* Expand let constructs automatically *)</span>
<span class="keyword1"><span class="command">declare</span></span> Let_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  
<span class="keyword1"><span class="command">function</span></span> <span class="entity">usubstappf</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> variable set <span class="main">⇒</span> <span class="main">(</span>fml <span class="main">⇒</span> fmlo<span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">usubstappp</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> variable set <span class="main">⇒</span> <span class="main">(</span>game <span class="main">⇒</span> variable set <span class="main">×</span> gameo<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span>   <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="keyword1">of</span> undeft   <span class="main">⇒</span> undeff
                          <span class="main">|</span> Aterm <span class="bound">σθ</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF<span class="main">(</span><span class="bound">r</span><span class="main">)</span><span class="main">∩</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">=</span><span class="main">{}</span> <span class="keyword1">then</span> <span class="free">usubstappf</span><span class="main">(</span>dotsubstt <span class="bound">σθ</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">r</span> <span class="keyword1">else</span> undeff <span class="main">|</span> None <span class="main">⇒</span> Afml<span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">σθ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span>    <span class="main">=</span> Geqo <span class="main">(</span>usubstappt <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">(</span>usubstappt <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">η</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>      <span class="main">=</span> Noto <span class="main">(</span><span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>    <span class="main">=</span> Ando <span class="main">(</span><span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> Existso <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">∪</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Diamond <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">Vα</span> <span class="main">=</span> <span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="keyword1">in</span> Diamondo <span class="main">(</span>snd <span class="bound">Vα</span><span class="main">)</span> <span class="main">(</span><span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span>fst <span class="bound">Vα</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Game <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>   <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> SGames <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">∪</span>BVG<span class="main">(</span><span class="bound">r</span><span class="main">)</span><span class="main">,</span>Agame <span class="bound">r</span><span class="main">)</span>
                    <span class="main">|</span> None   <span class="main">⇒</span> <span class="main">(</span>allvars<span class="main">,</span>Agame<span class="main">(</span>Game <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Assign <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">∪</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">,</span> Assigno <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>usubstappt <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> Testo <span class="main">(</span><span class="free">usubstappf</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Choice <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">Vα</span> <span class="main">=</span> <span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="keyword1">in</span>
     <span class="keyword1">let</span> <span class="bound">Wβ</span> <span class="main">=</span> <span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="keyword1">in</span>
     <span class="main">(</span>fst <span class="bound">Vα</span><span class="main">∪</span>fst <span class="bound">Wβ</span><span class="main">,</span> Choiceo <span class="main">(</span>snd <span class="bound">Vα</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">Wβ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Compose <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">Vα</span> <span class="main">=</span> <span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="keyword1">in</span>
     <span class="keyword1">let</span> <span class="bound">Wβ</span> <span class="main">=</span> <span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span>fst <span class="bound">Vα</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="keyword1">in</span>
     <span class="main">(</span>fst <span class="bound">Wβ</span><span class="main">,</span> Composeo <span class="main">(</span>snd <span class="bound">Vα</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">Wβ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Loop <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">V</span> <span class="main">=</span> fst<span class="main">(</span><span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
     <span class="main">(</span><span class="bound">V</span><span class="main">,</span> Loopo <span class="main">(</span>snd<span class="main">(</span><span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">V</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>Dual <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">Vα</span> <span class="main">=</span> <span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">Vα</span><span class="main">,</span> Dualo <span class="main">(</span>snd <span class="bound">Vα</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">usubstappp</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>ODE <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">∪</span><span class="main">{</span>RVar <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span>DVar <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">,</span> ODEo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>usubstappt <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">∪</span><span class="main">{</span>RVar <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span>DVar <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measures <span class="main">[</span><span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> usubstsize <span class="main">(</span><span class="keyword1">case</span> <span class="bound">k</span> <span class="keyword1">of</span> Inl<span class="main">(</span><span class="bound">σ</span><span class="main">,</span><span class="bound">U</span><span class="main">,</span><span class="bound">φ</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">σ</span> <span class="main">|</span> Inr<span class="main">(</span><span class="bound">σ</span><span class="main">,</span><span class="bound">U</span><span class="main">,</span><span class="bound">α</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">k</span> <span class="keyword1">of</span> Inl <span class="main">(</span><span class="bound">σ</span><span class="main">,</span><span class="bound">U</span><span class="main">,</span><span class="bound">φ</span><span class="main">)</span> <span class="main">⇒</span> size <span class="bound">φ</span> <span class="main">|</span> Inr <span class="main">(</span><span class="bound">σ</span><span class="main">,</span><span class="bound">U</span><span class="main">,</span><span class="bound">α</span><span class="main">)</span> <span class="main">⇒</span> size <span class="bound">α</span><span class="main">)</span><span class="main">]</span>"</span></span><span class="main">)</span> 
  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usubstsize_def dotsubstt_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Induction Principles for Uniform Substitutions›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> usubstappt_induct <span class="main">=</span> usubstappt.induct <span class="main">[</span><span class="operator">case_names</span> Var Number Const FuncMatch Plus Times Differential<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> usubstappfp_induct <span class="main">=</span> usubstappf_usubstappp.induct <span class="main">[</span><span class="operator">case_names</span> Pred Geq Not And Exists Diamond  Game Assign Test Choice Compose Loop Dual ODE<span class="main">]</span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Simple Observations for Automation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹More automation for Case›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usappconst_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟹</span> FVT<span class="main">(</span><span class="free">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">=</span><span class="main">{}</span> <span class="main">⟹</span> usappconst <span class="free">σ</span> <span class="free">U</span> <span class="free">f</span> <span class="main">=</span> Aterm<span class="main">(</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> None <span class="main">⟹</span> usappconst <span class="free">σ</span> <span class="free">U</span> <span class="free">f</span> <span class="main">=</span> Aterm<span class="main">(</span>Const <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟹</span> FVT<span class="main">(</span><span class="free">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> usappconst <span class="free">σ</span> <span class="free">U</span> <span class="free">f</span> <span class="main">=</span> undeft"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> usappconst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> usappconst_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"usappconst <span class="free">σ</span> <span class="free">U</span> <span class="free">f</span><span class="main">≠</span>undeft <span class="main">⟹</span>
  SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> None <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> Some <span class="bound">r</span> <span class="main">∧</span> FVT<span class="main">(</span><span class="bound">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="comment1">(*by (smt option.case_eq_if option.collapse usappconst_def)*)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"usappconst <span class="free">σ</span> <span class="free">U</span> <span class="free">f</span><span class="main">≠</span>undeft"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> None <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> Some <span class="bound">r</span> <span class="main">∧</span> FVT<span class="main">(</span><span class="bound">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="free">f</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> as usappconst_def<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> σ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">σ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span><span class="main">]</span> option.distinct<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappt_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟹</span> FVT<span class="main">(</span><span class="free">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">=</span><span class="main">{}</span> <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Const <span class="free">f</span><span class="main">)</span> <span class="main">=</span> Aterm<span class="main">(</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> None <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Const <span class="free">f</span><span class="main">)</span> <span class="main">=</span> Aterm<span class="main">(</span>Const <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟹</span> FVT<span class="main">(</span><span class="free">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Const <span class="free">f</span><span class="main">)</span> <span class="main">=</span> undeft"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usappconst_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappt_const_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Const <span class="free">f</span><span class="main">)</span><span class="main">≠</span>undeft <span class="main">⟹</span>
  SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> None <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> SConst <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> Some <span class="bound">r</span> <span class="main">∧</span> FVT<span class="main">(</span><span class="bound">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usappconst_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappt_func <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟹</span> FVT<span class="main">(</span><span class="free">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">=</span><span class="main">{}</span> <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">=</span> Aterm <span class="free">σθ</span> <span class="main">⟹</span>
  usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Func <span class="free">f</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> usubstappt <span class="main">(</span>dotsubstt <span class="free">σθ</span><span class="main">)</span> <span class="main">{}</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="free">f</span><span class="main">=</span>None <span class="main">⟹</span>  usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">=</span> Aterm <span class="free">σθ</span> <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Func <span class="free">f</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> Aterm<span class="main">(</span>Func <span class="free">f</span> <span class="free">σθ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">=</span> undeft <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Func <span class="free">f</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> undeft"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappt_func2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟹</span> FVT<span class="main">(</span><span class="free">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Func <span class="free">f</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> undeft"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappt_func_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Func <span class="free">f</span> <span class="free">θ</span><span class="main">)</span> <span class="main">≠</span> undeft <span class="main">⟹</span>
  usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">≠</span> undeft <span class="main">∧</span>
    <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> None <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> SFuncs <span class="free">σ</span> <span class="free">f</span> <span class="main">=</span> Some <span class="bound">r</span> <span class="main">∧</span> FVT<span class="main">(</span><span class="bound">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> option.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> undeft_equiv usubstappt.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> usubstappt_func2<span class="main">)</span>
  <span class="comment1">(*by (cases "usubstappt σ U θ") (auto) *)</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappt_plus_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Plus <span class="free">θ</span> <span class="free">η</span><span class="main">)</span> <span class="main">≠</span> undeft <span class="main">⟹</span>
  usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">≠</span> undeft <span class="main">∧</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">η</span> <span class="main">≠</span> undeft"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pluso_undef<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> usubstappt_times_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Times <span class="free">θ</span> <span class="free">η</span><span class="main">)</span> <span class="main">≠</span> undeft <span class="main">⟹</span>
  usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">≠</span> undeft <span class="main">∧</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">η</span> <span class="main">≠</span> undeft"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Timeso_undef<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappt_differential_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Differential <span class="free">θ</span><span class="main">)</span> <span class="main">≠</span> undeft <span class="main">⟹</span>
  usubstappt <span class="free">σ</span> allvars <span class="free">θ</span> <span class="main">≠</span> undeft"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Differentialo_undef<span class="main">)</span>
  

<span class="keyword1"><span class="command">lemma</span></span> usubstappf_pred <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟹</span> FVF<span class="main">(</span><span class="free">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">=</span><span class="main">{}</span> <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">=</span> Aterm <span class="free">σθ</span> <span class="main">⟹</span>
  usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Pred <span class="free">p</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> usubstappf <span class="main">(</span>dotsubstt <span class="free">σθ</span><span class="main">)</span> <span class="main">{}</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="free">p</span> <span class="main">=</span> None <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">=</span> Aterm <span class="free">σθ</span> <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Pred <span class="free">p</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> Afml<span class="main">(</span>Pred <span class="free">p</span> <span class="free">σθ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">=</span> undeft <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Pred <span class="free">p</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> undeff"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> usubstappf_pred2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟹</span> FVF<span class="main">(</span><span class="free">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Pred <span class="free">p</span> <span class="free">θ</span><span class="main">)</span> <span class="main">=</span> undeff"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappf_pred_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Pred <span class="free">p</span> <span class="free">θ</span><span class="main">)</span> <span class="main">≠</span> undeff <span class="main">⟹</span>
  usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">≠</span> undeft <span class="main">∧</span>
    <span class="main">(</span>SPreds <span class="free">σ</span> <span class="free">p</span> <span class="main">=</span> None <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> SPreds <span class="free">σ</span> <span class="free">p</span> <span class="main">=</span> Some <span class="bound">r</span> <span class="main">∧</span> FVF<span class="main">(</span><span class="bound">r</span><span class="main">)</span><span class="main">∩</span><span class="free">U</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> option.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> undeff_equiv usubstappf.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> usubstappf_pred2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappf_geq<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">≠</span> undeft <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">η</span> <span class="main">≠</span> undeft <span class="main">⟹</span>
  usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Geq <span class="free">θ</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> Afml<span class="main">(</span>Geq <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappf_geq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Geq <span class="free">θ</span> <span class="free">η</span><span class="main">)</span> <span class="main">≠</span> undeff <span class="main">⟹</span>
  usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">≠</span> undeft <span class="main">∧</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">η</span> <span class="main">≠</span> undeft"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Geqo_undef<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> usubstappf_geqr<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Geq <span class="free">θ</span> <span class="free">η</span><span class="main">)</span> <span class="main">≠</span> undeff <span class="main">⟹</span>
  usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Geq <span class="free">θ</span> <span class="free">η</span><span class="main">)</span> <span class="main">=</span> Afml<span class="main">(</span>Geq <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">η</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubstappf_geq usubstappf_geq_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappf_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Exists <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">≠</span> undeff <span class="main">⟹</span>
  usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Exists <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> Afml<span class="main">(</span>Exists <span class="free">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="free">σ</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Existso_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappp_game <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SGames <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟹</span> usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Game <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span>BVG<span class="main">(</span><span class="free">r</span><span class="main">)</span><span class="main">,</span>Agame<span class="main">(</span><span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"SGames <span class="free">σ</span> <span class="free">a</span> <span class="main">=</span> None <span class="main">⟹</span> usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Game <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>allvars<span class="main">,</span>Agame<span class="main">(</span>Game <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

<span class="keyword1"><span class="command">lemma</span></span> usubstappp_choice <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Choice <span class="free">α</span> <span class="free">β</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">∪</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">β</span><span class="main">)</span><span class="main">,</span> Choiceo <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappp_choice_conv <span class="main">:</span> <span class="quoted"><span class="quoted">"snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Choice <span class="free">α</span> <span class="free">β</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">⟹</span>
  snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">∧</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">β</span><span class="main">)</span> <span class="main">≠</span> undefg"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Choiceo_undef<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappp_compose <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Compose <span class="free">α</span> <span class="free">β</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="free">β</span><span class="main">)</span><span class="main">,</span> Composeo <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappp_loop<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">,</span> Loopo <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappp_dual <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Dual <span class="free">α</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">,</span> Dualo <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


  
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Soundness of Uniform Substitution›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹USubst Application is a Function of Deterministic Result›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappt_det<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">≠</span> undeft <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="free">θ</span> <span class="main">≠</span> undeft <span class="main">⟹</span>
  usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">=</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="free">θ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">θ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Number <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="comment1">(*by (smt option.case_eq_if usappconst_def usubstappt.simps(3))*)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> Aterm <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usappconst_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="bound">f</span> <span class="bound">za</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">za</span> <span class="main">=</span> undeft <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span><span class="main">::</span>trm option <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span>the <span class="bound">za</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">if</span> FVT <span class="main">(</span>the <span class="main">(</span>SConst <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> Aterm <span class="main">(</span>the <span class="main">(</span>SConst <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeft<span class="main">)</span> <span class="main">=</span> usappconst <span class="free">σ</span> <span class="free">U</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usappconst_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> FVT <span class="main">(</span>the <span class="main">(</span>SConst <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Const.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> usubstappt.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">if</span> FVT <span class="main">(</span>the <span class="main">(</span>SConst <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> Aterm <span class="main">(</span>the <span class="main">(</span>SConst <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeft<span class="main">)</span> <span class="main">=</span> usappconst <span class="free">σ</span> <span class="free">V</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 usappconst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> FVT <span class="main">(</span>the <span class="main">(</span>SConst <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Const.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> usubstappt.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> usappconst <span class="free">σ</span> <span class="free">V</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f3 f2 f1 usappconst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="main">≠</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">case</span> SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> Aterm <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usappconst_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_func
      <span class="comment1">(*by (cases "SFuncs σ f") (auto simp add: usubstappt_func)*)</span>
      <span class="comment1">(*by (smt option.case_eq_if usubstappt.simps(4))*)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeft <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">ta</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">ta</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">ta</span> <span class="keyword1">else</span> undeft<span class="main">)</span><span class="main">)</span> <span class="main">≠</span> undeft"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Func<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="bound">f</span> <span class="bound">za</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">za</span> <span class="main">=</span> undeft <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span><span class="main">::</span>trm option <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span>the <span class="bound">za</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeft <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">ta</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">ta</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">ta</span> <span class="keyword1">else</span> undeft<span class="main">)</span><span class="main">)</span> <span class="main">≠</span> undeft"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Func<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f3 f2 Func<span class="main">(</span>1<span class="main">)</span> usubstappt.simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">if</span> FVT <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeft<span class="main">)</span> <span class="main">=</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f4 f3 f2 Func<span class="main">(</span>1<span class="main">)</span> usubstappt.simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> FVT <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Func<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeft <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">ta</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">ta</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">ta</span> <span class="keyword1">else</span> undeft<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f4 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">if</span> FVT <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeft<span class="main">)</span> <span class="main">=</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> FVT <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Func<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span> <span class="main">≠</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f7 f5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f8 f7 f6 f5 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">θ1</span> <span class="skolem">θ2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Pluso_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">θ1</span> <span class="skolem">θ2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Timeso_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Differential <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Differentialo_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> usubstappf_and_usubstappp_det<span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">V</span> <span class="free">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">=</span> usubstappf <span class="free">σ</span> <span class="free">V</span> <span class="free">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">V</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">=</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">V</span> <span class="free">α</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_det usubstappf_pred
  <span class="comment1">(*by (metis usubstappf.simps(1)) *)</span>
  <span class="comment1">(*by (smt option.case_eq_if usubstappf.simps(1)) *)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeff <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span><span class="main">)</span> <span class="main">≠</span> undeff"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Pred.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="bound">f</span> <span class="bound">za</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">za</span> <span class="main">=</span> undeft <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span><span class="main">::</span>fml option <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span>the <span class="bound">za</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> option.case_eq_if<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeff <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeff <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span><span class="main">)</span> <span class="main">≠</span> undeff"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Pred.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="main">=</span> usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> usubstappt_det<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f3 usubstappf.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="bound">f</span> <span class="bound">za</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">za</span> <span class="main">=</span> undeff <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span><span class="main">::</span>fml option <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span>the <span class="bound">za</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> option.case_eq_if<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeff <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f4 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff <span class="main">⟶</span> usubstappf <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> usubstappf <span class="free">σ</span> <span class="skolem">V</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> usubstappf <span class="free">σ</span> <span class="skolem">V</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Pred.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> calculation f5 option.collapse usubstappf_pred usubstappf_pred2 usubstappf_pred_conv<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f3 Pred.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f5 <span class="keyword1"><span class="command">using</span></span> Pred.prems<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span> f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f7 <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span>›</span></span> calculation<span class="main">(</span>2<span class="main">)</span> f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">qed</span></span><span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f8 Pred.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Pred.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span> option.collapse usubstappf_pred2<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Pred.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Pred.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹usubstappf <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> usubstappf <span class="free">σ</span> <span class="skolem">V</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> calculation<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> option.collapse usubstappf_pred usubstappf_pred_conv<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Geq <span class="skolem">θ</span> <span class="skolem">η</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_det <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Geqo_undef usubstappf.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Noto.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> usubstappf.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ando_undef usubstappf.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Exists <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Existso_undef usubstappf.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Diamond <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diamondo_undef usubstappf.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Game <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"SGames <span class="free">σ</span> <span class="skolem">a</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_det <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Assigno_undef snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ODE <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_det <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ODEo_undef snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Test <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Testo_undef snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Choice <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Choiceo_undef snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Composeo_undef snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Loopo_undef snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dual <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Dualo_undef snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappf_det<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">V</span> <span class="free">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">=</span> usubstappf <span class="free">σ</span> <span class="free">V</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubstappf_and_usubstappp_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappp_det<span class="main">:</span> <span class="quoted"><span class="quoted">"snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">V</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">=</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">V</span> <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubstappf_and_usubstappp_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Uniform Substitutions are Antimonotone in Taboos›</span></span>


<span class="keyword1"><span class="command">lemma</span></span> usubst_taboos_mon<span class="main">:</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">⊇</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> game_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Game <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"SGames <span class="free">σ</span> <span class="skolem">a</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ODE <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Test <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Choice <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dual <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fst_pair <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> snd_pair <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  
<span class="keyword1"><span class="command">lemma</span></span> usubstappt_antimon<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">⊆</span><span class="free">U</span> <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">≠</span> undeft <span class="main">⟹</span>
  usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span> <span class="main">=</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="free">θ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">θ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Number <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="comment1">(*by (smt disjoint_iff_not_equal option.case_eq_if set_rev_mp usappconst_def usubstappt.simps(3))*)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> Aterm <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usappconst_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="bound">f</span> <span class="bound">za</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">za</span> <span class="main">=</span> undeft <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span><span class="main">::</span>trm option <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span>the <span class="bound">za</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">if</span> FVT <span class="main">(</span>the <span class="main">(</span>SConst <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> Aterm <span class="main">(</span>the <span class="main">(</span>SConst <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeft<span class="main">)</span> <span class="main">=</span> usappconst <span class="free">σ</span> <span class="free">U</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> usappconst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> FVT <span class="main">(</span>the <span class="main">(</span>SConst <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Const.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> usubstappt.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">V</span> <span class="bound">Va</span><span class="main">.</span> <span class="main">(</span><span class="bound">V</span> <span class="main">∩</span> <span class="bound">Va</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">::</span>variable<span class="main">)</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">va</span><span class="main">.</span> <span class="bound">va</span> <span class="main">∈</span> <span class="bound">Va</span> <span class="main">⟶</span> <span class="bound">v</span> <span class="main">≠</span> <span class="bound">va</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="main">≠</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">case</span> SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> Aterm <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usappconst_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">∧</span> FVT <span class="main">(</span>the <span class="main">(</span>SConst <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f4 f3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Const.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f3 f2 usappconst_def usubstappt.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_func
      <span class="comment1">(*by (smt disjoint_iff_not_equal option.case_eq_if subset_iff usubstappt.simps(4))*)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeft <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">ta</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">ta</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">ta</span> <span class="keyword1">else</span> undeft<span class="main">)</span><span class="main">)</span> <span class="main">≠</span> undeft"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Func.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="bound">f</span> <span class="bound">za</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">za</span> <span class="main">=</span> undeft <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span><span class="main">::</span>trm option <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span>the <span class="bound">za</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeft <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">ta</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">ta</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">ta</span> <span class="keyword1">else</span> undeft<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="skolem">θ</span> <span class="main">=</span> undeft <span class="main">∨</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="skolem">θ</span> <span class="main">=</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Func.IH Func.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">if</span> FVT <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeft<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">if</span> FVT <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeft<span class="main">)</span> <span class="main">=</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f5 f4 f3 usubstappt.simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> FVT <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Func.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> <span class="free">V</span> <span class="main">⊆</span> <span class="main">-</span> FVT <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Func.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeft <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">ta</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">ta</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">ta</span> <span class="keyword1">else</span> undeft<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f5 f3 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f6 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft <span class="main">⟶</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SFuncs <span class="free">σ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f5 f4 f3 usubstappt.simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVT <span class="bound">t</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">t</span> <span class="keyword1">else</span> undeft<span class="main">)</span> <span class="main">≠</span> Aterm <span class="main">(</span>trm.Func <span class="skolem">f</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="skolem">f</span> <span class="main">≠</span> undeft"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f5 f3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f9 f8 f7 f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_eq_subset_Compl inf.commute<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">θ1</span> <span class="skolem">θ2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Pluso_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">θ1</span> <span class="skolem">θ2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Timeso_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Differential <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Differentialo_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Uniform Substitutions of Games have monotone taboo output›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappp_fst_mon<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span><span class="main">⊆</span><span class="free">V</span> <span class="main">⟹</span> fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">⊆</span> fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">V</span> <span class="free">α</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> game_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Game <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"SGames <span class="free">σ</span> <span class="skolem">a</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ODE <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Test <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Choice <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_mono fst_pair usubstappp_choice<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_pair usubstappp_compose<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_pair usubstappp_loop<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dual <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_pair usubstappp_dual<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> usubstappf_and_usubstappp_antimon<span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">⊆</span><span class="free">U</span> <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">=</span> usubstappf <span class="free">σ</span> <span class="free">V</span> <span class="free">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">⊆</span><span class="free">U</span> <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">=</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">V</span> <span class="free">α</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">⊆</span><span class="free">U</span> <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">V</span> <span class="free">φ</span> <span class="main">≠</span> undeff"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">⊆</span><span class="free">U</span> <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">V</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_antimon usubstappf_pred
    <span class="comment1">(*by (smt Un_mono disjoint_eq_subset_Compl empty_subsetI inf.commute option.case_eq_if sup.absorb_iff1 sup.absorb_iff2 usubstappf.simps(1)) *)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="skolem">V</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Pred.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="bound">f</span> <span class="bound">za</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">za</span> <span class="main">=</span> undeff <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span><span class="main">::</span>fml option <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span>the <span class="bound">za</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> option.case_eq_if<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeff <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span><span class="main">)</span> <span class="main">≠</span> undeff"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Pred.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="bound">f</span> <span class="bound">za</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">za</span> <span class="main">=</span> undeft <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span><span class="main">::</span>fml option <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">za</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">z</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span>the <span class="bound">za</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> option.case_eq_if<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="keyword1">of</span> None <span class="main">⇒</span> undeff <span class="main">|</span> Some <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="bound">t</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="main">=</span> usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Pred.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> usubstappt_antimon<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff <span class="main">⟶</span> usubstappf <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> usubstappf <span class="free">σ</span> <span class="skolem">V</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 usubstappf.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vv</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"variable set <span class="main">⇒</span> variable set <span class="main">⇒</span> variable"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v2</span><span class="main">.</span> <span class="bound">v2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v3</span><span class="main">.</span> <span class="bound">v3</span> <span class="main">∈</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="bound">v2</span> <span class="main">=</span> <span class="bound">v3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">vv</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v3</span><span class="main">.</span> <span class="bound">v3</span> <span class="main">∈</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="skolem">vv</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">=</span> <span class="bound">v3</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vva</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"variable set <span class="main">⇒</span> variable set <span class="main">⇒</span> variable"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      f9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">V</span> <span class="bound">Va</span><span class="main">.</span> <span class="main">(</span><span class="bound">V</span> <span class="main">∩</span> <span class="bound">Va</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="bound">V</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">va</span><span class="main">.</span> <span class="bound">va</span> <span class="main">∉</span> <span class="bound">Va</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">≠</span> <span class="bound">va</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">∩</span> <span class="bound">Va</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="skolem">vv</span> <span class="bound">Va</span> <span class="bound">V</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> <span class="skolem">vva</span> <span class="bound">Va</span> <span class="bound">V</span> <span class="main">∈</span> <span class="bound">Va</span> <span class="main">∧</span> <span class="skolem">vv</span> <span class="bound">Va</span> <span class="bound">V</span> <span class="main">=</span> <span class="skolem">vva</span> <span class="bound">Va</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">va</span><span class="main">.</span> <span class="bound">va</span> <span class="main">∉</span> <span class="skolem">V</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">≠</span> <span class="bound">va</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="skolem">vv</span> <span class="skolem">V</span> <span class="main">(</span>FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">vva</span> <span class="skolem">V</span> <span class="main">(</span>FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">∧</span> <span class="skolem">vv</span> <span class="skolem">V</span> <span class="main">(</span>FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">vva</span> <span class="skolem">V</span> <span class="main">(</span>FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vv</span> <span class="skolem">V</span> <span class="main">(</span>FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">vva</span> <span class="skolem">V</span> <span class="main">(</span>FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">V</span> <span class="main">∨</span> <span class="skolem">vv</span> <span class="skolem">V</span> <span class="main">(</span>FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">vva</span> <span class="skolem">V</span> <span class="main">(</span>FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> undeff"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> usubstappf <span class="free">σ</span> <span class="skolem">V</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f7 f5 f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> usubstappf <span class="free">σ</span> <span class="skolem">V</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> calculation f5 f7 option.collapse usubstappf_pred<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="skolem">V</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> undeff <span class="main">⟶</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> usubstappf <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f7<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f2  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Pred.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> usubstappf <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> f5 f7 option.collapse usubstappf_pred usubstappf_pred2<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟶</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> usubstappf <span class="free">σ</span> <span class="skolem">V</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> undeff <span class="main">⟶</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f10 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Pred.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f6 Pred.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  <span class="quoted"><span class="quoted">‹FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">if</span> FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f2
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Pred.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹FVF <span class="main">(</span>the <span class="main">(</span>SPreds <span class="free">σ</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> option.discI option.expand option.sel usubstappf_pred2<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="skolem">V</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> undeff <span class="main">⟶</span> SPreds <span class="free">σ</span> <span class="skolem">p</span> <span class="main">=</span> undeff"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f9 f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Pred.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Geq <span class="skolem">θ</span> <span class="skolem">η</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_antimon <span class="keyword1"><span class="command">using</span></span> Geqo_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Noto_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Ando_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Exists <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Existso_undef
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Un_mono subsetI usubstappf.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Diamond <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Diamondo_undef usubstappf.simps<span class="main">(</span>6<span class="main">)</span> usubstappp_fst_mon <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Game <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"SGames <span class="free">σ</span> <span class="skolem">a</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_antimon <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Assigno_undef snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ODE <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_antimon ODEo_undef
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Un_mono order_refl snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Test <span class="skolem">φ</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Testo_undef snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Choice <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Choiceo_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> usubstappp_compose<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> σ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">σ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> α<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> β<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">β</span></span><span class="main">]</span> usubstappp_compose<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> σ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">σ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> α<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> β<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">β</span></span><span class="main">]</span>
          Composeo_undef<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> α<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> β<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">β</span><span class="main">)</span>›</span></span><span class="main">]</span>
          Composeo_undef<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> α<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">α</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> β<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">V</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">β</span><span class="main">)</span>›</span></span><span class="main">]</span>
          snd_conv usubstappp_fst_mon <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="comment1">(*proof-
            from Compose have ca: "snd (usubstappp σ U (α ;; β)) ≠ undefg" by simp
            have decU: "snd (usubstappp σ U (α ;; β)) = Composeo (snd(usubstappp σ U α)) (snd(usubstappp σ (fst(usubstappp σ U α)) β))" using usubstappp_compose by simp
            have decV: "snd (usubstappp σ V (α ;; β)) = Composeo (snd(usubstappp σ V α)) (snd(usubstappp σ (fst(usubstappp σ V α)) β))" using usubstappp_compose by simp
            from Compose have fact1: "snd(usubstappp σ V α) ≠ undefg" using Composeo_undef by auto 
            from Compose have fact2: "snd(usubstappp σ (fst(usubstappp σ U α)) β) ≠ undefg" using Composeo_undef by auto 
            have rel: "fst(usubstappp σ V α) ⊆ fst(usubstappp σ U α)" using ‹V⊆U› usubstappp_fst_mon by auto
            from Compose have fact3: "snd(usubstappp σ (fst(usubstappp σ V α)) β) ≠ undefg" using fact2 rel by auto 
            then show ?thesis by (simp add: Composeo_undef fact1)
          qed*)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Loopo_undef snd_conv usubstappp.simps<span class="main">(</span>6<span class="main">)</span> usubstappp_fst_mon <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dual <span class="skolem">α</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Dualo_undef snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">⊆</span><span class="free">U</span> <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">=</span> usubstappf <span class="free">σ</span> <span class="free">V</span> <span class="free">φ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">⊆</span><span class="free">U</span> <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">=</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">V</span> <span class="free">α</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappf_and_usubstappp_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappf_antimon<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">⊆</span><span class="free">U</span> <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">=</span> usubstappf <span class="free">σ</span> <span class="free">V</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubstappf_and_usubstappp_antimon <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappp_antimon<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">⊆</span><span class="free">U</span> <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">=</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">V</span> <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubstappf_and_usubstappp_antimon <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Taboo Lemmas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubstappp_loop_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">⟹</span>
  snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">∧</span>
  snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg"</span></span>
  <span class="comment1">(*using usubstappp_loop Loopo_undef*)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> undefg"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fact<span class="main">:</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">⊇</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubst_taboos_mon <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg"</span></span> <span class="keyword1"><span class="command">using</span></span> a usubstappp_loop Loopo_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg"</span></span> <span class="keyword1"><span class="command">using</span></span> a usubstappp_loop Loopo_undef fact usubstappp_antimon <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 13 of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹http://arxiv.org/abs/1902.07230›</span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubst_taboos<span class="main">:</span> <span class="quoted"><span class="quoted">"snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">≠</span>undefg <span class="main">⟹</span> fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">⊇</span> <span class="free">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> game_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Game <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"SGames <span class="free">σ</span> <span class="skolem">a</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> BVG_assign Assigno_undef
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Assigno.elims BVG_assign_other fst_pair option.sel singletonI snd_pair subsetI union_or usubstappp.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ODE <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> BVG_ODE ODEo_undef
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ODEo.elims Un_least fst_pair option.sel snd_conv sup.coboundedI2 usubst_taboos_mon usubstappp.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Test <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> BVG_test Testo_undef usubst_taboos_mon <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Choice <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="comment1">(*using usubstappp.simps Product_Type.fst_conv Product_Type.snd_conv BVG_choice*)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> Choice <span class="keyword1"><span class="command">have</span></span> IHa<span class="main">:</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Choiceo_undef<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Choice <span class="keyword1"><span class="command">have</span></span> IHb<span class="main">:</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Choiceo_undef<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> fact<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊇</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Choice <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BVG_choice
        <span class="comment1">(*by (smt Choice.prems Choiceo.simps(1) Choiceo_undef option.collapse option.sel snd_pair usubstappp_choice)*)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Agame <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="main">∪∪</span> the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Choiceo <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Choice.prems Choiceo.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> option.collapse usubstappp_choice_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> BVG_choice Choice.prems Pair_inject option.collapse option.inject surjective_pairing usubstappp.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> IHa <span class="keyword2"><span class="keyword">and</span></span> IHb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">∪</span> fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Choice <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappp.simps Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Choice <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Choice <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappp.simps fact <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Compose <span class="keyword1"><span class="command">have</span></span> IHa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?V</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Composeo_undef<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Compose <span class="keyword1"><span class="command">have</span></span> IHb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?W</span> <span class="main">⊇</span> <span class="var">?V</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Composeo_undef<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> fact<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊇</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappp.simps BVG_compose
        <span class="comment1">(*by (smt Compose.prems Composeo.simps(1) Composeo_undef option.collapse option.sel snd_pair)*)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> undefg <span class="main">∨</span> Agame <span class="main">(</span>the <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> option.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Agame <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">α</span> <span class="main">;;</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Compose.prems Composeo_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> BVG_compose Compose.prems option.inject<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?W</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappp.simps Let_def IHa IHb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?W</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fact <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappp.simps Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="var">?V</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Loop <span class="keyword1"><span class="command">have</span></span> defα<span class="main">:</span> <span class="quoted"><span class="quoted">"snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">≠</span> undefg"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappp_loop_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Loop <span class="keyword1"><span class="command">have</span></span> IHdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?V</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> defα usubstappp_loop<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> σ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">σ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> α<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">α</span></span><span class="main">]</span> Loopo_undef<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> α<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">α</span><span class="main">)</span>›</span></span><span class="main">]</span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Loop <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?W</span> <span class="main">⊇</span> <span class="var">?V</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="var">?V</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loopo_undef<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Vfix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?V</span> <span class="main">⊇</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="var">?V</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> usubstappp_det <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IHdef Loop.prems le_sup_iff usubstappp_loop_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?V</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> usubstappp.simps Vfix IHdef BVG_loop usubst_taboos_mon usubstappp_loop_conv
        <span class="comment1">(*by (smt Loop.prems Loopo.simps(1) Un_mono option.collapse option.sel snd_pair sup.absorb_iff1)*)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> undefg <span class="main">∨</span> Agame <span class="main">(</span>the <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> option.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">∧</span> snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">≠</span> undefg"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Loop.prems usubstappp_loop_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Agame <span class="main">(</span>Loop <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> BVG_loop Loop.prems Vfix option.inject sup.absorb_iff1 sup.mono usubst_taboos_mon<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappp.simps Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dual <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="comment1">(*using BVG_dual usubstappp.simps Let_def by auto*)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Dual <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?V</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dualo_undef<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> fact<span class="main">:</span> <span class="quoted"><span class="quoted">"BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊇</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Dual <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappp.simps BVG_dual
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Dual.prems Dualo.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Dualo.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> option.collapse option.sel snd_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?V</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Dual <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH fact <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Dual <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="main">⊇</span> <span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="skolem">U</span> <span class="main">(</span>Dual <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappp.simps Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Substitution Adjoints›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Modified interpretation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>repI I f d›</span></span></span></span> replaces the interpretation of constant function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> in the interpretation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>I›</span></span></span></span> with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">repc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">" interp <span class="main">⇒</span> ident <span class="main">⇒</span> real <span class="main">⇒</span> interp"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">repc</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span>  mkinterp<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">c</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">else</span> Consts <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">c</span><span class="main">)</span><span class="main">,</span> Funcs <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Preds <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Games <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> repc_consts <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Consts <span class="main">(</span>repc <span class="free">I</span> <span class="free">f</span> <span class="free">d</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">c</span><span class="main">=</span><span class="free">f</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">d</span> <span class="keyword1">else</span> Consts <span class="free">I</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> repc_funcs <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Funcs <span class="main">(</span>repc <span class="free">I</span> <span class="free">f</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> Funcs <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> repc_preds <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Preds <span class="main">(</span>repc <span class="free">I</span> <span class="free">f</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> Preds <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> repc_games <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Games <span class="main">(</span>repc <span class="free">I</span> <span class="free">f</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> Games <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mon_mono<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> adjoint_stays_mon<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="keyword1">case</span> SGames <span class="free">σ</span> <span class="free">a</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Games <span class="free">I</span> <span class="free">a</span> <span class="main">|</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="main">λ</span><span class="bound">X</span><span class="main">.</span> game_sem <span class="free">I</span> <span class="bound">r</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> game_sem_mono game_sem.simps<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjE_realizer2 option.case_distrib<span class="main">)</span> 
  <span class="comment1">(*proof -
  have "∀z p b i f. (mono (case z of None ⇒ f | Some x ⇒ game_sem i x) ∨ ¬ (case z of None ⇒ b | Some x ⇒ p x)) ∨ ¬ mono f"
  by (metis (no_types) disjE_realizer2 game_sem_mono)
  then show ?thesis
  by (metis (no_types) game_sem.simps(1) game_sem_mono option.case_distrib)
  qed*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹adjoint interpretation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>adjoint σ I ω›</span></span></span></span> to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>σ›</span></span></span></span> of interpretation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>I›</span></span></span></span> in state <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ω›</span></span></span></span>›</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">adjoint</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> <span class="main">(</span>interp <span class="main">⇒</span> state <span class="main">⇒</span> interp<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">adjoint</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span> <span class="main">=</span> mkinterp<span class="main">(</span>
         <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> SConst <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Consts <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">f</span><span class="main">|</span> Some <span class="bound">r</span> <span class="main">⇒</span> term_sem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">r</span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
         <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Funcs <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">f</span> <span class="main">|</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="main">λ</span><span class="bound">d</span><span class="main">.</span> term_sem <span class="main">(</span>repc <span class="free"><span class="bound"><span class="entity">I</span></span></span> dotid <span class="bound">d</span><span class="main">)</span> <span class="bound">r</span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
         <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Preds <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">p</span> <span class="main">|</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">∈</span>fml_sem <span class="main">(</span>repc <span class="free"><span class="bound"><span class="entity">I</span></span></span> dotid <span class="bound">d</span><span class="main">)</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
         <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> SGames <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">a</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Games <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">a</span> <span class="main">|</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="main">λ</span><span class="bound">X</span><span class="main">.</span> game_sem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">r</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>
  <span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Simple Observations about Adjoints›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> adjoint_consts<span class="main">:</span> <span class="quoted"><span class="quoted">"Consts <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="main">(</span><span class="keyword1">case</span> SConst <span class="free">σ</span> <span class="free">f</span> <span class="keyword1">of</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="bound">r</span> <span class="main">|</span> None <span class="main">⇒</span> Const <span class="free">f</span><span class="main">)</span> <span class="free">ω</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> adjoint_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"SConst <span class="free">σ</span> <span class="free">f</span><span class="main">=</span>None"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> adjoint_funcs<span class="main">:</span> <span class="quoted"><span class="quoted">"Funcs <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SFuncs <span class="free">σ</span> <span class="free">f</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Funcs <span class="free">I</span> <span class="free">f</span> <span class="main">|</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="main">λ</span><span class="bound">d</span><span class="main">.</span> term_sem <span class="main">(</span>repc <span class="free">I</span> dotid <span class="bound">d</span><span class="main">)</span> <span class="bound">r</span> <span class="free">ω</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> adjoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> adjoint_funcs_match<span class="main">:</span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="free">f</span><span class="main">=</span>Some <span class="free">r</span> <span class="main">⟹</span> Funcs <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> term_sem <span class="main">(</span>repc <span class="free">I</span> dotid <span class="bound">d</span><span class="main">)</span> <span class="free">r</span> <span class="free">ω</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> adjoint_funcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> adjoint_funcs_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"SFuncs <span class="free">σ</span> <span class="free">f</span><span class="main">=</span>None <span class="main">⟹</span> Funcs <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> Funcs <span class="free">I</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> adjoint_funcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> adjoint_preds<span class="main">:</span> <span class="quoted"><span class="quoted">"Preds <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="free">σ</span> <span class="free">p</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Preds <span class="free">I</span> <span class="free">p</span> <span class="main">|</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="free">ω</span><span class="main">∈</span>fml_sem <span class="main">(</span>repc <span class="free">I</span> dotid <span class="bound">d</span><span class="main">)</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> adjoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> adjoint_preds_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="free">p</span><span class="main">=</span>None <span class="main">⟹</span> Preds <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> Preds <span class="free">I</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> adjoint_preds <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> adjoint_preds_match<span class="main">:</span> <span class="quoted"><span class="quoted">"SPreds <span class="free">σ</span> <span class="free">p</span><span class="main">=</span>Some <span class="free">r</span> <span class="main">⟹</span> Preds <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="free">ω</span><span class="main">∈</span>fml_sem <span class="main">(</span>repc <span class="free">I</span> dotid <span class="bound">d</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> adjoint_preds <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> adjoint_games <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Games <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SGames <span class="free">σ</span> <span class="free">a</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Games <span class="free">I</span> <span class="free">a</span> <span class="main">|</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="main">λ</span><span class="bound">X</span><span class="main">.</span> game_sem <span class="free">I</span> <span class="bound">r</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> adjoint_def <span class="keyword1"><span class="command">using</span></span> adjoint_stays_mon Games_mkinterp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

<span class="keyword1"><span class="command">lemma</span></span> adjoint_dotsubstt<span class="main">:</span> <span class="quoted"><span class="quoted">"adjoint <span class="main">(</span>dotsubstt <span class="free">θ</span><span class="main">)</span> <span class="free">I</span> <span class="free">ω</span> <span class="main">=</span> repc <span class="free">I</span> dotid <span class="main">(</span>term_sem <span class="free">I</span> <span class="free">θ</span> <span class="free">ω</span><span class="main">)</span>"</span></span>
  <span class="comment1">(*unfolding adjoint_def dotsubstt_def adjoint_consts adjoint_funcs_skip adjoint_preds adjoint_games*)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"adjoint <span class="main">(</span>dotsubstt <span class="free">θ</span><span class="main">)</span> <span class="free">I</span> <span class="free">ω</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"repc <span class="free">I</span> dotid <span class="main">(</span>term_sem <span class="free">I</span> <span class="free">θ</span> <span class="free">ω</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> feq<span class="main">:</span> <span class="quoted"><span class="quoted">"Funcs <span class="var">?lhs</span> <span class="main">=</span> Funcs <span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> repc_funcs adjoint_funcs dotsubstt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> peq<span class="main">:</span> <span class="quoted"><span class="quoted">"Preds <span class="var">?lhs</span> <span class="main">=</span> Preds <span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> repc_preds adjoint_preds dotsubstt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> geq<span class="main">:</span> <span class="quoted"><span class="quoted">"Games <span class="var">?lhs</span> <span class="main">=</span> Games <span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> repc_games adjoint_games dotsubstt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> ceq<span class="main">:</span> <span class="quoted"><span class="quoted">"Consts <span class="var">?lhs</span> <span class="main">=</span> Consts <span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> repc_consts  adjoint_consts dotsubstt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mkinterp_eq<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="var">?lhs</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> J<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span><span class="main">]</span> feq peq geq ceq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Uniform Substitution for Terms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 15 of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹http://arxiv.org/abs/1902.07230›</span></span>›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> usubst_term<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ν</span> <span class="free">ω</span> <span class="free">U</span> <span class="main">⟹</span> usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span><span class="main">≠</span>undeft <span class="main">⟹</span>
    term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">θ</span> <span class="free">ν</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword3"><span class="command">assume</span></span> vaouter<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ν</span> <span class="free">ω</span> <span class="free">U</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> defouter<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="free">U</span> <span class="free">θ</span><span class="main">≠</span>undeft"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"usubstappt <span class="skolem">σ</span> <span class="free">U</span> <span class="skolem">θ</span><span class="main">≠</span>undeft <span class="main">⟹</span> term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="free">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="free">ν</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">σ</span> <span class="skolem">θ</span>
    <span class="keyword1"><span class="command">using</span></span> vaouter <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ν</span></span> <span class="quoted"><span class="free">ω</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> usubstappt_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Number <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">r</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Const <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">f</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"SConst <span class="skolem">σ</span> <span class="skolem">f</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> adjoint_consts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usappconst_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">r</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> varcond<span class="main">:</span> <span class="quoted"><span class="quoted">"FVT<span class="main">(</span><span class="skolem">r</span><span class="main">)</span><span class="main">∩</span><span class="skolem">U</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Const usubstappt_const usubstappt_const_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.inject option.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Some <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="skolem">r</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> varcond<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="skolem">r</span> <span class="skolem">ω</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Const coincidence_term_cor<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ν</span></span> <span class="quoted"><span class="skolem">ω</span></span> <span class="quoted"><span class="skolem">U</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> varcond <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Consts <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Some adjoint_consts <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Const <span class="skolem">f</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>FuncMatch <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> va<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"SFuncs <span class="skolem">σ</span> <span class="skolem">f</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None 
      <span class="keyword1"><span class="command">from</span></span> FuncMatch <span class="keyword2"><span class="keyword">and</span></span> None <span class="keyword1"><span class="command">have</span></span> IHsubterm<span class="main">:</span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> va
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FuncMatch.IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> usubstappt_func_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> None <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_func IHsubterm adjoint_funcs
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> FuncMatch.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> option.case_eq_if option.sel term_sem.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> usubstappt.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">r</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> varcond<span class="main">:</span> <span class="quoted"><span class="quoted">"FVT<span class="main">(</span><span class="skolem">r</span><span class="main">)</span><span class="main">∩</span><span class="skolem">U</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FuncMatch usubstappt_func usubstappt_func2 usubstappt_func_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">from</span></span> FuncMatch <span class="keyword1"><span class="command">have</span></span> subdef<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_func_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> FuncMatch <span class="keyword2"><span class="keyword">and</span></span> Some
      <span class="keyword1"><span class="command">have</span></span> IHsubterm<span class="main">:</span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> va subdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> FuncMatch <span class="keyword2"><span class="keyword">and</span></span> Some
      <span class="keyword1"><span class="command">have</span></span> IHsubsubst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span> <span class="bound">ω</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="bound">ω</span> <span class="main">{}</span> <span class="main">⟹</span> term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="bound">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="bound">ω</span><span class="main">)</span> <span class="skolem">r</span> <span class="bound">ν</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subdef varcond <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> deq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IHsubterm<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dotIa</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"adjoint <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="skolem">ν</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> Some 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subdef varcond <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> term_sem <span class="var">?dotIa</span> <span class="skolem">r</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IHsubsubst<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ν</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ω<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ν</span></span><span class="main">]</span> Uvariation_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> term_sem <span class="main">(</span>repc <span class="free">I</span> dotid <span class="var">?d</span><span class="main">)</span> <span class="skolem">r</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adjoint_dotsubstt<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> θ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ω<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ν</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> term_sem <span class="main">(</span>repc <span class="free">I</span> dotid <span class="var">?d</span><span class="main">)</span> <span class="skolem">r</span> <span class="skolem">ω</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincidence_term_cor<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ω<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ν</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ω'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ω</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> θ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹repc <span class="free">I</span> dotid <span class="var">?d</span>›</span></span><span class="main">]</span> va varcond <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="comment1">(*I.^dω⟦σf(⋅)⟧  also have "... = term_sem ?dotIa r ω" using coincidence_term_cor[of ν ω U r ?dotIa] uv varcond by simp*)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Funcs <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span><span class="main">(</span><span class="var">?d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adjoint_funcs_match Some <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Funcs <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span><span class="main">(</span>term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="skolem">ν</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> deq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Func <span class="skolem">f</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="skolem">η</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Pluso_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="skolem">η</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Timeso_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Differential <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Differential <span class="keyword1"><span class="command">have</span></span> subdef<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="skolem">σ</span> allvars <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappt_differential_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Differential <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span><span class="main">.</span> term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> allvars <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="bound">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="bound">ν</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subdef Uvariation_univ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="comment1">(*by auto*)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Differential <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="main">(</span>Differential <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> allvars <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">ν</span><span class="main">(</span>DVar <span class="bound">x</span><span class="main">)</span><span class="main">*</span>deriv<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> allvars <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>repv <span class="skolem">ν</span> <span class="main">(</span>RVar <span class="bound">x</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="skolem">ν</span><span class="main">(</span>RVar <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">(</span>allidents<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">ν</span><span class="main">(</span>DVar <span class="bound">x</span><span class="main">)</span><span class="main">*</span>deriv<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="main">(</span>repv <span class="skolem">ν</span> <span class="main">(</span>RVar <span class="bound">x</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="skolem">ν</span><span class="main">(</span>RVar <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">(</span>allidents<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Differential <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Differential <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Differential <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Uniform Substitution for Formulas and Games›</span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Separately Prove Crucial Ingredient for the ODE Case of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>usubst_fml_game›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> same_ODE_same_sol<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">ν</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">⟹</span> term_sem <span class="free">I</span> <span class="free">θ</span> <span class="bound">ν</span> <span class="main">=</span> term_sem <span class="free">J</span> <span class="free">η</span> <span class="bound">ν</span><span class="main">)</span>
  <span class="main">⟹</span> solves_ODE <span class="free">I</span> <span class="free">F</span> <span class="free">x</span> <span class="free">θ</span> <span class="main">=</span> solves_ODE <span class="free">J</span> <span class="free">F</span> <span class="free">x</span> <span class="free">η</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Uvariation_Vagree Vagree_def solves_ODE_def
    <span class="comment1">(*by (smt double_complement)*)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> va<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">⟹</span> term_sem <span class="free">I</span> <span class="free">θ</span> <span class="bound">ν</span> <span class="main">=</span> term_sem <span class="free">J</span> <span class="free">η</span> <span class="bound">ν</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> va2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">⟹</span> term_sem <span class="free">J</span> <span class="free">η</span> <span class="bound">ν</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="free">θ</span> <span class="bound">ν</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">θ</span> <span class="bound">η</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">ν</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">⟹</span> term_sem <span class="bound">I</span> <span class="bound">θ</span> <span class="bound">ν</span> <span class="main">=</span> term_sem <span class="bound">J</span> <span class="bound">η</span> <span class="bound">ν</span><span class="main">)</span>
   <span class="main">⟹</span> solves_ODE <span class="bound">I</span> <span class="free">F</span> <span class="free">x</span> <span class="bound">θ</span> <span class="main">⟹</span> solves_ODE <span class="bound">J</span> <span class="free">F</span> <span class="free">x</span> <span class="bound">η</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">θ</span> <span class="skolem">η</span>
     <span class="keyword3"><span class="command">assume</span></span> vaflow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">⟹</span> term_sem <span class="skolem">I</span> <span class="skolem">θ</span> <span class="bound">ν</span> <span class="main">=</span> term_sem <span class="skolem">J</span> <span class="skolem">η</span> <span class="bound">ν</span>"</span></span>
     <span class="keyword3"><span class="command">assume</span></span> sol<span class="main">:</span> <span class="quoted"><span class="quoted">"solves_ODE <span class="skolem">I</span> <span class="free">F</span> <span class="free">x</span> <span class="skolem">θ</span>"</span></span>
     <span class="keyword1"><span class="command">from</span></span> vaflow <span class="keyword2"><span class="keyword">and</span></span> sol <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"solves_ODE <span class="skolem">J</span> <span class="free">F</span> <span class="free">x</span> <span class="skolem">η</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> solves_ODE_def <span class="keyword1"><span class="command">using</span></span> Uvariation_Vagree coincidence_term
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_complement solves_Vagree sol<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"solves_ODE <span class="free">I</span> <span class="free">F</span> <span class="free">x</span> <span class="free">θ</span> <span class="main">=</span> solves_ODE <span class="free">J</span> <span class="free">F</span> <span class="free">x</span> <span class="free">η</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> one<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> θ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">θ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> η<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">η</span></span><span class="main">,</span> <span class="operator">OF</span> va<span class="main">]</span> one<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> θ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">η</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> η<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">θ</span></span><span class="main">,</span> <span class="operator">OF</span> va2<span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> usubst_ode<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subdef<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span> <span class="free">θ</span> <span class="main">≠</span> undeft"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"solves_ODE <span class="free">I</span> <span class="free">F</span> <span class="free">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> solves_ODE <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span> <span class="free">x</span> <span class="free">θ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> vaflow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F</span> <span class="bound">θ</span> <span class="bound">ζ</span><span class="main">.</span> solves_ODE <span class="free">I</span> <span class="bound">F</span> <span class="free">x</span> <span class="bound">θ</span> <span class="main">⟹</span> Uvariation <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> solves_Vagree_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> subdef <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">⟹</span> term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="bound">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">θ</span> <span class="bound">ν</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usubst_term<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IH vaflow solves_ODE_def Uvariation_Vagree same_ODE_same_sol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubst_ode_ext<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>     uv<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subdef<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span> <span class="main">≠</span> undeft"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"solves_ODE <span class="free">I</span> <span class="free">F</span> <span class="free">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> solves_ODE <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">F</span> <span class="free">x</span> <span class="free">θ</span>"</span></span>
  <span class="comment1">(*using usubst_ode usubstappt_det usubstappt_antimon Uvariation_Vagree Uvariation_mon *)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> vaflow1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F</span> <span class="bound">θ</span> <span class="bound">ζ</span><span class="main">.</span> solves_ODE <span class="free">I</span> <span class="bound">F</span> <span class="free">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="bound">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Uvariation <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> solves_Vagree_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> vaflow2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F</span> <span class="bound">θ</span> <span class="bound">ζ</span><span class="main">.</span> solves_ODE <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="bound">F</span> <span class="free">x</span> <span class="bound">θ</span> <span class="main">⟹</span> Uvariation <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="bound">ζ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> solves_Vagree_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> subdef <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="bound">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">θ</span> <span class="bound">ν</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Uvariation_refl Uvariation_trans usubst_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> l2r<span class="main">:</span> <span class="quoted"><span class="quoted">"solves_ODE <span class="free">I</span> <span class="free">F</span> <span class="free">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> solves_ODE <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">F</span> <span class="free">x</span> <span class="free">θ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vaflow1 subdef same_ODE_same_sol Uvariation_trans usubst_term uv
      <span class="comment1">(*by (smt sup_commute sup_left_idem)*)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"solves_ODE <span class="free">I</span> <span class="free">F</span> <span class="free">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> interp <span class="main">⇒</span> trm <span class="main">⇒</span> interp <span class="main">⇒</span> char <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> variable <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> variable <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">x3</span> <span class="bound">x4</span> <span class="bound">x5</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v6</span><span class="main">.</span> Uvariation <span class="bound">v6</span> <span class="main">(</span><span class="bound">x5</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span>RVar <span class="bound">x4</span><span class="main">,</span> DVar <span class="bound">x4</span><span class="main">}</span> <span class="main">∧</span> term_sem <span class="bound">x3</span> <span class="bound">x2</span> <span class="bound">v6</span> <span class="main">≠</span> term_sem <span class="bound">x1</span> <span class="bound">x0</span> <span class="bound">v6</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Uvariation <span class="main">(</span><span class="skolem">rr</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">x3</span> <span class="bound">x4</span> <span class="bound">x5</span><span class="main">)</span> <span class="main">(</span><span class="bound">x5</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span>RVar <span class="bound">x4</span><span class="main">,</span> DVar <span class="bound">x4</span><span class="main">}</span> <span class="main">∧</span> term_sem <span class="bound">x3</span> <span class="bound">x2</span> <span class="main">(</span><span class="skolem">rr</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">x3</span> <span class="bound">x4</span> <span class="bound">x5</span><span class="main">)</span> <span class="main">≠</span> term_sem <span class="bound">x1</span> <span class="bound">x0</span> <span class="main">(</span><span class="skolem">rr</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">x3</span> <span class="bound">x4</span> <span class="bound">x5</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="main">(</span><span class="free">F</span> <span class="main">0</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span>insert <span class="main">(</span>RVar <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{}</span> <span class="main">∪</span> <span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">=</span> insert <span class="main">(</span>DVar <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{}</span> <span class="main">∪</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> insert <span class="main">(</span>RVar <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>RVar <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{}</span> <span class="main">∪</span> <span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">=</span> insert <span class="main">(</span>DVar <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{}</span> <span class="main">∪</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> Uvariation <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">θ</span> <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">x</span> <span class="free">F</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> insert <span class="main">(</span>RVar <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Uvariation <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">θ</span> <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">x</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span> <span class="main">∨</span> term_sem <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">θ</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">θ</span> <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">x</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">θ</span> <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">x</span> <span class="free">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f4 subdef usubst_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Uvariation <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">θ</span> <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">x</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span> <span class="main">∨</span> term_sem <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">θ</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">θ</span> <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">x</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rr</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">θ</span> <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">x</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Uvariation_trans insert_is_Un<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> same_ODE_same_sol<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">have</span></span> r2l<span class="main">:</span> <span class="quoted"><span class="quoted">"solves_ODE <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">F</span> <span class="free">x</span> <span class="free">θ</span> <span class="main">⟹</span> solves_ODE <span class="free">I</span> <span class="free">F</span> <span class="free">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vaflow2 subdef same_ODE_same_sol Uvariation_trans usubst_term uv
      <span class="comment1">(*by (smt sup_commute sup_left_idem)*)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"solves_ODE <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">F</span> <span class="free">x</span> <span class="free">θ</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> interp <span class="main">⇒</span> trm <span class="main">⇒</span> interp <span class="main">⇒</span> char <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> variable <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> variable <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">x3</span> <span class="bound">x4</span> <span class="bound">x5</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v6</span><span class="main">.</span> Uvariation <span class="bound">v6</span> <span class="main">(</span><span class="bound">x5</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span>RVar <span class="bound">x4</span><span class="main">,</span> DVar <span class="bound">x4</span><span class="main">}</span> <span class="main">∧</span> term_sem <span class="bound">x3</span> <span class="bound">x2</span> <span class="bound">v6</span> <span class="main">≠</span> term_sem <span class="bound">x1</span> <span class="bound">x0</span> <span class="bound">v6</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Uvariation <span class="main">(</span><span class="skolem">rr</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">x3</span> <span class="bound">x4</span> <span class="bound">x5</span><span class="main">)</span> <span class="main">(</span><span class="bound">x5</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span>RVar <span class="bound">x4</span><span class="main">,</span> DVar <span class="bound">x4</span><span class="main">}</span> <span class="main">∧</span> term_sem <span class="bound">x3</span> <span class="bound">x2</span> <span class="main">(</span><span class="skolem">rr</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">x3</span> <span class="bound">x4</span> <span class="bound">x5</span><span class="main">)</span> <span class="main">≠</span> term_sem <span class="bound">x1</span> <span class="bound">x0</span> <span class="main">(</span><span class="skolem">rr</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">x3</span> <span class="bound">x4</span> <span class="bound">x5</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="bound">c</span> <span class="bound">i</span> <span class="bound">t</span> <span class="bound">ia</span> <span class="bound">ta</span><span class="main">.</span> Uvariation <span class="main">(</span><span class="skolem">rr</span> <span class="bound">ta</span> <span class="bound">ia</span> <span class="bound">t</span> <span class="bound">i</span> <span class="bound">c</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span>RVar <span class="bound">c</span><span class="main">,</span> DVar <span class="bound">c</span><span class="main">}</span> <span class="main">∧</span> term_sem <span class="bound">i</span> <span class="bound">t</span> <span class="main">(</span><span class="skolem">rr</span> <span class="bound">ta</span> <span class="bound">ia</span> <span class="bound">t</span> <span class="bound">i</span> <span class="bound">c</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≠</span> term_sem <span class="bound">ia</span> <span class="bound">ta</span> <span class="main">(</span><span class="skolem">rr</span> <span class="bound">ta</span> <span class="bound">ia</span> <span class="bound">t</span> <span class="bound">i</span> <span class="bound">c</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∨</span> solves_ODE <span class="bound">i</span> <span class="bound">f</span> <span class="bound">c</span> <span class="bound">t</span> <span class="main">=</span> solves_ODE <span class="bound">ia</span> <span class="bound">f</span> <span class="bound">c</span> <span class="bound">ta</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> same_ODE_same_sol<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="main">(</span><span class="free">F</span> <span class="main">0</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="free">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="main">(</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="free">U</span><span class="main">)</span> <span class="free">θ</span> <span class="main">≠</span> undeft"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Uvariation <span class="main">(</span><span class="skolem">rr</span> <span class="free">θ</span> <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">x</span> <span class="free">F</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Uvariation <span class="main">(</span><span class="skolem">rr</span> <span class="free">θ</span> <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">x</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span> <span class="main">∨</span> term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rr</span> <span class="free">θ</span> <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">x</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> term_sem <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">θ</span> <span class="main">(</span><span class="skolem">rr</span> <span class="free">θ</span> <span class="main">(</span>USubst.adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span> DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">x</span> <span class="free">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute usubst_term<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f3 f2 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Uvariation_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> l2r <span class="keyword2"><span class="keyword">and</span></span> r2l <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubst_ode_ext2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subdef<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span> <span class="main">≠</span> undeft"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>     uv<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"solves_ODE <span class="free">I</span> <span class="free">F</span> <span class="free">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="free">σ</span> <span class="main">(</span><span class="free">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="free">x</span><span class="main">,</span>DVar <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> solves_ODE <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">F</span> <span class="free">x</span> <span class="free">θ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubst_ode_ext subdef uv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Separately Prove the Loop Case of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>usubst_fml_game›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> union_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">=</span><span class="free">B</span><span class="main">∪</span><span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">loopfpτ</span><span class="main">::</span> <span class="quoted"><span class="quoted">"game <span class="main">⇒</span> interp <span class="main">⇒</span> <span class="main">(</span>state set <span class="main">⇒</span> state set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">loopfpτ</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> lfp<span class="main">(</span><span class="main">λ</span><span class="bound">Z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∪</span> game_sem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="bound">Z</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubst_game_loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  uv<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ν</span> <span class="free">ω</span> <span class="free">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  IHαrec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="bound">ω</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span><span class="main">≠</span>undefg <span class="main">⟹</span> 
         <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="bound">ω</span><span class="main">)</span> <span class="free">α</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">≠</span>undefg <span class="main">⟹</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> def<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">≠</span>undefg"</span></span>
  <span class="keyword1"><span class="command">have</span></span> loopfix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">α</span> <span class="bound">I</span> <span class="bound">X</span><span class="main">.</span> loopfpτ <span class="bound">α</span> <span class="bound">I</span> <span class="bound">X</span> <span class="main">=</span> game_sem <span class="bound">I</span> <span class="main">(</span>Loop <span class="bound">α</span><span class="main">)</span> <span class="bound">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> loopfpτ_def <span class="keyword1"><span class="command">using</span></span> game_sem_loop <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σαloopoff</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σα</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σαloop</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Loop <span class="var">?σα</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> loopform<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?σαloopoff</span> <span class="main">=</span> <span class="var">?σαloop</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappp_loop
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Loopo.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> def option.exhaust_sel option.inject snd_conv usubstappp_loop_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?τ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"loopfpτ <span class="var">?σαloop</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ρ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"loopfpτ <span class="free">α</span> <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fact1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V</span><span class="main">.</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="bound">V</span> <span class="free">α</span><span class="main">)</span><span class="main">≠</span>undefg <span class="main">⟹</span>  fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="bound">V</span> <span class="free">α</span><span class="main">)</span> <span class="main">⊇</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="bound">V</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubst_taboos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> fact2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V</span> <span class="bound">W</span><span class="main">.</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="bound">V</span> <span class="free">α</span><span class="main">)</span><span class="main">≠</span>undefg <span class="main">⟹</span> snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="bound">W</span> <span class="free">α</span><span class="main">)</span><span class="main">≠</span>undefg <span class="main">⟹</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="bound">V</span> <span class="free">α</span><span class="main">)</span> <span class="main">⊇</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="free">σ</span> <span class="bound">W</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fact1 usubst_taboos usubstappp_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> VgeqBV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?V</span> <span class="main">⊇</span> BVG<span class="main">(</span><span class="var">?σα</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubst_taboos fact2 def usubstappp_loop_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> uvV<span class="main">:</span> <span class="quoted"><span class="quoted">"Vagree <span class="free">ν</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span><span class="var">?V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uv
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Uvariation_Vagree Uvariation_mon double_compl usubst_taboos_mon<span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> τeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?τ</span><span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">=</span> game_sem <span class="free">I</span> <span class="var">?σαloop</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> loopfix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ρeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ρ</span><span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">=</span> game_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="main">(</span>Loop <span class="free">α</span><span class="main">)</span> <span class="free">X</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> loopfix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> τisρ<span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span><span class="var">?τ</span><span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span><span class="var">?V</span><span class="main">)</span><span class="main">=</span> selectlike <span class="main">(</span><span class="var">?ρ</span><span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span><span class="var">?V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">Z</span><span class="main">.</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="var">?σα</span> <span class="bound">Z</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">Y</span><span class="main">.</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">α</span> <span class="bound">Y</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">Z</span> <span class="bound">Y</span><span class="main">.</span> selectlike <span class="bound">Z</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span><span class="var">?V</span><span class="main">)</span> <span class="main">=</span> selectlike <span class="bound">Y</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span><span class="var">?V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">(</span>lfp <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>lfp <span class="var">?g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lfp_lockstep_induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="var"><span class="var">?f</span></span>›</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="var"><span class="var">?g</span></span>›</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> R<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="var"><span class="var">?R</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> monof
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> game_sem_loop_fixpoint_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> monog
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> game_sem_loop_fixpoint_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IHfp<span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="skolem">A</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span><span class="var">?V</span><span class="main">)</span> <span class="main">=</span> selectlike <span class="skolem">B</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span><span class="var">?V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="var">?σα</span> <span class="skolem">A</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span><span class="var">?V</span><span class="main">)</span> <span class="main">=</span> selectlike <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> game_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">α</span> <span class="skolem">B</span><span class="main">)</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span><span class="var">?V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> selectlike_equal_cocond_corule
          <span class="comment1">(*[where ν=ω and V=‹?V› and X=‹X ∪ game_sem I ?σα A› and Y=‹X ∪ game_sem (adjoint σ I ω) α B›]*)</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">μ</span>
        <span class="keyword3"><span class="command">assume</span></span> muvar<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">μ</span> <span class="free">ω</span> <span class="var">?V</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> forw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="var">?σα</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="var">?σα</span> <span class="main">(</span>selectlike <span class="skolem">A</span> <span class="skolem">μ</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span><span class="var">?σα</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> boundeffect <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">α</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="var">?σα</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IHαrec<span class="main">[</span><span class="operator">OF</span> muvar<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> def usubstappp_loop_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="var">?σα</span> <span class="main">(</span>selectlike <span class="skolem">B</span> <span class="skolem">μ</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span><span class="var">?σα</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> boundeffect <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> backw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span>  <span class="free">X</span> <span class="main">∪</span> game_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">α</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="var">?σα</span> <span class="main">(</span>selectlike <span class="skolem">B</span> <span class="skolem">μ</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span><span class="var">?σα</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

        <span class="keyword1"><span class="command">have</span></span> samewin<span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="skolem">A</span> <span class="skolem">μ</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span><span class="var">?σα</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> selectlike <span class="skolem">B</span> <span class="skolem">μ</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span><span class="var">?σα</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IHfp selectlike_antimon VgeqBV muvar Uvariation_trans selectlike_equal_cocond
            <span class="comment1">(*by (smt le_iff_sup)*)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Vagree <span class="skolem">μ</span> <span class="free">ω</span> <span class="main">(</span><span class="main">-</span> fst <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Uvariation_Vagree double_complement muvar<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"selectlike <span class="skolem">A</span> <span class="skolem">μ</span> <span class="main">(</span><span class="main">-</span> fst <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> selectlike <span class="skolem">B</span> <span class="skolem">μ</span> <span class="main">(</span><span class="main">-</span> fst <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> IHfp selectlike_Vagree <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Compl_subset_Compl_iff VgeqBV selectlike_compose sup.absorb_iff2<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> forw <span class="keyword2"><span class="keyword">and</span></span> backw <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="var">?σα</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∪</span> game_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">α</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> samewin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>union <span class="skolem">M</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> selectlike_Sup<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ω</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="var">?V</span>›</span></span><span class="main">]</span> fst_proj_def snd_proj_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> τeq loopfix loopfpτ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> τeq ρeq τisρ similar_selectlike_mem<span class="main">[</span><span class="operator">OF</span> uvV<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> loopform<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> usubst_fml_game<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> vaouter<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ν</span> <span class="free">ω</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span><span class="main">≠</span>undeff <span class="main">⟹</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">≠</span>undefg <span class="main">⟹</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">α</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"usubstappf <span class="skolem">σ</span> <span class="free">U</span> <span class="skolem">φ</span><span class="main">≠</span>undeff <span class="main">⟹</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="free">U</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="free">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">≠</span>undefg <span class="main">⟹</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="free">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="skolem">α</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">σ</span> <span class="skolem">φ</span> <span class="skolem">α</span>
    <span class="keyword1"><span class="command">using</span></span> vaouter <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="skolem">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ν</span></span> <span class="quoted"><span class="free">ω</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ν</span></span> <span class="quoted"><span class="free">ω</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> usubstappfp_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pred <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> va<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"SPreds <span class="skolem">σ</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubst_term<span class="main">[</span><span class="operator">OF</span> va<span class="main">]</span> adjoint_preds_skip
          <span class="comment1">(*by (smt Pred.prems(1) fml_sem.simps(1) mem_Collect_eq option.case_eq_if option.sel usubstappf.simps(1))*)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">V</span> <span class="bound">c</span> <span class="bound">t</span><span class="main">.</span> usubstappf <span class="bound">p</span> <span class="bound">V</span> <span class="main">(</span>Pred <span class="bound">c</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> usubstappt <span class="bound">p</span> <span class="bound">V</span> <span class="bound">t</span> <span class="main">=</span> undeft <span class="keyword1">then</span> undeff <span class="keyword1">else</span> <span class="keyword1">case</span> SPreds <span class="bound">p</span> <span class="bound">c</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="bound">c</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="bound">p</span> <span class="bound">V</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="bound">p</span> <span class="bound">V</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> option.case_eq_if<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">V</span> <span class="bound">c</span> <span class="bound">t</span><span class="main">.</span> <span class="keyword1">if</span> usubstappt <span class="bound">p</span> <span class="bound">V</span> <span class="bound">t</span> <span class="main">=</span> undeft <span class="keyword1">then</span> usubstappf <span class="bound">p</span> <span class="bound">V</span> <span class="main">(</span>Pred <span class="bound">c</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> undeff <span class="keyword1">else</span> usubstappf <span class="bound">p</span> <span class="bound">V</span> <span class="main">(</span>Pred <span class="bound">c</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> SPreds <span class="bound">p</span> <span class="bound">c</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Afml <span class="main">(</span>Pred <span class="bound">c</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="bound">p</span> <span class="bound">V</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">f</span> <span class="main">⇒</span> <span class="keyword1">if</span> FVF <span class="bound">f</span> <span class="main">∩</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="bound">p</span> <span class="bound">V</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="bound">f</span> <span class="keyword1">else</span> undeff<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Pred.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappf <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> Afml <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> None <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Pred.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> None <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">θ</span> <span class="bound">σ</span> <span class="bound">I</span><span class="main">.</span> usubstappt <span class="bound">σ</span> <span class="skolem">U</span> <span class="bound">θ</span> <span class="main">≠</span> undeft <span class="main">⟹</span> term_sem <span class="bound">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="bound">σ</span> <span class="skolem">U</span> <span class="bound">θ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>USubst.adjoint <span class="bound">σ</span> <span class="bound">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="bound">θ</span> <span class="skolem">ν</span>›</span></span> adjoint_preds_skip<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">r</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> varcond<span class="main">:</span> <span class="quoted"><span class="quoted">"FVF<span class="main">(</span><span class="skolem">r</span><span class="main">)</span><span class="main">∩</span><span class="skolem">U</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pred usubstappf_pred usubstappf_pred2 usubstappf_pred_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span> 
      <span class="keyword1"><span class="command">from</span></span> Pred <span class="keyword1"><span class="command">have</span></span> subdef<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappf_pred_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> Pred <span class="keyword2"><span class="keyword">and</span></span> Some
      <span class="keyword1"><span class="command">have</span></span> IHsubsubst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span> <span class="bound">ω</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="bound">ω</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="bound">ω</span><span class="main">)</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subdef varcond <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> deq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> usubst_term<span class="main"><span class="main">[</span></span><span class="operator">OF</span> va subdef<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dotIa</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"adjoint <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="skolem">ν</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> Some
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="main">(</span>dotsubstt <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subdef varcond <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="var">?dotIa</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IHsubsubst<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ν</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ω<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ν</span></span><span class="main">]</span> Uvariation_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="main">(</span>repc <span class="free">I</span> dotid <span class="var">?d</span><span class="main">)</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adjoint_dotsubstt<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> θ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ω<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ν</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ω</span><span class="main">∈</span>fml_sem <span class="main">(</span>repc <span class="free">I</span> dotid <span class="var">?d</span><span class="main">)</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coincidence_formula_cor<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ω<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ν</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ω'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ω</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> φ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹repc <span class="free">I</span> dotid <span class="var">?d</span>›</span></span><span class="main">]</span> va varcond <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="comment1">(*I.^dω⟦σf(⋅)⟧  also have "... = term_sem ?dotIa r ω" using coincidence_term_cor[of ν ω U r ?dotIa] uv varcond by simp*)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Preds <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span><span class="main">(</span><span class="var">?d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adjoint_preds_match Some <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Preds <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span><span class="main">(</span>term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="skolem">ν</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> deq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Geq <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="skolem">η</span><span class="main">)</span>
      <span class="comment1">(* then show ?case using usubst_term usubstappf_geq usubstappf_geq_conv
          by (smt fml_sem.simps(2) mem_Collect_eq option.sel)*)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> def1<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappf_geq_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> def2<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">η</span> <span class="main">≠</span> undeft"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstappf_geq_conv Geq.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> usubst_term<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>›</span></span><span class="main">,</span> <span class="operator">OF</span> def1<span class="main">]</span> usubst_term<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>›</span></span><span class="main">,</span><span class="operator">OF</span> def2<span class="main">]</span> usubstappf_geqr<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹usubstappf <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Geq <span class="skolem">θ</span> <span class="skolem">η</span><span class="main">)</span> <span class="main">≠</span> undeff›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">φ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Noto_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Ando_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Exists <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">x</span> <span class="skolem">φ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span> <span class="bound">ω</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="bound">ω</span> <span class="main">(</span><span class="skolem">U</span><span class="main">∪</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">U</span><span class="main">∪</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="bound">ω</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> Exists <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="comment1">(*from Exists have subdef: "usubstappt σ (U∪{x}) θ ≠ undeft" by auto*)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Uvar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">d</span><span class="main">.</span> Uvariation <span class="main">(</span>repv <span class="skolem">ν</span> <span class="skolem">x</span> <span class="bound">d</span><span class="main">)</span> <span class="skolem">ω</span> <span class="main">(</span><span class="skolem">U</span><span class="main">∪</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Uvariation_repv Uvariation_trans Uvariation_sym
      <span class="keyword1"><span class="command">using</span></span> Exists.prems<span class="main">(</span>2<span class="main">)</span> Uvariation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Exists <span class="skolem">x</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="free">I</span> <span class="main">(</span>Exists <span class="skolem">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">U</span><span class="main">∪</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> usubstappf_exists Exists.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span>repv <span class="skolem">ν</span> <span class="skolem">x</span> <span class="bound">d</span><span class="main">)</span><span class="main">∈</span>fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">U</span><span class="main">∪</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span>repv <span class="skolem">ν</span> <span class="skolem">x</span> <span class="bound">d</span><span class="main">)</span><span class="main">∈</span>fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH Uvar <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Exists <span class="skolem">x</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Exists <span class="skolem">x</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="skolem">ν</span><span class="main">∈</span>fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Exists <span class="skolem">x</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Diamond <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span> <span class="skolem">φ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Diamond <span class="keyword1"><span class="command">have</span></span> IHα<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">α</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">from</span></span> Diamond <span class="keyword1"><span class="command">have</span></span> IHφ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span> <span class="bound">ω</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="bound">ω</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="bound">ω</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Diamondo_undef<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> Diamond <span class="keyword1"><span class="command">have</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Diamond <span class="skolem">α</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">Vα</span> <span class="main">=</span> usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span> <span class="keyword1">in</span> Diamond <span class="main">(</span>the <span class="main">(</span>snd <span class="bound">Vα</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span>fst <span class="bound">Vα</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diamond.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Diamondo.elims option.sel usubstappf.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>Diamond <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="main">(</span>fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> boundeffect <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> forw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Diamond <span class="skolem">α</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="main">(</span>fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Diamond <span class="skolem">α</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">α</span> <span class="main">(</span>fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IHα uv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="main">(</span>fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> boundeffect <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> backw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Diamond <span class="skolem">α</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="main">(</span>fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> samewin<span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span>fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> selectlike <span class="main">(</span>fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> selectlike_equal_cocond_corule<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">μ</span>
      <span class="keyword3"><span class="command">assume</span></span> muvar<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">μ</span> <span class="skolem">ν</span> <span class="main">(</span>BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> Uμω<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">μ</span> <span class="skolem">ω</span> <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> muvar uv Uvariation_trans union_comm usubst_taboos Uvariation_mon
          <span class="comment1">(*by (smt Diamond.prems(1) Diamondo.simps(2) usubstappf.simps(6))*)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
        <span class="keyword1"><span class="command">have</span></span> Uμν<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">μ</span> <span class="skolem">ν</span> <span class="main">(</span>BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> muvar<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> Uνω<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uv<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">μ</span> <span class="skolem">ω</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∪</span> BVG<span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Uvariation_trans<span class="main">[</span><span class="operator">OF</span> Uμν Uνω<span class="main">]</span> union_comm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> HOL.back_subst<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubst_taboos Uvariation_mon <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Diamond.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Diamondo_undef Uvariation_mon usubst_taboos usubstappf.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span>fst<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> muvar Uvariation_trans uv IHφ boundeffect Uvariation_mon usubst_taboos Uμω <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="main">(</span>fst <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> forw <span class="keyword2"><span class="keyword">and</span></span> backw <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Diamond <span class="skolem">α</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Diamond <span class="skolem">α</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> samewin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">next</span></span> <span class="comment1">(* games *)</span>

    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Game <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> adjoint_games usubstappp_game <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"SGames <span class="skolem">σ</span> <span class="skolem">a</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubst_term Assigno_undef
        <span class="comment1">(*by (smt Assigno.elims game_sem.simps(2) mem_Collect_eq option.sel snd_pair usubstappp.simps(2))*)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammer*)</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Assign.prems<span class="main">(</span>1<span class="main">)</span> Assigno_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"repv <span class="skolem">ν</span> <span class="skolem">x</span> <span class="main">(</span>term_sem <span class="main">(</span>USubst.adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"repv <span class="skolem">ν</span> <span class="skolem">x</span> <span class="main">(</span>term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f1 Assign.prems<span class="main">(</span>2<span class="main">)</span> usubst_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"repv <span class="skolem">ν</span> <span class="skolem">x</span> <span class="main">(</span>term_sem <span class="main">(</span>USubst.adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>USubst.adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"repv <span class="skolem">ν</span> <span class="skolem">x</span> <span class="main">(</span>term_sem <span class="main">(</span>USubst.adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"repv <span class="skolem">ν</span> <span class="skolem">x</span> <span class="main">(</span>term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">X</span> <span class="main">∧</span> repv <span class="skolem">ν</span> <span class="skolem">x</span> <span class="main">(</span>term_sem <span class="main">(</span>USubst.adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f1 Assign.prems<span class="main">(</span>2<span class="main">)</span> usubst_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Test <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">φ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Testo_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Choice <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Choice <span class="keyword1"><span class="command">have</span></span> IHα<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">α</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Choiceo_undef<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> Choice <span class="keyword1"><span class="command">have</span></span> IHβ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">β</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Choiceo_undef<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> Choice <span class="keyword1"><span class="command">have</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IHα IHβ uv
        <span class="comment1">(*by (smt Choice.prems(1) Choiceo.elims game_sem.simps(4) option.sel snd_pair union_or usubstappp_choice) *)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"Agame <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Choice<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> option.collapse usubstappp_choice_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Agame <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Choice<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> option.collapse usubstappp_choice_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">α</span> <span class="main">∪∪</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Agame <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="main">∪∪</span> the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Choiceo.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> snd_conv usubstappp.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">∪</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">α</span> <span class="main">∪∪</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∉</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∉</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">α</span> <span class="main">∪∪</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span><span class="skolem">α</span> <span class="main">∪∪</span> <span class="skolem">β</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">ν</span> <span class="main">∉</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="skolem">ν</span> <span class="main">∉</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span><span class="skolem">α</span> <span class="main">∪∪</span> <span class="skolem">β</span><span class="main">)</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f2 Choice<span class="main">(</span>4<span class="main">)</span> IHα IHβ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∉</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">α</span> <span class="main">∪∪</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span><span class="skolem">α</span> <span class="main">∪∪</span> <span class="skolem">β</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f2 Choice<span class="main">(</span>4<span class="main">)</span> IHα <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Choice<span class="main">(</span>4<span class="main">)</span> IHβ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Compose <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Compose <span class="keyword1"><span class="command">have</span></span> IHα<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">α</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Composeo_undef<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> Compose <span class="keyword1"><span class="command">have</span></span> IHβ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="bound">ω</span> <span class="var">?V</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="bound">ω</span><span class="main">)</span> <span class="skolem">β</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Composeo_undef<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> Compose <span class="keyword1"><span class="command">have</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>Compose <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Compose.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Composeo.elims option.sel snd_pair usubstappp.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the<span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> boundeffect <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> forw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the<span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">α</span> <span class="main">(</span><span class="main">(</span>game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">β</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">β</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IHα<span class="main">[</span><span class="operator">OF</span> uv<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="main">(</span><span class="main">(</span>game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">β</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the<span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> boundeffect <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> backw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>selectlike <span class="main">(</span><span class="main">(</span>game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">β</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the<span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> samewin<span class="main">:</span> <span class="quoted"><span class="quoted">"selectlike <span class="main">(</span>game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the<span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> selectlike <span class="main">(</span><span class="main">(</span>game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">β</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">(</span><span class="main">-</span>BVG<span class="main">(</span>the<span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> selectlike_equal_cocond_corule<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">μ</span>
      <span class="keyword3"><span class="command">assume</span></span> muvar<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">μ</span> <span class="skolem">ν</span> <span class="main">(</span>BVG<span class="main">(</span>the<span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> Uμω<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">μ</span> <span class="skolem">ω</span> <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> muvar uv Uvariation_trans union_comm usubst_taboos Uvariation_mon
          <span class="comment1">(*by (smt Compose.prems(1) Composeo_undef snd_pair usubstappp.simps(5))*)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">μ</span> <span class="skolem">ω</span> <span class="main">(</span>BVG <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Uvariation_trans muvar uv<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Uvariation_mon union_comm usubst_taboos
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Compose.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Composeo_undef Pair_inject prod.collapse usubstappp_compose<span class="main">)</span> 
            <span class="comment1">(*by (metis (no_types) Uvariation_mon union_comm usubst_taboos)*)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the<span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">β</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> muvar Uvariation_trans uv IHβ boundeffect Uvariation_mon usubst_taboos Uμω <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the<span class="main">(</span>snd<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="var">?V</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">μ</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">β</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> forw <span class="keyword2"><span class="keyword">and</span></span> backw <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the<span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Compose <span class="skolem">α</span> <span class="skolem">β</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> samewin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Loop <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Loop <span class="keyword1"><span class="command">have</span></span> selfdef<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> undefg"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Loop <span class="keyword1"><span class="command">have</span></span> IHαrec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span> <span class="bound">ω</span> <span class="bound">X</span><span class="main">.</span> Uvariation <span class="bound">ν</span> <span class="bound">ω</span> <span class="var">?V</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="var">?V</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="bound">ω</span><span class="main">)</span> <span class="skolem">α</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">from</span></span> Loop <span class="keyword1"><span class="command">have</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>Loop <span class="skolem">α</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> usubst_game_loop IHαrec Loop.prems<span class="main">(</span>2<span class="main">)</span> selfdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="comment1">(*by (rule usubst_game_loop[OF uv (*IHα*) IHαrec])*)</span>

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dual <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Dual <span class="keyword1"><span class="command">have</span></span> IHα<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">α</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
    <span class="keyword1"><span class="command">from</span></span> Dual <span class="keyword1"><span class="command">have</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Dual <span class="keyword1"><span class="command">have</span></span> def<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">α</span><span class="keyword1">^d</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> undefg"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="comment1">(*show ?case using IHα[OF uv]
    by (smt Compl_iff Dual.prems(1) Dualo.elims game_sem.simps(7) option.sel snd_pair usubstappp.simps(7))*)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> <span class="main">-</span>game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="skolem">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> <span class="main">-</span>game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">α</span> <span class="main">(</span><span class="main">-</span><span class="skolem">X</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IHα<span class="main">[</span><span class="operator">OF</span> uv<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="keyword1">^d</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span><span class="skolem">α</span><span class="keyword1">^d</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> game_sem.simps<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> usubstappp_dual Dualo_undef
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">σ</span> <span class="bound">V</span> <span class="bound">α</span><span class="main">.</span> snd <span class="main">(</span>usubstappp <span class="bound">σ</span> <span class="skolem">U</span> <span class="main">(</span><span class="bound">α</span><span class="keyword1">^d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Dualo <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="bound">σ</span> <span class="skolem">U</span> <span class="bound">α</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">≠</span> undefg"</span></span> <span class="keyword1"><span class="command">using</span></span> Dualo_undef def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="keyword1">^d</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>USubst.adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span><span class="skolem">α</span><span class="keyword1">^d</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span> 

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ODE <span class="skolem">σ</span> <span class="skolem">U</span> <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> va<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> ODE <span class="keyword1"><span class="command">have</span></span> subdef<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstappt <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="skolem">x</span><span class="main">,</span>DVar <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">θ</span> <span class="main">≠</span> undeft"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ODEo_undef<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> ODE <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"term_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="skolem">x</span><span class="main">,</span>DVar <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">=</span> term_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="skolem">θ</span> <span class="skolem">ν</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> va
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ODEo_undef fst_pair snd_conv usubst_taboos_mon usubst_term usubstappp.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> usubstappt_antimon<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>ODE <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>ODEo <span class="skolem">x</span> <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="skolem">x</span><span class="main">,</span>DVar <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>ODE <span class="skolem">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="skolem">x</span><span class="main">,</span>DVar <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F</span> <span class="bound">T</span><span class="main">.</span> Vagree <span class="skolem">ν</span> <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span>DVar <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">(</span><span class="bound">T</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> solves_ODE <span class="free">I</span> <span class="bound">F</span> <span class="skolem">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="skolem">x</span><span class="main">,</span>DVar <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F</span> <span class="bound">T</span><span class="main">.</span> Uvariation <span class="skolem">ν</span> <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>DVar <span class="skolem">x</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">(</span><span class="bound">T</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> solves_ODE <span class="free">I</span> <span class="bound">F</span> <span class="skolem">x</span> <span class="main">(</span>the <span class="main">(</span>usubstappt <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">U</span><span class="main">∪</span><span class="main">{</span>RVar <span class="skolem">x</span><span class="main">,</span>DVar <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Uvariation_Vagree <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_compl<span class="main">)</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F</span> <span class="bound">T</span><span class="main">.</span> Uvariation <span class="skolem">ν</span> <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>DVar <span class="skolem">x</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">(</span><span class="bound">T</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> solves_ODE <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="bound">F</span> <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> usubst_ode_ext2<span class="main">[</span><span class="operator">OF</span> subdef<span class="main">]</span> va solves_Vagree_trans Uvariation_trans Uvariation_sym_rel Uvariation_mon <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subset_insertI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F</span> <span class="bound">T</span><span class="main">.</span> Vagree <span class="skolem">ν</span> <span class="main">(</span><span class="bound">F</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span>DVar <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">(</span><span class="bound">T</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> solves_ODE <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="bound">F</span> <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Uvariation_Vagree <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_compl<span class="main">)</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>ODE <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> solves_ODE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="skolem">σ</span> <span class="skolem">U</span> <span class="main">(</span>ODE <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="skolem">σ</span> <span class="free">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>ODE <span class="skolem">x</span> <span class="skolem">θ</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 16 of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹http://arxiv.org/abs/1902.07230›</span></span>›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> usubst_fml<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ν</span> <span class="free">ω</span> <span class="free">U</span> <span class="main">⟹</span> usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span>
    <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> fml_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="free">σ</span> <span class="free">U</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubst_fml_game <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 17 of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹http://arxiv.org/abs/1902.07230›</span></span>›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> usubst_game<span class="main">:</span> <span class="quoted"><span class="quoted">"Uvariation <span class="free">ν</span> <span class="free">ω</span> <span class="free">U</span> <span class="main">⟹</span> snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span> <span class="main">≠</span> undefg <span class="main">⟹</span>
    <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> game_sem <span class="free">I</span> <span class="main">(</span>the <span class="main">(</span>snd <span class="main">(</span>usubstappp <span class="free">σ</span> <span class="free">U</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν</span> <span class="main">∈</span> game_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="free">I</span> <span class="free">ω</span><span class="main">)</span> <span class="free">α</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubst_fml_game <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness of Uniform Substitution of Formulas›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">usubsta</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> fml <span class="main">⇒</span> fmlo"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">usubsta</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> usubstappf <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">{}</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 18 of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹http://arxiv.org/abs/1902.07230›</span></span>›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> usubst_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"usubsta <span class="free">σ</span> <span class="free">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span> valid <span class="free">φ</span> <span class="main">⟹</span> valid <span class="main">(</span>the <span class="main">(</span>usubsta <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> def<span class="main">:</span> <span class="quoted"><span class="quoted">"usubsta <span class="free">σ</span> <span class="free">φ</span> <span class="main">≠</span> undeff"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> prem<span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> prem <span class="keyword1"><span class="command">have</span></span> premc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">ω</span><span class="main">.</span> <span class="bound">ω</span> <span class="main">∈</span> fml_sem <span class="bound">I</span> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid <span class="main">(</span>the <span class="main">(</span>usubsta <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">ω</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ω</span> <span class="main">∈</span> fml_sem <span class="skolem">I</span> <span class="main">(</span>the <span class="main">(</span>usubsta <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ω</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="skolem">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubst_fml <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usubst_fml def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> premc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ω</span> <span class="main">∈</span> fml_sem <span class="skolem">I</span> <span class="main">(</span>the <span class="main">(</span>usubsta <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">∈</span> fml_sem <span class="skolem">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="free">σ</span> <span class="main">{}</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness of Uniform Substitution of Rules›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Uniform Substitution applied to a rule or inference›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">usubstr</span><span class="main">::</span> <span class="quoted"><span class="quoted">"usubst <span class="main">⇒</span> inference <span class="main">⇒</span> inference option"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">usubstr</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="main">(</span>usubstappf <span class="free"><span class="bound"><span class="entity">σ</span></span></span> allvars <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">≠</span> undeff <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">φ</span><span class="main">∈</span>set <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span><span class="main">.</span> usubstappf <span class="free"><span class="bound"><span class="entity">σ</span></span></span> allvars <span class="bound">φ</span> <span class="main">≠</span> undeff<span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span>
    Some<span class="main">(</span>map<span class="main">(</span>the <span class="keyword1">o</span> <span class="main">(</span>usubstappf <span class="free"><span class="bound"><span class="entity">σ</span></span></span> allvars<span class="main">)</span><span class="main">)</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span><span class="main">,</span> the <span class="main">(</span>usubstappf <span class="free"><span class="bound"><span class="entity">σ</span></span></span> allvars <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1">else</span>
    None"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Simple observations about applying uniform substitutions to a rule›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubstr_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstr <span class="free">σ</span> <span class="free">R</span> <span class="main">≠</span> None <span class="main">⟹</span>
  usubstappf <span class="free">σ</span> allvars <span class="main">(</span>snd <span class="free">R</span><span class="main">)</span> <span class="main">≠</span> undeff <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">φ</span><span class="main">∈</span>set <span class="main">(</span>fst <span class="free">R</span><span class="main">)</span><span class="main">.</span> usubstappf <span class="free">σ</span> allvars <span class="bound">φ</span> <span class="main">≠</span> undeff<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> usubstr_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstr_union_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>append <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubstr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> usubstr_union_undef2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>append <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubstr_union_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstr_cons_undef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>Cons <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">[</span><span class="free">A</span><span class="main">]</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubstr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> usubstr_cons_undef2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>Cons <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">[</span><span class="free">A</span><span class="main">]</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubstr_cons_undef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstr_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>Cons <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">⟹</span>
  the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>Cons <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Cons <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">[</span><span class="free">A</span><span class="main">]</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubstr_union_undef map_cons usubstr_def
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>Cons <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Cons <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="var">?R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>map<span class="main">(</span>the <span class="keyword1">o</span> <span class="main">(</span>usubstappf <span class="free">σ</span> allvars<span class="main">)</span><span class="main">)</span><span class="main">(</span>fst <span class="var">?R</span><span class="main">)</span> <span class="main">,</span> the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="main">(</span>snd <span class="var">?R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> def usubstr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.sel<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Cons <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map<span class="main">(</span>the <span class="keyword1">o</span> <span class="main">(</span>usubstappf <span class="free">σ</span> allvars<span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">,</span> the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="main">(</span>snd <span class="var">?R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> map_cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Cons <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">,</span> the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="main">(</span>snd <span class="var">?R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstr_cons_undef2<span class="main">[</span><span class="operator">OF</span> def<span class="main">]</span> usubstr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fst_conv option.sel<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Cons <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">,</span> snd <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">[</span><span class="free">A</span><span class="main">]</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> def usubstr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>Cons <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Cons <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">,</span> snd <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">[</span><span class="free">A</span><span class="main">]</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubstr_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>append <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">⟹</span>
  the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>append <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>append <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> usubstr_union_undef2
    <span class="comment1">(*by (smt fst_pair map_append option.sel snd_pair usubstr_def)*)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>append <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>append <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="var">?R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>map<span class="main">(</span>the <span class="keyword1">o</span> <span class="main">(</span>usubstappf <span class="free">σ</span> allvars<span class="main">)</span><span class="main">)</span><span class="main">(</span>fst <span class="var">?R</span><span class="main">)</span> <span class="main">,</span> the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="main">(</span>snd <span class="var">?R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> def usubstr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.sel<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>map<span class="main">(</span>the <span class="keyword1">o</span> <span class="main">(</span>usubstappf <span class="free">σ</span> allvars<span class="main">)</span><span class="main">)</span><span class="main">(</span>fst <span class="var">?R</span><span class="main">)</span> <span class="main">,</span> snd <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstr_union_undef2<span class="main">[</span><span class="operator">OF</span> def<span class="main">]</span> usubstr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.sel sndI<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>append <span class="main">(</span>map<span class="main">(</span>the <span class="keyword1">o</span> <span class="main">(</span>usubstappf <span class="free">σ</span> allvars<span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map<span class="main">(</span>the <span class="keyword1">o</span> <span class="main">(</span>usubstappf <span class="free">σ</span> allvars<span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">,</span> snd <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstr_union_undef2<span class="main">[</span><span class="operator">OF</span> def<span class="main">]</span> map_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>append <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstr_union_undef2<span class="main">[</span><span class="operator">OF</span> def<span class="main">]</span> usubstr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fst_conv option.sel<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="main">(</span>append <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>append <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> usubstr_length<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstr <span class="free">σ</span> <span class="free">R</span> <span class="main">≠</span> None <span class="main">⟹</span> length <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>fst <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_pair length_map option.sel usubstr_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> usubstr_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstr <span class="free">σ</span> <span class="free">R</span> <span class="main">≠</span> None <span class="main">⟹</span> <span class="main">0</span><span class="main">≤</span><span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span><span class="main">&lt;</span>length <span class="main">(</span>fst <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span>
   nth <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="main">(</span>nth <span class="main">(</span>fst <span class="free">R</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="comment1">(*unfolding usubstr_def using usubstr_length
  by (smt comp_apply fst_pair nth_map option.sel)*)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstr <span class="free">σ</span> <span class="free">R</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="free">k</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>length <span class="main">(</span>fst <span class="free">R</span><span class="main">)</span>"</span></span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="main">(</span>nth <span class="main">(</span>fst <span class="free">R</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">R</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">A</span> <span class="skolem">C</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">D</span> <span class="skolem">E</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> usubstr <span class="free">σ</span> <span class="main">(</span><span class="skolem">E</span><span class="main">,</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="bound">k</span> <span class="main">&lt;</span> length <span class="skolem">E</span> <span class="main">⟹</span> nth <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="skolem">E</span><span class="main">,</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">=</span> the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="main">(</span>nth <span class="skolem">E</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons usubstr_cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span>length <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> nati<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> def<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstr <span class="free">σ</span> <span class="main">(</span><span class="skolem">E</span><span class="main">,</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">using</span></span> usubstr_cons_undef2<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nth <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="main">(</span><span class="skolem">E</span><span class="main">,</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="main">(</span>nth <span class="main">(</span>fst <span class="main">(</span><span class="skolem">E</span><span class="main">,</span><span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">[</span><span class="operator">OF</span> def<span class="main">,</span> <span class="operator">OF</span> nati<span class="main">,</span> <span class="operator">OF</span> smaller<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons usubstr_cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 19 of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹http://arxiv.org/abs/1902.07230›</span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> usubst_rule_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstr <span class="free">σ</span> <span class="free">R</span> <span class="main">≠</span> None <span class="main">⟹</span> locally_sound <span class="free">R</span> <span class="main">⟹</span> locally_sound <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> def<span class="main">:</span> <span class="quoted"><span class="quoted">"usubstr <span class="free">σ</span> <span class="free">R</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> prem<span class="main">:</span> <span class="quoted"><span class="quoted">"locally_sound <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σD</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"usubstr <span class="free">σ</span> <span class="free">R</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ω</span>
  <span class="keyword1"><span class="command">from</span></span> usubst_fml <span class="keyword1"><span class="command">have</span></span> substeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">ν</span> <span class="bound">φ</span><span class="main">.</span> usubstappf <span class="free">σ</span> allvars <span class="bound">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> fml_sem <span class="bound">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="bound">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ν</span> <span class="main">∈</span> fml_sem <span class="main">(</span>adjoint <span class="free">σ</span> <span class="bound">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="bound">φ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Uvariation_univ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> substval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span><span class="main">.</span> usubstappf <span class="free">σ</span> allvars <span class="free">φ</span> <span class="main">≠</span> undeff <span class="main">⟹</span> valid_in <span class="bound">I</span> <span class="main">(</span>the <span class="main">(</span>usubstappf <span class="free">σ</span> allvars <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> valid_in <span class="main">(</span>adjoint <span class="free">σ</span> <span class="bound">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"locally_sound <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> locally_sound_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> length <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> valid_in <span class="skolem">I</span> <span class="main">(</span>nth <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> length <span class="main">(</span>fst <span class="free">R</span><span class="main">)</span> <span class="main">⟶</span> valid_in <span class="main">(</span>adjoint <span class="free">σ</span> <span class="skolem">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>nth <span class="main">(</span>fst <span class="free">R</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> substval usubstr_nth usubstr_length substeq valid_in_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> def nth_mem usubstr_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_in <span class="main">(</span>adjoint <span class="free">σ</span> <span class="skolem">I</span> <span class="skolem">ω</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prem <span class="keyword1"><span class="command">unfolding</span></span> locally_sound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_in <span class="skolem">I</span> <span class="main">(</span>snd <span class="main">(</span>the <span class="main">(</span>usubstr <span class="free">σ</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> usubst_fml substeq usubstr_def valid_in_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> def option.sel snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Ids">
<div class="head">
<h1>Theory Ids</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Ids"</span>
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <span class="quoted">"<a href="Syntax.html">Syntax</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some specific identifiers used in Axioms›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">hgid1</span><span class="main">::</span><span class="quoted">ident</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hgid1</span> <span class="main">≡</span> <span class="keyword1">CHR</span> <span class="inner_quoted">''a''</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">hgid2</span><span class="main">::</span><span class="quoted">ident</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hgid2</span> <span class="main">≡</span> <span class="keyword1">CHR</span> <span class="inner_quoted">''b''</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">hgidc</span><span class="main">::</span><span class="quoted">ident</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hgidc</span> <span class="main">≡</span> <span class="keyword1">CHR</span> <span class="inner_quoted">''c''</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">hgidd</span><span class="main">::</span><span class="quoted">ident</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hgidd</span> <span class="main">≡</span> <span class="keyword1">CHR</span> <span class="inner_quoted">''d''</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pid1</span><span class="main">::</span><span class="quoted">ident</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pid1</span>  <span class="main">≡</span> <span class="keyword1">CHR</span> <span class="inner_quoted">''p''</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pid2</span><span class="main">::</span><span class="quoted">ident</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pid2</span>  <span class="main">≡</span> <span class="keyword1">CHR</span> <span class="inner_quoted">''q''</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">fid1</span><span class="main">::</span><span class="quoted">ident</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fid1</span>  <span class="main">≡</span> <span class="keyword1">CHR</span> <span class="inner_quoted">''f''</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">xid1</span><span class="main">::</span><span class="quoted">variable</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xid1</span>  <span class="main">≡</span> RVar <span class="main">(</span><span class="keyword1">CHR</span> <span class="inner_quoted">''x''</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Axioms">
<div class="head">
<h1>Theory Axioms</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Axioms"</span> 
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="Syntax.html">Syntax</a>"</span>
  <span class="quoted">"<a href="Denotational_Semantics.html">Denotational_Semantics</a>"</span>
  <span class="quoted">"<a href="Ids.html">Ids</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Axioms and Axiomatic Proof Rules of Differential Game Logic›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Axioms›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pusall</span><span class="main">::</span> <span class="quoted"><span class="quoted">"fml"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pusall</span> <span class="main">≡</span> <span class="main">⟨</span>Game hgidc<span class="main">⟩</span>TT"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">nothing</span><span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nothing</span> <span class="main">≡</span> Number <span class="main">0</span>"</span></span>

  
<span class="keyword1"><span class="command">named_theorems</span></span> axiom_defs <span class="quoted">"Axiom definitions"</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">box_axiom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">axiom_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">box_axiom</span> <span class="main">≡</span> <span class="main">(</span>Box <span class="main">(</span>Game hgid1<span class="main">)</span> pusall<span class="main">)</span> <span class="main">↔</span> Not<span class="main">(</span>Diamond <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Not<span class="main">(</span>pusall<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assigneq_axiom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">axiom_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">assigneq_axiom</span> <span class="main">≡</span> <span class="main">(</span>Diamond <span class="main">(</span>Assign xid1 <span class="main">(</span>Const fid1<span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span> <span class="main">↔</span> Exists xid1 <span class="main">(</span>Equals <span class="main">(</span>Var xid1<span class="main">)</span> <span class="main">(</span>Const fid1<span class="main">)</span> <span class="main">&amp;&amp;</span> pusall<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stutterd_axiom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">axiom_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">stutterd_axiom</span> <span class="main">≡</span> <span class="main">(</span>Diamond <span class="main">(</span>Assign xid1 <span class="main">(</span>Var xid1<span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span> <span class="main">↔</span> pusall"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_axiom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">axiom_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">test_axiom</span> <span class="main">≡</span> Diamond <span class="main">(</span>Test <span class="main">(</span>Pred pid2 nothing<span class="main">)</span><span class="main">)</span> <span class="main">(</span>Pred pid1 nothing<span class="main">)</span> <span class="main">↔</span> <span class="main">(</span>Pred pid2 nothing <span class="main">&amp;&amp;</span> Pred pid1 nothing<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">choice_axiom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">axiom_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">choice_axiom</span> <span class="main">≡</span> Diamond <span class="main">(</span>Choice <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Game hgid2<span class="main">)</span><span class="main">)</span> pusall <span class="main">↔</span> <span class="main">(</span>Diamond <span class="main">(</span>Game hgid1<span class="main">)</span> pusall <span class="main">||</span> Diamond <span class="main">(</span>Game hgid2<span class="main">)</span> pusall<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compose_axiom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">axiom_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">compose_axiom</span> <span class="main">≡</span> Diamond <span class="main">(</span>Compose <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Game hgid2<span class="main">)</span><span class="main">)</span> pusall <span class="main">↔</span> Diamond <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Diamond <span class="main">(</span>Game hgid2<span class="main">)</span> pusall<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iterate_axiom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">axiom_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">iterate_axiom</span> <span class="main">≡</span> Diamond <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> pusall <span class="main">↔</span> <span class="main">(</span>pusall <span class="main">||</span> Diamond <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Diamond <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dual_axiom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fml"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">axiom_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">dual_axiom</span> <span class="main">≡</span> Diamond <span class="main">(</span>Dual <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> pusall <span class="main">↔</span> <span class="main">!</span><span class="main">(</span>Diamond <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span><span class="main">!</span>pusall<span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Axiomatic Rules›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> rule_defs <span class="quoted">"Rule definitions"</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mon_rule</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"inference"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">rule_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">mon_rule</span> <span class="main">≡</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">⟨</span>Game hgidc<span class="main">⟩</span>TT<span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="main">⟨</span>Game hgidd<span class="main">⟩</span>TT<span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">(</span><span class="main">⟨</span>Game hgid1<span class="main">⟩</span><span class="main">(</span><span class="main">⟨</span>Game hgidc<span class="main">⟩</span>TT<span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="main">⟨</span>Game hgid1<span class="main">⟩</span><span class="main">(</span><span class="main">⟨</span>Game hgidd<span class="main">⟩</span>TT<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FP_rule</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"inference"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">rule_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">FP_rule</span> <span class="main">≡</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="main">⟨</span>Game hgidc<span class="main">⟩</span>TT<span class="main">)</span> <span class="main">||</span> <span class="main">⟨</span>Game hgid1<span class="main">⟩</span><span class="main">⟨</span>Game hgidd<span class="main">⟩</span>TT<span class="main">)</span> <span class="main">→</span> <span class="main">⟨</span>Game hgidd<span class="main">⟩</span>TT<span class="main">]</span><span class="main">,</span> <span class="main">(</span><span class="main">⟨</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">⟩</span><span class="main">⟨</span>Game hgidc<span class="main">⟩</span>TT<span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="main">⟨</span>Game hgidd<span class="main">⟩</span>TT<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">MP_rule</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"inference"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">rule_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">MP_rule</span> <span class="main">≡</span> <span class="main">(</span><span class="main">[</span>Pred pid1 nothing <span class="main">,</span> Pred pid1 nothing <span class="main">→</span> Pred pid2 nothing<span class="main">]</span><span class="main">,</span> Pred pid2 nothing<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gena_rule</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"inference"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">rule_defs</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">gena_rule</span> <span class="main">≡</span> <span class="main">(</span><span class="main">[</span>pusall<span class="main">]</span><span class="main">,</span> Exists xid1 pusall<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness / Validity Proofs for Axioms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Because an axiom in a uniform substitution calculus is an individual formula, 
  proving the validity of that formula suffices to prove soundness›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> box_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid box_axiom"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> box_axiom_def Box_def Or_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(*lemma assign_equal: "game_sem I (Assign x (Const f)) (fml_sem I φ) = fml_sem I (Exists x (Equals (Var x) (Const f) &amp;&amp; φ))"
  by simp*)</span>

<span class="keyword1"><span class="command">lemma</span></span> assigneq_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid assigneq_axiom"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> assigneq_axiom_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_equiv<span class="main">)</span>
  
<span class="comment1">(*lemma game_sem_stutter: "game_sem I (Assign x (Var x)) X = X"
  by (auto simp add: repv_self)*)</span>

<span class="keyword1"><span class="command">lemma</span></span> stutterd_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid stutterd_axiom"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> stutterd_axiom_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_equiv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> test_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid test_axiom"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> test_axiom_def Or_def <span class="keyword1"><span class="command">using</span></span> valid_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> choice_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid choice_axiom"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> choice_axiom_def Or_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_equiv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compose_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid compose_axiom"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compose_axiom_def Or_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_equiv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dual_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid dual_axiom"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> dual_axiom_def <span class="keyword1"><span class="command">using</span></span> valid_equiv fml_sem_not <span class="keyword1"><span class="command">using</span></span> fml_sem.simps<span class="main">(</span>6<span class="main">)</span> game_sem.simps<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> iterate_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid iterate_axiom"</span></span>
<span class="comment1">(*unfolding iterate_axiom_def using valid_equiv fml_sem.simps(6) game_equiv_subst[OF loop_iterate_equiv]*)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">I</span><span class="main">.</span> fml_sem <span class="bound">I</span> <span class="main">(</span>Diamond <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span> <span class="main">=</span> fml_sem <span class="bound">I</span> <span class="main">(</span>pusall <span class="main">||</span> Diamond <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Diamond <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fml_sem <span class="skolem">I</span> <span class="main">(</span>Diamond <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span> <span class="main">=</span> game_sem <span class="skolem">I</span> <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> <span class="main">(</span>fml_sem <span class="skolem">I</span> pusall<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fml_sem.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> game_sem <span class="skolem">I</span> <span class="main">(</span>Choice Skip <span class="main">(</span>Compose <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fml_sem <span class="skolem">I</span> pusall<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> game_equiv_subst<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹fml_sem <span class="skolem">I</span> pusall›</span></span><span class="main">,</span> <span class="operator">OF</span> loop_iterate_equiv<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> α<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">‹Game hgid1›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fml_sem <span class="skolem">I</span> <span class="main">(</span>Diamond <span class="main">(</span>Choice Skip <span class="main">(</span>Compose <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fml_sem <span class="skolem">I</span> <span class="main">(</span>Diamond Skip pusall <span class="main">||</span> Diamond <span class="main">(</span>Compose <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fml_sem <span class="skolem">I</span> <span class="main">(</span>pusall <span class="main">||</span> Diamond <span class="main">(</span>Compose <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fml_sem <span class="skolem">I</span> <span class="main">(</span>pusall <span class="main">||</span> Diamond <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Diamond <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fml_sem <span class="skolem">I</span> <span class="main">(</span>Diamond <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span> <span class="main">=</span> fml_sem <span class="skolem">I</span> <span class="main">(</span>pusall <span class="main">||</span> Diamond <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Diamond <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid <span class="main">(</span><span class="main">(</span>Diamond <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span> <span class="main">↔</span> <span class="main">(</span>pusall <span class="main">||</span> Diamond <span class="main">(</span>Game hgid1<span class="main">)</span> <span class="main">(</span>Diamond <span class="main">(</span>Loop <span class="main">(</span>Game hgid1<span class="main">)</span><span class="main">)</span> pusall<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_equiv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_iffD2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid iterate_axiom"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> iterate_axiom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Local Soundness Proofs for Axiomatic Rules›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mon_locsound<span class="main">:</span> <span class="quoted"><span class="quoted">"locally_sound mon_rule"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mon_rule_def locally_sound_def <span class="keyword1"><span class="command">using</span></span> valid_in_impl monotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> FP_locsound<span class="main">:</span> <span class="quoted"><span class="quoted">"locally_sound FP_rule"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FP_rule_def locally_sound_def <span class="keyword1"><span class="command">using</span></span> valid_in_impl game_sem_loop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> MP_locsound<span class="main">:</span> <span class="quoted"><span class="quoted">"locally_sound MP_rule"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> MP_rule_def locally_sound_def valid_in_def <span class="keyword1"><span class="command">using</span></span> fml_sem_implies less_Suc_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">lemma</span></span> gena_locsound<span class="main">:</span> <span class="quoted"><span class="quoted">"locally_sound gena_rule"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> gena_rule_def locally_sound_def valid_in_def <span class="keyword1"><span class="command">using</span></span> fml_sem_implies less_Suc_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Differential_Game_Logic">
<div class="head">
<h1>Theory Differential_Game_Logic</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹dGL Formalization›</span></span>

<span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Differential_Game_Logic"</span> 
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <span class="quoted">"<a href="Lib.html">Lib</a>"</span>
  <span class="quoted">"<a href="Identifiers.html">Identifiers</a>"</span>
  <span class="quoted">"<a href="Syntax.html">Syntax</a>"</span>
  <span class="quoted">"<a href="Denotational_Semantics.html">Denotational_Semantics</a>"</span>
  <span class="quoted">"<a href="Static_Semantics.html">Static_Semantics</a>"</span>
  <span class="quoted">"<a href="Coincidence.html">Coincidence</a>"</span>
  <span class="quoted">"<a href="USubst.html">USubst</a>"</span>
  <span class="quoted">"<a href="Axioms.html">Axioms</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This formalization of Differential Game Logic <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹http://arxiv.org/abs/1902.07230›</span></span> \cite{DBLP:conf/cade/Platzer19} consists of
the syntax, denotational semantics, static semantics, uniform substitution lemmas, uniform substitution soundness proofs, and soundness proofs for axioms.›</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 
</pre>
</div>