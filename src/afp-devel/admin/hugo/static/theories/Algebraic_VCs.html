<div id="VC_KAT_scratch">
<div class="head">
<h1>Theory VC_KAT_scratch</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Program Correctness Component Based on Kleene Algebra with Tests
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Two Standalone Components›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAT_scratch
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Component Based on Kleene Algebra with Tests›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This component supports the verification and step-wise refinement of simple while programs
in a partial correctness setting.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹KAT: Definition and Basic Properties›</span></span>

<span class="keyword1"><span class="command">notation</span></span> times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> plus_ord <span class="main">=</span> plus <span class="main">+</span> ord <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> less_eq_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> less_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> dioid <span class="main">=</span> semiring <span class="main">+</span> one <span class="main">+</span> zero <span class="main">+</span> plus_ord <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> add_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> mult_onel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> mult_oner <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">1</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> add_zerol <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> annil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> annir <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> monoid_mult 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> order
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_def less_eq_def add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-mult_isol"><span class="command">lemma</span></span> mult_isol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left less_eq_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-mult_isor"><span class="command">lemma</span></span> mult_isor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right less_eq_def<span class="main">)</span>
                                         
<span class="keyword1" id="VC_KAT_scratch-add_iso"><span class="command">lemma</span></span> add_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> abel_semigroup.commute add.abel_semigroup_axioms add.semigroup_axioms add_idem less_eq_def semigroup.assoc<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-add_lub"><span class="command">lemma</span></span> add_lub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc add.left_commute add_idem less_eq_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> kleene_algebra <span class="main">=</span> dioid <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">star</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup></span></span></span>"</span> <span class="main">[</span>101<span class="main">]</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_unfoldl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span>"</span></span>  
  <span class="keyword2"><span class="keyword">and</span></span> star_unfoldr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> star_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> star_inductr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="VC_KAT_scratch-star_sim"><span class="command">lemma</span></span> star_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_lub distrib_left eq_refl less_eq_def mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_lub mult_isor star_unfoldr <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_inductr<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> kat <span class="main">=</span> kleene_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">at</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> test_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">at</span> <span class="main">(</span><span class="free">at</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">at</span> <span class="main">(</span><span class="free">at</span> <span class="main">(</span><span class="free">at</span> <span class="main">(</span><span class="free">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">at</span> <span class="main">(</span><span class="free">at</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">at</span> <span class="main">(</span><span class="free">at</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">at</span> <span class="main">(</span><span class="free">at</span> <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> test_mult_comp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">at</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">at</span> <span class="main">(</span><span class="free">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_de_morgan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">at</span> <span class="free">x</span> <span class="main">+</span> <span class="free">at</span> <span class="free">y</span> <span class="main">=</span> <span class="free">at</span> <span class="main">(</span><span class="free">at</span> <span class="main">(</span><span class="free">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">at</span> <span class="main">(</span><span class="free">at</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">t_op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">t</span>_"</span> <span class="main">[</span>100<span class="main">]</span> 101<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">t</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> at <span class="main">(</span>at <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="VC_KAT_scratch-t_n"><span class="command">lemma</span></span> t_n <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="main">(</span>at <span class="free">x</span><span class="main">)</span> <span class="main">=</span> at <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem test_de_morgan test_mult t_op_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-t_comm"><span class="command">lemma</span></span> t_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">t</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute test_de_morgan test_mult t_op_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-t_idem"><span class="command">lemma</span></span> t_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">t</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem test_de_morgan test_mult t_op_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-t_mult_closed"><span class="command">lemma</span></span> t_mult_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="main">(</span><span class="keyword1">t</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">t</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> t_comm t_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Propositional Hoare Logic›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⟷</span> <span class="keyword1">t</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">if_then_else</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">if</span> _ <span class="keyword1">then</span> _ <span class="keyword1">else</span> _ <span class="keyword1">fi</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">if</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">then</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">else</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1"><span class="free">fi</span></span> <span class="main">=</span> <span class="keyword1">t</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> at <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">while</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">do</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">od</span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">t</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> at <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">inv</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">while</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">inv</span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1"><span class="free">do</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">od</span></span> <span class="main">=</span> <span class="keyword1">while</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">od</span>"</span></span>

<span class="keyword1" id="VC_KAT_scratch-H_skip"><span class="command">lemma</span></span> H_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">1</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-H_cons"><span class="command">lemma</span></span> H_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">p'</span> <span class="main">⟹</span> <span class="keyword1">t</span> <span class="free">q'</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p'</span> <span class="free">x</span> <span class="free">q'</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> H_def mult_isol mult_isor order.trans<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-H_seq"><span class="command">lemma</span></span> H_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">r</span> <span class="free">y</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="free">x</span> <span class="free">r</span>  <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">r</span> <span class="free">y</span> <span class="free">q</span>"</span></span>  
  <span class="keyword1"><span class="command">hence</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">blast</span> <span class="keyword1"><span class="command">using</span></span> H_def h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h4 mult_isol mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAT_scratch-H_cond"><span class="command">lemma</span></span> H_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span><span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="main">(</span><span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> at <span class="free">r</span><span class="main">)</span> <span class="free">y</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span><span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span><span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> at <span class="free">r</span><span class="main">)</span> <span class="free">y</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"at <span class="free">r</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> at <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> at <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def mult_isol mult_assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> H_def h2 mult_isol mult_assoc t_mult_closed t_n<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  h6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> at <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> at <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc t_comm<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> h4 mult_assoc t_comm t_idem t_n<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> at <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> at <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">q</span> <span class="main">+</span> <span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> at <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h5 add_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">q</span> <span class="main">+</span> at <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_commute h6 add_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def if_then_else_def distrib_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAT_scratch-H_loop"><span class="command">lemma</span></span> H_loop<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span><span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="keyword1">while</span> <span class="free">r</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> at <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"H <span class="main">(</span><span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_def distrib_left less_eq_def mult_assoc t_mult_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc t_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> at <span class="free">r</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> at <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor star_sim mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> at <span class="free">r</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">t</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> at <span class="free">r</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> at <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc t_comm t_idem t_n<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_def mult_assoc t_mult_closed t_n while_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAT_scratch-H_while_inv"><span class="command">lemma</span></span> H_while_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">t</span> <span class="free">i</span> <span class="main">⋅</span> at <span class="free">r</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="main">(</span><span class="keyword1">t</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">i</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="keyword1">while</span> <span class="free">r</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_cons H_loop t_mult_closed t_n while_inv_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Soundness and Relation KAT›</span></span>

<span class="keyword1"><span class="command">notation</span></span> relcomp <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">;</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_d<span class="main">:</span> dioid <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dioid<span class="main">)</span> power_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">^</span> <span class="free">i</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_lub<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dual_order.trans local.mult_isol mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dioid<span class="main">)</span> power_inductr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_lub<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local.dual_order.trans local.mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc local.power_commutes<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAT_scratch-power_is_relpow"><span class="command">lemma</span></span> power_is_relpow<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_d.power <span class="free">X</span> <span class="free">i</span> <span class="main">=</span> <span class="free">X</span> <span class="main">^^</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relpow_commute<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-rel_star_def"><span class="command">lemma</span></span> rel_star_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">^*</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> rel_d.power <span class="free">X</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_is_relpow rtrancl_is_UN_relpow<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-rel_star_contl"><span class="command">lemma</span></span> rel_star_contl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">;</span> <span class="free">Y</span><span class="main">^*</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="main">;</span> rel_d.power <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_star_def relcomp_UNION_distrib<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-rel_star_contr"><span class="command">lemma</span></span> rel_star_contr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">^*</span> <span class="main">;</span> <span class="free">Y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>rel_d.power <span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">;</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_star_def relcomp_UNION_distrib2<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_at</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">rel_at</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> Id <span class="main">∩</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>  

<span class="keyword1"><span class="command">interpretation</span></span> rel_kat<span class="main">:</span> kat <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">rtrancl</span> <span class="quoted">rel_at</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_star_contr rel_d.power_inductl rel_star_contl  SUP_least rel_d.power_inductr rel_at_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Embedding Predicates in Relations›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> pred <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">p2r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌈</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">⌉</span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">|</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="VC_KAT_scratch-t_p2r"><span class="command">lemma</span></span> t_p2r <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_kat.t_op <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_kat.t_op_def rel_at_def<span class="main">)</span>
 
<span class="keyword1" id="VC_KAT_scratch-p2r_neg_hom"><span class="command">lemma</span></span> p2r_neg_hom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_at <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">s</span><span class="main">⌉</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_at_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-p2r_conj_hom"><span class="command">lemma</span></span> p2r_conj_hom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">∩</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span>  <span class="free">P</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="VC_KAT_scratch-p2r_conj_hom_var"><span class="command">lemma</span></span> p2r_conj_hom_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">;</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">⌉</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="VC_KAT_scratch-p2r_disj_hom"><span class="command">lemma</span></span> p2r_disj_hom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">∪</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="VC_KAT_scratch-impl_prop"><span class="command">lemma</span></span> impl_prop <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⊆</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span>  <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Store and Assignment›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> store <span class="main">=</span> <span class="quoted"><span class="quoted">"string  <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> store <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> store rel"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">::=</span> _"</span> <span class="main">[</span>70<span class="main">,</span> 65<span class="main">]</span> 61<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">::=</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="bound">s</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1" id="VC_KAT_scratch-H_assign"><span class="command">lemma</span></span> H_assign<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_kat.H <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">⌉</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gets_def rel_kat.H_def rel_kat.t_op_def rel_at_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-H_assign_var"><span class="command">lemma</span></span> H_assign_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gets_def rel_kat.H_def rel_kat.t_op_def rel_at_def<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">H_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">PRE</span> _ _ <span class="keyword1">POST</span> _"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">PRE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">POST</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> rel_kat.H <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">⌉</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">if_then_else_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">IF</span> _ <span class="keyword1">THEN</span> _ <span class="keyword1">ELSE</span> _ <span class="keyword1">FI</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">IF</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">THEN</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">ELSE</span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="keyword1"><span class="free">FI</span></span> <span class="main">≡</span> rel_kat.if_then_else <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">while_inv_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">WHILE</span> _ <span class="keyword1">INV</span> _ <span class="keyword1">DO</span> _ <span class="keyword1">OD</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">WHILE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">INV</span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1"><span class="free">DO</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">OD</span></span> <span class="main">≡</span> rel_kat.while_inv <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Verification Example›</span></span>

<span class="keyword1" id="VC_KAT_scratch-euclid"><span class="command">lemma</span></span> euclid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
    <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="keyword1">mod</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_kat.H_while_inv<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_kat.H_seq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H_assign<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> H_assign_var<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> gcd_red_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Refinement KAT›</span></span>

<span class="keyword1"><span class="command">class</span></span> rkat <span class="main">=</span> kat <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">R</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> R1<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">(</span><span class="free">R</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R2<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">R</span> <span class="free">p</span> <span class="free">q</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Propositional Refinement Calculus›</span></span>

<span class="keyword1" id="VC_KAT_scratch-R_skip"><span class="command">lemma</span></span> R_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_skip R2<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-R_cons"><span class="command">lemma</span></span> R_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">t</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">p'</span> <span class="main">⟹</span> <span class="keyword1">t</span> <span class="free">q'</span> <span class="main">≤</span> <span class="keyword1">t</span> <span class="free">q</span> <span class="main">⟹</span> R <span class="free">p'</span> <span class="free">q'</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_cons R2 R1<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-R_seq"><span class="command">lemma</span></span> R_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="free">p</span> <span class="free">r</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>R <span class="free">r</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_seq R2 R1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="VC_KAT_scratch-R_cond"><span class="command">lemma</span></span> R_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">(</span>R <span class="main">(</span><span class="keyword1">t</span> <span class="free">v</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>R <span class="main">(</span>at <span class="free">v</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">fi</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_cond R1 R2 t_comm t_n<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-R_loop"><span class="command">lemma</span></span> R_loop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="free">q</span> <span class="keyword1">do</span> <span class="main">(</span>R <span class="main">(</span><span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">t</span> <span class="free">q</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">od</span>  <span class="main">≤</span> R <span class="free">p</span> <span class="main">(</span><span class="keyword1">t</span> <span class="free">p</span> <span class="main">⋅</span> at <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_loop R2 R1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness and Relation RKAT›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">rel_R</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="bound">X</span><span class="main">.</span> rel_kat.H <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_rkat<span class="main">:</span> rkat <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">rtrancl</span> <span class="quoted">rel_at</span> <span class="quoted">rel_R</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_R_def rel_kat.H_def rel_kat.t_op_def rel_at_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Assignment Laws›</span></span>

<span class="keyword1" id="VC_KAT_scratch-R_assign"><span class="command">lemma</span></span> R_assign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_assign_var rel_rkat.R2<span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-R_assignr"><span class="command">lemma</span></span> R_assignr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q'</span><span class="main">⌉</span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">pa</span> <span class="bound">cs</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span> <span class="bound">fa</span> <span class="main">∨</span> <span class="bound">cs</span> <span class="main">::=</span> <span class="bound">f</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="bound">p</span><span class="main">⌉</span> <span class="main">⌈</span><span class="bound">pa</span><span class="main">⌉</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="bound">pa</span> <span class="main">(</span><span class="bound">fa</span><span class="main">(</span><span class="bound">cs</span> <span class="main">:=</span> <span class="bound">f</span> <span class="bound">fa</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">cs</span> <span class="main">::=</span> <span class="bound">f</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="bound">p</span><span class="main">⌉</span> <span class="main">⌈</span><span class="bound">pa</span><span class="main">⌉</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_assign <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">::=</span> <span class="free">e</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">Q'</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans rel_d.mult_isol rel_rkat.R_seq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAT_scratch-R_assignl"><span class="command">lemma</span></span> R_assignl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P'</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span>rel_R <span class="main">⌈</span><span class="free">P'</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span><span class="main">)</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P'</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">pa</span> <span class="bound">cs</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">fa</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span> <span class="bound">fa</span> <span class="main">∨</span> <span class="bound">cs</span> <span class="main">::=</span> <span class="bound">f</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="bound">p</span><span class="main">⌉</span> <span class="main">⌈</span><span class="bound">pa</span><span class="main">⌉</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="bound">pa</span> <span class="main">(</span><span class="bound">fa</span><span class="main">(</span><span class="bound">cs</span> <span class="main">:=</span> <span class="bound">f</span> <span class="bound">fa</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">cs</span> <span class="main">::=</span> <span class="bound">f</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="bound">p</span><span class="main">⌉</span> <span class="main">⌈</span><span class="bound">pa</span><span class="main">⌉</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_assign <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">::=</span> <span class="free">e</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">P'</span><span class="main">⌉</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans rel_d.mult_isor rel_rkat.R_seq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Refinement Example›</span></span>

<span class="keyword1" id="VC_KAT_scratch-var_swap_ref1"><span class="command">lemma</span></span> var_swap_ref1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> 
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R_assignl<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 

<span class="keyword1" id="VC_KAT_scratch-var_swap_ref2"><span class="command">lemma</span></span> var_swap_ref2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> 
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R_assignl<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-var_swap_ref3"><span class="command">lemma</span></span> var_swap_ref3<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> 
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R_assignl<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="VC_KAT_scratch-var_swap_ref_var"><span class="command">lemma</span></span> var_swap_ref_var<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> 
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> var_swap_ref1 var_swap_ref2 var_swap_ref3 rel_rkat.R_skip  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VC_KAD_scratch">
<div class="head">
<h1>Theory VC_KAD_scratch</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Program Correctness Component Based on Kleene Algebra with Domain
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Component Based on Kleene Algebra with Domain›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This component supports the verification and step-wise refinement of simple while programs
in a partial correctness setting.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAD_scratch
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹KAD: Definitions and Basic Properties›</span></span>

<span class="keyword1"><span class="command">notation</span></span> times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> plus_ord <span class="main">=</span> plus <span class="main">+</span> ord <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> less_eq_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> less_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> dioid <span class="main">=</span> semiring <span class="main">+</span> one <span class="main">+</span> zero <span class="main">+</span> plus_ord <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> add_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> mult_onel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> mult_oner <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">1</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> add_zerol <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> annil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> annir <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> monoid_mult
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> order
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_def less_eq_def add_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_assoc<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-mult_isor"><span class="command">lemma</span></span> mult_isor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>   
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right less_eq_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-mult_isol"><span class="command">lemma</span></span> mult_isol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>   
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left less_eq_def<span class="main">)</span>   

<span class="keyword1" id="VC_KAD_scratch-add_iso"><span class="command">lemma</span></span> add_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.semigroup_axioms add_idem less_eq_def semigroup.assoc<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-add_ub"><span class="command">lemma</span></span> add_ub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc add_idem less_eq_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-add_lub"><span class="command">lemma</span></span> add_lub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc add_ub add.left_commute less_eq_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> kleene_algebra  <span class="main">=</span> dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">star</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup></span></span></span>"</span> <span class="main">[</span>101<span class="main">]</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_unfoldl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span>"</span></span>  
  <span class="keyword2"><span class="keyword">and</span></span> star_unfoldr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> star_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> star_inductr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="VC_KAD_scratch-star_sim"><span class="command">lemma</span></span> star_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_lub distrib_left eq_refl less_eq_def mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_lub mult_isor star_unfoldr <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_inductr<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> antidomain_kleene_algebra <span class="main">=</span> kleene_algebra <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">ad</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">ad</span></span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> as1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ad</span></span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> as2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ad</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1"><span class="free">ad</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1"><span class="free">ad</span></span> <span class="main">(</span><span class="keyword1"><span class="free">ad</span></span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="free">ad</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1"><span class="free">ad</span></span> <span class="main">(</span><span class="keyword1"><span class="free">ad</span></span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> as3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ad</span></span> <span class="main">(</span><span class="keyword1"><span class="free">ad</span></span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1"><span class="free">ad</span></span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dom_op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">d</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">d</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="VC_KAD_scratch-a_subid_aux"><span class="command">lemma</span></span> a_subid_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute add_ub as3 mult_1_left mult_isor<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-d1_a"><span class="command">lemma</span></span> d1_a <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute dom_op_def add_zerol as1 as3 distrib_right mult_1_left<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-a_mul_d"><span class="command">lemma</span></span> a_mul_d <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute dom_op_def add_zerol as1 as2 distrib_right mult_1_left<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-a_d_closed"><span class="command">lemma</span></span> a_d_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d1_a dom_op_def add_zerol as1 as3 distrib_left mult_1_right<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-a_idem"><span class="command">lemma</span></span> a_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_d_closed d1_a<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-meet_ord"><span class="command">lemma</span></span> meet_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_d_closed a_subid_aux d1_a antisym mult_1_right mult_isol<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-d_wloc"><span class="command">lemma</span></span> d_wloc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_subid_aux d1_a dom_op_def add_ub antisym as1 as2 mult_1_right mult_assoc<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-gla_1"><span class="command">lemma</span></span> gla_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_subid_aux d_wloc dom_op_def add_zerol as3 distrib_left mult_1_right<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-a2_eq"><span class="command">lemma</span></span> a2_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_mul_d d1_a dom_op_def gla_1 add_ub antisym as1 as2 mult_assoc<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-a_supdist"><span class="command">lemma</span></span> a_supdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute gla_1 add_ub add_zerol as1 distrib_left less_eq_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-a_antitone"><span class="command">lemma</span></span> a_antitone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_supdist less_eq_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-a_comm"><span class="command">lemma</span></span> a_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="skolem">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_antitone a_d_closed a_subid_aux mult_oner a_subid_aux dom_op_def mult_isol mult_isor meet_ord<span class="main">)</span>   
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_scratch-a_closed"><span class="command">lemma</span></span> a_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="bound">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_antitone a_subid_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2_eq a_antitone a_comm a_d_closed dom_op_def f1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d1_a dom_op_def meet_ord mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_comm a_idem dom_op_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_scratch-a_exp"><span class="command">lemma</span></span> a_exp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_wloc mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_closed a_comm dom_op_def gla_1 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_op_def as3 distrib_left mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span>  <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a add_lub dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_antitone a_comm a_subid_aux meet_ord<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_antitone a_subid_aux<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2_eq a_antitone a_comm a_subid_aux dom_op_def add_lub<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="VC_KAD_scratch-d1_sum_var"><span class="command">lemma</span></span> d1_sum_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute add_lub add_ub combine_common_factor<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_scratch-a4"><span class="command">lemma</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_supdist add_commute mult_isor meet_ord<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_def add_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_closed a_exp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_antitone d1_sum_var dom_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_scratch-kat_prop"><span class="command">lemma</span></span> kat_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute dom_op_def add_zerol annir as1 less_eq_def mult_isor mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_op_def as3 distrib_left mult_1_right<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_subid_aux add_commute dom_op_def h add_zerol mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_scratch-shunt"><span class="command">lemma</span></span> shunt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right mult_isor<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_closed a_d_closed a_exp a_mul_d a_supdist dom_op_def dual_order.trans less_eq_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute dom_op_def as3 distrib_left mult_1_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h add_lub dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_subid_aux add_commute add_lub add_ub dual_order.trans<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹wp Calculus›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">if_then_else</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">if</span> _ <span class="keyword1">then</span> _ <span class="keyword1">else</span> _ <span class="keyword1">fi</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">if</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">then</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">else</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1"><span class="free">fi</span></span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">while</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">do</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">od</span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">inv</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">while</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">inv</span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1"><span class="free">do</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">od</span></span> <span class="main">=</span> <span class="keyword1">while</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">od</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wp</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="VC_KAD_scratch-demod"><span class="command">lemma</span></span> demod<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">q</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> as1 dom_op_def gla_1 kat_prop meet_ord mult_assoc wp_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-wp_weaken"><span class="command">lemma</span></span> wp_weaken<span class="main">:</span> <span class="quoted"><span class="quoted">"wp <span class="free">x</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a4 a_antitone a_d_closed a_mul_d dom_op_def gla_1 mult_isol mult_assoc wp_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-wp_seq"><span class="command">lemma</span></span> wp_seq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wp <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> wp <span class="free">x</span> <span class="main">(</span>wp <span class="free">y</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a2_eq dom_op_def mult_assoc wp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD_scratch-wp_seq_var"><span class="command">lemma</span></span> wp_seq_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">≤</span> wp <span class="free">y</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">r</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> wp <span class="free">y</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="main">¬</span> wp <span class="free">x</span> <span class="free">r</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≤</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 a_antitone mult_isol wp_def wp_seq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_scratch-wp_cond_var"><span class="command">lemma</span></span> wp_cond_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wp <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">p</span> <span class="main">+</span> wp <span class="free">x</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">+</span> wp <span class="free">y</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a4 a_d_closed dom_op_def if_then_else_def distrib_right mult_assoc wp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD_scratch-wp_cond_aux1"><span class="command">lemma</span></span> wp_cond_aux1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> wp <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> wp <span class="free">x</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> wp <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">p</span> <span class="main">+</span> wp <span class="free">x</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">+</span> wp <span class="free">y</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dom_op_def mult.semigroup_axioms semigroup.assoc wp_cond_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> wp <span class="free">x</span> <span class="free">q</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="main">(</span>wp <span class="free">y</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_comm a_d_closed dom_op_def distrib_left wp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> wp <span class="free">x</span> <span class="free">q</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_exp dom_op_def add_ub meet_ord mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_comm dom_op_def wp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_scratch-wp_cond_aux2"><span class="command">lemma</span></span> wp_cond_aux2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">p</span> <span class="main">⋅</span> wp <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">p</span> <span class="main">⋅</span> wp <span class="free">y</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> abel_semigroup.commute if_then_else_def a_d_closed add.abel_semigroup_axioms dom_op_def wp_cond_aux1<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-wp_cond"><span class="command">lemma</span></span> wp_cond <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wp <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> wp <span class="free">x</span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">p</span> <span class="main">⋅</span> wp <span class="free">y</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> as3 distrib_right dom_op_def mult_1_left wp_cond_aux2 wp_cond_aux1<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-wp_star_induct_var"><span class="command">lemma</span></span> wp_star_induct_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">q</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">≤</span> wp <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="free">q</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> demod star_sim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="VC_KAD_scratch-wp_while"><span class="command">lemma</span></span> wp_while<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">r</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">p</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="main">(</span><span class="keyword1">while</span> <span class="free">r</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">r</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="main">(</span><span class="keyword1">d</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dom_op_def mult.semigroup_axioms semigroup.assoc shunt wp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="main">(</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wp_star_induct_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_def<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> local.dual_order.trans wp_weaken <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_scratch-wp_while_inv"><span class="command">lemma</span></span> wp_while_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">r</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">r</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="main">(</span><span class="keyword1">while</span> <span class="free">r</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">r</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">r</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">i</span> <span class="main">≤</span> wp <span class="main">(</span><span class="keyword1">while</span> <span class="free">r</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_inv_def wp_while<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span>  wp <span class="main">(</span><span class="keyword1">while</span> <span class="free">r</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 a_antitone a_d_closed dom_op_def mult_isol wp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_scratch-wp_while_inv_break"><span class="command">lemma</span></span> wp_while_inv_break<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="free">y</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">r</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">r</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">while</span> <span class="free">r</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_op_def eq_refl mult_1_left mult_1_right wp_def wp_seq wp_seq_var wp_while_inv<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness and Relation KAD›</span></span>

<span class="keyword1"><span class="command">notation</span></span> relcomp <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">;</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_d<span class="main">:</span> dioid <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dioid<span class="main">)</span> pow_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">^</span> <span class="free">i</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_lub<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dual_order.trans local.mult_isol mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dioid<span class="main">)</span> pow_inductr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_lub<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local.dual_order.trans local.mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc local.power_commutes<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_scratch-power_is_relpow"><span class="command">lemma</span></span> power_is_relpow<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_d.power <span class="free">X</span> <span class="free">i</span> <span class="main">=</span> <span class="free">X</span> <span class="main">^^</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relpow_commute<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-rel_star_def"><span class="command">lemma</span></span> rel_star_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">^*</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> rel_d.power <span class="free">X</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_is_relpow rtrancl_is_UN_relpow<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-rel_star_contl"><span class="command">lemma</span></span> rel_star_contl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">;</span> <span class="free">Y</span><span class="main">^*</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="main">;</span> rel_d.power <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_star_def relcomp_UNION_distrib<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-rel_star_contr"><span class="command">lemma</span></span> rel_star_contr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">^*</span> <span class="main">;</span> <span class="free">Y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>rel_d.power <span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">;</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_star_def relcomp_UNION_distrib2<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_ad</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_ad</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span> 

<span class="keyword1"><span class="command">interpretation</span></span> rel_aka<span class="main">:</span> antidomain_kleene_algebra <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">rtrancl</span> <span class="quoted">rel_ad</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_star_contr rel_d.pow_inductl rel_star_contl SUP_least rel_d.pow_inductr rel_ad_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Embedding Predicates in Relations›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> pred <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">p2r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌈</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">⌉</span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">|</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="VC_KAD_scratch-d_p2r"><span class="command">lemma</span></span> d_p2r <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_aka.dom_op <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_aka.dom_op_def rel_ad_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-p2r_neg_hom"><span class="command">lemma</span></span> p2r_neg_hom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_ad <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">s</span><span class="main">⌉</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_ad_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-p2r_conj_hom"><span class="command">lemma</span></span> p2r_conj_hom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">∩</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD_scratch-p2r_conj_hom_var"><span class="command">lemma</span></span> p2r_conj_hom_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">;</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">⌉</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD_scratch-p2r_disj_hom"><span class="command">lemma</span></span> p2r_disj_hom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">∪</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Store and Assignment›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> store <span class="main">=</span> <span class="quoted"><span class="quoted">"string  <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> store <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> store rel"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">::=</span> _"</span> <span class="main">[</span>70<span class="main">,</span> 65<span class="main">]</span> 61<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">::=</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="bound">s</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1" id="VC_KAD_scratch-wp_assign"><span class="command">lemma</span></span> wp_assign <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_aka.wp <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_aka.wp_def gets_def rel_ad_def<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">spec_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">PRE</span> _ _ <span class="keyword1">POST</span> _"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">PRE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">POST</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> rel_aka.dom_op <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="main">⊆</span> rel_aka.wp <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">⌉</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">if_then_else_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">IF</span> _ <span class="keyword1">THEN</span> _ <span class="keyword1">ELSE</span> _ <span class="keyword1">FI</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">IF</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">THEN</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">ELSE</span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="keyword1"><span class="free">FI</span></span> <span class="main">≡</span> rel_aka.if_then_else <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">while_inv_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">WHILE</span> _ <span class="keyword1">INV</span> _ <span class="keyword1">DO</span> _ <span class="keyword1">OD</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">WHILE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">INV</span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1"><span class="free">DO</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">OD</span></span> <span class="main">≡</span> rel_aka.while_inv <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Verification Example›</span></span>

<span class="keyword1" id="VC_KAD_scratch-euclid"><span class="command">lemma</span></span> euclid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
    <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="keyword1">mod</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_aka.wp_while_inv<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> gcd_red_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> antidomain_kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Propositional Hoare Logic›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≤</span> wp <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1" id="VC_KAD_scratch-H_skip"><span class="command">lemma</span></span> H_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">1</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def dom_op_def wp_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-H_cons"><span class="command">lemma</span></span> H_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">p'</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">q'</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p'</span> <span class="free">x</span> <span class="free">q'</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> H_def demod mult_isol order_trans<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-H_seq"><span class="command">lemma</span></span> H_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">r</span> <span class="main">⟹</span> H <span class="free">r</span> <span class="free">y</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_def a_d_closed demod dom_op_def wp_seq_var<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-H_cond"><span class="command">lemma</span></span> H_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">r</span><span class="main">)</span> <span class="free">y</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span>  h1<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">r</span><span class="main">)</span> <span class="free">y</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">r</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">r</span> <span class="main">≤</span> wp <span class="free">y</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H_def a_closed dom_op_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> H_def h2 a_closed dom_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span>  <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">r</span> <span class="main">+</span> wp <span class="free">x</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span>  <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">r</span> <span class="main">+</span> wp <span class="free">y</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_op_def shunt wp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> h4 a_d_closed dom_op_def shunt wp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">p</span>  <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">r</span> <span class="main">+</span> wp <span class="free">y</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_idem distrib_left dom_op_def less_eq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">r</span> <span class="main">+</span> wp <span class="free">x</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">r</span> <span class="main">+</span> wp <span class="free">y</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h5 mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_scratch-H_loop"><span class="command">lemma</span></span> H_loop<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="keyword1">while</span> <span class="free">r</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> H_def a_closed dom_op_def wp_while<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-H_while_inv"><span class="command">lemma</span></span> H_while_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">r</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="main">(</span><span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">i</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="keyword1">while</span> <span class="free">r</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_def a_closed dom_op_def wp_while_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Definition of Refinement KAD›</span></span>

<span class="keyword1"><span class="command">class</span></span> rkad <span class="main">=</span> antidomain_kleene_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">R</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> R_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">R</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">q</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Propositional Refinement Calculus›</span></span>

<span class="keyword1" id="VC_KAD_scratch-HR"><span class="command">lemma</span></span> HR<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def R_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-wp_R1"><span class="command">lemma</span></span> wp_R1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="main">(</span>R <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="VC_KAD_scratch-wp_R2"><span class="command">lemma</span></span> wp_R2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> R <span class="main">(</span>wp <span class="free">x</span> <span class="free">q</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def wp_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-wp_R3"><span class="command">lemma</span></span> wp_R3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> wp <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-H_R1"><span class="command">lemma</span></span> H_R1<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">(</span>R <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HR<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-H_R2"><span class="command">lemma</span></span> H_R2<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HR<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-R_skip"><span class="command">lemma</span></span> R_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_R2 H_skip<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-R_cons"><span class="command">lemma</span></span> R_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">p'</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">q'</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⟹</span> R <span class="free">p'</span> <span class="free">q'</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_R1 H_R2 H_cons<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-R_seq"><span class="command">lemma</span></span> R_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="free">p</span> <span class="free">r</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>R <span class="free">r</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_R1 H_R2 H_seq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="VC_KAD_scratch-R_cond"><span class="command">lemma</span></span> R_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">(</span>R <span class="main">(</span><span class="keyword1">d</span> <span class="free">v</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>R <span class="main">(</span><span class="keyword1">ad</span> <span class="free">v</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">fi</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_R1 H_R2 H_cond a_comm dom_op_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-R_loop"><span class="command">lemma</span></span> R_loop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="free">q</span> <span class="keyword1">do</span> <span class="main">(</span>R <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">q</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">od</span> <span class="main">≤</span> R <span class="free">p</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_R1 H_R2 H_loop<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness and Relation RKAD›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">rel_R</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="bound">X</span><span class="main">.</span> rel_aka.dom_op <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⊆</span> rel_aka.wp <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_rkad<span class="main">:</span> rkad <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">rtrancl</span> <span class="quoted">rel_ad</span> <span class="quoted">rel_R</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_R_def rel_aka.dom_op_def rel_ad_def rel_aka.wp_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Assignment Laws›</span></span>

<span class="keyword1" id="VC_KAD_scratch-R_assign"><span class="command">lemma</span></span> R_assign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_rkad.R_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-H_assign_var"><span class="command">lemma</span></span> H_assign_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> rel_aka.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_aka.H_def rel_aka.dom_op_def rel_ad_def gets_def rel_aka.wp_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-R_assignr"><span class="command">lemma</span></span> R_assignr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q'</span><span class="main">⌉</span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_rkad.HR<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rel_aka.H_seq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> H_assign_var<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_rkad.H_R1<span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-R_assignl"><span class="command">lemma</span></span> R_assignl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P'</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span>rel_R <span class="main">⌈</span><span class="free">P'</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span><span class="main">)</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> rel_rkad.HR<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rel_aka.H_seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> H_assign_var<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_rkad.H_R1<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Refinement Example›</span></span>

<span class="keyword1" id="VC_KAD_scratch-var_swap_ref1"><span class="command">lemma</span></span> var_swap_ref1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> 
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R_assignl<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 

<span class="keyword1" id="VC_KAD_scratch-var_swap_ref2"><span class="command">lemma</span></span> var_swap_ref2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> 
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R_assignl<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-var_swap_ref3"><span class="command">lemma</span></span> var_swap_ref3<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> 
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R_assignl<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="VC_KAD_scratch-var_swap_ref_var"><span class="command">lemma</span></span> var_swap_ref_var<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> 
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> var_swap_ref1 var_swap_ref2 var_swap_ref3 rel_rkad.R_skip  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="P2S2R">
<div class="head">
<h1>Theory P2S2R</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Isomorphisms Betweeen Predicates, Sets and Relations *}
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Isomorphisms Between Predicates, Sets and Relations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> P2S2R
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>

<span class="keyword2"><span class="keyword">begin</span></span>    

<span class="keyword1"><span class="command">notation</span></span> relcomp <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">;</span>"</span> 70<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span>  
<span class="keyword1"><span class="command">notation</span></span> sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Id_on <span class="main">(</span><span class="quoted">"<span class="keyword1">s2r</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Domain <span class="main">(</span><span class="quoted">"<span class="keyword1">r2s</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Collect <span class="main">(</span><span class="quoted">"<span class="keyword1">p2s</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_n</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">rel_n</span>  <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> Id <span class="main">∩</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span>"</span></span>  

<span class="keyword1" id="P2S2R-subid_meet"><span class="command">lemma</span></span> subid_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="free">R</span> <span class="main">∩</span> <span class="free">S</span> <span class="main">=</span> <span class="free">R</span> <span class="main">;</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Isomorphism Between Sets and Relations›</span></span>

<span class="keyword1" id="P2S2R-srs"><span class="command">lemma</span></span> srs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r2s</span> <span class="main">∘</span> <span class="keyword1">s2r</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P2S2R-rsr"><span class="command">lemma</span></span> rsr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="keyword1">s2r</span> <span class="main">(</span><span class="keyword1">r2s</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Id_def Id_on_def Domain_def<span class="main">)</span> 

<span class="keyword1" id="P2S2R-s2r_inj"><span class="command">lemma</span></span> s2r_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="keyword1">s2r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Domain_Id_on injI<span class="main">)</span>

<span class="keyword1" id="P2S2R-r2s_inj"><span class="command">lemma</span></span> r2s_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="keyword1">r2s</span> <span class="free">R</span> <span class="main">=</span> <span class="keyword1">r2s</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rsr<span class="main">)</span>

<span class="keyword1" id="P2S2R-s2r_surj"><span class="command">lemma</span></span> s2r_surj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">R</span></span> <span class="main">⊆</span> Id<span class="main">.</span> <span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="bound">R</span> <span class="main">=</span> <span class="keyword1">s2r</span> <span class="bound">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rsr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword1" id="P2S2R-r2s_surj"><span class="command">lemma</span></span> r2s_surj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">R</span></span> <span class="main">⊆</span> Id<span class="main">.</span> <span class="bound">A</span> <span class="main">=</span> <span class="keyword1">r2s</span> <span class="bound">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Domain_Id_on Id_onE pair_in_Id_conv subsetI<span class="main">)</span>

<span class="keyword1" id="P2S2R-s2r_union_hom"><span class="command">lemma</span></span> s2r_union_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">s2r</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">s2r</span> <span class="free">A</span> <span class="main">∪</span> <span class="keyword1">s2r</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Id_on_def<span class="main">)</span>

<span class="keyword1" id="P2S2R-s2r_inter_hom"><span class="command">lemma</span></span> s2r_inter_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">s2r</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">s2r</span> <span class="free">A</span> <span class="main">∩</span> <span class="keyword1">s2r</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Id_on_def<span class="main">)</span>  

<span class="keyword1" id="P2S2R-s2r_inter_hom_var"><span class="command">lemma</span></span> s2r_inter_hom_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">s2r</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">s2r</span> <span class="free">A</span> <span class="main">;</span> <span class="keyword1">s2r</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Id_on_def<span class="main">)</span>

<span class="keyword1" id="P2S2R-s2r_compl_hom"><span class="command">lemma</span></span> s2r_compl_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">s2r</span> <span class="main">(</span><span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> rel_n <span class="main">(</span><span class="keyword1">s2r</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_n_def<span class="main">)</span>

<span class="keyword1" id="P2S2R-r2s_union_hom"><span class="command">lemma</span></span> r2s_union_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r2s</span> <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">r2s</span> <span class="free">R</span> <span class="main">∪</span> <span class="keyword1">r2s</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P2S2R-r2s_inter_hom"><span class="command">lemma</span></span> r2s_inter_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="keyword1">r2s</span> <span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">r2s</span> <span class="free">R</span> <span class="main">∩</span> <span class="keyword1">r2s</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P2S2R-r2s_inter_hom_var"><span class="command">lemma</span></span> r2s_inter_hom_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="keyword1">r2s</span> <span class="main">(</span><span class="free">R</span> <span class="main">;</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">r2s</span> <span class="free">R</span> <span class="main">∩</span> <span class="keyword1">r2s</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> r2s_inter_hom subid_meet<span class="main">)</span>

<span class="keyword1" id="P2S2R-r2s_ad_hom"><span class="command">lemma</span></span> r2s_ad_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="keyword1">r2s</span> <span class="main">(</span>rel_n <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="keyword1">r2s</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> r2s_surj rsr s2r_compl_hom<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Isomorphism Between Predicates and Sets›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> pred <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">s2p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> pred"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">s2p</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="P2S2R-sps"><span class="command">lemma</span></span> sps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"s2p <span class="main">∘</span> <span class="keyword1">p2s</span> <span class="main">=</span> id"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s2p_def<span class="main">)</span>

<span class="keyword1" id="P2S2R-psp"><span class="command">lemma</span></span> psp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">p2s</span> <span class="main">∘</span> s2p <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s2p_def<span class="main">)</span>

<span class="keyword1" id="P2S2R-s2p_bij"><span class="command">lemma</span></span> s2p_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij s2p"</span></span>
  <span class="keyword1"><span class="command">using</span></span> o_bij psp sps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P2S2R-p2s_bij"><span class="command">lemma</span></span> p2s_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="keyword1">p2s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> o_bij psp sps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P2S2R-s2p_compl_hom"><span class="command">lemma</span></span> s2p_compl_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"s2p <span class="main">(</span><span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>s2p <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_mem_eq comp_eq_dest_lhs id_apply sps uminus_set_def<span class="main">)</span>
 
<span class="keyword1" id="P2S2R-s2p_inter_hom"><span class="command">lemma</span></span> s2p_inter_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"s2p <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>s2p <span class="free">A</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>s2p <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_mem_eq comp_eq_dest_lhs id_apply inf_set_def sps<span class="main">)</span>

<span class="keyword1" id="P2S2R-s2p_union_hom"><span class="command">lemma</span></span> s2p_union_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"s2p <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>s2p <span class="free">A</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>s2p <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s2p_def<span class="main">)</span>

<span class="keyword1" id="P2S2R-p2s_neg_hom"><span class="command">lemma</span></span> p2s_neg_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">p2s</span> <span class="main">(</span><span class="main">-</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">p2s</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="P2S2R-p2s_conj_hom"><span class="command">lemma</span></span> p2s_conj_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">p2s</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">p2s</span> <span class="free">P</span> <span class="main">∩</span> <span class="keyword1">p2s</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P2S2R-p2s_disj_hom"><span class="command">lemma</span></span> p2s_disj_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">p2s</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊔</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">p2s</span> <span class="free">P</span> <span class="main">∪</span> <span class="keyword1">p2s</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Isomorphism Between Predicates and Relations›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p2r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p2r</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">|</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">r2p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> pred"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">r2p</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> Domain <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="P2S2R-p2r_subid"><span class="command">lemma</span></span> p2r_subid<span class="main">:</span> <span class="quoted"><span class="quoted">"p2r <span class="free">P</span> <span class="main">⊆</span> Id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2r_def subset_eq<span class="main">)</span>

<span class="keyword1" id="P2S2R-p2s2r"><span class="command">lemma</span></span> p2s2r<span class="main">:</span> <span class="quoted"><span class="quoted">"p2r <span class="main">=</span> <span class="keyword1">s2r</span> <span class="main">∘</span> <span class="keyword1">p2s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"p2r <span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">s2r</span> <span class="main">∘</span> <span class="keyword1">p2s</span><span class="main">)</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Id_on_def' p2r_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P2S2R-r2s2p"><span class="command">lemma</span></span> r2s2p<span class="main">:</span> <span class="quoted"><span class="quoted">"r2p <span class="main">=</span> s2p <span class="main">∘</span> <span class="keyword1">r2s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r2p_def s2p_def<span class="main">)</span>

<span class="keyword1" id="P2S2R-prp"><span class="command">lemma</span></span> prp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"r2p <span class="main">∘</span> p2r <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2s2r r2p_def<span class="main">)</span>

<span class="keyword1" id="P2S2R-rpr"><span class="command">lemma</span></span> rpr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> p2r <span class="main">(</span>r2p <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply id_apply p2s2r psp r2s2p rsr<span class="main">)</span>

<span class="keyword1" id="P2S2R-p2r_inj"><span class="command">lemma</span></span> p2r_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj p2r"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_eq_dest_lhs id_apply injI prp<span class="main">)</span>

<span class="keyword1" id="P2S2R-r2p_inj"><span class="command">lemma</span></span> r2p_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> Id <span class="main">⟹</span> r2p <span class="free">R</span> <span class="main">=</span> r2p <span class="free">S</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rpr<span class="main">)</span>

<span class="keyword1" id="P2S2R-p2r_surj"><span class="command">lemma</span></span> p2r_surj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">R</span></span> <span class="main">⊆</span> Id<span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> <span class="bound">R</span> <span class="main">=</span> p2r <span class="bound">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rpr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P2S2R-r2p_surj"><span class="command">lemma</span></span> r2p_surj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">R</span></span> <span class="main">⊆</span> Id<span class="main">.</span> <span class="bound">P</span> <span class="main">=</span> r2p <span class="bound">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply id_apply p2r_subid prp<span class="main">)</span>

<span class="keyword1" id="P2S2R-p2r_neg_hom"><span class="command">lemma</span></span> p2r_neg_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"p2r <span class="main">(</span><span class="main">-</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> rel_n <span class="main">(</span>p2r <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2s2r p2s_neg_hom s2r_compl_hom<span class="main">)</span>

<span class="keyword1" id="P2S2R-p2r_conj_hom"><span class="command">lemma</span></span> p2r_conj_hom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"p2r <span class="free">P</span> <span class="main">∩</span> p2r <span class="free">Q</span> <span class="main">=</span> p2r <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2s2r p2s_conj_hom s2r_inter_hom<span class="main">)</span>

<span class="keyword1" id="P2S2R-p2r_conj_hom_var"><span class="command">lemma</span></span> p2r_conj_hom_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"p2r <span class="free">P</span> <span class="main">;</span> p2r <span class="free">Q</span> <span class="main">=</span> p2r <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2s2r p2s_conj_hom s2r_inter_hom_var<span class="main">)</span>

<span class="keyword1" id="P2S2R-p2r_id_neg"><span class="command">lemma</span></span> p2r_id_neg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Id <span class="main">∩</span> <span class="main">-</span> p2r <span class="free">p</span> <span class="main">=</span> p2r <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"p2r bot <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword1" id="P2S2R-p2r_disj_hom"><span class="command">lemma</span></span> p2r_disj_hom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"p2r <span class="free">P</span> <span class="main">∪</span> p2r <span class="free">Q</span> <span class="main">=</span> p2r <span class="main">(</span><span class="free">P</span> <span class="main">⊔</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2s2r p2s_disj_hom s2r_union_hom<span class="main">)</span>

<span class="keyword1" id="P2S2R-r2p_ad_hom"><span class="command">lemma</span></span> r2p_ad_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> r2p <span class="main">(</span>rel_n <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>r2p <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r2s2p r2s_ad_hom s2p_compl_hom<span class="main">)</span>

<span class="keyword1" id="P2S2R-r2p_inter_hom"><span class="command">lemma</span></span> r2p_inter_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> Id <span class="main">⟹</span> r2p <span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>r2p <span class="free">R</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>r2p <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r2s2p r2s_inter_hom s2p_inter_hom<span class="main">)</span>

<span class="keyword1" id="P2S2R-r2p_inter_hom_var"><span class="command">lemma</span></span> r2p_inter_hom_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> Id <span class="main">⟹</span> r2p <span class="main">(</span><span class="free">R</span> <span class="main">;</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>r2p <span class="free">R</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>r2p <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r2s2p r2s_inter_hom_var s2p_inter_hom<span class="main">)</span>

<span class="keyword1" id="P2S2R-rel_to_pred_union_hom"><span class="command">lemma</span></span> rel_to_pred_union_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> Id <span class="main">⟹</span> r2p <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>r2p <span class="free">R</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>r2p <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Domain_Un_eq r2s2p s2p_union_hom<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VC_KAT">
<div class="head">
<h1>Theory VC_KAT</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on KAT
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Components Based on Kleene Algebra with Tests›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Verification Component›</span></span>      

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This component supports the verification of simple while programs
in a partial correctness setting.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAT
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="P2S2R.html">../P2S2R</a>"</span>
        <a href="../KAT_and_DRA/PHL_KAT.html">KAT_and_DRA.PHL_KAT</a> 
        <a href="../KAT_and_DRA/KAT_Models.html">KAT_and_DRA.KAT_Models</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This first part changes some of the facts from the AFP KAT theories. It should be added to KAT in the next AFP version. 
Currently these facts provide an interface between the KAT theories and the verification component.›</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> if_then_else <span class="main">(</span><span class="quoted">"<span class="keyword1">if</span> _ <span class="keyword1">then</span> _ <span class="keyword1">else</span> _ <span class="keyword1">fi</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> while <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> Archimedean_Field.ceiling <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> relcomp <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">;</span>"</span> 70<span class="main">)</span>               
<span class="keyword1"><span class="command">notation</span></span> p2r <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> kat 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions of Hoare Triple›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⟷</span> t <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> t <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span> 

<span class="keyword1" id="VC_KAT-H_var1"><span class="command">lemma</span></span> H_var1<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟷</span> t <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_def n_kat_3 t_n_closed<span class="main">)</span>

<span class="keyword1" id="VC_KAT-H_var2"><span class="command">lemma</span></span> H_var2<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟷</span> t <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> t <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def n_kat_2<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Syntax for Conditionals and Loops›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ifthenelse</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">if</span> _ <span class="keyword1">then</span> _ <span class="keyword1">else</span> _ <span class="keyword1">fi</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">if</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">then</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">else</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1"><span class="free">fi</span></span> <span class="main">=</span> <span class="main">(</span>t <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">while</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1"><span class="free">do</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">od</span></span> <span class="main">=</span> <span class="main">(</span>t <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">inv</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">while</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">inv</span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1"><span class="free">do</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">od</span></span> <span class="main">=</span> <span class="keyword1">while</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">od</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Propositional Hoare Logic›</span></span>

<span class="keyword1" id="VC_KAT-H_skip"><span class="command">lemma</span></span> H_skip<span class="main">:</span>  <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">1</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT-H_cons_1"><span class="command">lemma</span></span> H_cons_1<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">p</span> <span class="main">≤</span> t <span class="free">p'</span> <span class="main">⟹</span> H <span class="free">p'</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_def phl_cons1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="VC_KAT-H_cons_2"><span class="command">lemma</span></span> H_cons_2<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">q'</span> <span class="main">≤</span> t <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="free">x</span> <span class="free">q'</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_def phl_cons2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>          

<span class="keyword1" id="VC_KAT-H_cons"><span class="command">lemma</span></span> H_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">p</span> <span class="main">≤</span> t <span class="free">p'</span> <span class="main">⟹</span> t <span class="free">q'</span> <span class="main">≤</span> t <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p'</span> <span class="free">x</span> <span class="free">q'</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_cons_1 H_cons_2<span class="main">)</span>

<span class="keyword1" id="VC_KAT-H_seq_swap"><span class="command">lemma</span></span> H_seq_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">r</span> <span class="main">⟹</span> H <span class="free">r</span> <span class="free">y</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def phl_seq<span class="main">)</span>

<span class="keyword1" id="VC_KAT-H_seq"><span class="command">lemma</span></span> H_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">r</span> <span class="free">y</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="free">x</span> <span class="free">r</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_seq_swap<span class="main">)</span>

<span class="keyword1" id="VC_KAT-H_exp1"><span class="command">lemma</span></span> H_exp1<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span>t <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_def n_de_morgan_var2 phl.ht_at_phl_export1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAT-H_exp2"><span class="command">lemma</span></span> H_exp2<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> t <span class="free">r</span><span class="main">)</span> <span class="main">(</span>t <span class="free">q</span> <span class="main">⋅</span> t <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_def phl.ht_at_phl_export2 test_mult<span class="main">)</span>

<span class="keyword1" id="VC_KAT-H_cond_iff"><span class="command">lemma</span></span> H_cond_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">)</span> <span class="free">q</span> <span class="main">⟷</span> H <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">q</span> <span class="main">∧</span> H <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">r</span><span class="main">)</span> <span class="free">y</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">)</span> <span class="free">q</span> <span class="main">⟷</span> t <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span>t <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_var1 ifthenelse_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">q</span> <span class="main">+</span> t <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">r</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> t <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_0_left no_trivial_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_var1 test_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAT-H_cond"><span class="command">lemma</span></span> H_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">r</span><span class="main">)</span> <span class="free">y</span> <span class="free">q</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_cond_iff<span class="main">)</span>

<span class="keyword1" id="VC_KAT-H_loop"><span class="command">lemma</span></span> H_loop<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="keyword1">while</span> <span class="free">r</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"t <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">r</span> <span class="main">⋅</span> t <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_preserve test_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 H_def H_exp1 conway.phl.it_simr phl_export2 while_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAT-H_while_inv"><span class="command">lemma</span></span> H_while_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">p</span> <span class="main">≤</span> t <span class="free">i</span> <span class="main">⟹</span> t <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">r</span> <span class="main">≤</span> t <span class="free">q</span> <span class="main">⟹</span> H <span class="main">(</span>t <span class="free">i</span> <span class="main">⋅</span> t <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="free">i</span> <span class="main">⟹</span> H <span class="free">p</span> <span class="main">(</span><span class="keyword1">while</span> <span class="free">r</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_cons H_loop test_mult while_inv_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we prove a frame rule.›</span></span>

<span class="keyword1" id="VC_KAT-H_frame"><span class="command">lemma</span></span> H_frame<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">p</span> <span class="main">⟹</span> H <span class="free">q</span> <span class="free">x</span> <span class="free">r</span> <span class="main">⟹</span> H <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">q</span> <span class="free">x</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"t <span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">using</span></span> H_def a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> t <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_def mult_assoc test_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Store and Assignment›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The proper verification component starts here.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> store <span class="main">=</span> <span class="quoted"><span class="quoted">"string  <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1" id="VC_KAT-t_p2r"><span class="command">lemma</span></span> t_p2r <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_dioid_tests.t <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT-impl_prop"><span class="command">lemma</span></span> impl_prop <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⊆</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span>  <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT-Id_simp"><span class="command">lemma</span></span> Id_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Id <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> Id <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> Id <span class="main">∩</span> <span class="free">X</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAT-Id_p2r"><span class="command">lemma</span></span> Id_p2r <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Id <span class="main">∩</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Id_def p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT-Id_p2r_simp"><span class="command">lemma</span></span> Id_p2r_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Id <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> Id <span class="main">∪</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span><span class="main">)</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we derive the assignment command and assignment rules.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> store <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> store rel"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">::=</span> _"</span> <span class="main">[</span>70<span class="main">,</span> 65<span class="main">]</span> 61<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">::=</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="bound">s</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1" id="VC_KAT-H_assign_prop"><span class="command">lemma</span></span> H_assign_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">⌉</span> <span class="main">;</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">;</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def gets_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT-H_assign"><span class="command">lemma</span></span> H_assign<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_kat.H <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">⌉</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_kat.H_def gets_def p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT-H_assign_var"><span class="command">lemma</span></span> H_assign_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def gets_def rel_kat.H_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT-H_assign_iff"><span class="command">lemma</span></span> H_assign_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def gets_def rel_kat.H_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT-H_assign_floyd"><span class="command">lemma</span></span> H_assign_floyd<span class="main">:</span> <span class="quoted"><span class="quoted">" rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="bound">s</span> <span class="free">v</span> <span class="main">=</span> <span class="free">e</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> H_assign_var<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> fun_upd_same fun_upd_triv fun_upd_upd<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Simplified Hoare Rules›</span></span>

<span class="keyword1" id="VC_KAT-sH_cons_1"><span class="command">lemma</span></span> sH_cons_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">P'</span><span class="main">⌉</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_kat.H_cons_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT-sH_cons_2"><span class="command">lemma</span></span> sH_cons_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">Q'</span><span class="main">⌉</span> <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_kat.H_cons_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAT-sH_cons"><span class="command">lemma</span></span> sH_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">P'</span><span class="main">⌉</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">Q'</span><span class="main">⌉</span> <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sH_cons_1 sH_cons_2<span class="main">)</span>
  
<span class="keyword1" id="VC_KAT-sH_cond"><span class="command">lemma</span></span> sH_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_kat.H <span class="main">⌈</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">T</span><span class="main">⌉</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">P</span> <span class="main">⊓</span> <span class="main">-</span> <span class="free">T</span><span class="main">⌉</span> <span class="free">Y</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>  <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">(</span>rel_kat.ifthenelse <span class="main">⌈</span><span class="free">T</span><span class="main">⌉</span> <span class="free">X</span> <span class="free">Y</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_kat.H_cond<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_kat.H_def p2r_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="VC_KAT-sH_cond_iff"><span class="command">lemma</span></span> sH_cond_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">(</span>rel_kat.ifthenelse <span class="main">⌈</span><span class="free">T</span><span class="main">⌉</span> <span class="free">X</span> <span class="free">Y</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">⟷</span> <span class="main">(</span>rel_kat.H <span class="main">⌈</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">T</span><span class="main">⌉</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">∧</span> rel_kat.H <span class="main">⌈</span><span class="free">P</span> <span class="main">⊓</span> <span class="main">-</span> <span class="free">T</span><span class="main">⌉</span> <span class="free">Y</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_kat.H_cond_iff<span class="main">)</span>

<span class="keyword1" id="VC_KAT-sH_while_inv"><span class="command">lemma</span></span> sH_while_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">I</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">I</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">R</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">I</span> <span class="main">⊓</span> <span class="free">R</span><span class="main">⌉</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">I</span><span class="main">⌉</span> 
                     <span class="main">⟹</span> rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">(</span>rel_kat.while_inv <span class="main">⌈</span><span class="free">R</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">I</span><span class="main">⌉</span> <span class="free">X</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_kat.H_while_inv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def rel_kat.H_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1" id="VC_KAT-sH_H"><span class="command">lemma</span></span> sH_H<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_kat.H_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we provide additional syntax for specifications and commands.›</span></span>
 
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">H_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">PRE</span> _ _ <span class="keyword1">POST</span> _"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">PRE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">POST</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> rel_kat.H <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">⌉</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">if_then_else_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">IF</span> _ <span class="keyword1">THEN</span> _ <span class="keyword1">ELSE</span> _ <span class="keyword1">FI</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">IF</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">THEN</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">ELSE</span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="keyword1"><span class="free">FI</span></span> <span class="main">≡</span> rel_kat.ifthenelse <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">while_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">WHILE</span> _ <span class="keyword1">DO</span> _ <span class="keyword1">OD</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">WHILE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="keyword1"><span class="free">DO</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">OD</span></span> <span class="main">≡</span> rel_kat.while <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">while_inv_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">WHILE</span> _ <span class="keyword1">INV</span> _ <span class="keyword1">DO</span> _ <span class="keyword1">OD</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">WHILE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">INV</span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1"><span class="free">DO</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">OD</span></span> <span class="main">≡</span> rel_kat.while_inv <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1" id="VC_KAT-H_cond_iff2"><span class="command">lemma</span></span> H_cond_iff2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="free">p</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">r</span> <span class="keyword1">THEN</span> <span class="free">x</span> <span class="keyword1">ELSE</span> <span class="free">y</span> <span class="keyword1">FI</span><span class="main">)</span> <span class="keyword1">POST</span> <span class="free">q</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">PRE</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="keyword1">POST</span> <span class="free">q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">PRE</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="free">y</span> <span class="keyword1">POST</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_kat.H_cond_iff<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VC_KAT_Examples">
<div class="head">
<h1>Theory VC_KAT_Examples</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on KAT: Examples
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Verification Examples›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAT_Examples
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="VC_KAT.html">VC_KAT</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="VC_KAT_Examples-euclid"><span class="command">lemma</span></span> euclid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
    <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="keyword1">mod</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sH_while_inv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_kat.H_seq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H_assign<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> H_assign_var<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> gcd_red_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAT_Examples-maximum"><span class="command">lemma</span></span> maximum<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> nat store<span class="main">.</span> True<span class="main">)</span>
   <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> 
    <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">FI</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> max <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAT_Examples-integer_division"><span class="command">lemma</span></span> integer_division<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
    <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≤</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">DO</span>
      <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">&lt;</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_kat.H_seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sH_while_inv<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_kat.H_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> H_assign<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="VC_KAT_Examples-imp_reverse"><span class="command">lemma</span></span> imp_reverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> <span class="tfree">'a</span> list store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">X</span><span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> rev <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">@</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> rev <span class="free">X</span><span class="main">)</span>
    <span class="keyword1">DO</span> 
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> hd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">#</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> tl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span> 
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">=</span> rev <span class="free">X</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_kat.H_seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sH_while_inv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_kat.H_seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> H_assign_var<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> H_assign_var<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> append.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> append.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append_assoc hd_Cons_tl rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VC_KAT_Examples2">
<div class="head">
<h1>Theory VC_KAT_Examples2</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on KAT: Examples with Automated VCG
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Verification Examples with Automated VCG›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAT_Examples2
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="VC_KAT.html">VC_KAT</a> <span class="quoted">"<a href="../../HOL/HOL-Eisbach/Eisbach.html">HOL-Eisbach.Eisbach</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following simple tactic for verification condition generation has been 
implemented with the Eisbach proof methods language.›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> hl_intro

<span class="keyword1"><span class="command">declare</span></span> sH_while_inv <span class="main">[</span><span class="operator">hl_intro</span><span class="main">]</span>
  rel_kat.H_seq <span class="main">[</span><span class="operator">hl_intro</span><span class="main">]</span>
  H_assign_var <span class="main">[</span><span class="operator">hl_intro</span><span class="main">]</span>
  rel_kat.H_cond <span class="main">[</span><span class="operator">hl_intro</span><span class="main">]</span>

<span class="keyword1"><span class="command">method</span></span> hoare <span class="main">=</span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">hl_intro</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">hoare</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>

<span class="keyword1" id="VC_KAT_Examples2-euclid"><span class="command">lemma</span></span> euclid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
    <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="keyword1">mod</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">hoare</span>
   <span class="keyword1"><span class="command">using</span></span> gcd_red_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAT_Examples2-integer_division"><span class="command">lemma</span></span> integer_division<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
    <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≤</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">DO</span>
      <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">&lt;</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">hoare</span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAT_Examples2-imp_reverse"><span class="command">lemma</span></span> imp_reverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> <span class="tfree">'a</span> list store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">X</span><span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> rev <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">@</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> rev <span class="free">X</span><span class="main">)</span>
    <span class="keyword1">DO</span> 
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> hd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">#</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> tl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span> 
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">=</span> rev <span class="free">X</span> <span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">hoare</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cons_eq_appendI append_eq_append_conv2 hd_Cons_tl rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> self_append_conv<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="RKAT">
<div class="head">
<h1>Theory RKAT</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Refinement KAT
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Refinement Component›</span></span>

<span class="keyword1"><span class="command">theory</span></span> RKAT
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="VC_KAT.html">AVC_KAT/VC_KAT</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹RKAT: Definition and Basic Properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A refinement KAT is a KAT expanded by Morgan's specification statement.›</span></span>

<span class="keyword1"><span class="command">class</span></span> rkat <span class="main">=</span> kat <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">R</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> spec_def<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">R</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟷</span> H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="RKAT-R1"><span class="command">lemma</span></span> R1<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">(</span>R <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="RKAT-R2"><span class="command">lemma</span></span> R2<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spec_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Propositional Refinement Calculus›</span></span>

<span class="keyword1" id="RKAT-R_skip"><span class="command">lemma</span></span> R_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">1</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_skip<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RKAT-R_cons"><span class="command">lemma</span></span> R_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">p</span> <span class="main">≤</span> t <span class="free">p'</span> <span class="main">⟹</span> t <span class="free">q'</span> <span class="main">≤</span> t <span class="free">q</span> <span class="main">⟹</span> R <span class="free">p'</span> <span class="free">q'</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">p</span> <span class="main">≤</span> t <span class="free">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">q'</span> <span class="main">≤</span> t <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H <span class="free">p'</span> <span class="main">(</span>R <span class="free">p'</span> <span class="free">q'</span><span class="main">)</span> <span class="free">q'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">(</span>R <span class="free">p'</span> <span class="free">q'</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h1 h2 H_cons_1 H_cons_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RKAT-R_seq"><span class="command">lemma</span></span> R_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="free">p</span> <span class="free">r</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>R <span class="free">r</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">(</span>R <span class="free">p</span> <span class="free">r</span><span class="main">)</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"H <span class="free">r</span> <span class="main">(</span>R <span class="free">r</span> <span class="free">q</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">(</span><span class="main">(</span>R <span class="free">p</span> <span class="free">r</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>R <span class="free">r</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> H_seq_swap<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RKAT-R_cond"><span class="command">lemma</span></span> R_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">(</span>R <span class="main">(</span>t <span class="free">v</span> <span class="main">⋅</span> t <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>R <span class="main">(</span><span class="keyword1">n</span> <span class="free">v</span> <span class="main">⋅</span> t <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">fi</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H <span class="main">(</span>t <span class="free">v</span> <span class="main">⋅</span> t <span class="free">p</span><span class="main">)</span> <span class="main">(</span>R <span class="main">(</span>t <span class="free">v</span> <span class="main">⋅</span> t <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"H <span class="main">(</span><span class="keyword1">n</span> <span class="free">v</span> <span class="main">⋅</span> t <span class="free">p</span><span class="main">)</span> <span class="main">(</span>R <span class="main">(</span><span class="keyword1">n</span> <span class="free">v</span> <span class="main">⋅</span> t <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">(</span>R <span class="main">(</span>t <span class="free">v</span> <span class="main">⋅</span> t <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>R <span class="main">(</span><span class="keyword1">n</span> <span class="free">v</span> <span class="main">⋅</span> t <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">fi</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_cond n_mult_comm<span class="main">)</span>
 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RKAT-R_loop"><span class="command">lemma</span></span> R_loop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="free">q</span> <span class="keyword1">do</span> <span class="main">(</span>R <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">q</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">od</span> <span class="main">≤</span> R <span class="free">p</span> <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">q</span><span class="main">)</span> <span class="main">(</span>R <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">q</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>  <span class="free">p</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="main">(</span><span class="keyword1">while</span> <span class="free">q</span> <span class="keyword1">do</span> <span class="main">(</span>R <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> t <span class="free">q</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">(</span>t <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_loop<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RKAT-R_zero_one"><span class="command">lemma</span></span> R_zero_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> R <span class="main">0</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H <span class="main">0</span> <span class="free">x</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RKAT-R_one_zero"><span class="command">lemma</span></span> R_one_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"R <span class="main">1</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H <span class="main">1</span> <span class="main">(</span>R <span class="main">1</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def join.le_bot<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="RKAT_Models">
<div class="head">
<h1>Theory RKAT_Models</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Models of Refinement KAT
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Models of Refinement KAT›</span></span>

<span class="keyword1"><span class="command">theory</span></span> RKAT_Models
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="RKAT.html">RKAT</a>
   
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹So far only the relational model is developed.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">rel_R</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="bound">X</span><span class="main">.</span> rel_kat.H <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_rkat<span class="main">:</span> rkat <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(;)</span>"</span></span> <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">rtrancl</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> Id <span class="main">∩</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="quoted">rel_R</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_R_def rel_kat.H_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>



</pre>
</div><div id="VC_RKAT">
<div class="head">
<h1>Theory VC_RKAT</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Refinement Component Based on KAT
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">theory</span></span> VC_RKAT
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="RKAT_Models.html">../RKAT_Models</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This component supports the step-wise refinement of simple while programs
in a partial correctness setting.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Assignment Laws›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The store model is taken from KAT›</span></span>

<span class="keyword1" id="VC_RKAT-R_assign"><span class="command">lemma</span></span> R_assign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rel_kat.H <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> H_assign_var<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_rkat.R2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_RKAT-R_assignr"><span class="command">lemma</span></span> R_assignr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q'</span><span class="main">⌉</span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_assign_var rel_kat.H_seq rel_rkat.R1 rel_rkat.R2<span class="main">)</span>   

<span class="keyword1" id="VC_RKAT-R_assignl"><span class="command">lemma</span></span> R_assignl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P'</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span>rel_R <span class="main">⌈</span><span class="free">P'</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span><span class="main">)</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_assign_var rel_kat.H_seq rel_rkat.R1 rel_rkat.R2<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Simplified Refinement Laws›</span></span>

<span class="keyword1" id="VC_RKAT-R_cons"><span class="command">lemma</span></span> R_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P'</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> rel_R <span class="main">⌈</span><span class="free">P'</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q'</span><span class="main">⌉</span> <span class="main">⊆</span> rel_R <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_rkat.R1 rel_rkat.R2 sH_cons_1 sH_cons_2<span class="main">)</span>

<span class="keyword1" id="VC_RKAT-if_then_else_ref"><span class="command">lemma</span></span> if_then_else_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">X'</span> <span class="main">⟹</span> <span class="free">Y</span> <span class="main">⊆</span> <span class="free">Y'</span> <span class="main">⟹</span> <span class="keyword1">IF</span> <span class="free">P</span> <span class="keyword1">THEN</span> <span class="free">X</span> <span class="keyword1">ELSE</span> <span class="free">Y</span> <span class="keyword1">FI</span> <span class="main">⊆</span> <span class="keyword1">IF</span> <span class="free">P</span> <span class="keyword1">THEN</span> <span class="free">X'</span> <span class="keyword1">ELSE</span> <span class="free">Y'</span> <span class="keyword1">FI</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_kat.ifthenelse_def<span class="main">)</span>
                                     
<span class="keyword1" id="VC_RKAT-while_ref"><span class="command">lemma</span></span> while_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">X'</span> <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free">P</span> <span class="keyword1">DO</span> <span class="free">X</span> <span class="keyword1">OD</span> <span class="main">⊆</span> <span class="keyword1">WHILE</span> <span class="free">P</span> <span class="keyword1">DO</span> <span class="free">X'</span> <span class="keyword1">OD</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_kat.while_def rel_dioid.mult_isol rel_dioid.mult_isor rel_kleene_algebra.star_iso<span class="main">)</span>
                                                               
<span class="keyword2"><span class="keyword">end</span></span>


</pre>
</div><div id="VC_RKAT_Examples">
<div class="head">
<h1>Theory VC_RKAT_Examples</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Refinement Component Based on KAT: Examples
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Refinement Examples›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_RKAT_Examples 
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="VC_RKAT.html">VC_RKAT</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Currently  there is only one example, and no tactic for automating refinement proofs is provided.›</span></span>

<span class="keyword1" id="VC_RKAT_Examples-var_swap_ref1"><span class="command">lemma</span></span> var_swap_ref1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R_assignl<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 

<span class="keyword1" id="VC_RKAT_Examples-var_swap_ref2"><span class="command">lemma</span></span> var_swap_ref2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> 
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R_assignl<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="VC_RKAT_Examples-var_swap_ref3"><span class="command">lemma</span></span> var_swap_ref3<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R_assignl<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="VC_RKAT_Examples-var_swap_ref_var"><span class="command">lemma</span></span> var_swap_ref_var<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"rel_R <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">⌉</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">⌉</span>
   <span class="main">⊇</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> var_swap_ref1 var_swap_ref2 var_swap_ref3 rel_rkat.R_skip <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>


</pre>
</div><div id="VC_KAD">
<div class="head">
<h1>Theory VC_KAD</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on KAD
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Components Based on Kleene Algebra with Domain›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAD

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../KAD/Modal_Kleene_Algebra_Models.html">KAD.Modal_Kleene_Algebra_Models</a> <span class="quoted">"<a href="P2S2R.html">../P2S2R</a>"</span>      

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Verification Component for Backward Reasoning›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This component supports the verification of simple while programs
in a partial correctness setting.›</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> Archimedean_Field.ceiling <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> Archimedean_Field.floor <span class="main">(</span><span class="quoted">"<span class="keyword1">⌊</span>_<span class="keyword1">⌋</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> p2r <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> r2p <span class="main">(</span><span class="quoted">"<span class="keyword1">⌊</span>_<span class="keyword1">⌋</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> antidomain_kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Additional Facts for KAD›</span></span>

<span class="keyword1" id="VC_KAD-fbox_shunt"><span class="command">lemma</span></span> fbox_shunt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">t</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">q</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_6 a_antitone' a_loc add_commute addual.ars_r_def am_d_def da_shunt2 fbox_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Syntax for Conditionals and Loops›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">if</span> _ <span class="keyword1">then</span> _ <span class="keyword1">else</span> _ <span class="keyword1">fi</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">if</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">then</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">else</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1"><span class="free">fi</span></span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">while</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">do</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">od</span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">whilei</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">inv</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">while</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">inv</span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1"><span class="free">do</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">od</span></span> <span class="main">=</span> <span class="keyword1">while</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">od</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Weakest (Liberal) Precondition Calculus›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the setting of Kleene algebra with domain, the wlp operator is the forward modal box operator 
of antidomain Kleene algebra.›</span></span>

<span class="keyword1" id="VC_KAD-fbox_export1"><span class="command">lemma</span></span> fbox_export1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">p</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="main">|</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">]</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_d_add_closure addual.ars_r_def fbox_def fbox_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD-fbox_export2"><span class="command">lemma</span></span> fbox_export2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">q</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">t</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="skolem">t</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">q</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> a_comm_var a_mult_idem ads_d_def am2 ds.ddual.mult_assoc phl_export2<span class="main">)</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">q</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">q</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_closure' addual.ars_r_def ans_d_def dka.dsg3 ds.ddual.mult_assoc fbox_def fbox_demodalisation3<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_closure' addual.ars_r_def ans_d_def fbox_def order_refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD-fbox_export3"><span class="command">lemma</span></span> fbox_export3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">p</span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_de_morgan_var_3 ds.ddual.mult_assoc fbox_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD-fbox_seq"><span class="command">lemma</span></span> fbox_seq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_mult<span class="main">)</span> 

<span class="keyword1" id="VC_KAD-fbox_seq_var"><span class="command">lemma</span></span> fbox_seq_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">≤</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p'</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">]</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">≤</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p'</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dka.dom_iso fbox_iso<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> h1 dual_order.trans fbox_seq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD-fbox_cond_var"><span class="command">lemma</span></span> fbox_cond_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">p</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">q</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> cond_def a_closure' ads_d_def ans_d_def fbox_add2 fbox_export1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD-fbox_cond_aux1"><span class="command">lemma</span></span> fbox_cond_aux1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="main">(</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_d_add_closure addual.ars_r_def ds.ddual.mult_assoc fbox_def fbox_cond_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> addual.ars_r_def am2 dka.dns5 ds.ddual.mult_assoc fbox_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD-fbox_cond_aux2"><span class="command">lemma</span></span> fbox_cond_aux2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cond_def a_closure' add_commute addual.ars_r_def ans_d_def fbox_cond_aux1<span class="main">)</span>

<span class="keyword1" id="VC_KAD-fbox_cond"><span class="command">lemma</span></span> fbox_cond <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addual.ars_r_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  distrib_right' fbox_cond_aux1 fbox_cond_aux2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD-fbox_cond_var2"><span class="command">lemma</span></span> fbox_cond_var2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">q</span> <span class="keyword1">fi</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cond_def fbox_cond <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD-fbox_while_unfold"><span class="command">lemma</span></span> fbox_while_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">t</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fbox_export1 fbox_export3 dka.dom_add_closed fbox_star_unfold_var while_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD-fbox_while_var1"><span class="command">lemma</span></span> fbox_while_var1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fbox_while_unfold a_mult_add ads_d_def dka.dns5 ds.ddual.mult_assoc join.sup_commute<span class="main">)</span>

<span class="keyword1" id="VC_KAD-fbox_while_var2"><span class="command">lemma</span></span> fbox_while_var2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">t</span> <span class="main">⋅</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">t</span> <span class="main">⋅</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">t</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">t</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fbox_while_unfold ds.ddual.mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="keyword1">ad</span> <span class="free">t</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">t</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_de_morgan_var_3 addual.ars_r_def dka.dom_add_closed s4<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">t</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_subid_aux1' mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_de_morgan_var_3 a_mult_idem addual.ars_r_def ans4 dka.dsr5 dpdz.domain_1'' dual_order.trans fbox_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD-fbox_while"><span class="command">lemma</span></span> fbox_while<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">t</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">t</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">]</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_export1 fbox_shunt<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_star_induct_var<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> order_trans while_def fbox_export2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD-fbox_while_var"><span class="command">lemma</span></span> fbox_while_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="main">|</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">]</span> <span class="free">p</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl fbox_export1 fbox_shunt fbox_while<span class="main">)</span>
 
<span class="keyword1" id="VC_KAD-fbox_whilei"><span class="command">lemma</span></span> fbox_whilei<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">t</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">t</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">i</span> <span class="main">≤</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_while whilei_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 dka.dom_iso fbox_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next rule is used for dealing with while loops after a series of sequential steps.›</span></span>

<span class="keyword1" id="VC_KAD-fbox_whilei_break"><span class="command">lemma</span></span> fbox_whilei_break<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">t</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fbox_seq_var<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fbox_whilei<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> fbox_simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we derive a frame rule.›</span></span>

<span class="keyword1" id="VC_KAD-fbox_frame"><span class="command">lemma</span></span> fbox_frame<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">t</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">t</span><span class="main">)</span>"</span></span>    
  <span class="keyword1"><span class="command">using</span></span> dual.mult_isol_var fbox_add1 fbox_demodalisation3 fbox_simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD-fbox_frame_var"><span class="command">lemma</span></span> fbox_frame_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">t</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fbox_frame fbox_demodalisation3 fbox_simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Store and Assignment›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> store <span class="main">=</span> <span class="quoted"><span class="quoted">"string  <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> rel_antidomain_kleene_algebra.fbox <span class="main">(</span><span class="quoted">"<span class="keyword1">wp</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span> rel_antidomain_kleene_algebra.fdia <span class="main">(</span><span class="quoted">"<span class="keyword1">relfdia</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> store <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> store rel"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">::=</span> _"</span> <span class="main">[</span>70<span class="main">,</span> 65<span class="main">]</span> 61<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
   <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">::=</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="bound">s</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1" id="VC_KAD-assign_prop"><span class="command">lemma</span></span> assign_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">⌉</span> <span class="main">;</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">;</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2r_def gets_def<span class="main">)</span>
                                                                                 
<span class="keyword1" id="VC_KAD-wp_assign"><span class="command">lemma</span></span> wp_assign <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_antidomain_kleene_algebra.fbox_def gets_def rel_ad_def p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD-wp_assign_var"><span class="command">lemma</span></span> wp_assign_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="keyword1">wp</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> r2p_def p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD-wp_assign_det"><span class="command">lemma</span></span> wp_assign_det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">=</span> <span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_antidomain_kleene_algebra.fbox_def rel_antidomain_kleene_algebra.fdia_def gets_def p2r_def rel_ad_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
 
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Simplifications›</span></span>

<span class="keyword1"><span class="command">notation</span></span> rel_antidomain_kleene_algebra.ads_d <span class="main">(</span><span class="quoted">"<span class="keyword1">rdom</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">spec_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">PRE</span> _ _ <span class="keyword1">POST</span> _"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">PRE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">POST</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="keyword1">rdom</span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="main">⊆</span> <span class="keyword1">wp</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">⌉</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">cond_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">IF</span> _ <span class="keyword1">THEN</span> _ <span class="keyword1">ELSE</span> _ <span class="keyword1">FI</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">IF</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">THEN</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">ELSE</span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="keyword1"><span class="free">FI</span></span> <span class="main">≡</span> rel_antidomain_kleene_algebra.cond <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">whilei_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">WHILE</span> _ <span class="keyword1">INV</span> _ <span class="keyword1">DO</span> _ <span class="keyword1">OD</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">WHILE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">INV</span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1"><span class="free">DO</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">OD</span></span> <span class="main">≡</span> rel_antidomain_kleene_algebra.whilei <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1" id="VC_KAD-d_p2r"><span class="command">lemma</span></span> d_p2r <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">rdom</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2r_def rel_antidomain_kleene_algebra.ads_d_def rel_ad_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD-p2r_conj_hom_var_symm"><span class="command">lemma</span></span> p2r_conj_hom_var_symm <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">;</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2r_conj_hom_var<span class="main">)</span>

<span class="keyword1" id="VC_KAD-p2r_neg_hom"><span class="command">lemma</span></span> p2r_neg_hom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_ad <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">-</span> <span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_ad_def p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD-wp_trafo"><span class="command">lemma</span></span> wp_trafo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="keyword1">wp</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_antidomain_kleene_algebra.fbox_def rel_ad_def p2r_def r2p_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD-wp_trafo_var"><span class="command">lemma</span></span> wp_trafo_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="keyword1">wp</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span><span class="main">⌋</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wp_trafo<span class="main">)</span>

<span class="keyword1" id="VC_KAD-wp_simp"><span class="command">lemma</span></span> wp_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">rdom</span> <span class="main">⌈</span><span class="main">⌊</span><span class="keyword1">wp</span> <span class="free">X</span> <span class="free">Q</span><span class="main">⌋</span><span class="main">⌉</span> <span class="main">=</span> <span class="keyword1">wp</span> <span class="free">X</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_p2r rel_antidomain_kleene_algebra.a_subid' rel_antidomain_kleene_algebra.addual.bbox_def rpr<span class="main">)</span>

<span class="keyword1" id="VC_KAD-wp_simp_var"><span class="command">lemma</span></span> wp_simp_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">-</span> <span class="free">P</span> <span class="main">⊔</span> <span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_antidomain_kleene_algebra.fbox_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD-impl_prop"><span class="command">lemma</span></span> impl_prop <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⊆</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span>  <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD-p2r_eq_prop"><span class="command">lemma</span></span> p2r_eq_prop <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟷</span>  <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD-impl_prop_var"><span class="command">lemma</span></span> impl_prop_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">rdom</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⊆</span> <span class="keyword1">rdom</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span>  <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>     

<span class="keyword1" id="VC_KAD-p2r_eq_prop_var"><span class="command">lemma</span></span> p2r_eq_prop_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">rdom</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="keyword1">rdom</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟷</span>  <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>                                                     
 
<span class="keyword1" id="VC_KAD-wp_whilei"><span class="command">lemma</span></span> wp_whilei<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">I</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">T</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊓</span> <span class="free">T</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">⌊</span><span class="keyword1">wp</span> <span class="free">X</span> <span class="main">⌈</span><span class="free">I</span><span class="main">⌉</span><span class="main">⌋</span> <span class="bound">s</span><span class="main">)</span> 
                  <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">⌊</span><span class="keyword1">wp</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">T</span> <span class="keyword1">INV</span> <span class="free">I</span> <span class="keyword1">DO</span> <span class="free">X</span> <span class="keyword1">OD</span><span class="main">)</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span><span class="main">⌋</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> impl_prop_var<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> wp_simp<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_antidomain_kleene_algebra.fbox_whilei<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VC_KAD_Examples">
<div class="head">
<h1>Theory VC_KAD_Examples</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on KAD: Examples
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Verification Examples›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAD_Examples
<span class="keyword2"><span class="keyword">imports</span></span> <a href="VC_KAD.html">VC_KAD</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="VC_KAD_Examples-euclid"><span class="command">lemma</span></span> euclid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
    <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="keyword1">mod</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_antidomain_kleene_algebra.fbox_whilei<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gcd_non_0_nat<span class="main">)</span>

<span class="keyword1" id="VC_KAD_Examples-euclid_diff"><span class="command">lemma</span></span> euclid_diff<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">≠</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
     <span class="keyword1">DO</span>
        <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span>  <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span>
         <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">FI</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
    <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_antidomain_kleene_algebra.fbox_whilei<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gcd.commute gcd_diff1_nat le_cases nat_less_le<span class="main">)</span>

<span class="keyword1" id="VC_KAD_Examples-varible_swap"><span class="command">lemma</span></span> varible_swap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span>   
    <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="VC_KAD_Examples-maximum"><span class="command">lemma</span></span> maximum<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> nat store<span class="main">.</span> True<span class="main">)</span> 
   <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> 
    <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">FI</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> max <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD_Examples-integer_division"><span class="command">lemma</span></span> integer_division<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
    <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">DO</span>
      <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_antidomain_kleene_algebra.fbox_whilei_break<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="VC_KAD_Examples-factorial"><span class="command">lemma</span></span> factorial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> True<span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≠</span> <span class="free">x0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> fact <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">⋅</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> fact <span class="free">x0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_antidomain_kleene_algebra.fbox_whilei_break<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
 
<span class="keyword1" id="VC_KAD_Examples-my_power"><span class="command">lemma</span></span> my_power<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> True<span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''i''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''i''</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">≤</span> <span class="free">n</span><span class="main">)</span>
     <span class="keyword1">DO</span>
       <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
       <span class="main">(</span><span class="inner_quoted">''i''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_antidomain_kleene_algebra.fbox_whilei_break<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="VC_KAD_Examples-imp_reverse"><span class="command">lemma</span></span> imp_reverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> <span class="tfree">'a</span> list store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">X</span><span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> rev <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">@</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> rev <span class="free">X</span><span class="main">)</span>
    <span class="keyword1">DO</span> 
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> hd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">#</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> tl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span> 
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">=</span> rev <span class="free">X</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_antidomain_kleene_algebra.fbox_whilei_break<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> append.simps append_assoc hd_Cons_tl rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VC_KAD_Examples2">
<div class="head">
<h1>Theory VC_KAD_Examples2</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on KAD: Examples with Automated VCG
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Verification Examples with Automated VCG›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAD_Examples2
<span class="keyword2"><span class="keyword">imports</span></span> <a href="VC_KAD.html">VC_KAD</a> <span class="quoted">"<a href="../../HOL/HOL-Eisbach/Eisbach.html">HOL-Eisbach.Eisbach</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We have provide a simple tactic in the Eisbach proof method language. Additional simplification
steps are sometimes needed to bring the resulting verification conditions into shape for first-order automated
theorem proving.›</span></span>


<span class="keyword1"><span class="command">named_theorems</span></span> ht

<span class="keyword1"><span class="command">declare</span></span> rel_antidomain_kleene_algebra.fbox_whilei <span class="main">[</span><span class="operator">ht</span><span class="main">]</span>
  rel_antidomain_kleene_algebra.fbox_seq_var <span class="main">[</span><span class="operator">ht</span><span class="main">]</span>
  subset_refl<span class="main">[</span><span class="operator">ht</span><span class="main">]</span>

<span class="keyword1"><span class="command">method</span></span> hoare <span class="main">=</span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">ht</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">hoare</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>

<span class="keyword1" id="VC_KAD_Examples2-euclid2"><span class="command">lemma</span></span> euclid2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
    <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="keyword1">mod</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">hoare</span>
  <span class="keyword1"><span class="command">using</span></span> gcd_red_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD_Examples2-euclid_diff2"><span class="command">lemma</span></span> euclid_diff2<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">≠</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
     <span class="keyword1">DO</span>
        <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span>  <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span>
         <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">FI</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
    <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gcd.commute gcd_diff1_nat le_cases nat_less_le<span class="main">)</span>

<span class="keyword1" id="VC_KAD_Examples2-integer_division2"><span class="command">lemma</span></span> integer_division2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
    <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">DO</span>
      <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">hoare</span> <span class="operator">simp_all</span>

<span class="keyword1" id="VC_KAD_Examples2-factorial2"><span class="command">lemma</span></span> factorial2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> True<span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≠</span> <span class="free">x0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> fact <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">⋅</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> fact <span class="free">x0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">hoare</span> <span class="operator">simp_all</span>

<span class="keyword1" id="VC_KAD_Examples2-my_power2"><span class="command">lemma</span></span> my_power2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> True<span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''i''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''i''</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">≤</span> <span class="free">n</span><span class="main">)</span>
     <span class="keyword1">DO</span>
       <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
       <span class="main">(</span><span class="inner_quoted">''i''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">hoare</span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD_Examples2-imp_reverse2"><span class="command">lemma</span></span> imp_reverse2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> <span class="tfree">'a</span> list store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">X</span><span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> rev <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">@</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> rev <span class="free">X</span><span class="main">)</span>
    <span class="keyword1">DO</span> 
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> hd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">#</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> tl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span> 
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">=</span> rev <span class="free">X</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> append.simps append_assoc hd_Cons_tl rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VC_KAD_dual">
<div class="head">
<h1>Theory VC_KAD_dual</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on KAD for Forward Reasoning
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Verification Component for Forward Reasoning›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAD_dual
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="VC_KAD.html">VC_KAD</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> modal_kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This component supports the verification of simple while programs
in a partial correctness setting.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Strongest Postcondition Calculus›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In modal Kleene algebra, strongest postconditions are backward diamond operators. These
are linked with forward boxes aka weakest preconditions by a Galois connection.  This duality has been
implemented in the AFP entry for Kleene algebra with domain and is picked up automatically in
the following proofs.›</span></span>

<span class="keyword1" id="VC_KAD_dual-r_ad"><span class="command">lemma</span></span> r_ad <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_closure addual.ars_r_def am_d_def domrangefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD_dual-bdia_export1"><span class="command">lemma</span></span> bdia_export1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="main">(</span><span class="keyword1">r</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">r</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="keyword1">r</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">|</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ardual.ads_d_def ardual.ds.ddual.rsr2 ardual.ds.fdia_mult bdia_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_dual-bdia_export2"><span class="command">lemma</span></span> bdia_export2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">q</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">r</span> <span class="free">p</span><span class="main">|</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ardual.ads_d_def ardual.am2 ardual.fdia_export_2 bdia_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD_dual-bdia_seq"><span class="command">lemma</span></span> bdia_seq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">|</span> <span class="free">q</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">y</span><span class="main">|</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ardual.ds.fdia_mult<span class="main">)</span>

<span class="keyword1" id="VC_KAD_dual-bdia_seq_var"><span class="command">lemma</span></span> bdia_seq_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p'</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">y</span><span class="main">|</span> <span class="free">p'</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ardual.ds.fd_subdist_1 ardual.ds.fdia_mult dual_order.trans join.sup_absorb2<span class="main">)</span>

<span class="keyword1" id="VC_KAD_dual-bdia_cond_var"><span class="command">lemma</span></span> bdia_cond_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span><span class="main">|</span> <span class="free">q</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">r</span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">⟨</span><span class="free">y</span><span class="main">|</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">r</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> bdia_export1 a4' a_de_morgan a_de_morgan_var_3 a_subid_aux1' ardual.ds.fdia_add2 dka.dnso1 dka.dsg4 domrange dpdz.dnso1 cond_def join.sup.absorb_iff1 rangedom<span class="main">)</span>

<span class="keyword1" id="VC_KAD_dual-bdia_while"><span class="command">lemma</span></span> bdia_while<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="keyword1">r</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">p</span>  <span class="main">⟹</span> <span class="main">⟨</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="keyword1">r</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bdia_export1 dka.dsg4 domrange rangedom<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ardual.fdemodalisation22 ardual.kat_2_equiv_opp star_sim1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">t</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">⟨</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ardual.dpdz.dsg4 ars_r_def mult_isol r_ad<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bdia_export2 while_def r_ad<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_dual-bdia_whilei"><span class="command">lemma</span></span> bdia_whilei<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">r</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="keyword1">r</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">i</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="keyword1">r</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">|</span> <span class="free">i</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bdia_while whilei_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">|</span> <span class="free">i</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="free">i</span> <span class="main">≤</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="keyword1">r</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ars_r_def box_diamond_galois_1 domrange <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="keyword1">r</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ars_r_def box_diamond_galois_1 domrange <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_dual-bdia_whilei_break"><span class="command">lemma</span></span> bdia_whilei_break<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">y</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">r</span> <span class="free">i</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="keyword1">r</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">i</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">r</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bdia_whilei ardual.ads_d_def ardual.ds.fdia_mult bdia_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Floyd's Assignment Rule›</span></span>

<span class="keyword1" id="VC_KAD_dual-bdia_assign"><span class="command">lemma</span></span> bdia_assign <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_antirange_kleene_algebra.bdia <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="bound">s</span> <span class="free">v</span> <span class="main">=</span> <span class="free">e</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free">v</span><span class="main">:=</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_antirange_kleene_algebra.bdia_def gets_def p2r_def rel_ar_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_upd_apply fun_upd_triv fun_upd_upd<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1" id="VC_KAD_dual-d_p2r"><span class="command">lemma</span></span> d_p2r <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_antirange_kleene_algebra.ars_r  <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2r_def rel_antirange_kleene_algebra.ars_r_def rel_ar_def<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">fspec_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">FPRE</span> _ _ <span class="keyword1">POST</span> _"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">FPRE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">POST</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> rel_antirange_kleene_algebra.bdia <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="main">⊆</span> rel_antirange_kleene_algebra.ars_r <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">⌉</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VC_KAD_dual_Examples">
<div class="head">
<h1>Theory VC_KAD_dual_Examples</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on KAD for Forward Reasoning: Examples
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Verification Examples›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAD_dual_Examples
<span class="keyword2"><span class="keyword">imports</span></span> <a href="VC_KAD_dual.html">VC_KAD_dual</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The proofs are essentially the same as with forward boxes.›</span></span>

<span class="keyword1" id="VC_KAD_dual_Examples-euclid"><span class="command">lemma</span></span> euclid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">FPRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
    <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="keyword1">mod</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_modal_kleene_algebra.bdia_whilei<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gcd_non_0_nat<span class="main">)</span>

<span class="keyword1" id="VC_KAD_dual_Examples-euclid_diff"><span class="command">lemma</span></span> euclid_diff<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="keyword1">FPRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">≠</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
     <span class="keyword1">DO</span>
        <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span>  <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span>
         <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">FI</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
    <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_modal_kleene_algebra.bdia_whilei<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gcd.commute gcd_diff1_nat le_cases nat_less_le<span class="main">)</span>

<span class="keyword1" id="VC_KAD_dual_Examples-varible_swap"><span class="command">lemma</span></span> varible_swap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">FPRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span>   
    <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="VC_KAD_dual_Examples-maximum"><span class="command">lemma</span></span> maximum<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">FPRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> nat store<span class="main">.</span> True<span class="main">)</span> 
   <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> 
    <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">FI</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> max <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD_dual_Examples-integer_division"><span class="command">lemma</span></span> integer_division<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">FPRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
    <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">DO</span>
      <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_modal_kleene_algebra.bdia_whilei_break<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_dual_Examples-factorial"><span class="command">lemma</span></span> factorial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">FPRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> True<span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≠</span> <span class="free">x0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> fact <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">⋅</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> fact <span class="free">x0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_modal_kleene_algebra.bdia_whilei_break<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>
 
<span class="keyword1" id="VC_KAD_dual_Examples-my_power"><span class="command">lemma</span></span> my_power<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">FPRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> True<span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''i''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''i''</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">≤</span> <span class="free">n</span><span class="main">)</span>
     <span class="keyword1">DO</span>
       <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
       <span class="main">(</span><span class="inner_quoted">''i''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_modal_kleene_algebra.bdia_whilei_break<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_dual_Examples-imp_reverse"><span class="command">lemma</span></span> imp_reverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">FPRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> <span class="tfree">'a</span> list store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">X</span><span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> rev <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">@</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> rev <span class="free">X</span><span class="main">)</span>
    <span class="keyword1">DO</span> 
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> hd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">#</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> tl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span> 
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">=</span> rev <span class="free">X</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_modal_kleene_algebra.bdia_whilei_break<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> append.simps append_assoc hd_Cons_tl rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VC_KAD_wf">
<div class="head">
<h1>Theory VC_KAD_wf</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on Divergence Kleene Algebra for Total Correctness
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Verification Component for Total Correctness›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAD_wf

<span class="keyword2"><span class="keyword">imports</span></span> <a href="VC_KAD.html">VC_KAD</a> <a href="../KAD/Modal_Kleene_Algebra_Applications.html">KAD.Modal_Kleene_Algebra_Applications</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This component supports the verification of simple while programs
in a total correctness setting.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Relation Divergence Kleene Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Divergence Kleene algebras have been formalised in the AFP entry for Kleene algebra with domain.
The nabla or divergence operation models those states of a relation from which infinitely ascending chains
may start.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_nabla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">rel_nabla</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">P</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_nabla_bin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">rel_nabla_bin</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">P</span> <span class="main">∪</span> <span class="keyword1">rdom</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="VC_KAD_wf-rel_nabla_d_closed"><span class="command">lemma</span></span> rel_nabla_d_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1">rdom</span> <span class="main">(</span>rel_nabla <span class="free">x</span><span class="main">)</span> <span class="main">=</span> rel_nabla <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_nabla_def rel_antidomain_kleene_algebra.fdia_def rel_antidomain_kleene_algebra.ads_d_def rel_ad_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-rel_nabla_bin_d_closed"><span class="command">lemma</span></span> rel_nabla_bin_d_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1">rdom</span> <span class="main">(</span>rel_nabla_bin <span class="free">x</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> rel_nabla_bin <span class="free">x</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_nabla_bin_def rel_antidomain_kleene_algebra.fdia_def rel_antidomain_kleene_algebra.ads_d_def rel_ad_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-rel_nabla_unfold"><span class="command">lemma</span></span> rel_nabla_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_nabla <span class="free">X</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="free">X</span> <span class="main">(</span>rel_nabla <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_nabla_def rel_ad_def rel_antidomain_kleene_algebra.fdia_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-rel_nabla_bin_unfold"><span class="command">lemma</span></span> rel_nabla_bin_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_nabla_bin <span class="free">X</span> <span class="free">Q</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="free">X</span> <span class="main">(</span>rel_nabla_bin <span class="free">X</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∪</span> <span class="keyword1">rdom</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_nabla_bin_def rel_ad_def rel_antidomain_kleene_algebra.fdia_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-rel_nabla_coinduct_var"><span class="command">lemma</span></span> rel_nabla_coinduct_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="free">X</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⊆</span> rel_nabla <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_nabla_def rel_antidomain_kleene_algebra.fdia_def rel_ad_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-rel_nabla_bin_coinduct"><span class="command">lemma</span></span> rel_nabla_bin_coinduct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="free">X</span> <span class="free">P</span> <span class="main">∪</span> <span class="keyword1">rdom</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⊆</span> rel_nabla_bin <span class="free">X</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_nabla_bin_def rel_antidomain_kleene_algebra.fdia_def rel_ad_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The two fusion lemmas are, in fact, hard-coded fixpoint fusion proofs. They might be replaced
by more generic fusion proofs eventually.›</span></span>

<span class="keyword1" id="VC_KAD_wf-nabla_fusion1"><span class="command">lemma</span></span> nabla_fusion1<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_nabla <span class="free">X</span> <span class="main">∪</span> <span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span> <span class="main">⊆</span> rel_nabla_bin <span class="free">X</span> <span class="free">Q</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_nabla <span class="free">X</span> <span class="main">∪</span> <span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="free">X</span> <span class="main">(</span>rel_nabla <span class="free">X</span><span class="main">)</span> <span class="main">∪</span> <span class="keyword1">relfdia</span> <span class="free">X</span> <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∪</span> <span class="keyword1">rdom</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Un_mono inf_sup_aci<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> order_refl rel_antidomain_kleene_algebra.dka.fdia_star_unfold_var rel_nabla_unfold sup.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">relfdia</span> <span class="free">X</span> <span class="main">(</span>rel_nabla <span class="free">X</span> <span class="main">∪</span> <span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∪</span> <span class="keyword1">rdom</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_antidomain_kleene_algebra.dka.fdia_add1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_nabla_bin_coinduct <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_wf-rel_ad_inter_seq"><span class="command">lemma</span></span> rel_ad_inter_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_ad <span class="free">X</span> <span class="main">∩</span> rel_ad <span class="free">Y</span> <span class="main">=</span> rel_ad <span class="free">X</span> <span class="main">;</span> rel_ad <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_ad_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-fusion2_aux2"><span class="command">lemma</span></span> fusion2_aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">rdom</span> <span class="main">(</span>rel_nabla_bin <span class="free">X</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">rdom</span> <span class="main">(</span>rel_nabla_bin <span class="free">X</span> <span class="free">Q</span> <span class="main">∩</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∪</span> <span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_antidomain_kleene_algebra.ads_d_def rel_ad_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pair_in_Id_conv r_into_rtrancl rel_antidomain_kleene_algebra.a_one rel_antidomain_kleene_algebra.a_star rel_antidomain_kleene_algebra.addual.ars_r_def rel_antidomain_kleene_algebra.dka.dns1'' rel_antidomain_kleene_algebra.dpdz.dom_one rel_antidomain_kleene_algebra.ds.ddual.rsr5 rel_antidomain_kleene_algebra.dual.conway.dagger_unfoldr_eq rel_antidomain_kleene_algebra.dual.tc_eq rel_nabla_bin_d_closed<span class="main">)</span>  

<span class="keyword1" id="VC_KAD_wf-nabla_fusion2"><span class="command">lemma</span></span> nabla_fusion2<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_nabla_bin <span class="free">X</span> <span class="free">Q</span> <span class="main">⊆</span> rel_nabla <span class="free">X</span> <span class="main">∪</span> <span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_nabla_bin <span class="free">X</span> <span class="free">Q</span> <span class="main">∩</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span>  <span class="main">⊆</span> <span class="main">(</span><span class="keyword1">relfdia</span> <span class="free">X</span> <span class="main">(</span>rel_nabla_bin <span class="free">X</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∪</span> <span class="keyword1">rdom</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∩</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_mono equalityD1 rel_nabla_bin_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">(</span><span class="keyword1">relfdia</span> <span class="free">X</span> <span class="main">(</span>rel_nabla_bin <span class="free">X</span> <span class="free">Q</span> <span class="main">∩</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∪</span> <span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∪</span> <span class="keyword1">rdom</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∩</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> fusion2_aux2 rel_antidomain_kleene_algebra.dka.fd_iso1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">relfdia</span> <span class="free">X</span> <span class="main">(</span>rel_nabla_bin <span class="free">X</span> <span class="free">Q</span> <span class="main">∩</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="keyword1">relfdia</span> <span class="free">X</span> <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∪</span> <span class="keyword1">rdom</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∩</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_antidomain_kleene_algebra.dka.fdia_add1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">relfdia</span> <span class="free">X</span> <span class="main">(</span>rel_nabla_bin <span class="free">X</span> <span class="free">Q</span> <span class="main">∩</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∩</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_antidomain_kleene_algebra.dka.fdia_star_unfold_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_nabla_bin <span class="free">X</span> <span class="free">Q</span> <span class="main">∩</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="free">X</span> <span class="main">(</span><span class="main">(</span>rel_nabla_bin <span class="free">X</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∩</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> inf_commute order_trans_rules<span class="main"><span class="main">(</span></span>23<span class="main"><span class="main">)</span></span> rel_ad_inter_seq rel_antidomain_kleene_algebra.a_mult_add rel_antidomain_kleene_algebra.a_subid_aux1' rel_antidomain_kleene_algebra.addual.bdia_def rel_antidomain_kleene_algebra.ds.ddual.rsr5<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">rdom</span> <span class="main">(</span>rel_nabla_bin <span class="free">X</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;</span> rel_ad <span class="main">(</span><span class="keyword1">relfdia</span> <span class="main">(</span><span class="free">X</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">rdom</span> <span class="main">(</span>rel_nabla <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rel_ad_inter_seq rel_antidomain_kleene_algebra.addual.ars_r_def rel_nabla_bin_d_closed rel_nabla_coinduct_var rel_nabla_d_closed<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rel_antidomain_kleene_algebra.addual.ars_r_def rel_antidomain_kleene_algebra.addual.bdia_def rel_antidomain_kleene_algebra.d_a_galois1 rel_antidomain_kleene_algebra.dpdz.domain_invol rel_nabla_bin_d_closed rel_nabla_d_closed<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_wf-rel_nabla_coinduct"><span class="command">lemma</span></span> rel_nabla_coinduct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="free">X</span> <span class="free">P</span> <span class="main">∪</span> <span class="keyword1">rdom</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⊆</span> rel_nabla <span class="free">X</span> <span class="main">∪</span> <span class="keyword1">relfdia</span> <span class="main">(</span>rtrancl <span class="free">X</span><span class="main">)</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> nabla_fusion2 order_trans rel_nabla_bin_coinduct<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_fdivka<span class="main">:</span> fdivergence_kleene_algebra <span class="quoted">rel_ad</span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(;)</span> "</span></span> <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">rtrancl</span> <span class="quoted">rel_nabla</span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">rdom</span> <span class="main">(</span>rel_nabla <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> rel_nabla <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_nabla <span class="skolem">x</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="skolem">x</span> <span class="main">(</span>rel_nabla <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_nabla_unfold<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">rdom</span> <span class="skolem">y</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">∪</span> <span class="keyword1">rdom</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="keyword1">rdom</span> <span class="skolem">y</span> <span class="main">⊆</span> rel_nabla <span class="skolem">x</span> <span class="main">∪</span> <span class="keyword1">relfdia</span> <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_nabla_coinduct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Meta-Equational Loop  Rule›</span></span>

<span class="keyword1"><span class="command">context</span></span> fdivergence_kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The rule below is inspired by Arden' rule from language theory. It can be used in total correctness proofs.›</span></span>

<span class="keyword1" id="VC_KAD_wf-fdia_arden"><span class="command">lemma</span></span> fdia_arden<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span><span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">p</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span><span class="free">x</span> <span class="main">=</span> zero_class.zero"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> zero_class.zero <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 add_commute ads_d_def dka.fd_def nabla_coinduction <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ads_d_def dka.fd_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_wf-fdia_arden_eq"><span class="command">lemma</span></span> fdia_arden_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span><span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">p</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_arden dka.fdia_star_induct_eq eq_iff<span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-fdia_arden_iff"><span class="command">lemma</span></span> fdia_arden_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span><span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">p</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fdia_arden_eq dka.fdia_d_simp dka.fdia_star_unfold_var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_antitone_var<span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-fbox_arden"><span class="command">lemma</span></span> fbox_arden<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span><span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">q</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span><span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_antitone' a_subid addual.ars_r_def dpdz.domain_subid dual_order.trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">q</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">ad</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_6 addual.bbox_def ds.fd_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">ad</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fdia_arden h1 a_4 ads_d_def dpdz.dsg1  fdia_def meet_ord_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_antitone' ads_d_def fbox_simp fdia_fbox_de_morgan_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VC_KAD_wf-fbox_arden_eq"><span class="command">lemma</span></span> fbox_arden_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span><span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_arden antisym fbox_star_induct_eq<span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-fbox_arden_iff"><span class="command">lemma</span></span> fbox_arden_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span><span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">q</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fbox_arden_eq fbox_simp fbox_star_unfold_var<span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-fbox_arden_while_iff"><span class="command">lemma</span></span> fbox_arden_while_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">]</span> <span class="free">p</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fbox_arden_iff dka.dom_add_closed fbox_export3 while_def<span class="main">)</span>  

<span class="keyword1" id="VC_KAD_wf-fbox_arden_whilei"><span class="command">lemma</span></span> fbox_arden_whilei<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">]</span> <span class="free">i</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">=</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fbox_arden_while_iff whilei_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="VC_KAD_wf-fbox_arden_whilei_iff"><span class="command">lemma</span></span> fbox_arden_whilei_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">]</span> <span class="free">i</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">i</span> <span class="main">=</span> <span class="main">|</span><span class="keyword1">while</span> <span class="free">t</span> <span class="keyword1">inv</span> <span class="free">i</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span><span class="main">]</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fbox_arden_while_iff whilei_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Noethericity and Absence of Divergence›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Noetherian elements have been defined in the AFP entry for Kleene algebra with domain. First we show 
that noethericity and absence of divergence coincide. Then we turn to the relational model and 
show that noetherian relations model terminating programs.›</span></span>

<span class="keyword1" id="VC_KAD_wf-noether_nabla"><span class="command">lemma</span></span> noether_nabla<span class="main">:</span> <span class="quoted"><span class="quoted">"Noetherian <span class="free">x</span> <span class="main">⟹</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nabla_closure nabla_unfold noetherian_alt<span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-nabla_noether_iff"><span class="command">lemma</span></span> nabla_noether_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Noetherian <span class="free">x</span> <span class="main">⟷</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nabla_noether noether_nabla <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="VC_KAD_wf-nabla_preloeb_iff"><span class="command">lemma</span></span> nabla_preloeb_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟷</span> PreLoebian <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Noetherian_iff_PreLoebian nabla_noether noether_nabla <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="VC_KAD_wf-rel_nabla_prop"><span class="command">lemma</span></span> rel_nabla_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_nabla <span class="free">R</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="free">R</span> <span class="bound">P</span> <span class="main">⟶</span> <span class="bound">P</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum_uniqueI rel_nabla_coinduct_var rel_nabla_unfold<span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-fdia_rel_im1"><span class="command">lemma</span></span> fdia_rel_im1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">s2r</span> <span class="main">(</span><span class="main">(</span>converse <span class="free">R</span><span class="main">)</span> <span class="main">``</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">relfdia</span> <span class="free">R</span> <span class="main">(</span><span class="keyword1">s2r</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Id_on_def rel_antidomain_kleene_algebra.ads_d_def rel_ad_def rel_antidomain_kleene_algebra.fdia_def Image_def converse_def<span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-fdia_rel_im2"><span class="command">lemma</span></span> fdia_rel_im2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">s2r</span> <span class="main">(</span><span class="main">(</span>converse <span class="free">R</span><span class="main">)</span> <span class="main">``</span> <span class="main">(</span><span class="keyword1">r2s</span> <span class="main">(</span><span class="keyword1">rdom</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">relfdia</span> <span class="free">R</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_rel_im1 rsr<span class="main">)</span>

<span class="keyword1" id="VC_KAD_wf-wf_nabla_aux"><span class="command">lemma</span></span> wf_nabla_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊆</span> <span class="main">(</span>converse <span class="free">R</span><span class="main">)</span> <span class="main">``</span> <span class="free">P</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">s2r</span> <span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">relfdia</span> <span class="free">R</span> <span class="main">(</span><span class="keyword1">s2r</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">s2r</span> <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Domain_Id_on Domain_mono Id_on_empty fdia_rel_im1<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> fdia_rel_im1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A relation is noeterian if its converse is wellfounded. Hence a relation is noetherian if and only if its 
divergence is empty. In the relational program semantics, noetherian programs terminate.›</span></span>

<span class="keyword1" id="VC_KAD_wf-wf_nabla"><span class="command">lemma</span></span> wf_nabla<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>converse <span class="free">R</span><span class="main">)</span> <span class="main">⟷</span> rel_nabla <span class="free">R</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fdia_rel_im2 rel_fdivka.nabla_unfold_eq rel_nabla_prop rel_nabla_unfold wfE_pf wfI_pf wf_nabla_aux<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VC_KAD_wf_Examples">
<div class="head">
<h1>Theory VC_KAD_wf_Examples</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on Divergence Kleene Algebra for Total Correctness: Examples
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Verification Examples›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VC_KAD_wf_Examples
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="VC_KAD_wf.html">VC_KAD_wf</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The example should be taken with a grain of salt. More work is needed to make 
the while rule cooperate with simplification.›</span></span>

<span class="keyword1" id="VC_KAD_wf_Examples-euclid"><span class="command">lemma</span></span> euclid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_nabla <span class="main">(</span>
    <span class="main">⌈</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">⌉</span> <span class="main">;</span> 
      <span class="main">(</span><span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> 
      <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="keyword1">mod</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
      <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">{}</span>
    <span class="main">⟹</span>
  <span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
    <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="keyword1">mod</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_fdivka.fbox_arden_whilei<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> gcd_red_nat gr0I <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The termination assumption is now explicit in the verification proof. Here it is left 
untouched. Means beyond these components are required for discharging it.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Path_Model_Example">
<div class="head">
<h1>Theory Path_Model_Example</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on KAD: Trace Semantics
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Two Extensions›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹KAD Component with Trace Semantics›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Path_Model_Example
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="VC_KAD.html">VC_KAD</a> <span class="quoted">"<a href="../../HOL/HOL-Eisbach/Eisbach.html">HOL-Eisbach.Eisbach</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This component supports the verification of simple while programs
in a partial correctness setting based on a program trace semantics.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Program traces are modelled as non-empty paths or state sequences. The non-empty path model 
of Kleene algebra is taken from the AFP entry for Kleene algebra. Here we show that sets of paths form
antidomain Kleene Algebras.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pp_a</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath set <span class="main">⇒</span> <span class="tfree">'a</span> ppath set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pp_a</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>Node <span class="bound">u</span><span class="main">)</span> <span class="main">|</span><span class="bound">u</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> pp_first <span class="bound">v</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ppath_aka<span class="main">:</span> antidomain_kleene_algebra <span class="quoted">pp_a</span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted">pp_prod</span> <span class="quoted">pp_one</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">pp_star</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_prod_def pp_a_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_prod_def pp_a_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> pp_first.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pp_first_pp_fusion<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pp_a_def pp_one_def<span class="main">)</span>   

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A verification component can then be built with little effort, by and large reusing
parts of the relational components that are generic with respect to the store.›</span></span>      

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pp_gets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> store <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> store ppath set"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">::=</span> _"</span> <span class="main">[</span>70<span class="main">,</span> 65<span class="main">]</span> 61<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">::=</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">{</span>Cons <span class="bound">s</span> <span class="main">(</span>Node <span class="main">(</span><span class="bound">s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">s</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p2pp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> ppath set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p2pp</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span>Node <span class="bound">s</span> <span class="main">|</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Path_Model_Example-pp_a_neg"><span class="command">lemma</span></span> pp_a_neg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pp_a <span class="main">(</span>p2pp <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> p2pp <span class="main">(</span><span class="main">-</span><span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_a_def p2pp_def<span class="main">)</span>

<span class="keyword1" id="Path_Model_Example-ppath_assign"><span class="command">lemma</span></span> ppath_assign <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ppath_aka.fbox <span class="main">(</span><span class="free">v</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="main">(</span>p2pp <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> p2pp <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ppath_aka.fbox_def pp_a_def p2pp_def pp_prod_def pp_gets_def<span class="main">)</span>      

<span class="keyword1"><span class="command">no_notation</span></span> spec_sugar <span class="main">(</span><span class="quoted">"<span class="keyword1">PRE</span> _ _ <span class="keyword1">POST</span> _"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span>
   <span class="keyword2"><span class="keyword">and</span></span> relcomp <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">;</span>"</span> 70<span class="main">)</span>
   <span class="keyword2"><span class="keyword">and</span></span> cond_sugar <span class="main">(</span><span class="quoted">"<span class="keyword1">IF</span> _ <span class="keyword1">THEN</span> _ <span class="keyword1">ELSE</span> _ <span class="keyword1">FI</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span>
   <span class="keyword2"><span class="keyword">and</span></span> whilei_sugar <span class="main">(</span><span class="quoted">"<span class="keyword1">WHILE</span> _ <span class="keyword1">INV</span> _ <span class="keyword1">DO</span> _ <span class="keyword1">OD</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span>
   <span class="keyword2"><span class="keyword">and</span></span> gets <span class="main">(</span><span class="quoted">"_ <span class="keyword1">::=</span> _"</span> <span class="main">[</span>70<span class="main">,</span> 65<span class="main">]</span> 61<span class="main">)</span>
   <span class="keyword2"><span class="keyword">and</span></span> rel_antidomain_kleene_algebra.fbox <span class="main">(</span><span class="quoted">"<span class="keyword1">wp</span>"</span><span class="main">)</span>
   <span class="keyword2"><span class="keyword">and</span></span> rel_antidomain_kleene_algebra.ads_d <span class="main">(</span><span class="quoted">"<span class="keyword1">rdom</span>"</span><span class="main">)</span>
   <span class="keyword2"><span class="keyword">and</span></span> p2r <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> ppath_aka.fbox <span class="main">(</span><span class="quoted">"<span class="keyword1">wp</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> ppath_aka.ads_d <span class="main">(</span><span class="quoted">"<span class="keyword1">rdom</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> p2pp <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> pp_prod <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">;</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">spec_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> ppath set <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">PRE</span> _ _ <span class="keyword1">POST</span> _"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">PRE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">POST</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="keyword1">rdom</span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="main">⊆</span> <span class="keyword1">wp</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">⌉</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">cond_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> ppath set <span class="main">⇒</span> <span class="tfree">'a</span> ppath set <span class="main">⇒</span> <span class="tfree">'a</span> ppath set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">IF</span> _ <span class="keyword1">THEN</span> _ <span class="keyword1">ELSE</span> _ <span class="keyword1">FI</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">IF</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">THEN</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">ELSE</span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="keyword1"><span class="free">FI</span></span> <span class="main">≡</span> ppath_aka.cond <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">whilei_sugar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'a</span> ppath set <span class="main">⇒</span> <span class="tfree">'a</span> ppath set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">WHILE</span> _ <span class="keyword1">INV</span> _ <span class="keyword1">DO</span> _ <span class="keyword1">OD</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">WHILE</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">INV</span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1"><span class="free">DO</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">OD</span></span> <span class="main">≡</span> ppath_aka.whilei <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌉</span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">⌉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"p2pp <span class="free">P</span> <span class="main">∪</span> p2pp <span class="free">Q</span> <span class="main">=</span> p2pp <span class="main">(</span><span class="free">P</span> <span class="main">⊔</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2pp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"p2pp <span class="free">P</span><span class="main">;</span> p2pp <span class="free">Q</span> <span class="main">=</span> p2pp <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2pp_def pp_prod_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≤</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">⊆</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2pp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">rdom</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ppath_aka.addual.ars_r_def<span class="main">)</span>

<span class="keyword1" id="Path_Model_Example-euclid"><span class="command">lemma</span></span> euclid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≠</span> <span class="numeral">0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
    <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="keyword1">mod</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ppath_aka.fbox_whilei<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2pp_def rel_ad_def gcd_non_0_nat<span class="main">)</span>

<span class="keyword1" id="Path_Model_Example-euclid_diff"><span class="command">lemma</span></span> euclid_diff<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="numeral">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="numeral">0</span><span class="main">)</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">≠</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
     <span class="keyword1">DO</span>
        <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span>  <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span>
         <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">FI</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
    <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ppath_aka.fbox_whilei<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2pp_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> gcd.commute gcd_diff1_nat le_cases nat_less_le<span class="main">)</span>

<span class="keyword1" id="Path_Model_Example-varible_swap"><span class="command">lemma</span></span> varible_swap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span>   
    <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Path_Model_Example-maximum"><span class="command">lemma</span></span> maximum<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> nat store<span class="main">.</span> True<span class="main">)</span> 
   <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> 
    <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">FI</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> max <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Path_Model_Example-integer_division"><span class="command">lemma</span></span> integer_division<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="free">x</span> <span class="main">≥</span> <span class="numeral">0</span><span class="main">)</span>
    <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="numeral">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
    <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="numeral">0</span><span class="main">)</span>
     <span class="keyword1">DO</span>
      <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="numeral">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ppath_aka.fbox_whilei_break<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now reconsider these examples with an Eisbach tactic.›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> ht

<span class="keyword1"><span class="command">declare</span></span> ppath_aka.fbox_whilei <span class="main">[</span><span class="operator">ht</span><span class="main">]</span>
  ppath_aka.fbox_seq_var <span class="main">[</span><span class="operator">ht</span><span class="main">]</span>
  subset_refl<span class="main">[</span><span class="operator">ht</span><span class="main">]</span>

<span class="keyword1"><span class="command">method</span></span> hoare <span class="main">=</span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">ht</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">hoare</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>

<span class="keyword1" id="Path_Model_Example-euclid2"><span class="command">lemma</span></span> euclid2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">≠</span> <span class="numeral">0</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
    <span class="keyword1">DO</span>
     <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="keyword1">mod</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">hoare</span>
<span class="keyword1"><span class="command">using</span></span> gcd_red_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Path_Model_Example-euclid_diff2"><span class="command">lemma</span></span> euclid_diff2<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="numeral">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="numeral">0</span><span class="main">)</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">≠</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> gcd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span> 
     <span class="keyword1">DO</span>
        <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span>  <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span>
         <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">FI</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span>
    <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">hoare</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> gcd.commute gcd_diff1_nat le_cases nat_less_le<span class="main">)</span>

<span class="keyword1" id="Path_Model_Example-varible_swap2"><span class="command">lemma</span></span> varible_swap2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span>   
    <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

<span class="keyword1" id="Path_Model_Example-maximum2"><span class="command">lemma</span></span> maximum2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> nat store<span class="main">.</span> True<span class="main">)</span> 
   <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> 
    <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">FI</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> max <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Path_Model_Example-integer_division2"><span class="command">lemma</span></span> integer_division2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> <span class="free">x</span> <span class="main">≥</span> <span class="numeral">0</span><span class="main">)</span>
    <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="numeral">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
    <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="numeral">0</span><span class="main">)</span>
     <span class="keyword1">DO</span>
      <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''q''</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="numeral">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">hoare</span> <span class="operator">auto</span>

<span class="keyword1" id="Path_Model_Example-my_power2"><span class="command">lemma</span></span> my_power2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>nat store<span class="main">.</span> True<span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''i''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="numeral">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''i''</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">≤</span> <span class="free">n</span><span class="main">)</span>
     <span class="keyword1">DO</span>
       <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
       <span class="main">(</span><span class="inner_quoted">''i''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''i''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">OD</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">hoare</span> <span class="operator">auto</span>

<span class="keyword1" id="Path_Model_Example-imp_reverse2"><span class="command">lemma</span></span> imp_reverse2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> <span class="tfree">'a</span> list store<span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="free">X</span><span class="main">)</span>
   <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> rev <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">@</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> rev <span class="free">X</span><span class="main">)</span>
    <span class="keyword1">DO</span> 
     <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> hd <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">#</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
     <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> tl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">OD</span><span class="main">)</span> 
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">=</span> rev <span class="free">X</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">hoare</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append.simps append_assoc hd_Cons_tl rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Pointer_Examples">
<div class="head">
<h1>Theory Pointer_Examples</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Verification Component Based on KAD: Programs with Pointers
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹KAD Component for Pointer Programs›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Pointer_Examples
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="VC_KAD_Examples2.html">VC_KAD_Examples2</a> <span class="quoted">"<a href="../../HOL/HOL-Hoare/Heap.html">HOL-Hoare.Heap</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This component supports the verification of simple while programs
with pointers in a partial correctness setting.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹All we do here is integrating Nipkow's implementation of pointers and heaps.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> state <span class="main">=</span> <span class="quoted"><span class="quoted">"string  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> ref <span class="main">+</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ref<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Pointer_Examples-list_reversal"><span class="command">lemma</span></span> list_reversal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="main">::</span> <span class="tfree">'a</span> state<span class="main">.</span> List <span class="main">(</span>projr <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''h''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>projl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''p''</span><span class="main">)</span><span class="main">)</span> <span class="free">Ps</span> 
        <span class="main">∧</span> List <span class="main">(</span>projr <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''h''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>projl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''q''</span><span class="main">)</span><span class="main">)</span> <span class="free">Qs</span> 
        <span class="main">∧</span> set <span class="free">Ps</span> <span class="main">∩</span> set <span class="free">Qs</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>
    <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> projl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''p''</span><span class="main">)</span> <span class="main">≠</span> Null<span class="main">)</span> 
     <span class="keyword1">INV</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span> <span class="bound">qs</span><span class="main">.</span> List <span class="main">(</span>projr <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''h''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>projl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''p''</span><span class="main">)</span><span class="main">)</span> <span class="bound">ps</span> 
              <span class="main">∧</span> List <span class="main">(</span>projr <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''h''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>projl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''q''</span><span class="main">)</span><span class="main">)</span> <span class="bound">qs</span> 
              <span class="main">∧</span> set <span class="bound">ps</span> <span class="main">∩</span> set <span class="bound">qs</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> rev <span class="bound">ps</span> <span class="main">@</span> <span class="bound">qs</span> <span class="main">=</span> rev <span class="free">Ps</span> <span class="main">@</span> <span class="free">Qs</span><span class="main">)</span>
     <span class="keyword1">DO</span>
      <span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''p''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="inner_quoted">''p''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> Inl <span class="main">(</span>projr <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''h''</span><span class="main">)</span> <span class="main">(</span>addr <span class="main">(</span>projl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''p''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="inner_quoted">''h''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> Inr <span class="main">(</span><span class="main">(</span>projr <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''h''</span><span class="main">)</span><span class="main">)</span><span class="main">(</span>addr <span class="main">(</span>projl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span><span class="main">)</span> <span class="main">:=</span> projl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''q''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="inner_quoted">''q''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">OD</span><span class="main">)</span>
  <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> List <span class="main">(</span>projr <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''h''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>projl <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''q''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">Ps</span> <span class="main">@</span> <span class="free">Qs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">hoare</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> notin_List_update<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="KAD_is_KAT">
<div class="head">
<h1>Theory KAD_is_KAT</h1>
</div>
<pre class="source"><span class="comment1">(* Title: KAD is KAT
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Bringing KAT Components into Scope of KAD›</span></span>

<span class="keyword1"><span class="command">theory</span></span> KAD_is_KAT
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../KAD/Antidomain_Semiring.html">KAD.Antidomain_Semiring</a> 
        <a href="../KAT_and_DRA/KAT.html">KAT_and_DRA.KAT</a>
        <span class="quoted">"<a href="VC_KAD.html">AVC_KAD/VC_KAD</a>"</span>
        <span class="quoted">"<a href="VC_KAT.html">AVC_KAT/VC_KAT</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> antidomain_kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every Kleene algebra with domain is a Kleene algebra with tests. This fact should eventually move into
the AFP KAD entry.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> kat <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted">star</span> <span class="quoted">antidomain_op</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> a_d_mult_closure am_d_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> dpdz.dom_weakly_local <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_d_add_closure a_de_morgan <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next statement links the wp operator with the Hoare triple.›</span></span>

<span class="keyword1" id="KAD_is_KAT-H_kat_to_kad"><span class="command">lemma</span></span> H_kat_to_kad<span class="main">:</span> <span class="quoted"><span class="quoted">"H <span class="free">p</span> <span class="free">x</span> <span class="free">q</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_def addual.ars_r_def fbox_demodalisation3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
 
<span class="keyword1" id="KAD_is_KAT-H_eq"><span class="command">lemma</span></span> H_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> Id <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⊆</span> Id <span class="main">⟹</span> rel_kat.H <span class="free">P</span> <span class="free">X</span> <span class="free">Q</span> <span class="main">=</span> rel_antidomain_kleene_algebra.H <span class="free">P</span> <span class="free">X</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_kat.H_def rel_antidomain_kleene_algebra.H_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"rel_antidomain_kleene_algebra.t <span class="free">P</span> <span class="main">=</span> Id <span class="main">∩</span> <span class="free">P</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"rel_antidomain_kleene_algebra.t <span class="free">Q</span> <span class="main">=</span> Id <span class="main">∩</span> <span class="free">Q</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_ad_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">no_notation</span></span> VC_KAD.spec_sugar <span class="main">(</span><span class="quoted">"<span class="keyword1">PRE</span> _ _ <span class="keyword1">POST</span> _"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span> VC_KAD.cond_sugar <span class="main">(</span><span class="quoted">"<span class="keyword1">IF</span> _ <span class="keyword1">THEN</span> _ <span class="keyword1">ELSE</span> _ <span class="keyword1">FI</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span> VC_KAD.gets <span class="main">(</span><span class="quoted">"_ <span class="keyword1">::=</span> _"</span> <span class="main">[</span>70<span class="main">,</span> 65<span class="main">]</span> 61<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we provide some syntactic sugar.›</span></span>

<span class="keyword1" id="KAD_is_KAT-H_from_kat"><span class="command">lemma</span></span> H_from_kat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="free">p</span> <span class="free">x</span> <span class="keyword1">POST</span> <span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">⌈</span><span class="free">p</span><span class="main">⌉</span> <span class="main">≤</span> <span class="main">(</span>rel_antidomain_kleene_algebra.fbox <span class="free">x</span><span class="main">)</span> <span class="main">⌈</span><span class="free">q</span><span class="main">⌉</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2r_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_antidomain_kleene_algebra.H_kat_to_kad<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"rel_antidomain_kleene_algebra.ads_d <span class="main">⌈</span><span class="free">p</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">p</span><span class="main">⌉</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"rel_antidomain_kleene_algebra.ads_d <span class="main">⌈</span><span class="free">q</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">q</span><span class="main">⌉</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_antidomain_kleene_algebra.ads_d_def rel_ad_def p2r_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="KAD_is_KAT-cond_iff"><span class="command">lemma</span></span> cond_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_kat.ifthenelse <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="free">X</span> <span class="free">Y</span> <span class="main">=</span> rel_antidomain_kleene_algebra.cond <span class="main">⌈</span><span class="free">P</span><span class="main">⌉</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_kat.ifthenelse_def rel_antidomain_kleene_algebra.cond_def<span class="main">)</span>

<span class="keyword1" id="KAD_is_KAT-gets_iff"><span class="command">lemma</span></span> gets_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">::=</span> <span class="free">e</span> <span class="main">=</span> VC_KAD.gets <span class="free">v</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> VC_KAT.gets_def VC_KAD.gets_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we present two examples to test the integration.›</span></span>

<span class="keyword1" id="KAD_is_KAT-maximum"><span class="command">lemma</span></span> maximum<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> nat store<span class="main">.</span> True<span class="main">)</span>
   <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> 
    <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">FI</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> max <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sH_cond_iff H_assign_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="KAD_is_KAT-maximum2"><span class="command">lemma</span></span> maximum2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">PRE</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span> nat store<span class="main">.</span> True<span class="main">)</span>
   <span class="main">(</span><span class="keyword1">IF</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span> 
    <span class="keyword1">THEN</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">ELSE</span> <span class="main">(</span><span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">FI</span><span class="main">)</span>
   <span class="keyword1">POST</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">=</span> max <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H_from_kat<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cond_iff<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> gets_iff<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> gets_iff<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Domain_Quantale">
<div class="head">
<h1>Theory Domain_Quantale</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Domain Quantales
   Author: Victor Gomes, Georg Struth
   Maintainer: Victor Gomes &lt;victor.gomes@cl.cam.ac.uk&gt;
               Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Component for Recursive Programs›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Domain_Quantale
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../KAD/Modal_Kleene_Algebra.html">KAD.Modal_Kleene_Algebra</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This component supports the verification and step-wise refinement of recursive programs
in a partial correctness setting.›</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>
<span class="comment1">(*
  Inf ("⨅_" [900] 900) and
  Sup ("⨆_" [900] 900)
*)</span>

<span class="comment1">(*
syntax
  "_INF1"     :: "pttrns ⇒ 'b ⇒ 'b"           ("(3⨅_./ _)" [0, 10] 10)
  "_INF"      :: "pttrn ⇒ 'a set ⇒ 'b ⇒ 'b"  ("(3⨅_∈_./ _)" [0, 0, 10] 10)
  "_SUP1"     :: "pttrns ⇒ 'b ⇒ 'b"           ("(3⨆_./ _)" [0, 10] 10)
  "_SUP"      :: "pttrn ⇒ 'a set ⇒ 'b ⇒ 'b"  ("(3⨆_∈_./ _)" [0, 0, 10] 10)

*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lattice-Ordered Monoids with Domain›</span></span>

<span class="keyword1"><span class="command">class</span></span> bd_lattice_ordered_monoid <span class="main">=</span> bounded_lattice <span class="main">+</span> distrib_lattice <span class="main">+</span> monoid_mult <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> left_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> right_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bot_annil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bot_annir <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> semiring_one_zero <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"bot"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sup.assoc sup.commute sup_left_commute left_distrib right_distrib sup_absorb1<span class="main">)</span>   

<span class="keyword1"><span class="command">sublocale</span></span> dioid_one_zero <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted">bot</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> ads_d <span class="main">(</span><span class="quoted">"<span class="keyword1">d</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> ars_r <span class="main">(</span><span class="quoted">"<span class="keyword1">r</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> antirange_op <span class="main">(</span><span class="quoted">"<span class="keyword1">ar</span> _"</span> <span class="main">[</span>999<span class="main">]</span> 1000<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> domain_bdlo_monoid <span class="main">=</span> bd_lattice_ordered_monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rdv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> top<span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> top"</span></span>  

<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="main">⊤</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> ds<span class="main">:</span> domain_semiring <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"d"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊔</span> d <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">=</span> d <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_def inf_sup_absorb left_distrib mult_1_left mult_1_right rdv sup.absorb_iff1 sup.idem sup.left_commute top_greatest<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> d <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def inf_absorb2 rdv  mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"d <span class="skolem">x</span> <span class="main">⊔</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def sup.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"d bot <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def inf.absorb1 inf.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> d <span class="skolem">x</span> <span class="main">⊔</span> d <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def inf_sup_distrib1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Boolean Monoids with Domain›</span></span>

<span class="keyword1"><span class="command">class</span></span> boolean_monoid <span class="main">=</span> boolean_algebra <span class="main">+</span> monoid_mult <span class="main">+</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> left_distrib'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> right_distrib'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bot_annil' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bot_annir' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> bd_lattice_ordered_monoid
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_distrib' right_distrib'<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-inf_bot_iff_le"><span class="command">lemma</span></span> inf_bot_iff_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_inf inf_sup_distrib1 inf_top_right sup_bot.left_neutral sup_compl_top compl_inf_bot inf.assoc inf_bot_right<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_boolean_monoid <span class="main">=</span> boolean_monoid <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> rdv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span>"</span></span>     

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> dblo<span class="main">:</span> domain_bdlo_monoid <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊓)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rdv'<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>dblo.d <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
                                
<span class="keyword1" id="Domain_Quantale-a_d_iff"><span class="command">lemma</span></span> a_d_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"a <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def dblo.d_def inf_sup_distrib1<span class="main">)</span> 

<span class="keyword1" id="Domain_Quantale-topr"><span class="command">lemma</span></span> topr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">⊤</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol_var mult_oner order_refl top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">⊤</span>  <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">⊤</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span>  <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rdv'<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">⊤</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_bot_iff_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Quantale-dd_a"><span class="command">lemma</span></span> dd_a<span class="main">:</span> <span class="quoted"><span class="quoted">"dblo.d <span class="free">x</span> <span class="main">=</span> a <span class="main">(</span>a <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_d_iff dblo.d_def double_compl inf_top.left_neutral mult_1_left rdv' topr<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-ad_a"><span class="command">lemma</span></span> ad_a <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"a <span class="main">(</span>dblo.d <span class="free">x</span><span class="main">)</span> <span class="main">=</span> a <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-da_a"><span class="command">lemma</span></span> da_a <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dblo.d <span class="main">(</span>a <span class="free">x</span><span class="main">)</span> <span class="main">=</span> a <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ad_a dd_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Domain_Quantale-a1"><span class="command">lemma</span></span> a1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"a <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_d_iff inf_compl_bot mult_1_left rdv' topr<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> dblo.d_def dblo.ds.domain_very_strict inf_bot_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Quantale-a2"><span class="command">lemma</span></span> a2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"a <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> a <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> a <span class="main">(</span>a <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> a <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> a <span class="main">(</span>a <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_def dblo.ds.dsr2 dd_a sup.idem<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-a3"><span class="command">lemma</span></span> a3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"a <span class="main">(</span>a <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> a <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_def da_a inf.commute sup.commute sup_compl_top sup_inf_absorb sup_inf_distrib1<span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> domain_bdlo_monoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next statement shows that every boolean monoid with domain is an antidomain semiring. 
In this setting the domain operation has been defined explicitly.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> ad<span class="main">:</span> antidomain_semiring <span class="quoted">a</span> <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> ad_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ad.ads_d <span class="free">x</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"class.antidomain_semiring a <span class="main">(⊔)</span> <span class="main">(⋅)</span> <span class="main">1</span> <span class="main">⊥</span> <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ad<span class="main">:</span> antidomain_semiring <span class="quoted">a</span> <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ad.ads_d <span class="free">x</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ad.ads_d_def dd_a<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Boolean Monoids with Range›</span></span>

<span class="keyword1"><span class="command">class</span></span> range_boolean_monoid <span class="main">=</span> boolean_monoid <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> ldv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⊓</span> <span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="main">⊤</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ar</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>r <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
                                
<span class="keyword1" id="Domain_Quantale-ar_r_iff"><span class="command">lemma</span></span> ar_r_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"ar <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ar_def inf_sup_distrib1 r_def<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-topl"><span class="command">lemma</span></span> topl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span><span class="main">⋅</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_annir' compl_inf_bot inf_bot_iff_le ldv'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⊤</span> <span class="main">⋅</span> <span class="main">-</span> <span class="main">(</span><span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le2 inf_top.right_neutral mult_1_left mult_isor<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Quantale-r_ar"><span class="command">lemma</span></span> r_ar<span class="main">:</span> <span class="quoted"><span class="quoted">"r <span class="free">x</span> <span class="main">=</span> ar <span class="main">(</span>ar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ar_r_iff double_compl inf.commute inf_top.right_neutral ldv' mult_1_right r_def topl<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-ar_ar"><span class="command">lemma</span></span> ar_ar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ar <span class="main">(</span>r <span class="free">x</span><span class="main">)</span> <span class="main">=</span> ar <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ar_def ldv' r_def<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-rar_ar"><span class="command">lemma</span></span> rar_ar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"r <span class="main">(</span>ar <span class="free">x</span><span class="main">)</span> <span class="main">=</span> ar <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r_ar ar_ar <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Domain_Quantale-ar1"><span class="command">lemma</span></span> ar1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> ar <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> ar <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ar_r_iff inf_compl_bot ldv' mult_oner topl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_bot_iff_le inf_le2 inf_top.right_neutral mult_1_left mult_isor mult_oner topl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Quantale-ars"><span class="command">lemma</span></span> ars<span class="main">:</span> <span class="quoted"><span class="quoted">"r <span class="main">(</span>r <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> r <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_top.right_neutral ldv' mult_oner mult_assoc r_def<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-ar2"><span class="command">lemma</span></span> ar2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ar <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> ar <span class="main">(</span>ar <span class="main">(</span>ar <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> ar <span class="main">(</span>ar <span class="main">(</span>ar <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ar_def ars r_ar sup.idem<span class="main">)</span>
                         
<span class="keyword1" id="Domain_Quantale-ar3"><span class="command">lemma</span></span> ar3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ar <span class="main">(</span>ar <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> ar <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ar_def rar_ar inf.commute sup.commute sup_compl_top sup_inf_absorb sup_inf_distrib1<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ar<span class="main">:</span> antirange_semiring <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span> <span class="quoted">ar</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> ar_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ar.ars_r <span class="free">x</span> <span class="main">=</span> r <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"class.antirange_semiring <span class="main">(⊔)</span> <span class="main">(⋅)</span> <span class="main">1</span> <span class="main">⊥</span> ar <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ar<span class="main">:</span> antirange_semiring <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span> <span class="quoted">ar</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ar.ars_r <span class="free">x</span> <span class="main">=</span> r <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ar.ars_r_def r_ar<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Quantales›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This part will eventually move into an AFP quantale entry.›</span></span> 

<span class="keyword1"><span class="command">class</span></span> quantale <span class="main">=</span> complete_lattice <span class="main">+</span> monoid_mult <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Sup_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup <span class="free">X</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> Sup <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Sup_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> Sup <span class="free">Y</span> <span class="main">=</span> Sup <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">}</span>"</span></span>       

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Domain_Quantale-bot_annil''"><span class="command">lemma</span></span> bot_annil'' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Sup_distr<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Domain_Quantale-bot_annirr''"><span class="command">lemma</span></span> bot_annirr'' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Sup_distl<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Domain_Quantale-sup_distl"><span class="command">lemma</span></span> sup_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Sup_distl<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_eqI<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-sup_distr"><span class="command">lemma</span></span> sup_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Sup_distr<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_eqI<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> semiring_one_zero <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sup.assoc sup.commute sup_left_commute sup_distl sup_distr<span class="main">)</span>     

<span class="keyword1"><span class="command">sublocale</span></span> dioid_one_zero <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-Sup_sup_pred"><span class="command">lemma</span></span> Sup_sup_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">P</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_mono Sup_subset_mono Sup_upper<span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> Sup_least Sup_upper le_supI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">star</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">star</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Domain_Quantale-star_def_var1"><span class="command">lemma</span></span> star_def_var1<span class="main">:</span> <span class="quoted"><span class="quoted">"star <span class="free">x</span> <span class="main">=</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_def full_SetCompr_eq<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-star_def_var2"><span class="command">lemma</span></span> star_def_var2<span class="main">:</span> <span class="quoted"><span class="quoted">"star <span class="free">x</span> <span class="main">=</span> Sup<span class="main">{</span><span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_def full_SetCompr_eq<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-star_unfoldl'"><span class="command">lemma</span></span> star_unfoldl' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span>star <span class="free">x</span><span class="main">)</span> <span class="main">=</span> star <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span>star <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_def_var1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">0</span> <span class="main">⊔</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_distl<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_sup_pred <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 power.power.power_Suc power.power_eq_if<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_def_var1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Quantale-star_unfoldr'"><span class="command">lemma</span></span> star_unfoldr' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span>star <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> star <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span>star <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">0</span> <span class="main">⊔</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">}</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_def_var1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">0</span> <span class="main">⊔</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_distr<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">0</span> <span class="main">⊔</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> power_Suc2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_sup_pred <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Sup<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 power.power.power_Suc power.power_eq_if<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_def_var1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dioid_one_zero<span class="main">)</span> power_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"0.prems"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">case</span></span> Suc <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> mult.assoc mult_isol order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dioid_one_zero<span class="main">)</span> power_inductr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"0.prems"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">case</span></span> Suc
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc power_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc power_commutes<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_isor<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Quantale-star_inductl'"><span class="command">lemma</span></span> star_inductl'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>star <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_inductl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Sup<span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">w</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">}</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Sup<span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">w</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">}</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_distr Sup_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>star <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_def_var1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Quantale-star_inductr'"><span class="command">lemma</span></span> star_inductr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span>star <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span>  <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_inductr<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Sup<span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">w</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">}</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> Sup<span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">w</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">}</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_distl Sup_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span>star <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_def_var1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> ka<span class="main">:</span> kleene_algebra <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted">star</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_inductl' star_inductr'<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Distributive quantales are often assumed to satisfy infinite distributivity laws between
joins and meets, but finite ones suffice for our purposes.›</span></span>

<span class="keyword1"><span class="command">class</span></span> distributive_quantale <span class="main">=</span> quantale <span class="main">+</span> distrib_lattice 

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> bd_lattice_ordered_monoid
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="comment1">(* nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Domain Quantales›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_quantale <span class="main">=</span> distributive_quantale <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rdv''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span>"</span></span>  

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> domain_bdlo_monoid 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rdv''<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> range_quantale <span class="main">=</span> distributive_quantale <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ldv''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⊓</span> <span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> boolean_quantale <span class="main">=</span> quantale <span class="main">+</span> complete_boolean_algebra

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> boolean_monoid
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_distl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="comment1">(*nitpick[expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
<span class="comment1">(*nitpick[expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Boolean Domain Quantales›</span></span> 

<span class="keyword1"><span class="command">class</span></span> domain_boolean_quantale <span class="main">=</span> domain_quantale <span class="main">+</span> boolean_quantale

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> domain_boolean_monoid
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rdv''<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-fbox_eq"><span class="command">lemma</span></span> fbox_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ad.fbox <span class="free">x</span> <span class="free">q</span> <span class="main">=</span> Sup<span class="main">{</span>d <span class="bound">p</span> <span class="main">|</span><span class="bound">p</span><span class="main">.</span> d <span class="bound">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> d <span class="free">q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_eqI<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">using</span></span> ad.fbox_demodalisation3 ad.fbox_simp <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ad.fbox_def ad.fbox_demodalisation3 ad.fbox_simp da_a eq_refl<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-fdia_eq"><span class="command">lemma</span></span> fdia_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ad.fdia <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Inf<span class="main">{</span>d <span class="bound">q</span> <span class="main">|</span><span class="bound">q</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> d <span class="free">p</span> <span class="main">≤</span> d <span class="bound">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Inf_eqI<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">using</span></span> ds.fdemodalisation2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ad.fd_eq_fdia ad.fdia_def da_a double_compl ds.fdemodalisation2 inf_bot_iff_le inf_compl_bot<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The specification statement can be defined explicitly.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> Sup<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>d <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⋅</span> d <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> d <span class="free">p</span> <span class="main">≤</span> ad.fbox <span class="free">x</span> <span class="main">(</span>d <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def ad.kat_1_equiv ad.kat_2_equiv<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> Sup<span class="main">{</span><span class="bound">x</span><span class="main">.</span> d <span class="free">p</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">⋅</span> a <span class="free">q</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"d <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> a <span class="free">q</span> <span class="main">≤</span> d <span class="free">p</span> <span class="main">⋅</span> Sup<span class="main">{</span><span class="bound">x</span><span class="main">.</span> d <span class="free">p</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">⋅</span> a <span class="free">q</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">}</span> <span class="main">⋅</span> a <span class="free">q</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_double_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Sup<span class="main">{</span>d <span class="free">p</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">⋅</span> a <span class="free">q</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> d <span class="free">p</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">⋅</span> a <span class="free">q</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Sup_distl<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Sup_distr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sup_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ad.fbox_demodalisation3 ad.kat_3 ad.kat_4 le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"d <span class="free">p</span> <span class="main">≤</span> ad.fbox <span class="free">x</span> <span class="main">(</span>d <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> R <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_upper<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> ad.fbox_demodalisation3 ad.fbox_simp <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Relational Model of Boolean Domain Quantales›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_dbq<span class="main">:</span> domain_boolean_quantale <span class="quoted">Inter</span> <span class="quoted">Union</span> <span class="quoted"><span class="quoted">"<span class="main">(∩)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted">UNIV</span> <span class="quoted">minus</span> <span class="quoted">uminus</span> <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> O_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Modal Boolean Quantales›</span></span>

<span class="keyword1"><span class="command">class</span></span> range_boolean_quantale <span class="main">=</span> range_quantale <span class="main">+</span> boolean_quantale

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> range_boolean_monoid
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ldv''<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-fbox_eq"><span class="command">lemma</span></span> fbox_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ar.bbox <span class="free">x</span> <span class="main">(</span>r <span class="free">q</span><span class="main">)</span> <span class="main">=</span> Sup<span class="main">{</span>r <span class="bound">p</span> <span class="main">|</span><span class="bound">p</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> r <span class="bound">p</span> <span class="main">≤</span> <span class="main">(</span>r <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_eqI<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">using</span></span> ar.ardual.fbox_demodalisation3 ar.ardual.fbox_simp <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ar.ardual.fbox_def ar.ardual.fbox_demodalisation3 eq_refl rar_ar<span class="main">)</span>

<span class="keyword1" id="Domain_Quantale-fdia_eq"><span class="command">lemma</span></span> fdia_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ar.bdia <span class="free">x</span> <span class="main">(</span>r <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Inf<span class="main">{</span>r <span class="bound">q</span> <span class="main">|</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span>r <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> r <span class="bound">q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Inf_eqI<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">using</span></span> ar.ars_r_def ar.ardual.fdemodalisation22 ar.ardual.kat_3_equiv_opp ar.ardual.kat_4_equiv_opp <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">using</span></span> ar.bdia_def ar.ardual.ds.fdemodalisation2 r_ar <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> modal_boolean_quantale <span class="main">=</span> domain_boolean_quantale <span class="main">+</span> range_boolean_quantale <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> domrange' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>r <span class="free">x</span><span class="main">)</span> <span class="main">=</span> r <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rangedom' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"r <span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> mka<span class="main">:</span> modal_kleene_algebra <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">⊥</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted">star</span> <span class="quoted">a</span> <span class="quoted">ar</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ar_eq ad_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> fbox <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span> <span class="keyword1">|</span>_<span class="keyword1">]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>61<span class="main">,</span>81<span class="main">]</span> 82<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> antidomain_semiringl_class.fbox <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span> <span class="keyword1">|</span>_<span class="keyword1">]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>61<span class="main">,</span>81<span class="main">]</span> 82<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> ad.fbox <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span> <span class="keyword1">|</span>_<span class="keyword1">]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>61<span class="main">,</span>81<span class="main">]</span> 82<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Recursion Rule›</span></span>

<span class="keyword1" id="Domain_Quantale-recursion"><span class="command">lemma</span></span> recursion<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> domain_boolean_quantale<span class="main">)</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> d <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="bound">x</span><span class="main">]</span> d <span class="free">q</span> <span class="main">⟹</span> d <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">f</span> <span class="bound">x</span><span class="main">]</span> d <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span>  d <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span>lfp <span class="free">f</span><span class="main">]</span> d <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> lfp_ordinal_induct <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ad.addual.ardual.fbox_demodalisation3 Sup_distr Sup_distl <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Sup_mono<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We have already tested this rule in the context of test quantales~\cite{ArmstrongGS15}, which is based
on a formalisation of quantales that is currently not in the AFP. The two theories will be merged as
soon as the quantale is available in the AFP.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>