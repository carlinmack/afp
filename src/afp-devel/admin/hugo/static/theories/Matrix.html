<div id="Utility">
<div class="head">
<h1>Theory Utility</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Executable Matrix Operations on Matrices of Arbitrary Dimensions
    Author:      Christian Sternagel &lt;christian.sternagel@uibk.ac.at&gt;
                 René Thiemann       &lt;rene.thiemann@uibk.ac.at&gt;
    Maintainer:  Christian Sternagel and René Thiemann
    License:     LGPL
*)</span>

<span class="comment1">(*
Copyright 2010 Christian Sternagel, René Thiemann

This file is part of IsaFoR/CeTA.

IsaFoR/CeTA is free software: you can redistribute it and/or modify it under the
terms of the GNU Lesser General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.

IsaFoR/CeTA is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along
with IsaFoR/CeTA. If not, see &lt;http://www.gnu.org/licenses/&gt;.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Utility Functions and Lemmas›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Utility
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ballI2<span class="main">[</span><span class="operator">Pure.intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> infinite_imp_elem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> finite <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> infinite_imp_many_elems<span class="main">:</span>
  <span class="quoted"><span class="quoted">"infinite <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> distinct <span class="bound">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> infinite_imp_elem<span class="main">[</span><span class="operator">OF</span> Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span> <span class="main"><span class="main"><span class="main">#</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">xs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> inf_pigeonhole_principle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">k'</span></span><span class="main">≥</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k'</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> nfin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> finite <span class="main">(</span>UNIV <span class="main">::</span> nat set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> pigeonhole_infinite_rel<span class="main">[</span><span class="operator">OF</span> nfin fin<span class="main">]</span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nfin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> finite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> nfin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> finite <span class="main">(</span><span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="skolem">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> infinite_imp_elem<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≥</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k'</span></span> <span class="main">≥</span> <span class="skolem">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k'</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_upt_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_upt_add<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> map <span class="free">f</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span> <span class="main">@</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="skolem">f</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="skolem">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> map <span class="skolem">f</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="free">m</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> map_upt_Suc <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Suc map_upt_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> map_upt_split<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span> <span class="main">=</span> map <span class="free">f</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">i</span><span class="main">]</span> <span class="main">@</span> <span class="free">f</span> <span class="free">i</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="main">0</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="main">0</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">unfolding</span></span> map_upt_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> all_Suc_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ex_Suc_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> all_Suc_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sorted_list_subset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> linorder list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sorted_list_subset</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free">sorted_list_subset</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free">sorted_list_subset</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span>
     <span class="keyword1">else</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sorted_list_subset</span> <span class="main">[]</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> None"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sorted_list_subset</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> sorted_list_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">as</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sorted_list_subset <span class="free">as</span> <span class="free">bs</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>set <span class="free">as</span> <span class="main">⊆</span> set <span class="free">bs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sorted_list_subset.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">as</span> <span class="skolem">b</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> sas<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="skolem">as</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a'</span><span class="main">.</span> <span class="bound">a'</span> <span class="main">∈</span> set <span class="skolem">as</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="main">≤</span> <span class="bound">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> sbs<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="skolem">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">b'</span><span class="main">.</span> <span class="bound">b'</span> <span class="main">∈</span> set <span class="skolem">bs</span> <span class="main">⟹</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="bound">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this sas 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> oFalse <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="skolem">b</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> set <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False True 1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> sbs<span class="main">]</span> False True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> oFalse <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">with</span></span> oFalse False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zip_nth_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">⟹</span> zip <span class="free">xs</span> <span class="free">ys</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">ys</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">yys</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">yys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">yys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ys 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> upt_Suc <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_upt_Suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> len<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nth_map_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> map <span class="free">g</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> sum_list <span class="free">xs</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> foldr_foldr_concat<span class="main">:</span> <span class="quoted"><span class="quoted">"foldr <span class="main">(</span>foldr <span class="free">f</span><span class="main">)</span> <span class="free">m</span> <span class="free">a</span> <span class="main">=</span> foldr <span class="free">f</span> <span class="main">(</span>concat <span class="free">m</span><span class="main">)</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">m</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> concat.simps foldr_Cons o_def Cons
    <span class="keyword1"><span class="command">unfolding</span></span> foldr_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_double_concat<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="free">as</span> <span class="free">bs</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span> sum_list <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> 
        sum_list <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="free">g</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">←</span><span class="free">as</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">b</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">b</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="main">+</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="free">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> list.map concat.simps sum_list_append
    <span class="keyword1"><span class="command">unfolding</span></span> Cons
    <span class="keyword1"><span class="command">unfolding</span></span> id 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">max_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">max_list</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">max_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">max_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_list<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> max_list <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> max_list_mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> max_list <span class="free">xs</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> max_list <span class="skolem">xs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"max_list <span class="skolem">xs</span> <span class="main">&gt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> max <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="skolem">x</span> <span class="main">(</span>max_list <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> max_list <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> nil<span class="main">]</span> max <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> max_list_set<span class="main">:</span> <span class="quoted"><span class="quoted">"max_list <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">note</span></span> p <span class="main">=</span> max_list_mem<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> max_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id if_False
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> p<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> p<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> max_list<span class="main">[</span><span class="operator">OF</span> mem<span class="main">]</span> le<span class="main">[</span><span class="operator">OF</span> max_list_mem<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">]</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> max_list <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1"><span class="command">lemma</span></span> max_list_eq_set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> set <span class="free">ys</span> <span class="main">⟹</span> max_list <span class="free">xs</span> <span class="main">=</span> max_list <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> max_list_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> all_less_two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Induction over a finite set of natural numbers.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> bound_nat_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">l</span><span class="main">..</span><span class="free">u</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span><span class="free">P</span> <span class="bound">n</span><span class="main">;</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">l</span><span class="main">..&lt;</span><span class="free">u</span><span class="main">}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> <span class="free">l</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Ordered_Semiring">
<div class="head">
<h1>Theory Ordered_Semiring</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Executable Matrix Operations on Matrices of Arbitrary Dimensions
    Author:      Christian Sternagel &lt;christian.sternagel@uibk.ac.at&gt;
                 René Thiemann       &lt;rene.thiemann@uibk.ac.at&gt;
    Maintainer:  Christian Sternagel and René Thiemann
    License:     LGPL
*)</span>

<span class="comment1">(*
Copyright 2013 Christian Sternagel, René Thiemann

This file is part of IsaFoR/CeTA.

IsaFoR/CeTA is free software: you can redistribute it and/or modify it under the
terms of the GNU Lesser General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.

IsaFoR/CeTA is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along
with IsaFoR/CeTA. If not, see &lt;http://www.gnu.org/licenses/&gt;.
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Ordered_Semiring 
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../../HOL/HOL-Algebra/Ring.html">HOL-Algebra.Ring</a>"</span>
  <span class="quoted">"<a href="../Abstract-Rewriting/SN_Orders.html">Abstract-Rewriting.SN_Orders</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> ordered_semiring <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ring"</span></span> <span class="main">+</span>
  geq <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≽</span>ı"</span> 50<span class="main">)</span>
  gt <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≻</span>ı"</span> 50<span class="main">)</span>
  max <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Max</span>ı"</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> ordered_semiring_record_simps <span class="main">=</span> ring_record_simps ordered_semiring.simps

<span class="keyword1"><span class="command">locale</span></span> ordered_semiring <span class="main">=</span> semiring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> compat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">≽</span> <span class="main">(</span><span class="free">t</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">;</span> <span class="free">t</span> <span class="main">≻</span> <span class="free">u</span><span class="main">;</span> <span class="free">s</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≻</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> compat2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">≻</span> <span class="main">(</span><span class="free">t</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">;</span> <span class="free">t</span> <span class="main">≽</span> <span class="free">u</span><span class="main">;</span> <span class="free">s</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≻</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> plus_left_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">≽</span> <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊕</span> <span class="free">z</span> <span class="main">≽</span> <span class="free">y</span> <span class="main">⊕</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> times_left_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">z</span> <span class="main">≽</span> <span class="main">𝟬</span><span class="main">;</span> <span class="free">x</span> <span class="main">≽</span> <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊗</span> <span class="free">z</span> <span class="main">≽</span> <span class="free">y</span> <span class="main">⊗</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> times_right_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">≽</span> <span class="main">𝟬</span><span class="main">;</span> <span class="free">y</span> <span class="main">≽</span> <span class="free">z</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span> <span class="main">≽</span> <span class="free">x</span> <span class="main">⊗</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> geq_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≽</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> geq_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">≽</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">≽</span> <span class="free">z</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≽</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gt_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">≻</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">≻</span> <span class="free">z</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≻</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gt_imp_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≻</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≽</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> max_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="keyword1">Max</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">Max</span> <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> max_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="keyword1">Max</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≽</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> max_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≽</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">Max</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> max_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="keyword1">Max</span> <span class="free">z</span> <span class="free">x</span> <span class="main">≽</span> <span class="keyword1">Max</span> <span class="free">z</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf_max<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="keyword1">Max</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> one_geq_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">≽</span> <span class="main">𝟬</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> max_ge_right<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Max</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≽</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> max_comm<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> max_ge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> y x<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_max0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="keyword1">Max</span> <span class="main">𝟬</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_max<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">𝟬</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> max0_id_pos<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽</span> <span class="main">𝟬</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Max</span> <span class="main">𝟬</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_comm<span class="main">[</span><span class="operator">OF</span> zero_closed wf<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf zero_closed x<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> gt geq max

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A connection between class based semirings and set based semirings›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">class_semiring</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> itself <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>plus<span class="main">,</span>times<span class="main">,</span>one<span class="main">,</span>zero<span class="main">}</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>ring_scheme"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">class_semiring</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">⦇</span> carrier <span class="main">=</span> UNIV<span class="main">,</span> mult <span class="main">=</span> <span class="main">(*)</span><span class="main">,</span> one <span class="main">=</span> <span class="main">1</span><span class="main">,</span> zero <span class="main">=</span> <span class="main">0</span><span class="main">,</span> add <span class="main">=</span> <span class="main">(+)</span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> class_semiring<span class="main">:</span> <span class="quoted"><span class="quoted">"semiring <span class="main">(</span>class_semiring <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ordered_semiring_1<span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> class_semiring_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">class_ordered_semiring</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> itself <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ordered_semiring_1 <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> ordered_semiring_scheme"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">class_ordered_semiring</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">gt</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> class_semiring <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⦇</span>
    ordered_semiring.geq <span class="main">=</span> <span class="main">(≥)</span><span class="main">,</span>
    gt <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">gt</span></span></span><span class="main">,</span>
    max <span class="main">=</span> max<span class="main">,</span>
    <span class="main">…</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> class_ordered_semiring<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"order_pair <span class="main">(</span><span class="free">gt</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ordered_semiring_1 <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">)</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordered_semiring 
    <span class="main">(</span>class_ordered_semiring <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">gt</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"ordered_semiring <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> order_pair <span class="quoted"><span class="free">gt</span></span> <span class="quoted"><span class="free">d</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> semiring <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> class_ordered_semiring_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> class_semiring<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> class_ordered_semiring_def class_semiring_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span>
    <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> compat compat2 gt_imp_ge ge_trans max_comm max_id max_mono ge_refl one_ge_zero
     times_left_mono times_right_mono plus_left_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> one_mono_ordered_semiring_1<span class="main">)</span> class_ordered_semiring<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"ordered_semiring 
    <span class="main">(</span>class_ordered_semiring <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">(≻)</span></span> <span class="free">b</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> class_ordered_semiring<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">default</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> both_mono_ordered_semiring_1<span class="main">)</span> class_ordered_semiring<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"ordered_semiring 
    <span class="main">(</span>class_ordered_semiring <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">(≻)</span></span> <span class="free">b</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> class_ordered_semiring<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">default</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Matrix_Legacy">
<div class="head">
<h1>Theory Matrix_Legacy</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Executable Matrix Operations on Matrices of Arbitrary Dimensions
    Author:      Christian Sternagel &lt;christian.sternagel@uibk.ac.at&gt;
                 René Thiemann       &lt;rene.thiemann@uibk.ac.at&gt;
    Maintainer:  Christian Sternagel and René Thiemann
    License:     LGPL
*)</span>

<span class="comment1">(*
Copyright 2010 Christian Sternagel, René Thiemann

This file is part of IsaFoR/CeTA.

IsaFoR/CeTA is free software: you can redistribute it and/or modify it under the
terms of the GNU Lesser General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.

IsaFoR/CeTA is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along
with IsaFoR/CeTA. If not, see &lt;http://www.gnu.org/licenses/&gt;.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Basic Operations on Matrices›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Matrix_Legacy
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Utility.html">Utility</a>
  <a href="Ordered_Semiring.html">Ordered_Semiring</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory is marked as legacy, since there is a better
  implementation of matrices available in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹../Jordan_Normal_Form/Matrix.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  That formalization is more abstract, more complete in terms of operations,
  and it still provides an efficient implementation.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This theory provides the operations of matrix addition, multiplication,
  and transposition as executable functions.
  Most properties are proven via pointwise equality of matrices.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹types and well-formedness of vectors / matrices›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> vec <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> mat <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec list"</span></span> <span class="comment1">(* list of column-vectors *)</span>


<span class="comment1">(* vector of given length *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'x</span> vec <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* matrix of given number of rows and columns *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">mat</span> <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="free"><span class="bound"><span class="entity">nc</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">nc</span></span></span> <span class="main">∧</span> Ball <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>vec <span class="free"><span class="bound"><span class="entity">nr</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹definitions / algorithms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹note that these algorithms are generic in all basic definitions / operations
like 0 (ze) 1 (on) addition (pl) multiplication (ti) and in the dimension(s) of the matrix/vector.
Hence, many of these algorithms require these definitions/operations/sizes as arguments.
All indices start from 0.
›</span></span>

<span class="comment1">(* the 0 vector *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec0I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">vec0I</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> replicate <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span>"</span></span>

<span class="comment1">(* the 0 matrix *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat0I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mat0I</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="free"><span class="bound"><span class="entity">nc</span></span></span> <span class="main">=</span> replicate <span class="free"><span class="bound"><span class="entity">nc</span></span></span> <span class="main">(</span>vec0I <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">nr</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* the i-th unit vector of size n *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec1I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec1I</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">on</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> replicate <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">on</span></span></span> <span class="main">#</span> replicate <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span>"</span></span>

<span class="comment1">(* the 1 matrix *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat1I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat1I</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">on</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> map <span class="main">(</span>vec1I <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">on</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span>"</span></span>


<span class="comment1">(* vector addition *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec_plusI</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">vec_plusI</span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">xy</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="main">(</span>fst <span class="bound">xy</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">xy</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* matrix addition *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_plusI</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_plusI</span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">uv</span><span class="main">.</span> vec_plusI <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="main">(</span>fst <span class="bound">uv</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">uv</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* scalar product *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">scalar_prodI</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">scalar_prodI</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">ti</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> foldr <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ti</span></span></span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>zip <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span>"</span></span>

<span class="comment1">(* the m-th row of a matrix *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">row</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">row</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="comment1">(* the m-th column of a matrix *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">col</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">col</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="comment1">(* transposition of a matrix (number of rows of matrix has to be given since otherwise one
   could not compute transpose [] which might be [] or [[]] or [[], []], or ...) *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">transpose</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">transpose</span> <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="main">[]</span> <span class="main">=</span> replicate <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="main">[]</span>"</span></span>
     <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">transpose</span> <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">vi</span><span class="main">,</span><span class="bound">mi</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">vi</span> <span class="main">#</span> <span class="bound">mi</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="free">transpose</span> <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* matrix-vector multiplication, assumes the transposed matrix is given *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matT_vec_multI</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">matT_vec_multI</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">ti</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> scalar_prodI <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">ti</span></span></span> <span class="bound">w</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="comment1">(* matrix-matrix multiplication, number of rows of left matrix has to be given (as transpose is used) *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_multI</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_multI</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">ti</span></span></span> <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="main">≡</span> map <span class="main">(</span>matT_vec_multI <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">ti</span></span></span> <span class="main">(</span>transpose <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span>"</span></span>

<span class="comment1">(* power of a square matrix *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mat_powI</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_powI</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">on</span></span></span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">ti</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">0</span> <span class="main">=</span> mat1I <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">on</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
      <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mat_powI</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">on</span></span></span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">ti</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> mat_multI <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">ti</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">mat_powI</span> <span class="free"><span class="bound"><span class="entity">ze</span></span></span> <span class="free"><span class="bound"><span class="entity">on</span></span></span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">ti</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sub_vec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sub_vec</span> <span class="main">=</span> take"</span></span>

<span class="comment1">(* taking only the upper left sub matrix *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sub_mat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sub_mat</span> <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="free"><span class="bound"><span class="entity">nc</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> map <span class="main">(</span>sub_vec <span class="free"><span class="bound"><span class="entity">nr</span></span></span><span class="main">)</span> <span class="main">(</span>take <span class="free"><span class="bound"><span class="entity">nc</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>


<span class="comment1">(* map on vectors *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec_map</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec_map</span> <span class="main">=</span> map"</span></span>

<span class="comment1">(* map on matrices *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_map</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_map</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> map <span class="main">(</span>vec_map <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹algorithms preserve dimensions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vec0<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="main">(</span>vec0I <span class="free">ze</span> <span class="free">nr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_def vec0I_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> replicate_prop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="main">(</span>replicate <span class="free">n</span> <span class="free">x</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> mat0<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="main">(</span>mat0I <span class="free">ze</span> <span class="free">nr</span> <span class="free">nc</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mat_def mat0I_def
<span class="keyword1"><span class="command">using</span></span> replicate_prop<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span>"</span></span> <span class="quoted"><span class="quoted">"vec0I <span class="free">ze</span> <span class="free">nr</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">nc</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> vec1<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="main">(</span>vec1I <span class="free">ze</span> <span class="free">on</span> <span class="free">nr</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_def vec1I_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mat1<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nr</span> <span class="main">(</span>mat1I <span class="free">ze</span> <span class="free">on</span> <span class="free">nr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mat_def mat1I_def <span class="keyword1"><span class="command">using</span></span> vec1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vec_plus<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>vec <span class="free">nr</span> <span class="free">u</span><span class="main">;</span> vec <span class="free">nr</span> <span class="free">v</span><span class="main">⟧</span> <span class="main">⟹</span> vec <span class="free">nr</span> <span class="main">(</span>vec_plusI <span class="free">pl</span> <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_plusI_def vec_def
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_plus<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="main">(</span>mat_plusI <span class="free">pl</span> <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> mat_def mat_plusI_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">nc</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m1</span></span> <span class="quoted"><span class="free">m2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nn</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m1</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v1</span> <span class="skolem">mm1</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> oCons <span class="main">=</span> this
    <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">mm1</span> <span class="main">=</span> <span class="skolem">nn</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m2</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v2</span> <span class="skolem">mm2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">mm2</span> <span class="main">=</span> <span class="skolem">nn</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons oCons<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vec_plus<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons oCons Suc<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cons oCons Suc l1 l2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vec_map<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">u</span> <span class="main">⟹</span> vec <span class="free">nr</span> <span class="main">(</span>vec_map <span class="free">f</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_map_def vec_def
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_map<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span> <span class="main">⟹</span> mat <span class="free">nr</span> <span class="free">nc</span> <span class="main">(</span>mat_map <span class="free">f</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> vec_map
<span class="keyword1"><span class="command">unfolding</span></span> mat_map_def mat_def
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vec_fold</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">vec_fold</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> foldr <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mat_fold</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mat_fold</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> foldr <span class="main">(</span>vec_fold <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> concat_mat<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span> <span class="main">⟹</span>
  concat <span class="free">m</span> <span class="main">=</span> <span class="main">[</span> <span class="free">m</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">!</span> <span class="bound">j</span><span class="main">.</span> i <span class="main">←</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">nc</span><span class="main">]</span><span class="main">,</span> j <span class="main">←</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">nr</span><span class="main">]</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">nc</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">m</span> <span class="skolem">snc</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nc</span></span> <span class="keyword2"><span class="keyword">where</span></span> snc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">snc</span> <span class="main">=</span> Suc <span class="skolem">nc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mat<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="skolem">nc</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">snc</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> v <span class="keyword1"><span class="command">have</span></span> nr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nr</span> <span class="main">=</span> length <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">nr</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nr map_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mat<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> snc
    <span class="keyword1"><span class="command">unfolding</span></span> map_upt_Suc
    <span class="keyword1"><span class="command">unfolding</span></span> nth.simps nat.simps concat.simps
    <span class="keyword1"><span class="command">unfolding</span></span> IH v <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> row<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">nc</span> <span class="main">(</span>row <span class="free">m</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> vec_def row_def mat_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> col<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="main">(</span>col <span class="free">m</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> vec_def col_def mat_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> transpose<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nc</span> <span class="free">nr</span> <span class="main">(</span>transpose <span class="free">nr</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">nc</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹mat <span class="free">nr</span> <span class="skolem">nc</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">m</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ncc</span></span> <span class="keyword2"><span class="keyword">where</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nc</span> <span class="main">=</span> Suc <span class="skolem">ncc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">nc</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> wfRec<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="skolem">ncc</span> <span class="free">nr</span> <span class="main">(</span>transpose <span class="free">nr</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="free">nr</span> <span class="main">(</span>length <span class="main">(</span>transpose <span class="free">nr</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wfRec <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">(</span>transpose <span class="free">nr</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>vec <span class="skolem">nc</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="skolem">v</span> <span class="main">(</span>transpose <span class="free">nr</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> mem <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span>transpose <span class="free">nr</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_zip_rightD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> wfRec <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">ncc</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">using</span></span> vec_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ncc</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>case_prod <span class="main">(#)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">ncc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def nc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹mat <span class="free">nr</span> <span class="skolem">nc</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">m</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> wfV<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">v</span> <span class="main">=</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wfV wfRec mat_def vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_def vec_def set_replicate_conv_if<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> matT_vec_multI<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">nc</span> <span class="main">(</span>matT_vec_multI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="free">m</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matT_vec_multI_def
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> mat_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_mult<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">n</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="main">(</span>mat_multI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="free">nr</span> <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> mat_def mat_multI_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> matT_vec_multI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> transpose<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> wf1<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_pow<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">n</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">n</span> <span class="main">(</span>mat_powI <span class="free">ze</span> <span class="free">on</span> <span class="free">pl</span> <span class="free">ti</span> <span class="free">n</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_powI.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_powI.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sub_vec<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sd</span> <span class="main">≤</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">sd</span> <span class="main">(</span>sub_vec <span class="free">sd</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vec_def sub_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sub_mat<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sr</span> <span class="main">≤</span> <span class="free">nr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="main">≤</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">sr</span> <span class="free">sc</span> <span class="main">(</span>sub_mat <span class="free">sr</span> <span class="free">sc</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms in_set_takeD<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">sc</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span> sub_vec<span class="main">[</span><span class="operator">OF</span> _ sr<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def sub_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹properties of algorithms which do not depend on properties of type of matrix›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat0_index<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat0I <span class="free">ze</span> <span class="free">nr</span> <span class="free">nc</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="free">ze</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mat0I_def vec0I_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mat0_row<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>mat0I <span class="free">ze</span> <span class="free">nr</span> <span class="free">nc</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> vec0I <span class="free">ze</span> <span class="free">nc</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> row_def mat0I_def vec0I_def
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> mat0_col<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>mat0I <span class="free">ze</span> <span class="free">nr</span> <span class="free">nc</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> vec0I <span class="free">ze</span> <span class="free">nr</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mat0I_def col_def
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vec1_index<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec1I <span class="free">ze</span> <span class="free">on</span> <span class="free">n</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">on</span> <span class="keyword1">else</span> <span class="free">ze</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> vec1I_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"replicate <span class="free">i</span> <span class="free">ze</span> <span class="main">@</span> <span class="free">on</span> <span class="main">#</span> replicate <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="free">ze</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="var">?l</span> <span class="main">&gt;</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> len2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>replicate <span class="free">i</span> <span class="free">ze</span> <span class="main">@</span> <span class="free">on</span> <span class="main">#</span> <span class="main">[]</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">≠</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&gt;</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="free">j</span> <span class="main">=</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> j <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> col_transpose_is_row<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>transpose <span class="free">nr</span> <span class="free">m</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="free">m</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> wf
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">nc</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹mat <span class="free">nr</span> <span class="skolem">nc</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">m</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ncc</span></span> <span class="keyword2"><span class="keyword">where</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nc</span> <span class="main">=</span> Suc <span class="skolem">ncc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="skolem">ncc</span> <span class="skolem">m</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">nc</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹mat <span class="free">nr</span> <span class="skolem">nc</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">m</span><span class="main">)</span>›</span></span> nc <span class="keyword1"><span class="command">have</span></span> lengths<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="skolem">m</span><span class="main">.</span> length <span class="bound">w</span> <span class="main">=</span> <span class="free">nr</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">v</span> <span class="main">=</span> <span class="free">nr</span> <span class="main">∧</span> length <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">ncc</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> wf Cons <span class="keyword1"><span class="command">have</span></span> colRec<span class="main">:</span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>transpose <span class="free">nr</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="skolem">m</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> simpme<span class="main">:</span> <span class="quoted"><span class="quoted">"transpose <span class="free">nr</span> <span class="skolem">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> row <span class="skolem">m</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> wf <span class="keyword1"><span class="command">have</span></span> trans<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="skolem">ncc</span> <span class="free">nr</span> <span class="main">(</span>transpose <span class="free">nr</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transpose<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> lengths2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="main">(</span>transpose <span class="free">nr</span> <span class="skolem">m</span><span class="main">)</span><span class="main">.</span> length <span class="bound">w</span> <span class="main">=</span> <span class="skolem">ncc</span><span class="main">)</span> <span class="main">∧</span> length <span class="main">(</span>transpose <span class="free">nr</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>col <span class="main">(</span>transpose <span class="free">nr</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">ncc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_def lengths2 lengths i<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>transpose <span class="free">nr</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> row <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> row_def col_def i lengths lengths2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> row_def col_def i lengths lengths2 simpme<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> simpme <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_def row_def lengths lengths2 i<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> simpme<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_def row_def mat_def i<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_col_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m1</span> <span class="main">=</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">nc</span><span class="main">.</span> col <span class="free">m1</span> <span class="bound">i</span> <span class="main">=</span> col <span class="free">m2</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="free">m1</span> <span class="main">=</span> length <span class="free">m2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf1 wf2 <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">m1</span> <span class="main">⟹</span> <span class="free">m1</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">!</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf1 <span class="keyword1"><span class="command">unfolding</span></span> col_def mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_col_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">nc</span> <span class="main">⟹</span> col <span class="free">m1</span> <span class="bound">i</span> <span class="main">=</span> col <span class="free">m2</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">=</span> <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_col_eq<span class="main">[</span><span class="operator">OF</span> wf1 wf2<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m1</span> <span class="main">=</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">nc</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="free">nr</span><span class="main">.</span> <span class="free">m1</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_col_eqI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> col_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">m1</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>  <span class="main">=</span> length <span class="main">(</span><span class="free">m2</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf1 wf2 i <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span>›</span></span> i <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">m1</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">m1</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="bound">j</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> wf1 wf2 <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">nc</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">nr</span> <span class="main">⟹</span> <span class="free">m1</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">!</span> <span class="bound">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">=</span> <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_eq<span class="main">[</span><span class="operator">OF</span> wf1 wf2<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vec_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">n</span> <span class="free">v1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">n</span> <span class="free">v2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span> <span class="main">=</span> <span class="free">v2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="free">v1</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">v2</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> wf1 wf2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v1</span> <span class="main">=</span> length <span class="free">v2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span>›</span></span> wf1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">v1</span> <span class="main">⟹</span> <span class="free">v1</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">v2</span> <span class="main">!</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vec_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">n</span> <span class="free">v1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">n</span> <span class="free">v2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">v1</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">v2</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v1</span> <span class="main">=</span> <span class="free">v2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_eq<span class="main">[</span><span class="operator">OF</span> wf1 wf2<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> row_col<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="free">m</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> col <span class="free">m</span> <span class="free">j</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> mat_def row_def col_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> col_index<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="free">m</span> <span class="free">i</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">nr</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> m<span class="main">[</span><span class="operator">unfolded</span> mat_def<span class="main">]</span> i
  <span class="keyword1"><span class="command">have</span></span> nr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nr</span> <span class="main">=</span> length <span class="main">(</span><span class="free">m</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> nr col_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_nth<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> row_index<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="free">m</span> <span class="free">i</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="free">m</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">nc</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> rc <span class="main">=</span> row_col<span class="main">[</span><span class="operator">OF</span> m i<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> row<span class="main">[</span><span class="operator">OF</span> m i<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">nc</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> map_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"row <span class="free">m</span> <span class="free">i</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="free">m</span> <span class="free">i</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> row <span class="free">m</span> <span class="free">i</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">nc</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="free">m</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">nc</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rc<span class="main">[</span><span class="operator">unfolded</span> col_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> mat_row_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m1</span> <span class="main">=</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">nr</span><span class="main">.</span> row <span class="free">m1</span> <span class="bound">i</span> <span class="main">=</span> row <span class="free">m2</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="free">m1</span> <span class="main">=</span> length <span class="free">m2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf1 wf2 <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">m1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">m1</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="free">m2</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf1 wf2 i <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">m1</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> i j wf1 <span class="keyword1"><span class="command">have</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span>›</span></span> j1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"col <span class="free">m1</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> col <span class="free">m2</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> row_col<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 j1 i1<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> row_col<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf2 j1 i1<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> col_def <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_row_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">nr</span> <span class="main">⟹</span> row <span class="free">m1</span> <span class="bound">i</span> <span class="main">=</span> row <span class="free">m2</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">=</span> <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_row_eq<span class="main">[</span><span class="operator">OF</span> wf1 wf2<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> row_transpose_is_col<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>   <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>transpose <span class="free">nr</span> <span class="free">m</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> col <span class="free">m</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="main">(</span>transpose <span class="free">nr</span> <span class="free">m</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>col <span class="free">m</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> transpose<span class="main">[</span><span class="operator">OF</span> wf<span class="main">]</span>  wf i  <span class="keyword1"><span class="command">unfolding</span></span> row_def col_def mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> len<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>row <span class="main">(</span>transpose <span class="free">nr</span> <span class="free">m</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> transpose<span class="main">[</span><span class="operator">OF</span> wf<span class="main">]</span> wf i <span class="keyword1"><span class="command">unfolding</span></span> row_def col_def mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>transpose <span class="free">nr</span> <span class="free">m</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> col <span class="free">m</span> <span class="free">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> row_col<span class="main"><span class="main">[</span></span><span class="operator">OF</span> transpose<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> wf<span class="main"><span class="main"><span class="main">]</span></span></span> i j<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> col_transpose_is_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf j<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> row_col<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf j i<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> matT_vec_mult_to_scalar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matT_vec_multI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="free">m</span> <span class="free">v</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> scalar_prodI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="main">(</span>col <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matT_vec_multI_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> mat_def col_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_vec_mult_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wfV<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nc</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matT_vec_multI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="main">(</span>transpose <span class="free">nr</span> <span class="free">m</span><span class="main">)</span> <span class="free">v</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> scalar_prodI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="main">(</span>row <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>matT_vec_mult_to_scalar<span class="main"><span class="main">[</span></span><span class="operator">OF</span> transpose<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> wf<span class="main"><span class="main"><span class="main">]</span></span></span> wfV i<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
  <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> col_transpose_is_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf i<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_mult_index<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">n</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_multI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="free">nr</span> <span class="free">m1</span> <span class="free">m2</span> <span class="main">!</span> <span class="free">j</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> scalar_prodI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="main">(</span>row <span class="free">m1</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>col <span class="free">m2</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> jlen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">m2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf2 j <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> wfj<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">n</span> <span class="main">(</span><span class="free">m2</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jlen j wf2 <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mat_multI_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> jlen<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mat_vec_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wfj i<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> col_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> col_mat_mult_index <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">n</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>mat_multI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="free">nr</span> <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> scalar_prodI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="main">(</span>row <span class="free">m1</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>col <span class="free">m2</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">nr</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"col <span class="var">?l</span> <span class="free">j</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> wf12<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>col <span class="var">?l</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> length <span class="var">?r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nr<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>col <span class="var">?l</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf1 wf2 wf12 j <span class="keyword1"><span class="command">unfolding</span></span> mat_def col_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> len<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> j nr<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> col_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>
    mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf2 _ j<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> row_mat_mult_index <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">n</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>mat_multI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="free">nr</span> <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> scalar_prodI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="main">(</span>row <span class="free">m1</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>col <span class="free">m2</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">nc</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"row <span class="var">?l</span> <span class="free">i</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> wf12<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> lenL<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="var">?l</span> <span class="main">=</span> <span class="free">nc</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="var">?l</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> length <span class="var">?r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="var">?l</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">nc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf1 wf2 wf12 i <span class="keyword1"><span class="command">unfolding</span></span> mat_def row_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> len<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i nc<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> row_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lenL<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>
    mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf2 i<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> row_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> scalar_prod_cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"scalar_prodI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">as</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">=</span> <span class="free">pl</span> <span class="main">(</span><span class="free">ti</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>scalar_prodI <span class="free">ze</span> <span class="free">pl</span> <span class="free">ti</span> <span class="free">as</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> scalar_prodI_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> vec_plus_index<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">v1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">v2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_plusI <span class="free">pl</span> <span class="free">v1</span> <span class="free">v2</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">pl</span> <span class="main">(</span><span class="free">v1</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>  <span class="main">(</span><span class="free">v2</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> wf1 wf2 i
<span class="keyword1"><span class="command">unfolding</span></span> vec_def vec_plusI_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">v1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">v2</span></span> <span class="quoted"><span class="free">nr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">v11</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">v22</span></span> <span class="keyword2"><span class="keyword">where</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">v22</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> v2 Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nrr</span></span> <span class="keyword2"><span class="keyword">where</span></span> nr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nr</span> <span class="main">=</span> Suc <span class="skolem">nrr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> v2 nr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_map_index<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_map <span class="free">f</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> wf i <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> wf j <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">m</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat_map <span class="free">f</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> map <span class="main">(</span>map <span class="free">f</span><span class="main">)</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_map_def vec_map_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> map <span class="free">f</span> <span class="main">(</span><span class="free">m</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> mat_plus_index<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_plusI <span class="free">pl</span> <span class="free">m1</span> <span class="free">m2</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="free">pl</span> <span class="main">(</span><span class="free">m1</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">m2</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> wf1 wf2 i
<span class="keyword1"><span class="command">unfolding</span></span> mat_plusI_def mat_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">m1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m2</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">nc</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v1</span> <span class="skolem">m11</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">m22</span></span> <span class="keyword2"><span class="keyword">where</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">v2</span> <span class="main">#</span> <span class="skolem">m22</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> m2 Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ncc</span></span> <span class="keyword2"><span class="keyword">where</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nc</span> <span class="main">=</span> Suc <span class="skolem">ncc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> vec_plus_index<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> nr <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">nr</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cons j m2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">ii</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> m2 nc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> col_mat_plus<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>mat_plusI <span class="free">pl</span> <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> vec_plusI <span class="free">pl</span> <span class="main">(</span>col <span class="free">m1</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>col <span class="free">m2</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> mat_plusI_def col_def mat_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m2</span></span> <span class="quoted"><span class="free">nc</span></span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">m1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">m22</span></span> <span class="keyword2"><span class="keyword">where</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">v2</span> <span class="main">#</span> <span class="skolem">m22</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> m2 Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ncc</span></span> <span class="keyword2"><span class="keyword">where</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nc</span> <span class="main">=</span> Suc <span class="skolem">ncc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">ii</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> m2 nc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> transpose_index<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"transpose <span class="free">nr</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="free">m</span> <span class="main">!</span> <span class="free">j</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transpose <span class="free">nr</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> col <span class="main">(</span>transpose <span class="free">nr</span> <span class="free">m</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> row <span class="free">m</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> col_transpose_is_row<span class="main">[</span><span class="operator">OF</span> wf i<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">m</span> <span class="main">!</span> <span class="free">j</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_def <span class="keyword1"><span class="command">using</span></span> wf j <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> transpose_mat_plus<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"transpose <span class="free">nr</span> <span class="main">(</span>mat_plusI <span class="free">pl</span> <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> mat_plusI <span class="free">pl</span> <span class="main">(</span>transpose <span class="free">nr</span> <span class="free">m1</span><span class="main">)</span> <span class="main">(</span>transpose <span class="free">nr</span> <span class="free">m2</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> transpose_index<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> mat_plus_index<span class="main">[</span><span class="operator">OF</span> _ _ j i<span class="main">]</span> mat_plus_index<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> row_mat_plus<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>mat_plusI <span class="free">pl</span> <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> vec_plusI <span class="free">pl</span> <span class="main">(</span>row <span class="free">m1</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>row <span class="free">m2</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span>
    <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> col_transpose_is_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mat_plus<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> wf1 wf2<span class="main"><span class="main"><span class="main">]</span></span></span> i<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> transpose_mat_plus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> col_mat_plus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> transpose<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> wf1<span class="main"><span class="main"><span class="main">]</span></span></span> transpose<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> wf2<span class="main"><span class="main"><span class="main">]</span></span></span> i<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> col_transpose_is_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 i<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> col_transpose_is_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf2 i<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> col_mat1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>mat1I <span class="free">ze</span> <span class="free">on</span> <span class="free">nr</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> vec1I <span class="free">ze</span> <span class="free">on</span> <span class="free">nr</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mat1I_def col_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> mat1_index<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat1I <span class="free">ze</span> <span class="free">on</span> <span class="free">n</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">on</span> <span class="keyword1">else</span> <span class="free">ze</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_mat1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> col_def<span class="main"><span class="main">]</span></span> vec1_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> j<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> transpose_mat1<span class="main">:</span> <span class="quoted"><span class="quoted">"transpose <span class="free">nr</span> <span class="main">(</span>mat1I <span class="free">ze</span> <span class="free">on</span> <span class="free">nr</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mat1I <span class="free">ze</span> <span class="free">on</span> <span class="free">nr</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> transpose_index<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> mat1_index<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> mat1_index<span class="main">[</span><span class="operator">OF</span> j i<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> row_mat1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>mat1I <span class="free">ze</span> <span class="free">on</span> <span class="free">nr</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> vec1I <span class="free">ze</span> <span class="free">on</span> <span class="free">nr</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> col_transpose_is_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mat1 i<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
  <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> transpose_mat1<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> col_mat1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sub_mat_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sr</span> <span class="main">≤</span> <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="main">≤</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">sr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">sc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sub_mat <span class="free">sr</span> <span class="free">sc</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> im<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> jm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">m</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sub_mat <span class="free">sr</span> <span class="free">sc</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> map <span class="main">(</span>take <span class="free">sr</span><span class="main">)</span> <span class="main">(</span>take <span class="free">sc</span> <span class="free">m</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sub_mat_def sub_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> take <span class="free">sr</span> <span class="main">(</span><span class="free">m</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i im <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j jm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹lemmas requiring properties of plus, times, ...›</span></span>

<span class="keyword1"><span class="command">context</span></span> plus
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">vec_plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec_plus</span> <span class="main">≡</span> vec_plusI plus"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mat_plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_plus</span> <span class="main">≡</span> mat_plusI plus"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> semigroup_add
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> vec_plus_assoc<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> vec<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">w</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_plus <span class="free">u</span> <span class="main">(</span>vec_plus <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> vec_plus <span class="main">(</span>vec_plus <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> vec_plus_index<span class="main">[</span><span class="operator">OF</span> _ _ i<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> vec
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_plus <span class="free">u</span> <span class="main">(</span>vec_plus <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> vec_plus <span class="main">(</span>vec_plus <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">w</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> vec<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_plus_assoc<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_plus <span class="free">m1</span> <span class="main">(</span>mat_plus <span class="free">m2</span> <span class="free">m3</span><span class="main">)</span> <span class="main">=</span> mat_plus <span class="main">(</span>mat_plus <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">m3</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> mat_plus_index<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wf<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> ab_semigroup_add
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> vec_plus_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_plus <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> vec_plus <span class="free">y</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_plusI_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> mat_plus_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"mat_plus <span class="free">m1</span> <span class="free">m2</span> <span class="main">=</span> mat_plus <span class="free">m2</span> <span class="free">m1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mat_plusI_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m2</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">m1</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> oCons <span class="main">=</span> this
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m2</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">w</span> <span class="skolem">m2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mat_plus <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">m1</span><span class="main">)</span> <span class="skolem">m2</span> <span class="main">=</span> vec_plus <span class="skolem">v</span> <span class="skolem">w</span> <span class="main">#</span> mat_plus <span class="skolem">m1</span> <span class="skolem">m2a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mat_plusI_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> vec_plus <span class="skolem">w</span> <span class="skolem">v</span> <span class="main">#</span> mat_plus <span class="skolem">m1</span> <span class="skolem">m2a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec_plus_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons oCons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mat_plusI_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> zero
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">vec0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec0</span> <span class="main">≡</span> vec0I <span class="free">zero</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mat0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat0</span> <span class="main">≡</span> mat0I <span class="free">zero</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> monoid_add
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> vec0_plus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_plus <span class="main">(</span>vec0 <span class="free">nr</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> vec_def vec_plusI_def vec0I_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">nr</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nn</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> plus_vec0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_plus <span class="free">u</span> <span class="main">(</span>vec0 <span class="free">nr</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> vec_def vec_plusI_def vec0I_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">nr</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nn</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> plus_mat0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_plus <span class="free">m</span> <span class="main">(</span>mat0 <span class="free">nr</span> <span class="free">nc</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> mat_plus_index<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main">]</span> mat0_index<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> wf<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mat0_plus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_plus <span class="main">(</span>mat0 <span class="free">nr</span> <span class="free">nc</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> mat_plus_index<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main">]</span> mat0_index<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> wf<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> semiring_0
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">scalar_prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">scalar_prod</span> <span class="main">≡</span> scalar_prodI <span class="free">zero</span> plus times"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mat_mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_mult</span> <span class="main">≡</span> mat_multI <span class="free">zero</span> plus times"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> scalar_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"scalar_prod <span class="free">v1</span> <span class="free">v2</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">v1</span> <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"zip <span class="free">v1</span> <span class="free">v2</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> scalar_prodI_def z
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> scalar_prod_last<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v1</span> <span class="main">=</span> length <span class="free">v2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"scalar_prod <span class="main">(</span><span class="free">v1</span> <span class="main">@</span> <span class="main">[</span><span class="free">x1</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">v2</span> <span class="main">@</span> <span class="main">[</span><span class="free">x2</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">x1</span> <span class="main">*</span> <span class="free">x2</span> <span class="main">+</span> scalar_prod <span class="free">v1</span> <span class="free">v2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">v1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v2</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y1</span> <span class="skolem">w1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">w2</span></span> <span class="keyword2"><span class="keyword">where</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">=</span> Cons <span class="skolem">y2</span> <span class="skolem">w2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> len<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> rec<span class="main">:</span> <span class="quoted"><span class="quoted">"scalar_prod <span class="main">(</span><span class="skolem">w1</span> <span class="main">@</span> <span class="main">[</span><span class="free">x1</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w2</span> <span class="main">@</span> <span class="main">[</span><span class="free">x2</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">x1</span> <span class="main">*</span> <span class="free">x2</span> <span class="main">+</span> scalar_prod <span class="skolem">w1</span> <span class="skolem">w2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"scalar_prod <span class="main">(</span><span class="main">(</span><span class="skolem">y1</span> <span class="main">#</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">x1</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v2</span> <span class="main">@</span> <span class="main">[</span><span class="free">x2</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="skolem">y1</span> <span class="main">*</span> <span class="skolem">y2</span> <span class="main">+</span> <span class="free">x1</span> <span class="main">*</span> <span class="free">x2</span><span class="main">)</span> <span class="main">+</span> scalar_prod <span class="skolem">w1</span> <span class="skolem">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prod_cons v2 rec add.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">x1</span> <span class="main">*</span> <span class="free">x2</span> <span class="main">+</span> <span class="skolem">y1</span> <span class="main">*</span> <span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> scalar_prod <span class="skolem">w1</span> <span class="skolem">w2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">*</span> <span class="free">x2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x1</span> <span class="main">*</span> <span class="free">x2</span> <span class="main">+</span> <span class="main">(</span>scalar_prod <span class="main">(</span><span class="skolem">y1</span> <span class="main">#</span> <span class="skolem">w1</span><span class="main">)</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc scalar_prod_cons v2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prodI_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> scalar_product_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wfm<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wfr<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wfc<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nc</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"scalar_prod <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> scalar_prod <span class="free">r</span> <span class="main">(</span>col <span class="free">m</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">nc</span><span class="main">]</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> scalar_prod <span class="free">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> scalar_prod <span class="main">(</span>row <span class="free">m</span> <span class="bound">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">nr</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> wfm wfc
<span class="keyword1"><span class="command">unfolding</span></span> col_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">nc</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">hence</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nc</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> wfr <span class="keyword1"><span class="command">have</span></span> nr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nr</span> <span class="main">=</span> length <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?term</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">r</span> <span class="main">::</span> <span class="tfree">'a</span> vec<span class="main">.</span> zip <span class="bound">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="free">zero</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="bound">r</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fun</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> plus <span class="main">(</span>times <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"foldr <span class="var">?fun</span> <span class="main">(</span><span class="var">?term</span> <span class="free">r</span><span class="main">)</span> <span class="free">zero</span> <span class="main">=</span> <span class="free">zero</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">d</span> <span class="skolem">r</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"foldr <span class="var">?fun</span> <span class="main">(</span><span class="var">?term</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">#</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="free">zero</span> <span class="main">=</span> foldr <span class="var">?fun</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span><span class="free">zero</span><span class="main">)</span> <span class="main">#</span> <span class="var">?term</span> <span class="skolem">r</span><span class="main">)</span> <span class="free">zero</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> map_replicate_trivial<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">zero</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero</span> <span class="main">=</span> foldr <span class="var">?fun</span> <span class="main">(</span>zip <span class="free">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="free">zero</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">nr</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">zero</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nr<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Nil nc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prodI_def row_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ncc</span></span> <span class="keyword2"><span class="keyword">where</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nc</span> <span class="main">=</span> Suc <span class="skolem">ncc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="skolem">ncc</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> nc <span class="quoted"><span class="quoted">‹vec <span class="skolem">nc</span> <span class="skolem">c</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">cc</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">cc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wfc<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="skolem">ncc</span> <span class="skolem">cc</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rec<span class="main">:</span> <span class="quoted"><span class="quoted">"scalar_prod <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> scalar_prod <span class="free">r</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">ncc</span><span class="main">]</span><span class="main">)</span> <span class="skolem">cc</span> <span class="main">=</span> scalar_prod <span class="free">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> scalar_prod <span class="main">(</span>row <span class="skolem">m</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">nr</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> wf<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> wfc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> scalar_prod <span class="free">r</span> <span class="main">(</span><span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">ncc</span><span class="main">]</span> <span class="main">=</span> scalar_prod <span class="free">r</span> <span class="skolem">v</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> scalar_prod <span class="free">r</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">ncc</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ncc</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> wfr <span class="keyword1"><span class="command">have</span></span> nr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nr</span> <span class="main">=</span> length <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">v</span> <span class="main">=</span> length <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">nr</span><span class="main">.</span> vec <span class="skolem">ncc</span> <span class="main">(</span>row <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tm</span></span> <span class="keyword2"><span class="keyword">where</span></span> tm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tm</span> <span class="main">=</span> transpose <span class="free">nr</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> idk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="free">r</span><span class="main">.</span> row <span class="skolem">m</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">tm</span> <span class="main">!</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> col_transpose_is_row<span class="main">[</span><span class="operator">OF</span> wf<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> col_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nr<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> idtm1<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> scalar_prod <span class="main">(</span>row <span class="skolem">m</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">r</span><span class="main">]</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> scalar_prod <span class="main">(</span><span class="skolem">tm</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">r</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> idtm2<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> plus <span class="main">(</span>times <span class="main">(</span><span class="skolem">v</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>scalar_prod <span class="main">(</span>row <span class="skolem">m</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">r</span><span class="main">]</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> plus <span class="main">(</span>times <span class="main">(</span><span class="skolem">v</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>scalar_prod <span class="main">(</span><span class="skolem">tm</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">r</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> tm transpose<span class="main">[</span><span class="operator">OF</span> wf<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="skolem">ncc</span> <span class="free">nr</span> <span class="skolem">tm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> nr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tm</span> <span class="main">=</span> length <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">r</span><span class="main">.</span> length <span class="main">(</span><span class="skolem">tm</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ncc</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> v <span class="keyword1"><span class="command">have</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"plus <span class="main">(</span>times <span class="main">(</span>scalar_prod <span class="free">r</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>scalar_prod <span class="free">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> scalar_prod <span class="main">(</span><span class="skolem">tm</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">r</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    scalar_prod <span class="free">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> plus <span class="main">(</span>times <span class="main">(</span><span class="skolem">v</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>scalar_prod <span class="main">(</span><span class="skolem">tm</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">r</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">tm</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scalar_prodI_def row_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">r</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">vv</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">#</span> <span class="skolem">vv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vvlen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">vv</span> <span class="main">=</span> length <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">mm</span></span> <span class="keyword2"><span class="keyword">where</span></span> tm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tm</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">#</span> <span class="skolem">mm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mmlen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">mm</span> <span class="main">=</span> length <span class="skolem">r</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tm</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons tm <span class="keyword1"><span class="command">have</span></span> argLen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">r</span><span class="main">.</span> length <span class="main">(</span><span class="skolem">mm</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ncc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> rec<span class="main">:</span> <span class="quoted"><span class="quoted">"plus <span class="main">(</span>times <span class="main">(</span>scalar_prod <span class="skolem">r</span> <span class="skolem">vv</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>scalar_prod <span class="skolem">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> scalar_prod <span class="main">(</span><span class="skolem">mm</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">r</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     scalar_prod <span class="skolem">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> plus <span class="main">(</span>times <span class="main">(</span><span class="skolem">vv</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>scalar_prod <span class="main">(</span><span class="skolem">mm</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">r</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"plus <span class="main">(</span>times <span class="var">?rv</span> <span class="skolem">a</span><span class="main">)</span> <span class="var">?recl</span> <span class="main">=</span> <span class="var">?recr</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vvlen mmlen argLen<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> scalar_prod <span class="main">(</span><span class="main">(</span><span class="skolem">u</span> <span class="main">#</span> <span class="skolem">mm</span><span class="main">)</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">r</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> scalar_prod <span class="skolem">u</span> <span class="skolem">cc</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> scalar_prod <span class="main">(</span><span class="skolem">mm</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">r</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> plus <span class="main">(</span>times <span class="main">(</span><span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">vv</span><span class="main">)</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>scalar_prod <span class="main">(</span><span class="main">(</span><span class="skolem">u</span> <span class="main">#</span> <span class="skolem">mm</span><span class="main">)</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">r</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span>
               <span class="main">(</span>plus <span class="main">(</span>times <span class="skolem">c</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>scalar_prod <span class="skolem">u</span> <span class="skolem">cc</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span>
               map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> plus <span class="main">(</span>times <span class="main">(</span><span class="skolem">vv</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>scalar_prod <span class="main">(</span><span class="skolem">mm</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">r</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> v tm<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> id<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> id2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> scalar_prod_cons<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"scalar_prod <span class="skolem">u</span> <span class="skolem">cc</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"times <span class="main">(</span>times <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"plus <span class="main">(</span>times <span class="main">(</span>plus <span class="main">(</span>times <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="var">?rv</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>plus <span class="main">(</span>times <span class="skolem">b</span> <span class="var">?uc</span><span class="main">)</span> <span class="var">?recl</span><span class="main">)</span> <span class="main">=</span> plus <span class="main">(</span>plus <span class="var">?bca</span> <span class="main">(</span>times <span class="var">?rv</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>plus <span class="main">(</span>times <span class="skolem">b</span> <span class="var">?uc</span><span class="main">)</span> <span class="var">?recl</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> plus <span class="main">(</span>plus <span class="var">?bca</span> <span class="main">(</span>times <span class="var">?rv</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>plus <span class="var">?recl</span> <span class="main">(</span>times <span class="skolem">b</span> <span class="var">?uc</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> plus <span class="var">?bca</span> <span class="main">(</span>plus <span class="main">(</span>plus <span class="main">(</span>times <span class="var">?rv</span> <span class="skolem">a</span><span class="main">)</span> <span class="var">?recl</span><span class="main">)</span> <span class="main">(</span>times <span class="skolem">b</span> <span class="var">?uc</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> plus <span class="var">?bca</span> <span class="main">(</span>plus <span class="var">?recr</span> <span class="main">(</span>times <span class="skolem">b</span> <span class="var">?uc</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rec<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> plus <span class="var">?bca</span> <span class="main">(</span>plus <span class="main">(</span>times <span class="skolem">b</span> <span class="var">?uc</span><span class="main">)</span> <span class="var">?recr</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> plus <span class="main">(</span>times <span class="skolem">b</span> <span class="main">(</span>plus <span class="main">(</span>times <span class="skolem">c</span> <span class="skolem">a</span><span class="main">)</span> <span class="var">?uc</span><span class="main">)</span><span class="main">)</span> <span class="var">?recr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left mult.assoc add.assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"plus <span class="main">(</span>times <span class="main">(</span>plus <span class="main">(</span>times <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="var">?rv</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>plus <span class="main">(</span>times <span class="skolem">b</span> <span class="var">?uc</span><span class="main">)</span> <span class="var">?recl</span><span class="main">)</span> <span class="main">=</span> plus <span class="main">(</span>times <span class="skolem">b</span> <span class="main">(</span>plus <span class="main">(</span>times <span class="skolem">c</span> <span class="skolem">a</span><span class="main">)</span> <span class="var">?uc</span><span class="main">)</span><span class="main">)</span> <span class="var">?recr</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> c scalar_prod_cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> id<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> scalar_prod_cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> idtm1 idtm2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> main<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> idtm2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> row_def scalar_prod_cons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> mat_mult_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">n1</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n1</span> <span class="free">n2</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf3<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n2</span> <span class="free">nc</span> <span class="free">m3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="main">(</span>mat_mult <span class="free">nr</span> <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">m3</span> <span class="main">=</span> mat_mult <span class="free">nr</span> <span class="free">m1</span> <span class="main">(</span>mat_mult <span class="free">n1</span> <span class="free">m2</span> <span class="free">m3</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m12_3</span> <span class="main">=</span> <span class="var">?m1_23</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> wf <span class="main">=</span> wf1 wf2 wf3
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m12</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="free">m1</span> <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m23</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">n1</span> <span class="free">m2</span> <span class="free">m3</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> wf <span class="keyword1"><span class="command">have</span></span>
    wf12<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">n2</span> <span class="var">?m12</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf23<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n1</span> <span class="free">nc</span> <span class="var">?m23</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf1_23<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="var">?m1_23</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf12_3<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="var">?m12_3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_col_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> col_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> wf1_23 wf12_3 wf3 <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="var">?m12_3</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="var">?m1_23</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ilen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">m3</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m12_3</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?m1_23</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> len<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> jlen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="var">?m12_3</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> wf12_3 i <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m12_3</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?m1_23</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf12 wf3 j i<span class="main"><span class="main">]</span></span>
              mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf23 j i<span class="main"><span class="main">]</span></span>
              row_mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf2 j<span class="main"><span class="main">]</span></span>
              col_mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf2 wf3 i<span class="main"><span class="main">]</span></span>
              scalar_product_assoc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf2 row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 j<span class="main"><span class="main">]</span></span> col<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf3 i<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> wf<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_mult_assoc_n<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">n</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">n</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf3<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">n</span> <span class="free">m3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">n</span> <span class="main">(</span>mat_mult <span class="free">n</span> <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">m3</span> <span class="main">=</span> mat_mult <span class="free">n</span> <span class="free">m1</span> <span class="main">(</span>mat_mult <span class="free">n</span> <span class="free">m2</span> <span class="free">m3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_mult_assoc<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> scalar_left_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"scalar_prod <span class="main">(</span>vec0 <span class="free">nn</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="free">zero</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec0I_def scalar_prodI_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">nn</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> scalar_right_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"scalar_prod <span class="free">v</span> <span class="main">(</span>vec0 <span class="free">nn</span><span class="main">)</span> <span class="main">=</span> <span class="free">zero</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec0I_def scalar_prodI_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">v</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">nn</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">vv</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">nn</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> mat0_mult_left<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nc</span> <span class="free">ncc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="main">(</span>mat0 <span class="free">nr</span> <span class="free">nc</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span>mat0 <span class="free">nr</span> <span class="free">ncc</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">ncc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="main">(</span>mat0 <span class="free">nr</span> <span class="free">nc</span><span class="main">)</span> <span class="free">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> mat0 <span class="free">nr</span> <span class="free">ncc</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mat0 wf j i<span class="main"><span class="main">]</span></span> mat0_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i j<span class="main"><span class="main">]</span></span> mat0_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> j<span class="main"><span class="main">]</span></span> scalar_left_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wf<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> mat0_mult_right<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="free">m</span> <span class="main">(</span>mat0 <span class="free">nc</span> <span class="free">ncc</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mat0 <span class="free">nr</span> <span class="free">ncc</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">ncc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="free">m</span> <span class="main">(</span>mat0 <span class="free">nc</span> <span class="free">ncc</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> mat0 <span class="free">nr</span> <span class="free">ncc</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf mat0 j i<span class="main"><span class="main">]</span></span> mat0_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i j<span class="main"><span class="main">]</span></span> mat0_col<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span> scalar_right_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> wf<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> scalar_vec_plus_distrib_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf3<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"scalar_prod <span class="free">u</span> <span class="main">(</span>vec_plus <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> plus <span class="main">(</span>scalar_prod <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>scalar_prod <span class="free">u</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> vec_def scalar_prodI_def vec_plusI_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">nr</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">uu</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">uu</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">vv</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">vv</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">ww</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">#</span> <span class="skolem">ww</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">w</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc u v w <span class="keyword1"><span class="command">have</span></span> lu<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">uu</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lv<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">vv</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lw<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ww</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> u v w<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> lu lv lw<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"times <span class="skolem">a</span> <span class="skolem">c</span>"</span></span><span class="main"><span class="main">]</span></span> distrib_left add.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> scalar_vec_plus_distrib_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf3<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"scalar_prod <span class="main">(</span>vec_plus <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> plus <span class="main">(</span>scalar_prod <span class="free">u</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span>scalar_prod <span class="free">v</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> vec_def scalar_prodI_def vec_plusI_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">nr</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">uu</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">uu</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">vv</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">vv</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">ww</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">#</span> <span class="skolem">ww</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">w</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc u v w <span class="keyword1"><span class="command">have</span></span> lu<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">uu</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lv<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">vv</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lw<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ww</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> u v w<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> lu lv lw<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"times <span class="skolem">b</span> <span class="skolem">c</span>"</span></span><span class="main"><span class="main">]</span></span> distrib_right add.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_mult_plus_distrib_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nc</span> <span class="free">ncc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf3<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nc</span> <span class="free">ncc</span> <span class="free">m3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="free">m1</span> <span class="main">(</span>mat_plus <span class="free">m2</span> <span class="free">m3</span><span class="main">)</span> <span class="main">=</span> mat_plus <span class="main">(</span>mat_mult <span class="free">nr</span> <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="main">(</span>mat_mult <span class="free">nr</span> <span class="free">m1</span> <span class="free">m3</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="free">m1</span> <span class="var">?m23</span> <span class="main">=</span> mat_plus <span class="var">?m12</span> <span class="var">?m13</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> wf <span class="main">=</span> wf1 wf2 wf3
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m1_23</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="free">m1</span> <span class="var">?m23</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m12_13</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat_plus <span class="var">?m12</span> <span class="var">?m13</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> wf <span class="keyword1"><span class="command">have</span></span>
    wf23<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nc</span> <span class="free">ncc</span> <span class="var">?m23</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf12<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">ncc</span> <span class="var">?m12</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf13<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">ncc</span> <span class="var">?m13</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf1_23<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">ncc</span> <span class="var">?m1_23</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf12_13<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">ncc</span> <span class="var">?m12_13</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">ncc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m1_23</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?m12_13</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf23 j i<span class="main"><span class="main">]</span></span>
           mat_plus_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf12 wf13 i j<span class="main"><span class="main">]</span></span>
           mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf2 j i<span class="main"><span class="main">]</span></span>
           mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf3 j i<span class="main"><span class="main">]</span></span>
           col_mat_plus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf2 wf3 i<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">rule</span> scalar_vec_plus_distrib_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 j<span class="main"><span class="main">]</span></span> col<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf2 i<span class="main"><span class="main">]</span></span> col<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf3 i<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> wf<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_mult_plus_distrib_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf3<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nc</span> <span class="free">ncc</span> <span class="free">m3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="main">(</span>mat_plus <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">m3</span> <span class="main">=</span> mat_plus <span class="main">(</span>mat_mult <span class="free">nr</span> <span class="free">m1</span> <span class="free">m3</span><span class="main">)</span> <span class="main">(</span>mat_mult <span class="free">nr</span> <span class="free">m2</span> <span class="free">m3</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="var">?m12</span> <span class="main">_</span> <span class="main">=</span> mat_plus <span class="var">?m13</span> <span class="var">?m23</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> wf <span class="main">=</span> wf1 wf2 wf3
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m12_3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="var">?m12</span> <span class="free">m3</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m13_23</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat_plus <span class="var">?m13</span> <span class="var">?m23</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> wf <span class="keyword1"><span class="command">have</span></span>
    wf12<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="var">?m12</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf13<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">ncc</span> <span class="var">?m13</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf23<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">ncc</span> <span class="var">?m23</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf12_3<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">ncc</span> <span class="var">?m12_3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf13_23<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">ncc</span> <span class="var">?m13_23</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">ncc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m12_3</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?m13_23</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf12 wf3 j i<span class="main"><span class="main">]</span></span>
           mat_plus_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf13 wf23 i j<span class="main"><span class="main">]</span></span>
           mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf3 j i<span class="main"><span class="main">]</span></span>
           mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf2 wf3 j i<span class="main"><span class="main">]</span></span>
           row_mat_plus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 wf2 j<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
           <span class="operator">rule</span> scalar_vec_plus_distrib_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf1 j<span class="main"><span class="main">]</span></span> row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf2 j<span class="main"><span class="main">]</span></span> col<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf3 i<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> wf<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> semiring_1
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">vec1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec1</span> <span class="main">≡</span> vec1I <span class="free">zero</span> <span class="free">one</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mat1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat1</span> <span class="main">≡</span> mat1I <span class="free">zero</span> <span class="free">one</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mat_pow</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_pow</span> <span class="main">≡</span> mat_powI <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">1</span> <span class="main">(+)</span> <span class="main">(*)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> scalar_left_one<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nn</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nn</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"scalar_prod <span class="main">(</span>vec1 <span class="free">nn</span> <span class="free">i</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> vec1I_def vec_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">nn</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> oSuc <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">vv</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">vv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lvv<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">vv</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> scalar_left_zero <span class="keyword1"><span class="command">unfolding</span></span> vec0I_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v scalar_prod_cons add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">ii</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> oSuc lvv v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scalar_prod_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> scalar_right_one<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"vec <span class="free">nn</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nn</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"scalar_prod <span class="free">v</span> <span class="main">(</span>vec1 <span class="free">nn</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> vec1I_def vec_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">nn</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> oSuc <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">vv</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">vv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lvv<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">vv</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> scalar_right_zero <span class="keyword1"><span class="command">unfolding</span></span> vec0I_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v scalar_prod_cons add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">ii</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> oSuc lvv v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scalar_prod_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> mat1_mult_right<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="free">m</span> <span class="main">(</span>mat1 <span class="free">nc</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="free">m</span> <span class="main">(</span>mat1 <span class="free">nc</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf mat1 j i<span class="main"><span class="main">]</span></span>
     col_mat1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span>
     scalar_right_one<span class="main"><span class="main">[</span></span><span class="operator">OF</span> row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf j<span class="main"><span class="main">]</span></span> i<span class="main"><span class="main">]</span></span>
     row_col<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf j i<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">unfold</span> col_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> wf<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> mat1_mult_left<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="main">(</span>mat1 <span class="free">nr</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mat_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat_mult <span class="free">nr</span> <span class="main">(</span>mat1 <span class="free">nr</span><span class="main">)</span> <span class="free">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> mat_mult_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mat1 wf j i<span class="main"><span class="main">]</span></span>
      row_mat1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> j<span class="main"><span class="main">]</span></span>
      scalar_left_one<span class="main"><span class="main">[</span></span><span class="operator">OF</span> col<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf i<span class="main"><span class="main">]</span></span> j<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> col_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> wf<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">declare</span></span> vec0<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> mat0<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> vec0_plus<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> plus_vec0<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> plus_mat0<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Connection to HOL-Algebra›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_monoid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>plus<span class="main">,</span>zero<span class="main">}</span><span class="main">)</span> mat<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> monoid_scheme"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mat_monoid</span> <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="free"><span class="bound"><span class="entity">nc</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>
    carrier <span class="main">=</span> Collect <span class="main">(</span>mat <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="free"><span class="bound"><span class="entity">nc</span></span></span><span class="main">)</span><span class="main">,</span>
    mult <span class="main">=</span> mat_plus<span class="main">,</span>
    one <span class="main">=</span> mat0 <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="free"><span class="bound"><span class="entity">nc</span></span></span><span class="main">,</span>
    <span class="main">…</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_ring</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> semiring_1<span class="main">)</span> mat<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> ring_scheme"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mat_ring</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>
    carrier <span class="main">=</span> Collect <span class="main">(</span>mat <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span>
    mult <span class="main">=</span> mat_mult <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>
    one <span class="main">=</span> mat1 <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>
    zero <span class="main">=</span> mat0 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>
    add <span class="main">=</span> mat_plus<span class="main">,</span>
    <span class="main">…</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_monoid<span class="main">:</span> <span class="quoted"><span class="quoted">"monoid <span class="main">(</span>mat_monoid <span class="free">nr</span> <span class="free">nc</span> <span class="free">b</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> monoid_add<span class="main">)</span> mat<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>monoid_scheme<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mat_plus_assoc mat_monoid_def plus_mat0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_group<span class="main">:</span> <span class="quoted"><span class="quoted">"group <span class="main">(</span>mat_monoid <span class="free">nr</span> <span class="free">nc</span> <span class="free">b</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> group_add<span class="main">)</span> mat<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>monoid_scheme<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"group <span class="var">?G</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> monoid <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_monoid<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat_map uminus <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m'</span><span class="main">.</span> mat <span class="free">nr</span> <span class="free">nc</span> <span class="bound">m'</span> <span class="main">∧</span> mat_plus <span class="bound">m'</span> <span class="skolem">m</span> <span class="main">=</span> mat0 <span class="free">nr</span> <span class="free">nc</span> <span class="main">∧</span> mat_plus <span class="skolem">m</span> <span class="bound">m'</span> <span class="main">=</span> mat0 <span class="free">nr</span> <span class="free">nc</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?m'</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI mat_eqI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
      <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> mat_plus_index<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main">]</span> mat_map_index<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> mat0_index<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat_plus <span class="var">?m'</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> mat0 <span class="free">nr</span> <span class="free">nc</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat_plus <span class="skolem">m</span> <span class="var">?m'</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> mat0 <span class="free">nr</span> <span class="free">nc</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> Units <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mat_monoid_def Units_def Units<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_comm_monoid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"comm_monoid <span class="main">(</span>mat_monoid <span class="free">nr</span> <span class="free">nc</span> <span class="free">b</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add<span class="main">)</span> mat<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>monoid_scheme<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"comm_monoid <span class="var">?G</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> monoid <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_monoid<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> mat_plus_comm<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mat_monoid_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_comm_group<span class="main">:</span>
  <span class="quoted"><span class="quoted">"comm_group <span class="main">(</span>mat_monoid <span class="free">nr</span> <span class="free">nc</span> <span class="free">b</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ab_group_add<span class="main">)</span> mat<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>monoid_scheme<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"comm_group <span class="var">?G</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> group <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_group<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> comm_monoid <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_comm_monoid<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_abelian_monoid<span class="main">:</span> <span class="quoted"><span class="quoted">"abelian_monoid <span class="main">(</span>mat_ring <span class="free">n</span> <span class="free">b</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> semiring_1<span class="main">)</span> mat<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>ring_scheme<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_ring_def
  <span class="keyword1"><span class="command">unfolding</span></span> abelian_monoid_def <span class="keyword1"><span class="command">using</span></span> mat_comm_monoid<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">,</span> <span class="operator">unfolded</span> mat_monoid_def mat_ring_def<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_abelian_group<span class="main">:</span> <span class="quoted"><span class="quoted">"abelian_group <span class="main">(</span>mat_ring <span class="free">n</span> <span class="free">b</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>ab_group_add<span class="main">,</span>semiring_1<span class="main">}</span><span class="main">)</span> mat<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>ring_scheme<span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"abelian_group <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> abelian_monoid <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_abelian_monoid<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> group.Units<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat_group mat_monoid_def mat_ring_def partial_object.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ring.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ring.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_semiring<span class="main">:</span> <span class="quoted"><span class="quoted">"semiring <span class="main">(</span>mat_ring <span class="free">n</span> <span class="free">b</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> semiring_1<span class="main">)</span> mat<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>ring_scheme<span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"semiring <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> abelian_monoid <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_abelian_monoid<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_ring_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span>
      mat_mult_assoc mat0_mult_left mat0_mult_right mat1_mult_left mat1_mult_right
      mat_mult_plus_distrib_left mat_mult_plus_distrib_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_ring<span class="main">:</span> <span class="quoted"><span class="quoted">"ring <span class="main">(</span>mat_ring <span class="free">n</span> <span class="free">b</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ring_1<span class="main">)</span> mat<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>ring_scheme<span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"ring <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> abelian_group <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_abelian_group<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_ring_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span>
      mat_mult_assoc mat1_mult_left mat1_mult_right mat_mult_plus_distrib_left
      mat_mult_plus_distrib_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_pow_ring_pow<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> mat<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">n</span> <span class="main">(</span><span class="free">m</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> semiring_1<span class="main">)</span>mat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_pow <span class="free">n</span> <span class="free">m</span> <span class="free">k</span> <span class="main">=</span> <span class="free">m</span> <span class="main">[^]</span><span class="main"><span class="hidden">⇘</span><sub></sub></span>mat_ring <span class="free">n</span> <span class="free">b</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">k</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="free">m</span> <span class="main">[^]</span><span class="main"><span class="hidden">⇘</span><sub></sub></span><span class="var">?C</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">k</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> semiring <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_semiring<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mat_ring_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>