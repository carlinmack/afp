<div id="Nash_Extras">
<div class="head">
<h1>Theory Nash_Extras</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Pointwise Less-Than Relation Between Two Sets›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Nash_Extras
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Library/Ramsey.html">HOL-Library.Ramsey</a>"</span> <span class="quoted">"<a href="../../HOL/HOL-Library/Countable_Set.html">HOL-Library.Countable_Set</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">less_sets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>order set<span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>order set<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_sets</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span>"</span></span>

<span class="keyword1" id="Nash_Extras-less_setsD"><span class="command">lemma</span></span> less_setsD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>less_sets <span class="free">A</span> <span class="free">B</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>

<span class="keyword1" id="Nash_Extras-less_sets_irrefl"><span class="command">lemma</span></span> less_sets_irrefl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="free">A</span> <span class="free">A</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>

<span class="keyword1" id="Nash_Extras-less_sets_trans"><span class="command">lemma</span></span> less_sets_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>less_sets <span class="free">A</span> <span class="free">B</span><span class="main">;</span> less_sets <span class="free">B</span> <span class="free">C</span><span class="main">;</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> less_sets <span class="free">A</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_sets_def <span class="keyword1"><span class="command">using</span></span> less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Nash_Extras-less_sets_weaken1"><span class="command">lemma</span></span> less_sets_weaken1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>less_sets <span class="free">A'</span> <span class="free">B</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A'</span><span class="main">⟧</span> <span class="main">⟹</span> less_sets <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>

<span class="keyword1" id="Nash_Extras-less_sets_weaken2"><span class="command">lemma</span></span> less_sets_weaken2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>less_sets <span class="free">A</span> <span class="free">B'</span><span class="main">;</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">B'</span><span class="main">⟧</span> <span class="main">⟹</span> less_sets <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>

<span class="keyword1" id="Nash_Extras-less_sets_imp_disjnt"><span class="command">lemma</span></span> less_sets_imp_disjnt<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> disjnt <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def disjnt_def<span class="main">)</span>

<span class="keyword1" id="Nash_Extras-less_sets_UN1"><span class="command">lemma</span></span> less_sets_UN1<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="main">(</span><span class="main">⋃</span><span class="free">𝒜</span><span class="main">)</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">𝒜</span><span class="main">.</span> less_sets <span class="bound">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>

<span class="keyword1" id="Nash_Extras-less_sets_UN2"><span class="command">lemma</span></span> less_sets_UN2<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="free">A</span> <span class="main">(</span><span class="main">⋃</span> <span class="free">ℬ</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="free">ℬ</span><span class="main">.</span> less_sets <span class="free">A</span> <span class="bound">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>

<span class="keyword1" id="Nash_Extras-less_sets_Un1"><span class="command">lemma</span></span> less_sets_Un1<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">A'</span><span class="main">)</span> <span class="free">B</span> <span class="main">⟷</span> less_sets <span class="free">A</span> <span class="free">B</span> <span class="main">∧</span> less_sets <span class="free">A'</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>

<span class="keyword1" id="Nash_Extras-less_sets_Un2"><span class="command">lemma</span></span> less_sets_Un2<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="free">A</span> <span class="main">(</span><span class="free">B</span> <span class="main">∪</span> <span class="free">B'</span><span class="main">)</span> <span class="main">⟷</span> less_sets <span class="free">A</span> <span class="free">B</span> <span class="main">∧</span> less_sets <span class="free">A</span> <span class="free">B'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>

<span class="keyword1" id="Nash_Extras-strict_sorted_imp_less_sets"><span class="command">lemma</span></span> strict_sorted_imp_less_sets<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="main">⟹</span> less_sets <span class="main">(</span>list.set <span class="free">as</span><span class="main">)</span> <span class="main">(</span>list.set <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_sets_def sorted_wrt_append strict_sorted_sorted_wrt<span class="main">)</span>

<span class="keyword1" id="Nash_Extras-Sup_nat_less_sets_singleton"><span class="command">lemma</span></span> Sup_nat_less_sets_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Sup <span class="free">T</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="free">T</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Max_less_iff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sup_nat_def less_sets_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>



</pre>
</div><div id="Nash_Williams">
<div class="head">
<h1>Theory Nash_Williams</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Nash-Williams Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Following S. Todorčević, \emph{Introduction to Ramsey Spaces}, 
Princeton University Press (2010), 11--12.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Nash_Williams
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Nash_Extras.html">Nash_Extras</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Nash_Williams-finite_nat_Int_greaterThan_iff"><span class="command">lemma</span></span> finite_nat_Int_greaterThan_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">N</span> <span class="main">∩</span> <span class="main">{</span><span class="free">n</span><span class="main">&lt;..}</span><span class="main">)</span> <span class="main">⟷</span> finite <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_nat_iff_bounded subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.strict_trans2 nat_less_le not_less_eq<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Initial segments›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">init_segment</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> nat set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">init_segment</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">S'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∪</span> <span class="bound">S'</span> <span class="main">∧</span> less_sets <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">S'</span>"</span></span>

<span class="keyword1" id="Nash_Williams-init_segment_subset"><span class="command">lemma</span></span> init_segment_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"init_segment <span class="free">S</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_segment_def<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-init_segment_refl"><span class="command">lemma</span></span> init_segment_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"init_segment <span class="free">S</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff init_segment_def less_sets_def sup_bot.right_neutral<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-init_segment_antisym"><span class="command">lemma</span></span> init_segment_antisym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>init_segment <span class="free">S</span> <span class="free">T</span><span class="main">;</span> init_segment <span class="free">T</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span><span class="main">=</span><span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_segment_def<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-init_segment_trans"><span class="command">lemma</span></span> init_segment_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>init_segment <span class="free">S</span> <span class="free">T</span><span class="main">;</span> init_segment <span class="free">T</span> <span class="free">U</span><span class="main">⟧</span> <span class="main">⟹</span> init_segment <span class="free">S</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> init_segment_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UnE Un_assoc Un_upper1 less_sets_def less_sets_weaken1<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-init_segment_empty2"><span class="command">lemma</span></span> init_segment_empty2 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"init_segment <span class="free">S</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">S</span><span class="main">=</span><span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_segment_def less_sets_def<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-init_segment_Un"><span class="command">lemma</span></span> init_segment_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="free">S</span> <span class="free">S'</span> <span class="main">⟹</span> init_segment <span class="free">S</span> <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_segment_def less_sets_def<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-init_segment_iff"><span class="command">lemma</span></span> init_segment_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="free">S</span> <span class="free">T</span> <span class="main">⟷</span> <span class="free">S</span><span class="main">=</span><span class="free">T</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="main">∈</span> <span class="free">T</span><span class="main">.</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="free">T</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">m</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span><span class="main">=</span><span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> S'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∪</span> <span class="skolem">S'</span>"</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="free">S</span> <span class="skolem">S'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> init_segment_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span> <span class="main">=</span> <span class="free">T</span><span class="main">-</span><span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> S' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="skolem">S'</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_eq_empty_iff Diff_iff Inf_nat_def1 eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">&lt;</span> Inf <span class="skolem">S'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> S' False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Inf_nat_def1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="free">T</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> Inf <span class="skolem">S'</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Inf_nat_def eq not_less_Least <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE bexE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="free">S</span> <span class="free">T</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> init_segment_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="free">T</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="skolem">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="free">T</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="free">S</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="free">T</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="free">S</span> <span class="free">T</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> init_segment_Un <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Nash_Williams-init_segment_empty"><span class="command">lemma</span></span> init_segment_empty <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"init_segment <span class="main">{}</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_segment_def less_sets_def<span class="main">)</span>


<span class="keyword1" id="Nash_Williams-init_segment_insert_iff"><span class="command">lemma</span></span> init_segment_insert_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Sn<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="free">S</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> TS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">T</span><span class="main">-</span><span class="free">S</span> <span class="main">⟹</span> <span class="free">n</span><span class="main">≤</span><span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="main">(</span>insert <span class="free">n</span> <span class="free">S</span><span class="main">)</span> <span class="free">T</span> <span class="main">⟷</span> init_segment <span class="free">S</span> <span class="free">T</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"init_segment <span class="main">(</span>insert <span class="free">n</span> <span class="free">S</span><span class="main">)</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="main">(</span><span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="free">S</span><span class="main">)</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="free">S</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Sn init_segment_Un init_segment_trans sup.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_segment_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="free">S</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> S'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∪</span> <span class="skolem">S'</span>"</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="free">S</span> <span class="skolem">S'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_segment_def less_sets_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∪</span> <span class="skolem">S'</span> <span class="main">=</span> insert <span class="free">n</span> <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">S'</span> <span class="main">-</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               less_sets <span class="main">(</span>insert <span class="free">n</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="skolem">S'</span> <span class="main">-</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_sets_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">∈</span> <span class="free">T</span>›</span></span> TS nat_less_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="main">(</span>insert <span class="free">n</span> <span class="free">S</span><span class="main">)</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> S'<span class="main">(</span>1<span class="main">)</span> init_segment_Un <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Nash_Williams-init_segment_insert"><span class="command">lemma</span></span> init_segment_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="free">S</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="free">T</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="free">S</span> <span class="main">(</span>insert <span class="free">n</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> S'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∪</span> <span class="skolem">S'</span>"</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="free">S</span> <span class="skolem">S'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms init_segment_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">n</span> <span class="free">T</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∪</span> <span class="main">(</span>insert <span class="free">n</span> <span class="skolem">S'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="free">S</span> <span class="main">(</span>insert <span class="free">n</span> <span class="skolem">S'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> init_segment_Un <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions and basic properties›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Ramsey</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat set set<span class="main">,</span> nat<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ramsey</span> <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">}</span><span class="main">.</span>
                       <span class="main">∀</span><span class="bound">M</span><span class="main">.</span> infinite <span class="bound">M</span> <span class="main">⟶</span>
                           <span class="main">(</span><span class="main">∃</span><span class="bound">N</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">N</span> <span class="main">⊆</span> <span class="bound">M</span> <span class="main">∧</span> infinite <span class="bound">N</span> <span class="main">∧</span> <span class="bound">i</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">.</span> <span class="bound">j</span><span class="main">≠</span><span class="bound">i</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="main">∩</span> Pow <span class="bound">N</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thin_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">thin_set</span> <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="main">⊆</span> Collect finite <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">ℱ</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">T</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">ℱ</span></span></span><span class="main">.</span> init_segment <span class="bound">S</span> <span class="bound">T</span> <span class="main">⟶</span> <span class="bound">S</span><span class="main">=</span><span class="bound">T</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">comparables</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> nat set <span class="main">⇒</span> nat set set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">comparables</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> finite <span class="bound">T</span> <span class="main">∧</span> <span class="main">(</span>init_segment <span class="bound">T</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∨</span> init_segment <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">T</span> <span class="main">∧</span> <span class="bound">T</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Nash_Williams-comparables_iff"><span class="command">lemma</span></span> comparables_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> comparables <span class="free">S</span> <span class="free">M</span> <span class="main">⟷</span> finite <span class="free">T</span> <span class="main">∧</span> <span class="main">(</span>init_segment <span class="free">T</span> <span class="free">S</span> <span class="main">∨</span> init_segment <span class="free">S</span> <span class="free">T</span> <span class="main">∧</span> <span class="free">T</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comparables_def init_segment_def<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-comparables_subset"><span class="command">lemma</span></span> comparables_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>comparables <span class="free">S</span> <span class="free">M</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comparables_def init_segment_def<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-comparables_empty"><span class="command">lemma</span></span> comparables_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"comparables <span class="main">{}</span> <span class="free">M</span> <span class="main">=</span> Fpow <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comparables_def Fpow_def<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-comparables_mono"><span class="command">lemma</span></span> comparables_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> comparables <span class="free">S</span> <span class="free">N</span> <span class="main">⊆</span> comparables <span class="free">S</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comparables_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rejects</span> <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> comparables <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">accepts</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">accepts</span> <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">¬</span> rejects <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strongly_accepts</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">strongly_accepts</span> <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">N</span></span><span class="main">⊆</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> rejects <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">N</span> <span class="main">⟶</span> finite <span class="bound">N</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">decides</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">decides</span> <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> rejects <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∨</span> strongly_accepts <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">decides_subsets</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">decides_subsets</span> <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">T</span><span class="main">.</span> <span class="bound">T</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⟶</span> finite <span class="bound">T</span> <span class="main">⟶</span> decides <span class="free"><span class="bound"><span class="entity">ℱ</span></span></span> <span class="bound">T</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>

<span class="keyword1" id="Nash_Williams-strongly_accepts_imp_accepts"><span class="command">lemma</span></span> strongly_accepts_imp_accepts<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>strongly_accepts <span class="free">ℱ</span> <span class="free">S</span> <span class="free">M</span><span class="main">;</span> infinite <span class="free">M</span><span class="main">⟧</span> <span class="main">⟹</span> accepts <span class="free">ℱ</span> <span class="free">S</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strongly_accepts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Nash_Williams-rejects_trivial"><span class="command">lemma</span></span> rejects_trivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rejects <span class="free">ℱ</span> <span class="free">S</span> <span class="free">M</span><span class="main">;</span> thin_set <span class="free">ℱ</span><span class="main">;</span> init_segment <span class="free">F</span> <span class="free">S</span><span class="main">;</span> <span class="free">F</span> <span class="main">∈</span> <span class="free">ℱ</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rejects_def thin_set_def
  <span class="keyword1"><span class="command">using</span></span> comparables_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Nash_Williams-rejects_subset"><span class="command">lemma</span></span> rejects_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rejects <span class="free">ℱ</span> <span class="free">S</span> <span class="free">M</span><span class="main">;</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">⟧</span> <span class="main">⟹</span> rejects <span class="free">ℱ</span> <span class="free">S</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rejects_def comparables_def<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-strongly_accepts_subset"><span class="command">lemma</span></span> strongly_accepts_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>strongly_accepts <span class="free">ℱ</span> <span class="free">S</span> <span class="free">M</span><span class="main">;</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">⟧</span> <span class="main">⟹</span> strongly_accepts <span class="free">ℱ</span> <span class="free">S</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strongly_accepts_def<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-decides_subset"><span class="command">lemma</span></span> decides_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>decides <span class="free">ℱ</span> <span class="free">S</span> <span class="free">M</span><span class="main">;</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">⟧</span> <span class="main">⟹</span> decides <span class="free">ℱ</span> <span class="free">S</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> decides_def
  <span class="keyword1"><span class="command">using</span></span> rejects_subset strongly_accepts_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Nash_Williams-decides_subsets_subset"><span class="command">lemma</span></span> decides_subsets_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>decides_subsets <span class="free">ℱ</span> <span class="free">M</span><span class="main">;</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">⟧</span> <span class="main">⟹</span> decides_subsets <span class="free">ℱ</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> decides_subset decides_subsets_def subset_trans<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-rejects_empty"><span class="command">lemma</span></span> rejects_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rejects <span class="free">ℱ</span> <span class="main">{}</span> <span class="free">M</span> <span class="main">⟷</span> Fpow <span class="free">M</span> <span class="main">∩</span> <span class="free">ℱ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rejects_def comparables_def Fpow_def<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-strongly_accepts_empty"><span class="command">lemma</span></span> strongly_accepts_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="free">ℱ</span> <span class="main">{}</span> <span class="free">M</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">N</span></span><span class="main">⊆</span><span class="free">M</span><span class="main">.</span> Fpow <span class="bound">N</span> <span class="main">∩</span> <span class="free">ℱ</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟶</span> finite <span class="bound">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strongly_accepts_def Fpow_def disjoint_iff<span class="main">)</span>

<span class="keyword1" id="Nash_Williams-ex_infinite_decides_1"><span class="command">lemma</span></span> ex_infinite_decides_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">N</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"decides <span class="free">ℱ</span> <span class="free">S</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms decides_def order_refl strongly_accepts_def<span class="main">)</span>

<span class="keyword1"><span class="command">proposition</span></span> ex_infinite_decides_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">N</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="bound">T</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">⟹</span> decides <span class="free">ℱ</span> <span class="bound">T</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Pow <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">{..&lt;</span> card <span class="main">(</span>Pow <span class="free">S</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> Pow <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_surj_on <span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij_betw_from_nat_into_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M0</span></span> <span class="keyword2"><span class="keyword">where</span></span> M0<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">M0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M0</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"decides <span class="free">ℱ</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">M0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹infinite <span class="free">M</span>›</span></span> ex_infinite_decides_1<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≡</span> rec_nat <span class="skolem">M0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">N</span><span class="main">.</span> <span class="main">@</span><span class="bound">N'</span><span class="main">.</span> <span class="bound">N'</span> <span class="main">⊆</span> <span class="bound">N</span> <span class="main">∧</span> infinite <span class="bound">N'</span> <span class="main">∧</span> decides <span class="free">ℱ</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">N'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> P_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">@</span><span class="bound">N'</span><span class="main">.</span> <span class="bound">N'</span> <span class="main">⊆</span> <span class="skolem">F</span> <span class="skolem">n</span> <span class="main">∧</span> infinite <span class="bound">N'</span> <span class="main">∧</span> decides <span class="free">ℱ</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">N'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> decides <span class="free">ℱ</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">F</span> <span class="skolem">n</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">M</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_def M0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Φ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">N'</span><span class="main">.</span> <span class="bound">N'</span> <span class="main">⊆</span> <span class="skolem">F</span> <span class="skolem">n</span> <span class="main">∧</span> infinite <span class="bound">N'</span> <span class="main">∧</span> decides <span class="free">ℱ</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">N'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N'</span><span class="main">.</span> <span class="var">?Φ</span> <span class="bound">N'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Suc ex_infinite_decides_1 subset_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Eps <span class="var">?Φ</span> <span class="main">⊆</span> <span class="skolem">F</span> <span class="skolem">n</span> <span class="main">∧</span> infinite <span class="main">(</span>Eps <span class="var">?Φ</span><span class="main">)</span> <span class="main">∧</span> decides <span class="free">ℱ</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Eps <span class="var">?Φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Suc.IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> telescope<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">F</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ex_infinite_decides_1 someI_ex<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋂</span><span class="bound">n</span><span class="main">&lt;</span>card <span class="main">(</span>Pow <span class="free">S</span><span class="main">)</span><span class="main">.</span> <span class="skolem">F</span> <span class="bound">n</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> INF_lower2 Pow_iff f imageE order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋂</span><span class="bound">n</span><span class="main">≤</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">F</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">F</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> telescope <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> atMost_Suc›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"infinite <span class="var">?N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> Suc_le_D Suc_le_eq finite_subset le_INF_iff lessThan_Suc_atMost lessThan_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> card <span class="main">(</span>Pow <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> equalityE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"decides <span class="free">ℱ</span> <span class="skolem">T</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"decides <span class="free">ℱ</span> <span class="skolem">T</span> <span class="var">?N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> INT_lower <span class="quoted"><span class="quoted">‹decides <span class="free">ℱ</span> <span class="skolem">T</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&lt;</span> card <span class="main">(</span>Pow <span class="free">S</span><span class="main">)</span>›</span></span> decides_subset lessThan_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Nash_Williams-sorted_wrt_subset"><span class="command">lemma</span></span> sorted_wrt_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">X</span> <span class="main">∈</span> list.set <span class="free">l</span><span class="main">;</span> sorted_wrt <span class="main">(≤)</span> <span class="free">l</span><span class="main">⟧</span> <span class="main">⟹</span> hd <span class="free">l</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Todorčević's Lemma 1.18›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> ex_infinite_decides_subsets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"thin_set <span class="free">ℱ</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">N</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"decides_subsets <span class="free">ℱ</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M0</span></span> <span class="keyword2"><span class="keyword">where</span></span> M0<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">M0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M0</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"decides <span class="free">ℱ</span> <span class="main">{}</span> <span class="skolem">M0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹infinite <span class="free">M</span>›</span></span> ex_infinite_decides_1<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">decides_all</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">decides_all</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">S</span> <span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">T</span></span> <span class="main">⊆</span> <span class="bound">S</span><span class="main">.</span> decides <span class="free">ℱ</span> <span class="bound">T</span> <span class="bound">N</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">NL</span> <span class="bound">N</span><span class="main">.</span> <span class="bound">N</span> <span class="main">⊆</span> hd <span class="bound">NL</span> <span class="main">∧</span> Inf <span class="bound">N</span> <span class="main">&gt;</span> Inf <span class="main">(</span>hd <span class="bound">NL</span><span class="main">)</span> <span class="main">∧</span> infinite <span class="bound">N</span> <span class="main">∧</span> <span class="skolem">decides_all</span> <span class="main">(</span>List.set <span class="main">(</span>map Inf <span class="bound">NL</span><span class="main">)</span><span class="main">)</span> <span class="bound">N</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="skolem">NL</span> <span class="bound">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>hd <span class="skolem">NL</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">NL</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">⊆</span> hd <span class="skolem">NL</span> <span class="main">∧</span> infinite <span class="skolem">N</span> <span class="main">∧</span> <span class="skolem">decides_all</span> <span class="main">(</span>List.set <span class="main">(</span>map Inf <span class="skolem">NL</span><span class="main">)</span><span class="main">)</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Φ_def decides_all_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.finite_set ex_infinite_decides_finite <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>hd <span class="skolem">NL</span><span class="main">)</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span><span class="skolem">N</span> <span class="main">∩</span> <span class="main">{</span>Inf <span class="main">(</span>hd <span class="skolem">NL</span><span class="main">)</span><span class="main">&lt;..}</span><span class="main">)</span> <span class="main">&gt;</span> Inf <span class="main">(</span>hd <span class="skolem">NL</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_nat_def1 Int_iff finite.emptyI finite_nat_Int_greaterThan_iff greaterThan_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Φ_def decides_all_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_lower1 N decides_all_def decides_subset finite_nat_Int_greaterThan_iff subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Φ_Eps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">NL</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="skolem">NL</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>hd <span class="skolem">NL</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">NL</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> someI_ex that<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≡</span> rec_nat <span class="main">[</span><span class="skolem">M0</span><span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">NL</span><span class="main">.</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="bound">NL</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="bound">NL</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> F_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">M0</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">F</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> sorted_wrt <span class="main">(≤)</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> Collect infinite <span class="main">∧</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> Pow <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Φ_Eps hd_in_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(⊆)</span> <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subset_trans <span class="main">[</span><span class="operator">OF</span> _ sorted_wrt_subset<span class="main">]</span> Suc.IH Φ_def <span class="quoted">"*"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> infinite <span class="bound">S</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> Φ_def Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Pow <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> Suc.IH Φ_def hd_in_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> ΦF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> F Φ_Eps hd_in_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> decides<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">decides_all</span> <span class="main">(</span>List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> Φ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> Eps_subset_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> ΦF Φ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> map_Inf_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_class.lift_Suc_mono_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mmap</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mmap</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Inf <span class="main">(</span>hd <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mmap</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">mmap</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ΦF Φ_def list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mmap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">mmap</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_Suc_mono_less strict_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">mmap</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_imp_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> finite_F_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">⊆</span> List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> range <span class="skolem">mmap</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">K</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">mmap</span> <span class="main">`</span> <span class="skolem">K</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> S finite_subset_image order_refl<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mmap</span> <span class="main">`</span> <span class="skolem">K</span> <span class="main">⊆</span> list.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="main">(</span>Max <span class="skolem">K</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mmap_def image_subset_iff
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F Max_ge <span class="quoted"><span class="quoted">‹finite <span class="skolem">K</span>›</span></span> hd_in_set imageI map_Inf_subset not_less_eq_eq set_map subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> S <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> list.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="main">(</span>Max <span class="skolem">K</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">mmap</span> <span class="main">`</span> <span class="skolem">K</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ΦF Φ_def list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Eps_Φ_decreasing<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_class.lift_Suc_antimono_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> hd_Suc_eq_Eps<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> Inf_hd_in_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span>hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_nat_def1 ΦF Φ_def finite.emptyI rev_finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Inf_hd_in_Eps<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span>hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&gt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Eps_Φ_decreasing Nat.lessE leD mmap_def not_less_eq_eq subsetD that hd_Suc_eq_Eps<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> image_mmap_subset_hd_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..}</span> <span class="main">⊆</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_Suc_eq_Eps atLeast_iff image_subsetI le_imp_less_Suc mmap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">⊆</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_class.lift_Suc_mono_le<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_F_in_F<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> F hd_in_set subsetD that<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> infinite_mm<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>range <span class="skolem">mmap</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj <span class="skolem">mmap</span>›</span></span> range_inj_infinite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">mmap</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Eps_subset_hd <span class="quoted"><span class="quoted">‹<span class="skolem">M0</span> <span class="main">⊆</span> <span class="free">M</span>›</span></span> image_mmap_subset_hd_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"decides_subsets <span class="free">ℱ</span> <span class="main">(</span>range <span class="skolem">mmap</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> decides_subsets_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> range <span class="skolem">mmap</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≡</span> <span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">⊆</span> List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">⊆</span> List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> range <span class="skolem">mmap</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span> finite_F_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> minS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="skolem">S</span> <span class="main">⊆</span> List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> LeastI_ex not_less_Least<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> decides_Fn<span class="main">:</span> <span class="quoted"><span class="quoted">"decides <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> S decides decides_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"decides <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span>range <span class="skolem">mmap</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_mmap_subset_hd_F decides_Fn decides_subset hd_Suc_eq_Eps atLeast_0<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> notin_map_Inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="skolem">S</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Inf <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> ls<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="skolem">S</span> <span class="main">{</span>Inf <span class="skolem">T</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">if</span></span>  T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> Inf <span class="skolem">T</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> less_setsD ls <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">T</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Inf_nat_def not_less_Least <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">mmap</span> <span class="skolem">k</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> range <span class="skolem">mmap</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> T <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> Inf <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Eps_Φ_decreasing F Inf_hd_in_hd hd_Suc_eq_Eps <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">T</span>›</span></span> mmap_def not_le sorted_wrt_subset subsetD<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI hd_Suc_eq_Eps hd_F_in_F<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Inf <span class="main">`</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> k image_iff mmap_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> List.set <span class="main">(</span>map Inf <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">∈</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span>›</span></span> lessI less_Suc_eq_0_disj<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> minS <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> Inf_hd_F<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span>hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="skolem">S</span> <span class="main">{</span>Inf <span class="main">(</span>hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_hd_in_Eps hd_F_in_F notin_map_Inf imageI leI set_map that<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> less_S<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="skolem">S</span> <span class="main">{</span>Inf <span class="main">(</span>hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="skolem">S</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span>hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span>hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">T</span> <span class="skolem">m</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_segment_iff less_sets_def<span class="main">)</span>
        <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"rejects <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> decides_Fn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decides_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">case</span></span> 1
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rejects <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span>range <span class="skolem">mmap</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rejects_def disjoint_iff<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> comparables <span class="skolem">S</span> <span class="main">(</span>range <span class="skolem">mmap</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">ℱ</span>"</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">X</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">X</span> <span class="main">∈</span> <span class="free">ℱ</span><span class="main">;</span> init_segment <span class="skolem">S</span> <span class="bound">X</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∉</span> <span class="skolem">S</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> range <span class="skolem">mmap</span><span class="main">⟧</span>
                                <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> less_S Inf_hd_F mmap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> comparables <span class="skolem">S</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comparables_def disjoint_iff subset_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> 1 <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">ℱ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rejects_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decides_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 2
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
            <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">⊆</span> range <span class="skolem">mmap</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rejects <span class="free">ℱ</span> <span class="skolem">S</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..}</span> <span class="main">∩</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∩</span> <span class="skolem">N</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> in_mono that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..}</span> <span class="main">∩</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_Int finite_Un finite_imageI finite_lessThan that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rejects <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span><span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..}</span> <span class="main">∩</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> rejects_subset <span class="quoted"><span class="quoted">‹rejects <span class="free">ℱ</span> <span class="skolem">S</span> <span class="skolem">N</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..}</span> <span class="main">∩</span> <span class="skolem">N</span> <span class="main">⊆</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> image_mmap_subset_hd_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strongly_accepts_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span>range <span class="skolem">mmap</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strongly_accepts_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decides_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Todorčević's Lemma 1.19›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> strongly_accepts_1_19<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> acc<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="free">ℱ</span> <span class="free">S</span> <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"thin_set <span class="free">ℱ</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dsM<span class="main">:</span> <span class="quoted"><span class="quoted">"decides_subsets <span class="free">ℱ</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> <span class="main">¬</span> strongly_accepts <span class="free">ℱ</span> <span class="main">(</span>insert <span class="bound">n</span> <span class="free">S</span><span class="main">)</span> <span class="free">M</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> rejects <span class="free">ℱ</span> <span class="main">(</span>insert <span class="bound">n</span> <span class="free">S</span><span class="main">)</span> <span class="free">M</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span>Sup <span class="free">S</span><span class="main">&lt;..}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="skolem">N</span> <span class="main">⟷</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">∧</span> rejects <span class="free">ℱ</span> <span class="main">(</span>insert <span class="bound">n</span> <span class="free">S</span><span class="main">)</span> <span class="free">M</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&gt;</span> Sup <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> <span class="main">¬</span> strongly_accepts <span class="free">ℱ</span> <span class="main">(</span>insert <span class="bound">n</span> <span class="free">S</span><span class="main">)</span> <span class="free">M</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> rejects <span class="free">ℱ</span> <span class="main">(</span>insert <span class="bound">n</span> <span class="free">S</span><span class="main">)</span> <span class="free">M</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dsM <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> decides_subsets_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> decides_def finite.insertI insert_subset strongly_accepts_imp_accepts<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> rejects <span class="free">ℱ</span> <span class="main">(</span>insert <span class="bound">n</span> <span class="free">S</span><span class="main">)</span> <span class="free">M</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_def finite_nat_Int_greaterThan_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"accepts <span class="free">ℱ</span> <span class="free">S</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> acc strongly_accepts_def <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> comparables <span class="free">S</span> <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> <span class="free">ℱ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> TSN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∪</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rejects_def
    <span class="keyword1"><span class="command">using</span></span> comparables_iff init_segment_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="skolem">T</span> <span class="free">S</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"init_segment <span class="free">S</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">≠</span><span class="skolem">T</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comparables_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="skolem">T</span> <span class="main">(</span>insert <span class="skolem">n</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Sup_nat_less_sets_singleton N <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span> init_segment_insert that<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> <span class="quoted"><span class="quoted">‹thin_set <span class="free">ℱ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">∈</span> <span class="free">ℱ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> N infinite_nat_iff_unbounded rejects_trivial<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span><span class="skolem">T</span><span class="main">-</span><span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_partition Diff_subset_conv Min_in T<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> TSN comparables_iff finite_Diff init_segment_subset subsetD sup_bot.right_neutral<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rejects <span class="free">ℱ</span> <span class="main">(</span>insert <span class="var">?n</span> <span class="free">S</span><span class="main">)</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rejects_subset <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> init_segment <span class="skolem">T</span> <span class="main">(</span>insert <span class="var">?n</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> init_segment <span class="main">(</span>insert <span class="var">?n</span> <span class="free">S</span><span class="main">)</span> <span class="skolem">T</span> <span class="main">∨</span> insert <span class="var">?n</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T Diff_partition TSN <span class="quoted"><span class="quoted">‹Min <span class="main">(</span><span class="skolem">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">N</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rejects_def comparables_iff disjoint_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> T_nS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> insert <span class="var">?n</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> conjE disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> init_segment <span class="skolem">T</span> <span class="main">(</span>insert <span class="var">?n</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> init_segment <span class="main">(</span>insert <span class="var">?n</span> <span class="free">S</span><span class="main">)</span> <span class="skolem">T</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="free">S</span> <span class="main">{</span>Min <span class="main">(</span><span class="skolem">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Sup_nat_less_sets_singleton N <span class="quoted"><span class="quoted">‹Min <span class="main">(</span><span class="skolem">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">N</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> T comparables_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹init_segment <span class="free">S</span> <span class="skolem">T</span>›</span></span> Min_in init_segment_insert_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> non_TS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> init_segment <span class="skolem">T</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Sup_nat_less_sets_singleton N <span class="quoted"><span class="quoted">‹<span class="var">?n</span> <span class="main">∈</span> <span class="skolem">N</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> init_segment <span class="skolem">T</span> <span class="main">(</span>insert <span class="main">(</span><span class="var">?n</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> init_segment <span class="main">(</span>insert <span class="main">(</span><span class="var">?n</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="skolem">T</span> <span class="main">∨</span> insert <span class="main">(</span><span class="var">?n</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> init_segment_insert<span class="main">)</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>ST<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="skolem">T</span>"</span></span> <span class="main">|</span> <span class="main">(</span>TS<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 init_segment_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> ST
      <span class="keyword1"><span class="command">with</span></span> § <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 T<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">⊆</span> insert <span class="main">(</span><span class="var">?n</span><span class="main">)</span> <span class="free">S</span>›</span></span>  comparables_iff init_segment_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> TS
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> init_segment <span class="skolem">T</span> <span class="free">S</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Sup_nat_less_sets_singleton N <span class="quoted"><span class="quoted">‹<span class="var">?n</span> <span class="main">∈</span> <span class="skolem">N</span>›</span></span> § assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> init_segment_insert<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 TS init_segment_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Much work is needed for this slight strengthening of the previous result!›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> strongly_accepts_1_19_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"thin_set <span class="free">ℱ</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dsM<span class="main">:</span> <span class="quoted"><span class="quoted">"decides_subsets <span class="free">ℱ</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">N</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span> <span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">S</span> <span class="main">⊆</span> <span class="free">N</span><span class="main">;</span> finite <span class="bound">S</span><span class="main">;</span> strongly_accepts <span class="free">ℱ</span> <span class="bound">S</span> <span class="free">N</span><span class="main">;</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">N</span><span class="main">;</span> less_sets <span class="bound">S</span> <span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">⟧</span>
              <span class="main">⟹</span> strongly_accepts <span class="free">ℱ</span> <span class="main">(</span>insert <span class="bound">n</span> <span class="bound">S</span><span class="main">)</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">insert_closed</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">insert_closed</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">NL</span> <span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">T</span></span> <span class="main">⊆</span> Inf <span class="main">`</span> set <span class="bound">NL</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="bound">N</span><span class="main">.</span>
                      strongly_accepts <span class="free">ℱ</span> <span class="bound">T</span> <span class="main">(</span><span class="main">(</span>Inf <span class="main">`</span> set <span class="bound">NL</span><span class="main">)</span> <span class="main">∪</span> hd <span class="bound">NL</span><span class="main">)</span> <span class="main">⟶</span>
                      less_sets <span class="bound">T</span> <span class="main">{</span><span class="bound">n</span><span class="main">}</span> <span class="main">⟶</span> strongly_accepts <span class="free">ℱ</span> <span class="main">(</span>insert <span class="bound">n</span> <span class="bound">T</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Inf <span class="main">`</span> set <span class="bound">NL</span><span class="main">)</span> <span class="main">∪</span> hd <span class="bound">NL</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">NL</span> <span class="bound">N</span><span class="main">.</span> <span class="bound">N</span> <span class="main">⊆</span> hd <span class="bound">NL</span> <span class="main">∧</span> Inf <span class="bound">N</span> <span class="main">&gt;</span> Inf <span class="main">(</span>hd <span class="bound">NL</span><span class="main">)</span> <span class="main">∧</span> infinite <span class="bound">N</span> <span class="main">∧</span> <span class="skolem">insert_closed</span> <span class="bound">NL</span> <span class="bound">N</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="skolem">NL</span> <span class="bound">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> NL<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>hd <span class="skolem">NL</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">`</span> set <span class="skolem">NL</span> <span class="main">∪</span> hd <span class="skolem">NL</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">NL</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Inf <span class="main">`</span> set <span class="skolem">NL</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∪</span> hd <span class="skolem">NL</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="var">?M</span><span class="main">.</span> <span class="main">¬</span> strongly_accepts <span class="free">ℱ</span> <span class="main">(</span>insert <span class="bound">n</span> <span class="bound">S</span><span class="main">)</span> <span class="var">?M</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">P</span> <span class="skolem">S</span> <span class="main">⊆</span> <span class="main">{..</span><span class="bound">k</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> Inf <span class="main">`</span> set <span class="skolem">NL</span>"</span></span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="free">ℱ</span> <span class="skolem">S</span> <span class="var">?M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">P</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> P_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> strongly_accepts_1_19<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"decides_subsets <span class="free">ℱ</span> <span class="var">?M</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> NL<span class="main">(</span>2<span class="main">)</span> decides_subsets_subset dsM <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> finite_surj that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that NL assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_nat_iff_bounded_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">S</span> <span class="main">⊆</span> Inf <span class="main">`</span> set <span class="skolem">NL</span><span class="main">;</span> strongly_accepts <span class="free">ℱ</span> <span class="bound">S</span> <span class="var">?M</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">f</span> <span class="bound">S</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≡</span> Max <span class="main">(</span>insert <span class="main">(</span>Inf <span class="main">(</span>hd <span class="skolem">NL</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> Pow <span class="main">(</span>Inf <span class="main">`</span> set <span class="skolem">NL</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="free">ℱ</span> <span class="main">(</span>insert <span class="skolem">n</span> <span class="skolem">S</span><span class="main">)</span> <span class="var">?M</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> Inf <span class="main">`</span> set <span class="skolem">NL</span>"</span></span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="free">ℱ</span> <span class="skolem">S</span> <span class="var">?M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> hd <span class="skolem">NL</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">m</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">S</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f <span class="main">[</span><span class="operator">OF</span> S<span class="main">]</span> n <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">NL</span> <span class="main">(</span>hd <span class="skolem">NL</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">m</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Φ_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span>hd <span class="skolem">NL</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span>hd <span class="skolem">NL</span><span class="main">)</span> <span class="main">&lt;</span> Inf <span class="main">(</span>hd <span class="skolem">NL</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">m</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_nat_def1 Int_iff finite.emptyI finite_nat_Int_greaterThan_iff greaterThan_iff le_less_trans that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>hd <span class="skolem">NL</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">m</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_nat_Int_greaterThan_iff that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">insert_closed</span> <span class="skolem">NL</span> <span class="main">(</span>hd <span class="skolem">NL</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">m</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> § <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_closed_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Φ_Eps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">NL</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="skolem">NL</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>hd <span class="skolem">NL</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"Inf <span class="main">`</span> set <span class="skolem">NL</span> <span class="main">∪</span> hd <span class="skolem">NL</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">NL</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> someI_ex that<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≡</span> rec_nat <span class="main">[</span><span class="free">M</span><span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">NL</span><span class="main">.</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="bound">NL</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="bound">NL</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> F_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="free">M</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">F</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> InfM<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf <span class="free">M</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_nat_def1 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> finite.emptyI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> sorted_wrt <span class="main">(≤)</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> Collect infinite <span class="main">∧</span> set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> Pow <span class="free">M</span> <span class="main">∧</span> Inf <span class="main">`</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> InfM <span class="quoted"><span class="quoted">‹infinite <span class="free">M</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Pow_iff Suc.IH hd_in_set subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(⊆)</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> order_trans <span class="main">[</span><span class="operator">OF</span> _ sorted_wrt_subset<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.IH Un_subset_iff Φ_Eps Φ_def hd_in_set mem_Collect_eq subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ball_Collect Pow_iff Suc.IH Un_subset_iff Φ_Eps Φ_def hd_in_set subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Pow_iff Suc.IH 1 hd_in_set subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 2 3 Inf_nat_def1 finite.simps in_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 2 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> ΦF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ball_Collect F Pow_iff Un_subset_iff Φ_Eps hd_in_set subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> insert_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">insert_closed</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> Φ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> Eps_subset_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> ΦF Φ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mmap</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mmap</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Inf <span class="main">(</span>hd <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mmap</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">mmap</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ΦF Φ_def list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mmap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">mmap</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_Suc_mono_less strict_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">mmap</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_imp_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ΦF Φ_def list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Eps_Φ_decreasing<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_class.lift_Suc_antimono_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> hd_Suc_eq_Eps<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span>hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_nat_def1 ΦF Φ_def finite.emptyI rev_finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Inf_hd_in_Eps<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span>hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&gt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Eps_Φ_decreasing Nat.lessE hd_Suc_eq_Eps less_imp_le_nat subsetD that<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> image_mmap_subset_hd_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..}</span> <span class="main">⊆</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_Suc_eq_Eps atLeast_iff image_subsetI le_imp_less_Suc mmap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">⊆</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_class.lift_Suc_mono_le<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_F_in_F<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> F hd_in_set subsetD that<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> infinite_mm<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>range <span class="skolem">mmap</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj <span class="skolem">mmap</span>›</span></span> range_inj_infinite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">mmap</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Eps_subset_hd image_mmap_subset_hd_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> range <span class="skolem">mmap</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> acc<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span>range <span class="skolem">mmap</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> range <span class="skolem">mmap</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Sn<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="skolem">S</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">mmap</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">≡</span> <span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="bound">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="bound">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> range <span class="skolem">mmap</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span> finite_nat_iff_bounded finite_subset_image image_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">N</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> minS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">&lt;</span><span class="skolem">N</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="bound">m</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> LeastI_ex not_less_Least<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> range_mmap_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="skolem">mmap</span> <span class="main">⊆</span> Inf <span class="main">`</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∪</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Eps_subset_hd image_mmap_subset_hd_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">metis</span> Inf_hd_in_Eps hd_F_in_F image_iff leI mmap_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> subM<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Inf <span class="main">`</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">∪</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> F PowD hd_in_set subsetD sup.boundedI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="free">ℱ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>Inf <span class="main">`</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">∪</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> insert_closed <span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> insert_closed_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">N</span><span class="main">}</span> <span class="main">⊆</span> Inf <span class="main">`</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc_leI hd_F_in_F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mmap_def le_eq_less_or_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> S <span class="keyword3"><span class="command">show</span></span> Ssub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> Inf <span class="main">`</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">mmap</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Sn S <span class="quoted"><span class="quoted">‹strict_mono <span class="skolem">mmap</span>›</span></span> strict_mono_less
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def n  image_iff subset_iff Bex_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> leI minS <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Eps <span class="main">(</span><span class="skolem">Φ</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> image_mmap_subset_hd_F n <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span>Inf <span class="main">`</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">∪</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> strongly_accepts <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span>Inf <span class="main">`</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">∪</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rejects <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span>Inf <span class="main">`</span> list.set <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">∪</span> hd <span class="main">(</span><span class="skolem">F</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> dsM subM <span class="keyword1"><span class="command">unfolding</span></span> decides_subsets_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> F Ssub <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span> decides_def decides_subset subset_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"accepts <span class="free">ℱ</span> <span class="skolem">S</span> <span class="main">(</span>range <span class="skolem">mmap</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj <span class="skolem">mmap</span>›</span></span> acc range_inj_infinite strongly_accepts_imp_accepts <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> range_mmap_subset rejects_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="skolem">S</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sn<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="free">ℱ</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>range <span class="skolem">mmap</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> range_mmap_subset strongly_accepts_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Main Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Weirdly, the assumption  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">`</span></span> <span class="free"><span class="free">ℱ</span></span> <span class="main"><span class="main">⊆</span></span> <span class="main"><span class="main">{..&lt;</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not used here; it's perhaps unnecessary due to
     the particular way that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Ramsey</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is defined. It's only needed for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span> <span class="main"><span class="main">&gt;</span></span> <span class="numeral"><span class="numeral">2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Nash_Williams_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"thin_set <span class="free">ℱ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ramsey <span class="free">ℱ</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ramsey_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">M</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ℱ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span> <span class="main">∩</span> <span class="free">ℱ</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> finℱ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">ℱ</span> <span class="main">⟹</span> finite <span class="bound">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms thin_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> thin<span class="main">:</span> <span class="quoted"><span class="quoted">"thin_set <span class="main">(</span><span class="var">?ℱ</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> assms thin_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"decides_subsets <span class="main">(</span><span class="var">?ℱ</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">M</span>›</span></span> ex_infinite_decides_subsets thin <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"rejects <span class="main">(</span><span class="var">?ℱ</span> <span class="main">0</span><span class="main">)</span> <span class="main">{}</span> <span class="skolem">N</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="main">(</span><span class="var">?ℱ</span> <span class="main">0</span><span class="main">)</span> <span class="main">{}</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> decides_def decides_subsets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">N</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="main">∧</span> infinite <span class="bound">N</span> <span class="main">∧</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="free">ℱ</span> <span class="main">∩</span> Pow <span class="bound">N</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ℱ</span> <span class="main">0</span> <span class="main">∩</span> Pow <span class="skolem">N</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rejects_def disjoint_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntD2 PowD comparables_iff finℱ init_segment_empty sup_bot.left_neutral<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> less_2_cases_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">P</span><span class="main">⊆</span><span class="skolem">N</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">S</span> <span class="main">⊆</span> <span class="bound">P</span><span class="main">;</span> finite <span class="bound">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">S</span> <span class="main">∉</span> <span class="main">(</span><span class="var">?ℱ</span> <span class="main">0</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> finite <span class="bound">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fpow_def disjoint_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span> <span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">S</span> <span class="main">⊆</span> <span class="skolem">P</span><span class="main">;</span> finite <span class="bound">S</span><span class="main">;</span> strongly_accepts <span class="main">(</span><span class="var">?ℱ</span> <span class="main">0</span><span class="main">)</span> <span class="bound">S</span> <span class="skolem">P</span><span class="main">;</span> <span class="bound">n</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">;</span> less_sets <span class="bound">S</span> <span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">⟧</span>
              <span class="main">⟹</span> strongly_accepts <span class="main">(</span><span class="var">?ℱ</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>insert <span class="bound">n</span> <span class="bound">S</span><span class="main">)</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> strongly_accepts_1_19_plus <span class="main">[</span><span class="operator">OF</span> thin <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> N<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ℱ</span> <span class="main">1</span> <span class="main">∩</span> Pow <span class="skolem">P</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjoint_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T</span>
      <span class="keyword3"><span class="command">assume</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">T</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> <span class="free">ℱ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">T</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finℱ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="main">(</span><span class="var">?ℱ</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">S</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span>
        <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">S</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> insert <span class="main">(</span>Sup <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="main">{</span>Sup <span class="skolem">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Sup_nat_def Max_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="main">{</span>Sup <span class="skolem">S</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc card_Diff_singleton <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sacc<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="main">(</span><span class="var">?ℱ</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="main">{</span>Sup <span class="skolem">S</span><span class="main">}</span><span class="main">)</span> <span class="skolem">P</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="main">{</span>Sup <span class="skolem">S</span><span class="main">}</span><span class="main">)</span> <span class="main">{</span>Sup <span class="skolem">S</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>1<span class="main">)</span> finite_Sup_less_iff nat_neq_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strongly_accepts <span class="main">(</span><span class="var">?ℱ</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Sup <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="main">{</span>Sup <span class="skolem">S</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">P</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P Seq Suc.prems finite_Diff insert_subset sacc<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Seq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> 2 <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">N</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>comparables <span class="skolem">T</span> <span class="skolem">P</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">ℱ</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> strongly_accepts_def rejects_def disjoint_iff
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">⊆</span> <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">P</span>›</span></span> IntE order_refl vimage_singleton_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> T assms thin_set_def comparables_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">N</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">P</span>›</span></span> less_2_cases_iff subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Nash_Williams<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ℱ<span class="main">:</span> <span class="quoted"><span class="quoted">"thin_set <span class="free">ℱ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ramsey <span class="free">ℱ</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&lt;</span><span class="numeral">2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">r</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">with</span></span> ℱ <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ramsey_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">with</span></span> ℱ <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nash_Williams_2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Suc.IH <span class="keyword1"><span class="command">have</span></span> Ram<span class="main">:</span> <span class="quoted"><span class="quoted">"Ramsey <span class="free">ℱ</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False leI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Ramsey_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> fim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">ℱ</span> <span class="main">→</span> <span class="main">{..&lt;</span>Suc <span class="skolem">r</span><span class="main">}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">M</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">r</span> <span class="keyword1">then</span> <span class="skolem">r</span><span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> gim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">ℱ</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="skolem">r</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fim False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">r</span><span class="main">;</span> <span class="skolem">i</span><span class="main">≠</span><span class="bound">j</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">g</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="free">ℱ</span> <span class="main">∩</span> Pow <span class="skolem">N</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ram <span class="quoted"><span class="quoted">‹infinite <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ramsey_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">N</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="main">∧</span> infinite <span class="bound">N</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="skolem">r</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>Suc <span class="skolem">r</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="free">ℱ</span> <span class="main">∩</span> Pow <span class="bound">N</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">r</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">∩</span> <span class="free">ℱ</span> <span class="main">∩</span> Pow <span class="skolem">N</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">r</span>›</span></span> i that
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_iff g_def less_Suc_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True diff_less less_nat_zero_code nat_neq_iff zero_less_one<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> less_SucI<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">-</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">∩</span> <span class="free">ℱ</span> <span class="main">∩</span> Pow <span class="skolem">N</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span><span class="skolem">r</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
          <span class="keyword1"><span class="command">using</span></span> that i <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def disjoint_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">r</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> him<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">ℱ</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="skolem">r</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> fim i False <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">r</span><span class="main">.</span> <span class="skolem">j</span><span class="main">≠</span><span class="bound">k</span> <span class="main">⟶</span> <span class="skolem">h</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">k</span><span class="main">}</span> <span class="main">∩</span> <span class="free">ℱ</span> <span class="main">∩</span> Pow <span class="skolem">P</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ramsey_def Ram <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> null <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">N</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>›</span></span> j <span class="quoted"><span class="quoted">‹infinite <span class="skolem">P</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def disjoint_iff less_Suc_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> j <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">N</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">P</span>›</span></span> False
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def less_Suc_eq disjoint_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>