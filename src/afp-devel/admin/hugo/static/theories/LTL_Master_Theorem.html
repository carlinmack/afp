<div id="Syntactic_Fragments_and_Stability">
<div class="head">
<h1>Theory Syntactic_Fragments_and_Stability</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Syntactic Fragments and Stabilityâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> Syntactic_Fragments_and_Stability
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../LTL/LTL.html">LTL.LTL</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Sublist.html">HOL-Library.Sublist</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">â€• â€¹We use prefix and suffix on infinite words.â€º</span>
<span class="keyword1"><span class="command">hide_const</span></span> Sublist.prefix Sublist.suffix

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹The fragments <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Î¼LTL</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Î½LTL</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>â€º</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_Î¼LTL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_Î¼LTL</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î¼LTL</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î¼LTL</span> <span class="keyword1">prop<span class="hidden">â‡©</span><sub>n</sub>(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î¼LTL</span> <span class="keyword1">nprop<span class="hidden">â‡©</span><sub>n</sub>(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î¼LTL</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_Î¼LTL</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆ§</span> <span class="free">is_Î¼LTL</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î¼LTL</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_Î¼LTL</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆ§</span> <span class="free">is_Î¼LTL</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î¼LTL</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">is_Î¼LTL</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î¼LTL</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_Î¼LTL</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆ§</span> <span class="free">is_Î¼LTL</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î¼LTL</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_Î¼LTL</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆ§</span> <span class="free">is_Î¼LTL</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î¼LTL</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_Î½LTL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_Î½LTL</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î½LTL</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î½LTL</span> <span class="keyword1">prop<span class="hidden">â‡©</span><sub>n</sub>(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î½LTL</span> <span class="keyword1">nprop<span class="hidden">â‡©</span><sub>n</sub>(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î½LTL</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_Î½LTL</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆ§</span> <span class="free">is_Î½LTL</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î½LTL</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_Î½LTL</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆ§</span> <span class="free">is_Î½LTL</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î½LTL</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">is_Î½LTL</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î½LTL</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_Î½LTL</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆ§</span> <span class="free">is_Î½LTL</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î½LTL</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_Î½LTL</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆ§</span> <span class="free">is_Î½LTL</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Î½LTL</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Î¼LTL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Î¼LTL</span> <span class="main">=</span> <span class="main">{</span><span class="bound">Ï†</span><span class="main">.</span> is_Î¼LTL <span class="bound">Ï†</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Î½LTL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Î½LTL</span> <span class="main">=</span> <span class="main">{</span><span class="bound">Ï†</span><span class="main">.</span> is_Î½LTL <span class="bound">Ï†</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Î¼LTL_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL <span class="main">âŸ·</span> is_Î¼LTL <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Î¼LTL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Î½LTL_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL <span class="main">âŸ·</span> is_Î½LTL <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Î½LTL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">â€¹Subformulas in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Î¼LTL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Î½LTL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>â€º</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">}</span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">}</span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">}</span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">}</span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">Ïˆ</span></span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆ¨</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">Ïˆ</span></span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆ¨</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âŠ†</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âŠ†</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŸ¹</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ïˆ</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŸ¹</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ïˆ</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subfrmlsn_Î¼LTL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL <span class="main">âŸ¹</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŠ†</span> Î¼LTL"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subfrmlsn_Î½LTL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL <span class="main">âŸ¹</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŠ†</span> Î½LTL"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="hidden">â‡©</span><sub>Î½</sub>_disjoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_semantics subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_semantics
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆª</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âŠ†</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="hidden">â‡©</span><sub>Î½</sub>_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆª</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="hidden">â‡©</span><sub>Î½</sub>_disjoint subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_finite subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_finite card_Un_disjoint<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Stabilityâ€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">GF_singleton</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">â‰¡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">F_singleton</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">â‰¡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">then</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> GF_singleton_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> F_singleton_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ğ’¢â„±</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set word <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ğ’¢â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢â„±</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> GF_singleton <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">âˆª</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> GF_singleton <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">âˆª</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢â„±</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">â„±</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set word <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> F_singleton <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">âˆª</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> F_singleton <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">âˆª</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ğ’¢â„±_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">=</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ§</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> â„±_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">=</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ§</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢â„±_semantics'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢â„±_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±_semantics'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„±_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢â„±_â„±_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> â„± <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢â„±_semantics â„±_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


<span class="keyword1"><span class="command">lemma</span></span> ğ’¢â„±_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢â„±_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢â„±_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢â„±_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ğ’¢â„±_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢â„±_elim<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢â„±_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢â„±_suffix<span class="comment1">(* [simp] *)</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢â„±_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢â„±_semantics GF_Inf_many
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">j</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> INFM_nat_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢â„±_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŸ¹</span> ğ’¢â„± <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢â„±_semantics <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> â„±_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>â„± <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„±_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> â„±_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±_elim<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„±_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±_suffix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„± <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŠ†</span> â„± <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„±_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŸ¹</span> â„± <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main">âŠ†</span> â„± <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„±_semantics <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Î¼_stable</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âŸ·</span> ğ’¢â„± <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> â„± <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> suffix_Î¼_stable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> Î¼_stable <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">.</span> <span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span> <span class="main">âŸ·</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Alm_all_GF_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span> <span class="main">âŸ·</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_finite eventually_ball_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">Ïˆ</span></span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">Ïˆ</span></span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MOST_mono<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Collect_cong<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Î¼_stable_def ğ’¢â„±_semantics â„±_semantics
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MOST_mono<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Î¼_stable_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Î¼_stable <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŸ¹</span> <span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŸ¹</span> Î¼_stable <span class="free">Ïˆ</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"Î¼_stable <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ïˆ</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">=</span> â„± <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Î¼_stable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Un_commute â„±_semantics' ğ’¢â„±_semantics' Î¼_stable_def inf_left_commute inf_sup_absorb sup.orderE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Î¼_stable_suffix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Î¼_stable <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŸ¹</span> Î¼_stable <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> â„±_suffix ğ’¢â„±_â„±_subset ğ’¢â„±_suffix Î¼_stable_def subset_antisym<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">FG_singleton</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">â‰¡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">G_singleton</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">â‰¡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">then</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> FG_singleton_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> G_singleton_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">â„±ğ’¢</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set word <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">â„±ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±ğ’¢</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> FG_singleton <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">âˆª</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> FG_singleton <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">âˆª</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">â„±ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">â„±ğ’¢</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ğ’¢</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set word <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> G_singleton <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">âˆª</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> G_singleton <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">âˆª</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âˆª</span> <span class="free">ğ’¢</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ğ’¢</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> â„±ğ’¢_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">Ïˆ</span></span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">â‰¡</span> <span class="main">{</span><span class="bound"><span class="bound">Ïˆ</span></span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> â„±ğ’¢_semantics'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„±ğ’¢_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢_semantics'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢_â„±ğ’¢_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢_semantics â„±ğ’¢_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±ğ’¢_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±ğ’¢_subformulas<span class="hidden">â‡©</span><sub>Î½</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„±ğ’¢_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±ğ’¢_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> â„±ğ’¢_subformulas<span class="hidden">â‡©</span><sub>Î½</sub> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±ğ’¢_elim<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„±ğ’¢_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±ğ’¢_suffix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> â„±ğ’¢_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> â„±ğ’¢_semantics FG_Alm_all
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">j</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> MOST_nat_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> â„±ğ’¢_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŸ¹</span> â„±ğ’¢ <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„±ğ’¢_semantics <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> ğ’¢_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢_subformulas<span class="hidden">â‡©</span><sub>Î½</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ğ’¢_subformulas<span class="hidden">â‡©</span><sub>Î½</sub> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢_elim<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢_suffix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŸ¹</span> ğ’¢ <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢_semantics <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Î½_stable</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">âŸ·</span> â„±ğ’¢ <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> ğ’¢ <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> suffix_Î½_stable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">j</span><span class="main">.</span> Î½_stable <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="bound">j</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">.</span> <span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span> <span class="main">âŸ·</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Alm_all_FG_G <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span> <span class="main">âŸ·</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_finite eventually_ball_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">Ïˆ</span></span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">Ïˆ</span></span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MOST_mono<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Collect_cong<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Î½_stable_def â„±ğ’¢_semantics ğ’¢_semantics
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MOST_mono<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Î½_stable_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Î½_stable <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŸ¹</span> <span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŸ¹</span> Î½_stable <span class="free">Ïˆ</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"Î½_stable <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ïˆ</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">=</span> ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Î½_stable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Un_commute ğ’¢_semantics' â„±ğ’¢_semantics' Î½_stable_def inf_left_commute inf_sup_absorb sup.orderE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Î½_stable_suffix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Î½_stable <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŸ¹</span> Î½_stable <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> â„±ğ’¢_suffix ğ’¢_â„±ğ’¢_subset ğ’¢_suffix Î½_stable_def antisym_conv<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Definitions with Lists for Code Exportâ€º</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">â€¹</span></span>Î¼â€º</span></span></span></span>- and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">â€¹</span></span>Î½â€º</span></span></span></span>-subformulas as lists:â€º</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.insert <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">(</span>List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.insert <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">(</span>List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.insert <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">(</span>List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.insert <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">(</span>List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list_distinct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list_distinct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list_set subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list_distinct distinct_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list_set subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list_distinct distinct_card<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  We define the list of advice sets as the product of all subsequences
  of the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">â€¹</span></span>Î¼â€º</span></span></span></span>- and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">â€¹</span></span>Î½â€º</span></span></span></span>-subformulas of a formula.
â€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">advice_sets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> ltln list <span class="main">Ã—</span> <span class="tfree">'a</span> ltln list<span class="main">)</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">advice_sets</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">=</span> List.product <span class="main">(</span>subseqs <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subseqs <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subset_subseq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> set <span class="free">ys</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">xs</span><span class="main">.</span> <span class="free">X</span> <span class="main">=</span> set <span class="bound">xs</span> <span class="main">âˆ§</span> subseq <span class="bound">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Pow_iff image_iff in_set_subseqs subseqs_powset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subseqs_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">xs</span><span class="main">.</span> <span class="free">X</span> <span class="main">=</span> set <span class="bound">xs</span> <span class="main">âˆ§</span> <span class="bound">xs</span> <span class="main">âˆˆ</span> set <span class="main">(</span>subseqs <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subset_subseq subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list_set in_set_subseqs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subseqs_subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">ys</span><span class="main">.</span> <span class="free">Y</span> <span class="main">=</span> set <span class="bound">ys</span> <span class="main">âˆ§</span> <span class="bound">ys</span> <span class="main">âˆˆ</span> set <span class="main">(</span>subseqs <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subset_subseq subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list_set in_set_subseqs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> advice_sets_subformulas<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ§</span> <span class="free">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">X</span> <span class="main">=</span> set <span class="bound">xs</span> <span class="main">âˆ§</span> <span class="free">Y</span> <span class="main">=</span> set <span class="bound">ys</span> <span class="main">âˆ§</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">âˆˆ</span> set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> advice_sets_def set_product subseqs_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list subseqs_subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* TODO add to HOL/List.thy *)</span>
<span class="keyword1"><span class="command">lemma</span></span> subseqs_not_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subseqs <span class="free">xs</span> <span class="main">â‰ </span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff list.set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subseqs_refl<span class="main">)</span>

<span class="comment1">(* TODO add to HOL/List.thy *)</span>
<span class="keyword1"><span class="command">lemma</span></span> product_not_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">â‰ </span> <span class="main">[]</span> <span class="main">âŸ¹</span> <span class="free">ys</span> <span class="main">â‰ </span> <span class="main">[]</span> <span class="main">âŸ¹</span> List.product <span class="free">xs</span> <span class="free">ys</span> <span class="main">â‰ </span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> advice_sets_not_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"advice_sets <span class="free">Ï†</span> <span class="main">â‰ </span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> advice_sets_def <span class="keyword1"><span class="command">using</span></span> subseqs_not_empty product_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> advice_sets_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> advice_sets_def length_product length_subseqs subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list_length subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list_length power_add<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_1 card_mono lessI power_increasing_iff subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="hidden">â‡©</span><sub>Î½</sub>_card subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn subfrmlsn_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> advice_sets_element_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">âˆˆ</span> set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> length <span class="free">xs</span> <span class="main">â‰¤</span> card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">âˆˆ</span> set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> length <span class="free">ys</span> <span class="main">â‰¤</span> card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> advice_sets_def set_product
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SigmaD1 card_mono in_set_subseqs list_emb_length order_trans subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list_length subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn subfrmlsn_finite<span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> SigmaD2 card_mono in_set_subseqs list_emb_length order_trans subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list_length subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn subfrmlsn_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> advice_sets_element_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">âˆˆ</span> set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> set <span class="free">xs</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">âˆˆ</span> set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> set <span class="free">ys</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> advice_sets_def set_product
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> SigmaD1 subseqs_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list<span class="main">)</span>
     <span class="main">(</span><span class="operator">meson</span> SigmaD2 subseqs_subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="After">
<div class="head">
<h1>Theory After</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹The ``after''-Functionâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> After
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../LTL/LTL.html">LTL.LTL</a> <a href="../LTL/Equivalence_Relations.html">LTL.Equivalence_Relations</a> <a href="Syntactic_Fragments_and_Stability.html">Syntactic_Fragments_and_Stability</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Definition of afâ€º</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">af_letter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">af_letter</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">af_letter</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">af_letter</span> <span class="keyword1">prop<span class="hidden">â‡©</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">âˆˆ</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="keyword1">then</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">af_letter</span> <span class="keyword1">nprop<span class="hidden">â‡©</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">âˆ‰</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="keyword1">then</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">af_letter</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">af_letter</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">af_letter</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">af_letter</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">af_letter</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">af_letter</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">af_letter</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">af_letter</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">af</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set list <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">af</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">â‰¡</span> foldl af_letter <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> af_decompose<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> af_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">w</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"af <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">w</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> af <span class="free">Ï†</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> af_ite_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">j</span> <span class="main">âŸ¹</span> <span class="free">j</span> <span class="main">â‰¤</span> <span class="free">k</span> <span class="main">âŸ¹</span> af <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">j</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">j</span> <span class="main">â†’</span> <span class="free">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> foldl_append le_Suc_ex map_append subsequence_def upt_add_eq_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_U<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_U'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af_decompose<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_R<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_R'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af_decompose<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_W<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_W'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af_decompose<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_M<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_M'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af_decompose<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> suffix_build<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> suffix <span class="free">n</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter_build<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af_letter <span class="free">Ï†</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltln_expand_Until <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltln_expand_Release <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltln_expand_WeakUntil <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltln_expand_StrongRelease <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_ltl_continuation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">âŒ¢</span> <span class="free">w'</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="free">w'</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quoted"><span class="free">w'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> af_letter_build <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Range of the after functionâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>af_letter <span class="free">Ï†</span> <span class="free">Î½</span><span class="main">)</span> <span class="main">âŠ†</span> atoms_ltln <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> af_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>af <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŠ†</span> atoms_ltln <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> af_letter_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter_nested_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="main">(</span>af_letter <span class="free">Ï†</span> <span class="free">Î½</span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> af_nested_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="main">(</span>af <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> af_letter_nested_prop_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"range <span class="main">(</span>af_letter <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_letter_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> af_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"range <span class="main">(</span>af <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Subformulas of the after functionâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="main">(</span>af_letter <span class="free">Ï†</span> <span class="free">Î¾</span><span class="main">)</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> af_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="main">(</span>af <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_letter_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter_subformulas<span class="hidden">â‡©</span><sub>Î½</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>af_letter <span class="free">Ï†</span> <span class="free">Î¾</span><span class="main">)</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> af_subformulas<span class="hidden">â‡©</span><sub>Î½</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>af <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_letter_subformulas<span class="hidden">â‡©</span><sub>Î½</sub>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Stability and the after functionâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢â„±_af<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> ğ’¢â„± <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢â„±_semantics' af_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±_af<span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„± <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> â„± <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„±_semantics' af_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> â„±ğ’¢_af<span class="main">:</span>
  <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„±ğ’¢_semantics' af_subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ’¢_af<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ğ’¢ <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢_semantics' af_subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Congruenceâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter_lang_congruent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> af_letter <span class="free">Ï†</span> <span class="free">Î½</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> af_letter <span class="free">Ïˆ</span> <span class="free">Î½</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_lang_equiv_def
  <span class="keyword1"><span class="command">using</span></span> af_letter_build <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> af_lang_congruent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="free">w</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> af <span class="free">Ïˆ</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_lang_equiv_def <span class="keyword1"><span class="command">using</span></span> af_ltl_continuation
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>



<span class="keyword1"><span class="command">lemma</span></span> af_letter_subst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af_letter <span class="free">Ï†</span> <span class="free">Î½</span> <span class="main">=</span> subst <span class="free">Ï†</span> <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> Some <span class="main">(</span>af_letter <span class="bound">Ïˆ</span> <span class="free">Î½</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter_prop_congruent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âŸ¶<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> af_letter <span class="free">Ï†</span> <span class="free">Î½</span> <span class="keyword1">âŸ¶<span class="hidden">â‡©</span><sub>P</sub></span> af_letter <span class="free">Ïˆ</span> <span class="free">Î½</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> af_letter <span class="free">Ï†</span> <span class="free">Î½</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> af_letter <span class="free">Ïˆ</span> <span class="free">Î½</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter_subst subst_respects_ltl_prop_entailment<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_prop_congruent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âŸ¶<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="free">w</span> <span class="keyword1">âŸ¶<span class="hidden">â‡©</span><sub>P</sub></span> af <span class="free">Ïˆ</span> <span class="free">w</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="free">w</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> af <span class="free">Ïˆ</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quoted"><span class="free">Ïˆ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> af_letter_prop_congruent<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> af_letter_const_congruent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> af_letter <span class="free">Ï†</span> <span class="free">Î½</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> af_letter <span class="free">Ïˆ</span> <span class="free">Î½</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter_subst subst_respects_ltl_const_entailment<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_const_congruent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="free">w</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> af <span class="free">Ïˆ</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quoted"><span class="free">Ïˆ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> af_letter_const_congruent<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> af_letter_one_step_back<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">ğ’œ</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> af_letter <span class="bound">x</span> <span class="free">Ïƒ</span><span class="main">}</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="free">ğ’œ</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> af_letter <span class="free">Ï†</span> <span class="free">Ïƒ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Implicationsâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_F_prefix_prop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŸ¶<span class="hidden">â‡©</span><sub>P</sub></span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w'</span> <span class="main">@</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w'</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_implies_def af_decompose<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_G_prefix_prop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w'</span> <span class="main">@</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âŸ¶<span class="hidden">â‡©</span><sub>P</sub></span> af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w'</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_implies_def af_decompose<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">lemma</span></span> af_F_prefix_lang<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">ys</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_F_prefix_prop ltl_prop_implication_implies_ltl_implication <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> af_G_prefix_lang<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_G_prefix_prop ltl_prop_implication_implies_ltl_implication <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> af_F_prefix_const_equiv_true<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w'</span> <span class="main">@</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_F_prefix_prop ltl_const_equiv_implies_prop_equiv<span class="main">(</span>1<span class="main">)</span> ltl_prop_equiv_true_implies_true <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> af_G_prefix_const_equiv_false<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w'</span> <span class="main">@</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_G_prefix_prop ltl_const_equiv_implies_prop_equiv<span class="main">(</span>2<span class="main">)</span> ltl_prop_equiv_false_implied_by_false <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> af_F_prefix_lang_equiv_true<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w'</span> <span class="main">@</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_lang_equiv_def
  <span class="keyword1"><span class="command">using</span></span> af_F_prefix_lang <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> af_G_prefix_lang_equiv_false<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w'</span> <span class="main">@</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_lang_equiv_def
  <span class="keyword1"><span class="command">using</span></span> af_G_prefix_lang <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>



<span class="keyword1"><span class="command">locale</span></span> af_congruent <span class="main">=</span> ltl_equivalence <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    af_letter_congruent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> af_letter <span class="free">Ï†</span> <span class="free">Î½</span> <span class="main"><span class="free">âˆ¼</span></span> af_letter <span class="free">Ïˆ</span> <span class="free">Î½</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_congruentness<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="free">xs</span> <span class="main"><span class="free">âˆ¼</span></span> af <span class="free">Ïˆ</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quoted"><span class="free">Ïˆ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> af_letter_congruent<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_append_congruent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="free">Ï†</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> af <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="free">w'</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="free">w'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af_congruentness<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_append_true<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="free">Ï†</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="free">w'</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_congruentness <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> af_append_false<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="free">Ï†</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="free">w'</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_congruentness <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> prefix_append_subsequence<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">j</span> <span class="main">âŸ¹</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">j</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> prefix <span class="free">j</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_add_diff_inverse subsequence_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_prefix_congruent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">j</span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> af <span class="free">Ïˆ</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">j</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> af <span class="free">Ïˆ</span> <span class="main">(</span>prefix <span class="free">j</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_congruentness foldl_append prefix_append_subsequence<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_prefix_true<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">j</span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">j</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_append_true prefix_append_subsequence<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_prefix_false<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">j</span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">j</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_append_false prefix_append_subsequence<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>




<span class="keyword1"><span class="command">interpretation</span></span> lang_af_congruent<span class="main">:</span> af_congruent <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>L</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">rule</span> af_letter_lang_congruent<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> prop_af_congruent<span class="main">:</span> af_congruent <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>P</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">rule</span> af_letter_prop_congruent<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> const_af_congruent<span class="main">:</span> af_congruent <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>C</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">rule</span> af_letter_const_congruent<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹After in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Î¼LTL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Î½LTL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>â€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_prefix_implies_ltl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltl_lang_equiv_def <span class="keyword1"><span class="command">using</span></span> semantics_ltln.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_ltl_continuation <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_implies_satisfiable_prefix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ¹</span> <span class="main">Â¬</span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_ltl_continuation <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltl_lang_equiv_def <span class="keyword1"><span class="command">using</span></span> semantics_ltln.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Î¼LTL_implies_valid_prefix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True_ltln
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ltl_const_equiv_equivp equivp_reflp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Prop_ltln <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> foldl_Cons foldl_Nil ltl_const_equiv_equivp equivp_reflp semantics_ltln.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsequence_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Nprop_ltln <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> foldl_Cons foldl_Nil ltl_const_equiv_equivp equivp_reflp semantics_ltln.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> subsequence_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">i1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">i2</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="main">(</span><span class="skolem">i1</span> <span class="main">+</span> <span class="skolem">i2</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="main">(</span><span class="skolem">i2</span> <span class="main">+</span> <span class="skolem">i1</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_af_congruent.af_prefix_true le_add1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span><span class="skolem">i1</span> <span class="main">+</span> <span class="skolem">i2</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_decompose <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âˆ¨</span> af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">Ï†</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def add.right_neutral af_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> foldl_Nil foldl_append subsequence_append subsequence_shift subsequence_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">k</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Until_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> const_af_congruent.af_prefix_true le_SucI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_U <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">k</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_def<span class="main">:</span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">j</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Until_ltln Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> const_af_congruent.af_prefix_true le_SucI le_add1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">from</span></span> i_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def const_af_congruent.af_prefix_true le_add2 plus_1_eq_Suc subsequence_shift<span class="main">)</span>

    <span class="keyword1"><span class="command">ultimately</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_U <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span><span class="main">â‰¤</span><span class="skolem">k</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">i1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">i2</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i1</span> <span class="main">+</span> <span class="skolem">i2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i2</span> <span class="main">+</span> <span class="skolem">i1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> const_af_congruent.af_prefix_true le_SucI le_add1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i1</span> <span class="main">+</span> <span class="skolem">i2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_M <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span><span class="main">â‰¤</span><span class="skolem">k</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_def<span class="main">:</span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">j</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> const_af_congruent.af_prefix_true le_SucI le_add1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">from</span></span> i_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def const_af_congruent.af_prefix_true le_add2 plus_1_eq_Suc subsequence_shift<span class="main">)</span>

    <span class="keyword1"><span class="command">ultimately</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_M <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> satisfiable_prefix_implies_Î½LTL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL <span class="main">âŸ¹</span> <span class="main">âˆ„</span><span class="bound">i</span><span class="main">.</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False_ltln
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ltl_const_equiv_equivp equivp_reflp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Prop_ltln <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> foldl_Cons foldl_Nil ltl_const_equiv_equivp equivp_reflp semantics_ltln.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsequence_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Nprop_ltln <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> foldl_Cons foldl_Nil ltl_const_equiv_equivp equivp_reflp semantics_ltln.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> subsequence_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âˆ¨</span> af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">i1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">i2</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="main">(</span><span class="skolem">i1</span> <span class="main">+</span> <span class="skolem">i2</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="main">(</span><span class="skolem">i2</span> <span class="main">+</span> <span class="skolem">i1</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_af_congruent.af_prefix_false le_add1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span><span class="skolem">i1</span> <span class="main">+</span> <span class="skolem">i2</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_decompose <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">Ï†</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def add.right_neutral af_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> foldl_Nil foldl_append subsequence_append subsequence_shift subsequence_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">k</span><span class="main">.</span> <span class="main">Â¬</span> suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> const_af_congruent.af_prefix_false le_SucI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> suffix <span class="skolem">k</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">k</span><span class="main">.</span> <span class="main">Â¬</span> suffix <span class="bound">j</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_def<span class="main">:</span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">j</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltln Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> const_af_congruent.af_prefix_false le_SucI le_add1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">from</span></span> i_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def const_af_congruent.af_prefix_false le_add2 plus_1_eq_Suc subsequence_shift<span class="main">)</span>

    <span class="keyword1"><span class="command">ultimately</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span><span class="main">â‰¤</span><span class="skolem">k</span><span class="main">.</span> <span class="main">Â¬</span> suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">i1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">i2</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i1</span> <span class="main">+</span> <span class="skolem">i2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i2</span> <span class="main">+</span> <span class="skolem">i1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> const_af_congruent.af_prefix_false le_SucI le_add1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i1</span> <span class="main">+</span> <span class="skolem">i2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_W <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> suffix <span class="skolem">k</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span><span class="main">â‰¤</span><span class="skolem">k</span><span class="main">.</span> <span class="main">Â¬</span> suffix <span class="bound">j</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_def<span class="main">:</span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">j</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> const_af_congruent.af_prefix_false le_SucI le_add1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">from</span></span> i_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def const_af_congruent.af_prefix_false le_add2 plus_1_eq_Suc subsequence_shift<span class="main">)</span>

    <span class="keyword1"><span class="command">ultimately</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_W <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">context</span></span> ltl_equivalence
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_prefix_implies_ltl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_prefix_implies_ltl eq_implies_lang <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_implies_satisfiable_prefix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ¹</span> <span class="main">Â¬</span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_implies_satisfiable_prefix eq_implies_lang <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> Î¼LTL_implies_valid_prefix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Î¼LTL_implies_valid_prefix const_implies_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> satisfiable_prefix_implies_Î½LTL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL <span class="main">âŸ¹</span> <span class="main">âˆ„</span><span class="bound">i</span><span class="main">.</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> satisfiable_prefix_implies_Î½LTL const_implies_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> af_Î¼LTL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_prefix_implies_ltl Î¼LTL_implies_valid_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> af_Î½LTL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">Â¬</span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_implies_satisfiable_prefix satisfiable_prefix_implies_Î½LTL <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> af_Î¼LTL_GF<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="bound">i</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span>prefix <span class="bound">j</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_Î¼LTL<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">â€¹<span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTLâ€º</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_add_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="bound">i</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subsequence_prefix_suffix <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_Î½LTL_FG<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">j</span><span class="main">.</span> <span class="main">Â¬</span> <span class="main">(</span>af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="bound">i</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">j</span><span class="main">.</span> <span class="main">Â¬</span> <span class="main">(</span>af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span>prefix <span class="bound">j</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_Î½LTL<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">â€¹<span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTLâ€º</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">j</span><span class="main">.</span> <span class="main">Â¬</span> <span class="main">(</span>af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_add_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">j</span><span class="main">.</span> <span class="main">Â¬</span> <span class="main">(</span>af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="bound">i</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subsequence_prefix_suffix <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹Bring Propositional Equivalence into scopeâ€º</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> af_congruent <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>P</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">rule</span> af_letter_prop_congruent<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Advice">
<div class="head">
<h1>Theory Advice</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    Author:   Salomon Sickert
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Advice functionsâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> Advice
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../LTL/LTL.html">LTL.LTL</a> <a href="../LTL/Equivalence_Relations.html">LTL.Equivalence_Relations</a>
  <a href="Syntactic_Fragments_and_Stability.html">Syntactic_Fragments_and_Stability</a> <a href="After.html">After</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹The GF and FG Advice Functionsâ€º</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">GF_advice</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span> <span class="main">[</span>90<span class="main">,</span>60<span class="main">]</span> 89<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span> <span class="main">=</span> <span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main"><span class="free">[</span></span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">FG_advice</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span> <span class="main">[</span>90<span class="main">,</span>60<span class="main">]</span> 89<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span> <span class="main">=</span> <span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="keyword1">then</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="keyword1">then</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main"><span class="free">[</span></span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î¼</sub></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_Î½LTL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âˆˆ</span> Î½LTL"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">=</span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_Î¼LTL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âˆˆ</span> Î¼LTL"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">=</span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> GF_advice_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subfrmlsn <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subfrmlsn <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_subfrmlsn_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>subfrmlsn <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>subfrmlsn <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subfrmlsn_finite GF_advice_subfrmlsn card_mono<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_mem_eq card_image_le image_Collect subfrmlsn_finite<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_subfrmlsn_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>subfrmlsn <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>subfrmlsn <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subfrmlsn_finite FG_advice_subfrmlsn card_mono<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_mem_eq card_image_le image_Collect subfrmlsn_finite<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_monotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> <span class="free">Y</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_monotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> <span class="free">Y</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†</span> <span class="skolem">Ïˆ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_ite_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_ite_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Advice Functions on Nested Propositionsâ€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> nested_prop_atoms <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> nested_prop_atoms <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_def nested_prop_atoms_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub>_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub>_def nested_prop_atoms_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">(</span>nested_prop_atoms <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_mem_eq card_image_le image_Collect nested_prop_atoms_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub>_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">(</span>nested_prop_atoms <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub>_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_mem_eq card_image_le image_Collect nested_prop_atoms_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">unfold</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">unfold</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ï†</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ïˆ</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub>_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ï†</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="free">Y</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ïˆ</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_nested_prop_atoms_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">(</span>nested_prop_atoms <span class="free">Ï†</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_finite GF_advice_nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> card_mono<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_card le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_nested_prop_atoms_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">(</span>nested_prop_atoms <span class="free">Ï†</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub>_finite FG_advice_nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub> card_mono<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î¼</sub>_card le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Intersecting the Advice Setâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_inter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âˆ©</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âŠ†</span> <span class="free">S</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span> <span class="main">âˆ©</span> <span class="free">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">=</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_inter_subformulas<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span><span class="main">[</span><span class="free">X</span> <span class="main">âˆ©</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">=</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> GF_advice_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_minus_subformulas<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆ‰</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">Ïˆ</span><span class="main">}</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">=</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆ‰</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> <span class="free">X</span> <span class="main">âŠ†</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">Ïˆ</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span><span class="main">[</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">Ïˆ</span><span class="main">}</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">=</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice_inter Diff_subset Int_absorb1 inf.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_minus_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span>size <span class="free">Ï†</span> <span class="main">â‰¤</span> size <span class="free">Ïˆ</span><span class="main">;</span> <span class="free">Ï†</span> <span class="main">â‰ </span> <span class="free">Ïˆ</span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">Ïˆ</span><span class="main">}</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">=</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subfrmlsn_size subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn GF_advice_minus_subformulas
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1"><span class="command">lemma</span></span> FG_advice_inter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">âˆ©</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âŠ†</span> <span class="free">S</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span> <span class="main">âˆ©</span> <span class="free">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">=</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_inter_subformulas<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span> <span class="main">âˆ©</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">=</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FG_advice_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_minus_subformulas<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆ‰</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span> <span class="main">-</span> <span class="main">{</span><span class="free">Ïˆ</span><span class="main">}</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">=</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆ‰</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> <span class="free">Y</span> <span class="main">âŠ†</span> <span class="free">Y</span> <span class="main">-</span> <span class="main">{</span><span class="free">Ïˆ</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span> <span class="main">-</span> <span class="main">{</span><span class="free">Ïˆ</span><span class="main">}</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>  <span class="main">=</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FG_advice_inter Diff_subset Int_absorb1 inf.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_minus_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span>size <span class="free">Ï†</span> <span class="main">â‰¤</span> size <span class="free">Ïˆ</span><span class="main">;</span> <span class="free">Ï†</span> <span class="main">â‰ </span> <span class="free">Ïˆ</span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span> <span class="main">-</span> <span class="main">{</span><span class="free">Ïˆ</span><span class="main">}</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">=</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subfrmlsn_size subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn FG_advice_minus_subformulas
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_insert<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span><span class="free">Ïˆ</span> <span class="main">âˆ‰</span> <span class="free">Y</span><span class="main">;</span> size <span class="free">Ï†</span> <span class="main">&lt;</span> size <span class="free">Ïˆ</span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span>insert <span class="free">Ïˆ</span> <span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">=</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FG_advice_minus_size Diff_insert_absorb less_imp_le neq_iff<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Correctness GF-advice functionâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_a1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span>â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> <span class="free">X</span><span class="main">;</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">Ï†</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> â„±_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"â„± <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">âŠ†</span> â„± <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"â„± <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">âŠ†</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Until_ltln.prems ltln_strong_to_weak <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Until_ltln.IH
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> â„±_suffix subset_trans sup.boundedE<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Until_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> â„± <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Until_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> â„±_suffix subset_trans sup.boundedE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> â„±_suffix subset_trans sup.boundedE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"â„± <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">âŠ†</span> â„± <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"â„± <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">âŠ†</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln.prems ltln_strong_to_weak <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln.IH
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> â„±_suffix subset_trans sup.boundedE<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> â„± <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_a2_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span><span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">X</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">;</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">Ï†</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> GF_advice.simps semantics_ltln.simps<span class="main">(</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> GF_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ccontr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Until_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Until_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†1</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†2</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> GF_advice.simps <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">X</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> GF_advice.simps semantics_ltln.simps<span class="main">(</span>10<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_suffix Until_ltln.IH Until_ltln.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ltln_weak_to_strong <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> GF_advice.simps semantics_ltln.simps<span class="main">(</span>9<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_suffix Release_ltln.IH Release_ltln.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> GF_advice.simps semantics_ltln.simps<span class="main">(</span>10<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ccontr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†1</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†2</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> GF_advice.simps <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">X</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> GF_advice.simps semantics_ltln.simps<span class="main">(</span>9<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_suffix StrongRelease_ltln.IH StrongRelease_ltln.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ltln_weak_to_strong <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_a2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span><span class="free">X</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span><span class="main">;</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice_a2_helper ğ’¢â„±_elim subset_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_a3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span><span class="free">X</span> <span class="main">=</span> â„± <span class="free">Ï†</span> <span class="free">w</span><span class="main">;</span> <span class="free">X</span> <span class="main">=</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> GF_advice_a1 GF_advice_a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Correctness FG-advice functionâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_b1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span>â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> <span class="free">Y</span><span class="main">;</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">Ï†</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> â„±ğ’¢_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> â„±ğ’¢_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">Y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆ‰</span> â„±ğ’¢ <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltln.prems ltln_weak_to_strong <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">âŠ†</span> <span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltln.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> â„±ğ’¢_suffix<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">Y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆ‰</span> â„±ğ’¢ <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln.prems ltln_weak_to_strong <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">âŠ†</span> <span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> â„±ğ’¢_suffix<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> â„±ğ’¢_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_b2_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span><span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">Y</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">;</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> suffix_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">Y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†1</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†2</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltln
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> suffix_suffix<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ltln_strong_to_weak <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">Y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†1</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†2</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> suffix_suffix<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ltln_strong_to_weak <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> suffix_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_b2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span><span class="free">Y</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="main">;</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FG_advice_b2_helper ğ’¢_elim subset_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_b3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span><span class="free">Y</span> <span class="main">=</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="main">;</span> <span class="free">Y</span> <span class="main">=</span> ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FG_advice_b1 FG_advice_b2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Advice Functions and the ``after'' Functionâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_af_letter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af_letter <span class="free">Ï†</span> <span class="free">x</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af_letter <span class="main">(</span><span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_letter_build <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Until_ltln.IH af_letter_build <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af_letter <span class="main">(</span><span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_letter_build <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Release_ltln.IH af_letter_build <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af_letter <span class="main">(</span><span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_letter_build <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln.IH af_letter_build <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af_letter <span class="main">(</span><span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_letter_build <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln.IH af_letter_build <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_af_letter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af_letter <span class="free">Ï†</span> <span class="free">x</span><span class="main">)</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âŸ¹</span> <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Prop_ltln <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> semantics_ltln.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_letter.simps FG_advice.simps semantics_ltln.simps<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> af_letter_build <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af_letter <span class="skolem">Ï†2</span> <span class="free">x</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">Y</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_letter.simps FG_advice.simps semantics_ltln.simps<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> af_letter_build  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af_letter <span class="skolem">Ï†1</span> <span class="free">x</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> af_letter.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span> <span class="main">âˆˆ</span> <span class="free">Y</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_letter.simps FG_advice.simps semantics_ltln.simps<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> af_letter_build  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af_letter <span class="skolem">Ï†2</span> <span class="free">x</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> af_letter.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_letter.simps FG_advice.simps semantics_ltln.simps<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> af_letter_build <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af_letter <span class="skolem">Ï†1</span> <span class="free">x</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_af<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">âŒ¢</span> <span class="free">w'</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âŸ¹</span> <span class="free">w'</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> GF_advice_af_letter<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_af<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w'</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âŸ¹</span> <span class="main">(</span><span class="free">w</span> <span class="main">âŒ¢</span> <span class="free">w'</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> FG_advice_af_letter<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_af_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âŸ¹</span> suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> GF_advice_af <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_af_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FG_advice_af <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="comment1">(* TODO move to Omega_Words_Fun.thy ?? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> prefix_suffix_subsequence<span class="main">:</span> <span class="quoted"><span class="quoted">"prefix <span class="free">i</span> <span class="main">(</span>suffix <span class="free">j</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">j</span> <span class="main">â†’</span> <span class="free">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹We show this generic lemma to prove the following theorems:â€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_sync<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">index</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">â‡’</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">formula</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="main">(</span><span class="free">index</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">formula</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">index</span> <span class="bound">i</span> <span class="main">â†’</span> <span class="main">(</span><span class="free">index</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="bound">k</span> <span class="main">â‰¥</span> <span class="free">index</span> <span class="bound">i</span> <span class="main">âˆ§</span> suffix <span class="bound">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">formula</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">index</span> <span class="bound">i</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="keyword2"><span class="keyword">where</span></span> leq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">âŸ¹</span> <span class="skolem">k1</span> <span class="main">â‰¥</span> <span class="free">index</span> <span class="bound">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> suffix1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">âŸ¹</span> suffix <span class="skolem">k1</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">formula</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">(</span><span class="free">index</span> <span class="bound">i</span><span class="main">)</span> <span class="main">â†’</span> <span class="skolem">k1</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc less_SucI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> leq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">â‰¥</span> <span class="free">index</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> suffix2<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k2</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">formula</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">index</span> <span class="skolem">n</span> <span class="main">â†’</span> <span class="skolem">k2</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_add1 Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">â‰¡</span> <span class="skolem">k1</span> <span class="main">+</span> <span class="skolem">k2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span> <span class="main">âŸ¹</span> <span class="skolem">k</span> <span class="main">â‰¥</span> <span class="free">index</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leq1 leq2 less_SucE trans_le_add1 trans_le_add2<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">âŸ¹</span> suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">formula</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">(</span><span class="free">index</span> <span class="bound">i</span><span class="main">)</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> k_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice_af_2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> suffix1<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> suffix_suffix prefix_suffix_subsequence<span class="main"><span class="main">]</span></span> af_subsequence_append leq1 add.commute le_add1<span class="main">)</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">formula</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">index</span> <span class="skolem">n</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> k_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice_af_2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> suffix2<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> suffix_suffix prefix_suffix_subsequence<span class="main"><span class="main">]</span></span> af_subsequence_append leq2 add.commute le_add1<span class="main">)</span>

    <span class="keyword1"><span class="command">ultimately</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">â‰¤</span> <span class="skolem">n</span> <span class="main">âŸ¹</span> suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">formula</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">(</span><span class="free">index</span> <span class="bound">i</span><span class="main">)</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nat_less_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_Suc_eq_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_sync_and<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ïˆ</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âˆ§</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ïˆ</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?formula</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">Î»</span><span class="bound">i</span> <span class="main">::</span> nat<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">Ï†</span> <span class="keyword1">else</span> <span class="free">Ïˆ</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="var">?formula</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span> <span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">âŸ¹</span> suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">Ï†</span> <span class="keyword1">else</span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span>prefix <span class="skolem">k</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_sync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">Î»</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">w</span></span> <span class="var"><span class="quoted"><span class="var">?formula</span></span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> k_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> k_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_sync_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">i</span> <span class="main">â†’</span> <span class="bound">j</span> <span class="main">+</span> <span class="bound">i</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">n</span> <span class="main">â†’</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound"><span class="bound">k</span></span> <span class="main">â‰¥</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> suffix <span class="bound">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">âˆ§</span> suffix <span class="bound">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">n</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?index</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">Î»</span><span class="bound">i</span><span class="main">.</span> min <span class="bound">i</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?formula</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">Î»</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">Ï†</span> <span class="keyword1">else</span> <span class="free">Ïˆ</span>"</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> min_def<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="skolem">i</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="main">(</span><span class="var">?index</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="var">?formula</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="var">?index</span> <span class="skolem">i</span> <span class="main">â†’</span> <span class="main">(</span><span class="var">?index</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> min_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span>â€º</span></span> add.commute  less_SucE<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span> <span class="main">âŸ¹</span> min <span class="bound">i</span> <span class="free">n</span> <span class="main">â‰¤</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> suffix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span> <span class="main">âŸ¹</span> suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">Ï†</span> <span class="keyword1">else</span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span>min <span class="bound">i</span> <span class="free">n</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_sync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?index</span></span></span> <span class="quoted"><span class="free">w</span></span> <span class="var"><span class="quoted"><span class="var">?formula</span></span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suffix <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> less_SucI min.strict_order_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">n</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suffix<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">â‰¥</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_sync_lesseq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">â‰¤</span> <span class="free">n</span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">i</span> <span class="main">â†’</span> <span class="bound">j</span> <span class="main">+</span> <span class="bound">i</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">n</span> <span class="main">â†’</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound"><span class="bound">k</span></span> <span class="main">â‰¥</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span> <span class="main">â‰¤</span> <span class="free">n</span><span class="main">.</span> suffix <span class="bound">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">âˆ§</span> suffix <span class="bound">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">n</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?index</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">Î»</span><span class="bound">i</span><span class="main">.</span> min <span class="bound">i</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?formula</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">Î»</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">i</span> <span class="main">â‰¤</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">Ï†</span> <span class="keyword1">else</span> <span class="free">Ïˆ</span>"</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="main">(</span><span class="var">?index</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="var">?formula</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="var">?index</span> <span class="skolem">i</span> <span class="main">â†’</span> <span class="main">(</span><span class="var">?index</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> min_def<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="skolem">i</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> min_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc_leI Suc_le_mono True add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>â€º</span></span> less_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> min_def<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="skolem">i</span> <span class="free">n</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> False
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">â‰¤</span> Suc <span class="free">n</span> <span class="main">âŸ¹</span> min <span class="bound">i</span> <span class="free">n</span> <span class="main">â‰¤</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> suffix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span> <span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">âŸ¹</span> suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">â‰¤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">Ï†</span> <span class="keyword1">else</span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span>min <span class="bound">i</span> <span class="free">n</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_sync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?index</span></span></span> <span class="quoted"><span class="free">w</span></span> <span class="var"><span class="quoted"><span class="var">?formula</span></span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> less_Suc_eq min_le_iff_disj<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span> <span class="main">â‰¤</span> <span class="free">n</span><span class="main">.</span> suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suffix <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> le_SucI less_Suc_eq_le min.orderE<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">n</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suffix<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">â‰¥</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_U_GF_advice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">âŸ¹</span> suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">n</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_af_2<span class="main">[</span><span class="operator">OF</span> A<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> GF_advice.simps af_subsequence_U semantics_ltln.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> zero_less_Suc<span class="main">,</span> <span class="operator">THEN</span> GF_advice_af_2<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> Suc.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">1</span> <span class="skolem">w</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">]</span> Suc.prems
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B One_nat_def Suc_le_mono Suc_mono plus_1_eq_Suc subsequence_shift<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_U semantics_ltln.simps GF_advice.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_M_GF_advice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">â‰¤</span> <span class="free">i</span> <span class="main">âŸ¹</span> suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">n</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_af_2<span class="main">[</span><span class="operator">OF</span> A<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_af_2<span class="main">[</span><span class="operator">OF</span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_M GF_advice.simps semantics_ltln.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">1</span> <span class="main">(</span>suffix <span class="skolem">n</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span>prefix <span class="skolem">n</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>suffix <span class="skolem">n</span> <span class="skolem">w</span> <span class="main">0</span><span class="main">]</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> GF_advice_af_2 Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> plus_1_eq_Suc subsequence_singleton suffix_0 suffix_suffix zero_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> GF_advice_af_2<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> Suc.IH<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"suffix <span class="main">1</span> <span class="skolem">w</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> subsequence_shift suffix_suffix<span class="main">]</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B One_nat_def Suc_le_mono plus_1_eq_Suc Suc.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_M semantics_ltln.simps GF_advice.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_R_GF_advice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">â‰¤</span> <span class="free">i</span> <span class="main">âŸ¹</span> suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">n</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_af_2<span class="main">[</span><span class="operator">OF</span> A<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_af_2<span class="main">[</span><span class="operator">OF</span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_R GF_advice.simps semantics_ltln.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">1</span> <span class="main">(</span>suffix <span class="skolem">n</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span>prefix <span class="skolem">n</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>suffix <span class="skolem">n</span> <span class="skolem">w</span> <span class="main">0</span><span class="main">]</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> GF_advice_af_2 Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> plus_1_eq_Suc subsequence_singleton suffix_0 suffix_suffix zero_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> GF_advice_af_2<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> Suc.IH<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"suffix <span class="main">1</span> <span class="skolem">w</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> subsequence_shift suffix_suffix<span class="main">]</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B One_nat_def Suc_le_mono plus_1_eq_Suc Suc.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_R semantics_ltln.simps GF_advice.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_W_GF_advice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">âŸ¹</span> suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">n</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_af_2<span class="main">[</span><span class="operator">OF</span> A<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_W GF_advice.simps semantics_ltln.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> zero_less_Suc<span class="main">,</span> <span class="operator">THEN</span> GF_advice_af_2<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> Suc.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">1</span> <span class="skolem">w</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">]</span> Suc.prems
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B One_nat_def Suc_le_mono Suc_mono plus_1_eq_Suc subsequence_shift<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_W <span class="keyword1"><span class="command">unfolding</span></span> semantics_ltln.simps GF_advice.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_R_GF_advice_connect<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">â‰¤</span> <span class="free">i</span> <span class="main">âŸ¹</span> suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">n</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_af_2<span class="main">[</span><span class="operator">OF</span> A<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_af_2<span class="main">[</span><span class="operator">OF</span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_R GF_advice.simps semantics_ltln.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">1</span> <span class="main">(</span>suffix <span class="skolem">n</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span>prefix <span class="skolem">n</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>suffix <span class="skolem">n</span> <span class="skolem">w</span> <span class="main">0</span><span class="main">]</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> GF_advice_af_2 Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> plus_1_eq_Suc subsequence_singleton suffix_0 suffix_suffix zero_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ïˆ</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> GF_advice_af_2<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> Suc.IH<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"suffix <span class="main">1</span> <span class="skolem">w</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> subsequence_shift suffix_suffix<span class="main">]</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B One_nat_def Suc_le_mono plus_1_eq_Suc Suc.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_R semantics_ltln.simps GF_advice.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_subsequence_W_GF_advice_connect<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">âŸ¹</span> suffix <span class="free">n</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af_letter <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span>prefix <span class="skolem">n</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> GF_advice_af_letter<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">=</span> prefix <span class="skolem">n</span> <span class="skolem">w</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subseq_to_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> foldl.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> foldl.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> foldl_append<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> zero_less_Suc<span class="main">,</span> <span class="operator">THEN</span> GF_advice_af_2<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">note</span></span> Suc.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">1</span> <span class="skolem">w</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix<span class="main">]</span> Suc.prems
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="main">1</span> <span class="main">â†’</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B One_nat_def Suc_le_mono Suc_mono plus_1_eq_Suc subsequence_shift<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_subsequence_W <span class="keyword1"><span class="command">unfolding</span></span> semantics_ltln.simps GF_advice.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Advice Functions and Propositional Entailmentâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_prop_entailment<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ğ’œ</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âŸ¹</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âˆˆ</span> <span class="free">ğ’œ</span><span class="main">}</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âˆ‰</span> <span class="free">ğ’œ</span> <span class="main">âŸ¹</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âˆˆ</span> <span class="free">ğ’œ</span><span class="main">}</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span> <span class="main">âŸ¹</span> <span class="free">ğ’œ</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_iff_prop_entailment<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âˆ‰</span> <span class="free">ğ’œ</span> <span class="main">âŸ¹</span> <span class="free">ğ’œ</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âŸ·</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âˆˆ</span> <span class="free">ğ’œ</span><span class="main">}</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice_prop_entailment<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_prop_entailment<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âˆˆ</span> <span class="free">ğ’œ</span> <span class="main">âŸ¹</span> <span class="free">ğ’œ</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âŸ¹</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âˆˆ</span> <span class="free">ğ’œ</span><span class="main">}</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âˆˆ</span> <span class="free">ğ’œ</span><span class="main">}</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span> <span class="main">âŸ¹</span> <span class="free">ğ’œ</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_iff_prop_entailment<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âˆˆ</span> <span class="free">ğ’œ</span> <span class="main">âŸ¹</span> <span class="free">ğ’œ</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âŸ·</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âˆˆ</span> <span class="free">ğ’œ</span><span class="main">}</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FG_advice_prop_entailment<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_subst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">=</span> subst <span class="free">Ï†</span> <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> Some <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_subst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">=</span> subst <span class="free">Ï†</span> <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> Some <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_prop_congruent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âŸ¶<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="keyword1">âŸ¶<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice_subst subst_respects_ltl_prop_entailment<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_prop_congruent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âŸ¶<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="keyword1">âŸ¶<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FG_advice_subst subst_respects_ltl_prop_entailment<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹GF-advice with Equivalence Relationsâ€º</span></span>

<span class="keyword1"><span class="command">locale</span></span> GF_advice_congruent <span class="main">=</span> ltl_equivalence <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">normalise</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    normalise_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="free">normalise</span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    normalise_monotonic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    normalise_eventually_equivalent<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âŸ¹</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    GF_advice_congruent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main"><span class="free">âˆ¼</span></span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ïˆ</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> normalise_language_equivalent<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">normalise</span> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> normalise_eq ltl_lang_equiv_def eq_implies_lang <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> prop_GF_advice_compatible<span class="main">:</span> GF_advice_congruent <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>P</sub>)</span>"</span></span> <span class="quoted"><span class="quoted">"id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GF_advice_af GF_advice_prop_congruent<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Master_Theorem">
<div class="head">
<h1>Theory Master_Theorem</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹The Master Theoremâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> Master_Theorem
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Advice.html">Advice</a> <a href="After.html">After</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Checking <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">X</span></span> <span class="main"><span class="main">âŠ†</span></span> ğ’¢â„± <span class="free"><span class="free">Ï†</span></span> <span class="free"><span class="free">w</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Y</span></span> <span class="main"><span class="main">âŠ†</span></span> â„±ğ’¢ <span class="free"><span class="free">Ï†</span></span> <span class="free"><span class="free">w</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>â€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> X_ğ’¢â„±_Y_â„±ğ’¢<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    X_Î¼<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    Y_Î½<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    X_GF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">X</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    Y_FG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">Y</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âˆ§</span> <span class="free">Y</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">â€• â€¹Custom induction rule with <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">size</span><span class="antiquote">}</span></span> as a partial orderâ€º</span>
  <span class="keyword1"><span class="command">note</span></span> induct <span class="main">=</span> finite_ranking_induct<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted">size</span><span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">X</span> <span class="main">âˆª</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_finite subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_finite X_Î¼ Y_Î½ finite_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âˆª</span> <span class="free">Y</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">Ïˆ</span> <span class="skolem">S</span><span class="main">)</span>

    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> insert<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> insert_S <span class="main">=</span> <span class="quoted"><span class="quoted">â€¹insert <span class="skolem">Ïˆ</span> <span class="skolem">S</span> <span class="main">=</span> <span class="skolem">X</span> <span class="main">âˆª</span> <span class="skolem">Y</span>â€º</span></span>
    <span class="keyword1"><span class="command">note</span></span> X_Î¼ <span class="main">=</span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="skolem">Ï†</span>â€º</span></span>
    <span class="keyword1"><span class="command">note</span></span> Y_Î½ <span class="main">=</span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="skolem">Ï†</span>â€º</span></span>
    <span class="keyword1"><span class="command">note</span></span> X_GF <span class="main">=</span> <span class="quoted"><span class="quoted">â€¹<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">X</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="skolem">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>â€º</span></span>
    <span class="keyword1"><span class="command">note</span></span> Y_FG <span class="main">=</span> <span class="quoted"><span class="quoted">â€¹<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">Y</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="skolem">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>â€º</span></span>

    <span class="keyword1"><span class="command">from</span></span> X_Î¼ Y_Î½ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">âˆ©</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="hidden">â‡©</span><sub>Î½</sub>_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

    <span class="keyword1"><span class="command">from</span></span> insert_S X_Î¼ Y_Î½ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="skolem">Ï†</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">S</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">X</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">X</span>"</span></span>

      <span class="keyword1"><span class="command">{</span></span>
        <span class="comment1">â€• â€¹Show <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Ïˆ</span><span class="main">}</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="skolem">Ï†</span> <span class="free">w</span>"</span><span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">Y</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="skolem">Ï†</span> <span class="free">w</span>"</span><span class="antiquote">}</span></span>â€º</span>

        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">X</span> <span class="main">âˆ©</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">{}</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Ïˆ</span><span class="main">}</span><span class="main">)</span> <span class="main">âˆª</span> <span class="skolem">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> insert_S <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">S</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ'</span> <span class="main">âˆˆ</span> <span class="skolem">Y</span><span class="main">.</span> <span class="bound">Ïˆ'</span><span class="main">[</span><span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Ïˆ</span><span class="main">}</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">=</span> <span class="bound">Ïˆ'</span><span class="main">[</span><span class="skolem">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> GF_advice_minus_size insert<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">Y</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Ïˆ</span><span class="main">}</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="skolem">Ï†</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="skolem">Ï†</span> <span class="free">w</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Ïˆ</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">Y</span></span> <span class="quoted"><span class="skolem">Ï†</span></span><span class="main">]</span> X_Î¼ Y_Î½ X_GF Y_FG <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>

      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command">{</span></span>
        <span class="comment1">â€• â€¹Show <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> ğ’¢â„± <span class="skolem">Ï†</span> <span class="free">w</span>"</span><span class="antiquote">}</span></span>â€º</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="skolem">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> X_GF <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">X</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="skolem">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> GF_Inf_many <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command">from</span></span> Y_Î½ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_finite finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ï†</span> <span class="main">âˆˆ</span> <span class="skolem">Y</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ï†</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Y</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="skolem">Ï†</span> <span class="free">w</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> â„±ğ’¢_elim<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ï†</span> <span class="main">âˆˆ</span> <span class="skolem">Y</span><span class="main">.</span> <span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ï†</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> FG_suffix_G <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">Ï†</span> <span class="main">âˆˆ</span> <span class="skolem">Y</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ï†</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹finite <span class="skolem">Y</span>â€º</span></span> eventually_ball_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

        <span class="keyword1"><span class="command">ultimately</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="skolem">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âˆ§</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">Ï†</span> <span class="main">âˆˆ</span> <span class="skolem">Y</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ï†</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> INFM_conjI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> frequently_elim1<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> FG_advice_b2_helper<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> GF_Inf_many <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> ğ’¢â„± <span class="skolem">Ï†</span> <span class="free">w</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢â„±_semantics <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">X</span>â€º</span></span> X_Î¼ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>

      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

      <span class="keyword1"><span class="command">{</span></span>
        <span class="comment1">â€• â€¹Show <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">X</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="skolem">Ï†</span> <span class="free">w</span>"</span><span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Ïˆ</span><span class="main">}</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="skolem">Ï†</span> <span class="free">w</span>"</span><span class="antiquote">}</span></span>â€º</span>

        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">âˆ©</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> insert <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">X</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="skolem">X</span> <span class="main">âˆª</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Ïˆ</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> insert_S <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">S</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ'</span> <span class="main">âˆˆ</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">Ïˆ'</span><span class="main">[</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Ïˆ</span><span class="main">}</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">=</span> <span class="bound">Ïˆ'</span><span class="main">[</span><span class="skolem">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> FG_advice_minus_size insert<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">X</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="skolem">Ï†</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Ïˆ</span><span class="main">}</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="skolem">Ï†</span> <span class="free">w</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Ïˆ</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">Ï†</span></span><span class="main">]</span> X_Î¼ Y_Î½ X_GF Y_FG <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>

      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command">{</span></span>
        <span class="comment1">â€• â€¹Show <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> â„±ğ’¢ <span class="skolem">Ï†</span> <span class="free">w</span>"</span><span class="antiquote">}</span></span>â€º</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="skolem">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Y_FG <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">Y</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="skolem">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> FG_Alm_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ï†</span> <span class="main">âˆˆ</span> <span class="skolem">X</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ï†</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">X</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="skolem">Ï†</span> <span class="free">w</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ğ’¢â„±_elim<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">Ï†</span> <span class="main">âˆˆ</span> <span class="skolem">X</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ï†</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">ultimately</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="skolem">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âˆ§</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">Ï†</span> <span class="main">âˆˆ</span> <span class="skolem">X</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> MOST_conjI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> MOST_mono<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> GF_advice_a2_helper<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> FG_Alm_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> â„±ğ’¢ <span class="skolem">Ï†</span> <span class="free">w</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> â„±ğ’¢_semantics <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">Y</span>â€º</span></span> Y_Î½ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>

      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> <span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="skolem">X</span> <span class="main">âˆª</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ğ’¢â„±_implies_GF<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span>â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ğ’¢â„±_elim GF_Inf_many <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span>â€º</span></span> ğ’¢â„±_subfrmlsn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span> <span class="bound">w</span><span class="main">.</span> â„±ğ’¢ <span class="skolem">Ïˆ</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="bound">w</span><span class="main">)</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="bound">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> â„±ğ’¢_suffix â„±ğ’¢_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span>â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> frequently_elim1<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> FG_advice_b1<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span>â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> GF_Inf_many <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> â„±ğ’¢_implies_FG<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span>ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> â„±ğ’¢_elim FG_Alm_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>â€º</span></span> â„±ğ’¢_subfrmlsn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> ğ’¢â„± <span class="skolem">Ïˆ</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> â„± <span class="skolem">Ïˆ</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> suffix_Î¼_stable <span class="keyword1"><span class="command">unfolding</span></span> Î¼_stable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> â„± <span class="skolem">Ïˆ</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> MOST_nat_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ğ’¢â„±_subset ğ’¢â„±_suffix<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> â„± <span class="skolem">Ïˆ</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âˆ§</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_conj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€<span class="hidden">â‡©</span><sub>âˆ</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span>ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span>ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> FG_Alm_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Putting the pieces together: The Master Theoremâ€º</span></span>

<span class="keyword1"><span class="command">theorem</span></span> master_theorem_ltr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Y</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">X</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">Y</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ğ’¢â„±_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> â„±ğ’¢_subformulas<span class="hidden">â‡©</span><sub>Î½</sub><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> â„± <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suffix_Î¼_stable <span class="keyword1"><span class="command">unfolding</span></span> MOST_nat Î¼_stable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"â„± <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ğ’¢â„±_af â„±_af ğ’¢â„±_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_ltl_continuation <span class="quoted"><span class="quoted">â€¹<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span>ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span>â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ğ’¢â„±_implies_GF<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span>ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> â„±ğ’¢_implies_FG<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> master_theorem_rtl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">X</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free">Y</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X_ğ’¢â„±_Y_â„±ğ’¢ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> ğ’¢â„± <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ğ’¢â„±_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_a2 ğ’¢â„±_af <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_ltl_continuation <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> master_theorem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span>
    <span class="main">(</span><span class="main">âˆƒ</span><span class="bound"><span class="bound">X</span></span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">.</span>
      <span class="main">(</span><span class="main">âˆƒ</span><span class="bound"><span class="bound">Y</span></span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">.</span>
        <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="bound">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>
        <span class="main">âˆ§</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="bound">X</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="bound">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span>
        <span class="main">âˆ§</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="bound">Y</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="bound">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> master_theorem_ltr master_theorem_rtl<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹The Master Theorem on Languagesâ€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">â‡©</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="bound">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="bound">w</span><span class="main">)</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">â‡©</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="bound">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">â‡©</span><sub>3</sub></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">.</span> <span class="bound">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> master_theorem_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"language_ltln <span class="free">Ï†</span> <span class="main">=</span> <span class="main">â‹ƒ</span> <span class="main">{</span>L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="bound">X</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="bound">X</span> <span class="bound">Y</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="bound">X</span> <span class="bound">Y</span> <span class="main">|</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ§</span> <span class="bound">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> language_ltln <span class="free">Ï†</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> language_ltln_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="skolem">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">X</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="skolem">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">Y</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="skolem">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> master_theorem_ltr <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> L<span class="hidden">â‡©</span><sub>1</sub>_def L<span class="hidden">â‡©</span><sub>2</sub>_def L<span class="hidden">â‡©</span><sub>3</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> <span class="main">â‹ƒ</span> <span class="main">{</span>L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="bound">X</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="bound">X</span> <span class="bound">Y</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="bound">X</span> <span class="bound">Y</span> <span class="main">|</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ§</span> <span class="bound">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>â€º</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> language_ltln <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> language_ltln_def L<span class="hidden">â‡©</span><sub>1</sub>_def L<span class="hidden">â‡©</span><sub>2</sub>_def L<span class="hidden">â‡©</span><sub>3</sub>_def
    <span class="keyword1"><span class="command">using</span></span> master_theorem_rtl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Asymmetric_Master_Theorem">
<div class="head">
<h1>Theory Asymmetric_Master_Theorem</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Asymmetric Variant of the Master Theoremâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> Asymmetric_Master_Theorem
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Advice.html">Advice</a> <a href="After.html">After</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹This variant of the Master Theorem fixes only a subset <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Y</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
      of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Î½LTL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> subformulas and all conditions depend on the
      index <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. While this does not lead to a simple DRA construction,
      but can be used to build NBAs and LDBAs.â€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_b1_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŸ¹</span> suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">[</span>â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ïˆ</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŠ†</span> â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> â„±ğ’¢_suffix subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset <span class="keyword1"><span class="command">unfolding</span></span> â„±ğ’¢_semantics' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span>"</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">[</span>â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FG_advice_b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FG_advice_b2_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŸ¹</span> <span class="free">i</span> <span class="main">â‰¤</span> <span class="free">j</span> <span class="main">âŸ¹</span> suffix <span class="free">j</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">[</span><span class="free">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">âŸ¹</span> suffix <span class="free">j</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">â‰¤</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">j</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">[</span><span class="free">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">j</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">[</span><span class="free">S</span> <span class="main">âˆ©</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ïˆ</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FG_advice_inter_subformulas <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">âˆ©</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ïˆ</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ïˆ</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="free">S</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span>â€º</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢_semantics' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">âˆ©</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ïˆ</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ïˆ</span> <span class="main">(</span>suffix <span class="skolem">j</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ğ’¢_suffix <span class="quoted"><span class="quoted">â€¹<span class="skolem">i</span> <span class="main">â‰¤</span> <span class="skolem">j</span>â€º</span></span> inf.absorb_iff2 le_Suc_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">j</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FG_advice_b2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Y_ğ’¢<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Y_Î½<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    Y_G_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="free">Y</span> <span class="main">âŸ¶</span> suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    Y_G_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="free">Y</span> <span class="main">âŸ¶</span> suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">â€• â€¹Custom induction rule with <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">size</span><span class="antiquote">}</span></span> as a partial orderâ€º</span>
  <span class="keyword1"><span class="command">note</span></span> induct <span class="main">=</span> finite_ranking_induct<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted">size</span><span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Y_Î½ finite_subset subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">Ïˆ</span> <span class="skolem">S</span><span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">S</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">S</span>"</span></span>

      <span class="keyword1"><span class="command">note</span></span> FG_advice_insert <span class="main">=</span> FG_advice_insert<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">S</span>â€º</span></span><span class="main">]</span>

      <span class="keyword1"><span class="command">{</span></span>
        <span class="comment1">â€• â€¹Show <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">S</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span><span class="antiquote">}</span></span>â€º</span>

        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="skolem">S</span>"</span></span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span>insert <span class="skolem">Ïˆ</span> <span class="skolem">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> insert<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="skolem">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="skolem">S</span>â€º</span></span> FG_advice_insert insert.hyps<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">}</span></span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="skolem">S</span>"</span></span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span><span class="main">[</span>insert <span class="skolem">Ïˆ</span> <span class="skolem">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span>insert <span class="skolem">Ïˆ</span> <span class="skolem">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> insert<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span><span class="main">[</span><span class="skolem">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="skolem">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="skolem">S</span>â€º</span></span> FG_advice_insert insert.hyps<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">}</span></span>

        <span class="keyword1"><span class="command">ultimately</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> insert.IH insert.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span>

      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command">{</span></span>
        <span class="comment1">â€• â€¹Show <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span><span class="antiquote">}</span></span>â€º</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_semantics
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">Ïˆ</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">)</span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span>insert <span class="skolem">Ïˆ</span> <span class="skolem">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="skolem">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Release_ltln FG_advice_insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> FG_advice_b2_helper<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">S</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>â€º</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> Release_ltln globally_release
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">)</span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span><span class="main">[</span>insert <span class="skolem">Ïˆ</span> <span class="skolem">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span>insert <span class="skolem">Ïˆ</span> <span class="skolem">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">)</span><span class="main">[</span><span class="skolem">S</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln FG_advice_insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> FG_advice_b2_helper<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">S</span> <span class="main">âŠ†</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>â€º</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> WeakUntil_ltln semantics_ltln.simps
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_refl suffix_suffix<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢_semantics <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>â€º</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>

      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> <span class="skolem">Ïˆ</span> <span class="main">âˆ‰</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">Ïˆ</span> <span class="skolem">S</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> asymmetric_master_theorem_ltr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">Y</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">i</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="free">Y</span> <span class="main">âŸ¶</span> suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="free">Y</span> <span class="main">âŸ¶</span> suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> â„±ğ’¢_subformulas<span class="hidden">â‡©</span><sub>Î½</sub><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">SOME</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?Y</span> <span class="main">=</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="var">?i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="var">?i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_ltl_continuation <span class="quoted"><span class="quoted">â€¹<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="var">?i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="var">?i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="var">?Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> â„±ğ’¢_suffix FG_advice_b1 â„±ğ’¢_af order_refl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">SOME</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?Y</span> <span class="main">=</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?Y</span> <span class="main">=</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suffix_Î½_stable â„±ğ’¢_suffix <span class="keyword1"><span class="command">unfolding</span></span> Î½_stable_def MOST_nat
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Y_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">=</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="var">?i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> someI_ex<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="var">?Y</span> <span class="main">âŸ¶</span> suffix <span class="var">?i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="var">?Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="var">?Y</span>"</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="var">?i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Y_G ğ’¢_semantics' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="var">?i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> â„±ğ’¢_subfrmlsn <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="var">?Y</span>â€º</span></span> subfrmlsn_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="var">?i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">[</span><span class="var">?Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FG_advice_b1_helper <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">SOME</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?Y</span> <span class="main">=</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?Y</span> <span class="main">=</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suffix_Î½_stable â„±ğ’¢_suffix <span class="keyword1"><span class="command">unfolding</span></span> Î½_stable_def MOST_nat
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Y_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">=</span> ğ’¢ <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="var">?i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="var">?Y</span> <span class="main">âŸ¶</span> suffix <span class="var">?i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span><span class="main">[</span><span class="var">?Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="var">?Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="var">?Y</span>"</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="var">?i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Y_G ğ’¢_semantics' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="var">?i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> â„±ğ’¢_subfrmlsn <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="var">?Y</span>â€º</span></span> subfrmlsn_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="var">?i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span><span class="main">[</span><span class="var">?Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="var">?Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FG_advice_b1_helper <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> asymmetric_master_theorem_rtl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    2<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="free">Y</span> <span class="main">âŸ¶</span> suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="free">Y</span> <span class="main">âŸ¶</span> suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="free">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="free">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms Y_ğ’¢ FG_advice_b2 ğ’¢_af<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_ltl_continuation <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> asymmetric_master_theorem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span>
    <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound"><span class="bound">Y</span></span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">.</span>
      suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="bound">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>
      <span class="main">âˆ§</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="bound">Y</span> <span class="main">âŸ¶</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="bound">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span>
      <span class="main">âˆ§</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âˆˆ</span> <span class="bound">Y</span> <span class="main">âŸ¶</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span><span class="main">[</span><span class="bound">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">[</span><span class="bound">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asymmetric_master_theorem_ltr asymmetric_master_theorem_rtl<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Restricted_Master_Theorem">
<div class="head">
<h1>Theory Restricted_Master_Theorem</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Salomon Sickert
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Master Theorem with Reduced Subformulasâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> Restricted_Master_Theorem
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Master_Theorem.html">Master_Theorem</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Restricted Set of Subformulasâ€º</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">restricted_subformulas_inner</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas_inner</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">restricted_subformulas_inner</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">restricted_subformulas_inner</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas_inner</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">restricted_subformulas_inner</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">restricted_subformulas_inner</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas_inner</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">restricted_subformulas_inner</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas_inner</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">âˆª</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas_inner</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">restricted_subformulas_inner</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">restricted_subformulas_inner</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas_inner</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">restricted_subformulas_inner</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">restricted_subformulas_inner</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas_inner</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">âˆª</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas_inner</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">restricted_subformulas</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">restricted_subformulas</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">restricted_subformulas</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">restricted_subformulas</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">restricted_subformulas</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">restricted_subformulas</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">restricted_subformulas</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">restricted_subformulas</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">restricted_subformulas</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> restricted_subformulas_inner <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> restricted_subformulas_inner <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">restricted_subformulas</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">restricted_subformulas</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">âˆª</span> <span class="free">restricted_subformulas</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">restricted_subformulas</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_restricted_subformulas_inner<span class="main">:</span>
  <span class="quoted"><span class="quoted">"restricted_subformulas_inner <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_restricted_subformulas<span class="main">:</span>
  <span class="quoted"><span class="quoted">"restricted_subformulas <span class="main">(</span><span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GF_advice_restricted_subformulas_inner<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> restricted_subformulas_inner_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"restricted_subformulas_inner <span class="free">Ï†</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆª</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> restricted_subformulas_subset'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"restricted_subformulas <span class="free">Ï†</span> <span class="main">âŠ†</span> restricted_subformulas_inner <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> restricted_subformulas_inner_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> restricted_subformulas_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"restricted_subformulas <span class="free">Ï†</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆª</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> restricted_subformulas_inner_subset restricted_subformulas_subset' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> restricted_subformulas_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âŸ¹</span> size <span class="free">Ïˆ</span> <span class="main">&lt;</span> size <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">Ï†</span><span class="main">.</span> restricted_subformulas_inner <span class="bound">Ï†</span> <span class="main">âŠ†</span> subfrmlsn <span class="bound">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> restricted_subformulas_inner_subset subformulas<span class="hidden">â‡©</span><sub>Î¼</sub><span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inner<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">Ïˆ</span> <span class="bound">Ï†</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> restricted_subformulas_inner <span class="bound">Ï†</span> <span class="main">âŸ¹</span> size <span class="bound">Ïˆ</span> <span class="main">â‰¤</span> size <span class="bound">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subfrmlsn_size dual_order.strict_implies_order
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âŸ¹</span> size <span class="free">Ïˆ</span> <span class="main">&lt;</span> size <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Ïˆ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inner<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> restricted_subformulas_notin<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆ‰</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> restricted_subformulas_size <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> restricted_subformulas_superset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âŸ¹</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ïˆ</span> <span class="main">âˆª</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ïˆ</span> <span class="main">âŠ†</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ï‡</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> restricted_subformulas_inner <span class="skolem">Ï‡</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï‡</span><span class="main">)</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ¨</span> <span class="main">(</span><span class="skolem">Ï‡</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">)</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âŸ¹</span> restricted_subformulas_inner <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">âŠ†</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>2</sub></span><span class="main">)</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âŸ¹</span> restricted_subformulas_inner <span class="bound">Ïˆ<span class="hidden">â‡©</span><sub>1</sub></span> <span class="main">âŠ†</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> restricted_subformulas_subset'<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ïˆ</span> <span class="main">âˆª</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ïˆ</span> <span class="main">âŠ†</span>  restricted_subformulas_inner <span class="skolem">Ï‡</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> restricted_subformulas_inner <span class="skolem">Ï‡</span>â€º</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Ï‡</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï‡1</span> <span class="skolem">Ï‡2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">=</span> <span class="skolem">Ï‡1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï‡2</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="skolem">Ï‡1</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> le_supI1 le_supI2 subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset subset_eq subset_insertI2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="skolem">Ï‡2</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> le_supI1 le_supI2 subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset subset_eq subset_insertI2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="skolem">Ï‡1</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Un_insert_right subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset subsetD sup.coboundedI2 sup_commute<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Un_insert_right subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset subsetD sup.coboundedI2 sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï‡1</span> <span class="skolem">Ï‡2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï‡1</span> <span class="skolem">Ï‡2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï‡1</span> <span class="skolem">Ï‡2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">=</span> <span class="skolem">Ï‡1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï‡2</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="skolem">Ï‡1</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> le_supI1 le_supI2 subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset subset_eq subset_insertI2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="skolem">Ï‡2</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> le_supI1 le_supI2 subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset subset_eq subset_insertI2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="skolem">Ï‡1</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Un_insert_right subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset subsetD sup.coboundedI2 sup_commute<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Un_insert_right subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subset subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subset subsetD sup.coboundedI2 sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">ultimately</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ïˆ</span> <span class="main">âˆª</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ïˆ</span> <span class="main">âŠ†</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> restricted_subformulas_W_Î¼<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âŠ†</span> restricted_subformulas <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> restricted_subformulas_R_Î¼<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ïˆ</span> <span class="main">âŠ†</span> restricted_subformulas <span class="main">(</span><span class="free">Ï†</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ïˆ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ïˆ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> restrict_af_letter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"restricted_subformulas <span class="main">(</span>af_letter <span class="free">Ï†</span> <span class="free">Ïƒ</span><span class="main">)</span> <span class="main">=</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> restricted_subformulas_subset' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> restricted_subformulas_subset' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> restrict_af<span class="main">:</span>
  <span class="quoted"><span class="quoted">"restricted_subformulas <span class="main">(</span>af <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> restrict_af_letter<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Restricted Master Theorem / Lemmasâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delay_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Î¼_stable <span class="free">Ï†</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Prop_ltln <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice.simps<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> GF_advice_af prefix_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Nprop_ltln <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> GF_advice_af prefix_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span>  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X1</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X2</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X1</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">j</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X2</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Î¼_stable_subfrmlsn<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">â€¹Î¼_stable <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span>â€º</span></span><span class="main">]</span> And_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">ultimately</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">k</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">k</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_sync_and GF_advice_monotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_decompose semantics_ltln.simps<span class="main">(</span>5<span class="main">)</span> GF_advice.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span>  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X1</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X2</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X1</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âˆ¨</span> suffix <span class="skolem">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">j</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X2</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Î¼_stable_subfrmlsn<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">â€¹Î¼_stable <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="skolem">w</span>â€º</span></span><span class="main">]</span> Or_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">ultimately</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span>prefix <span class="skolem">k</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âˆ¨</span> suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span>prefix <span class="skolem">k</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_monotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> af_decompose semantics_ltln.simps<span class="main">(</span>6<span class="main">)</span> GF_advice.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">Ï†</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> stable<span class="main">:</span> <span class="quoted"><span class="quoted">"Î¼_stable <span class="skolem">Ï†</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> suffix<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="main">1</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> â„±_suffix ğ’¢â„±_â„±_subset ğ’¢â„±_suffix
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Î¼_stable_def<span class="main">)</span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Next_ltln.IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> stable suffix<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> suffix_suffix prefix_suffix_subsequence GF_suffix<span class="main"><span class="main">]</span></span> One_nat_def add.commute af_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> foldl_Nil foldl_append restricted_subformulas.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsequence_append subsequence_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span>  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> stable_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> Î¼_stable <span class="skolem">Ï†1</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> stable_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> Î¼_stable <span class="skolem">Ï†2</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Î¼_stable_subfrmlsn<span class="main">[</span><span class="operator">OF</span> Until_ltln.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Î¼_stable_suffix<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Until_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> suffix <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="bound">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X1</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> suffix <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="skolem">i</span> <span class="main">â†’</span> <span class="bound">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X2</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Until_ltln.IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> stable_1<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix prefix_suffix_subsequence GF_suffix<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> Until_ltln.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> stable_2<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix prefix_suffix_subsequence GF_suffix<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X1</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X2</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">ultimately</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">â‰¥</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="skolem">i</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_sync_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">Ï†1</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="quoted"><span class="skolem">Ï†2</span></span><span class="main">]</span> GF_advice_monotone<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> af_subsequence_U_GF_advice<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span>  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> stable_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> Î¼_stable <span class="skolem">Ï†1</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> stable_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> Î¼_stable <span class="skolem">Ï†2</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Î¼_stable_subfrmlsn<span class="main">[</span><span class="operator">OF</span> WeakUntil_ltln.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Î¼_stable_suffix<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> Until_ltln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> suffix <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="bound">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X1</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> suffix <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="skolem">i</span> <span class="main">â†’</span> <span class="bound">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X2</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln.IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> stable_1<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix prefix_suffix_subsequence GF_suffix<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> stable_2<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix prefix_suffix_subsequence GF_suffix<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X1</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X2</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> restricted_subformulas_subset' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">ultimately</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">â‰¥</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="skolem">i</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> GF_advice_sync_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">Ï†1</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="quoted"><span class="skolem">Ï†2</span></span><span class="main">]</span> GF_advice_monotone<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> af_subsequence_W_GF_advice<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> Globally_ltln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Globally_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span><span class="main">[</span><span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> stable_1 GF_advice_a1 ğ’¢â„±_suffix Î¼_stable_def ğ’¢â„±_elim mem_Collect_eq subsetI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice_inter restricted_subformulas_W_Î¼ le_infI2<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> GF_advice_af_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln.prems<span class="main">(</span>2<span class="main">)</span> ltln_weak_to_strong<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span>  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> stable_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> Î¼_stable <span class="skolem">Ï†1</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> stable_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> Î¼_stable <span class="skolem">Ï†2</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Î¼_stable_subfrmlsn<span class="main">[</span><span class="operator">OF</span> Release_ltln.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Î¼_stable_suffix<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> Until_ltln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">â‰¤</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">â‰¤</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> suffix <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="bound">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X2</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> suffix <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="skolem">i</span> <span class="main">â†’</span> <span class="bound">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X1</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltln.IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> stable_1<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix prefix_suffix_subsequence GF_suffix<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltln.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> stable_2<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix prefix_suffix_subsequence GF_suffix<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X1</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X2</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> restricted_subformulas_subset' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">ultimately</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">â‰¥</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="skolem">i</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">â‰¤</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> GF_advice_sync_lesseq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">Ï†2</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="quoted"><span class="skolem">Ï†1</span></span><span class="main">]</span> GF_advice_monotone<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> af_subsequence_R_GF_advice<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> Globally_ltln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Globally_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">[</span><span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> stable_2 GF_advice_a1 ğ’¢â„±_suffix Î¼_stable_def ğ’¢â„±_elim mem_Collect_eq subsetI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice_inter restricted_subformulas_R_Î¼ le_infI2<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> GF_advice_af_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Release_ltln.prems<span class="main">(</span>2<span class="main">)</span> ltln_weak_to_strong<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span>  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">}</span> <span class="main">âˆ©</span> restricted_subformulas <span class="skolem">Ï†2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> stable_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> Î¼_stable <span class="skolem">Ï†1</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> stable_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">i</span><span class="main">.</span> Î¼_stable <span class="skolem">Ï†2</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Î¼_stable_subfrmlsn<span class="main">[</span><span class="operator">OF</span> StrongRelease_ltln.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Î¼_stable_suffix<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">â‰¤</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">â‰¤</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> suffix <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="bound">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X2</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> suffix <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="skolem">i</span> <span class="main">â†’</span> <span class="bound">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X1</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln.IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> stable_1<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix prefix_suffix_subsequence GF_suffix<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> stable_2<span class="main">,</span> <span class="operator">unfolded</span> suffix_suffix prefix_suffix_subsequence GF_suffix<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X1</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X2</span> <span class="main">âŠ†</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">ultimately</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">â‰¥</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†1</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="skolem">i</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">â‰¤</span> <span class="skolem">i</span> <span class="main">âŸ¹</span> suffix <span class="skolem">k</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="skolem">Ï†2</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">[</span><span class="bound">j</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GF_advice_sync_lesseq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">Ï†2</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="quoted"><span class="skolem">Ï†1</span></span><span class="main">]</span> GF_advice_monotone<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> af_subsequence_M_GF_advice<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">theorem</span></span> master_theorem_restricted<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span>
    <span class="main">(</span><span class="main">âˆƒ</span><span class="bound"><span class="bound">X</span></span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span><span class="main">.</span>
       <span class="main">(</span><span class="main">âˆƒ</span><span class="bound"><span class="bound">Y</span></span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span><span class="main">.</span>
         <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="bound">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>
          <span class="main">âˆ§</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="bound">X</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="bound">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span>
          <span class="main">âˆ§</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="bound">Y</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="bound">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">âŸ·</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Î¼_stable <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MOST_nat less_Suc_eq suffix_Î¼_stable<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> stable<span class="main">:</span> <span class="quoted"><span class="quoted">"Î¼_stable <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> â„±_af ğ’¢â„±_af Î¼_stable_def<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ï†'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"â„±ğ’¢ <span class="free">Ï†</span> <span class="free">w</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="var">?Ï†'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="var">?lhs</span>â€º</span></span> af_ltl_continuation <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">j</span><span class="main">.</span> af <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>prefix <span class="bound">j</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsequence_append<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"ğ’¢â„± <span class="free">Ï†</span> <span class="free">w</span> <span class="main">=</span> ğ’¢â„± <span class="free">Ï†</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ğ’¢â„±_af ğ’¢â„±_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="main">(</span><span class="var">?Ï†'</span><span class="main">)</span> <span class="main">(</span>prefix <span class="bound">j</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="var">?X'</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> delay_2<span class="main">[</span><span class="operator">OF</span> stable 1<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> suffix_suffix 2 restrict_af 3 <span class="keyword1"><span class="command">unfolding</span></span> ğ’¢â„±_semantics'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> GF_advice_inter_subformulas af_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> inf_assoc inf_commute<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="var">?X'</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âŸ¹</span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="bound">X</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">=</span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="bound">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supE restricted_subformulas_superset FG_advice_inter inf.coboundedI2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="var">?X'</span> <span class="main">âŸ¹</span>  <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="var">?Y'</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ğ’¢â„±_implies_GF <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âŸ¹</span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="bound">X</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">=</span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="bound">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supE restricted_subformulas_superset GF_advice_inter inf.coboundedI2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> <span class="var">?Y'</span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span><span class="var">?X'</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> â„±ğ’¢_implies_FG <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X'</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ğ’¢â„±_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y'</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> â„±ğ’¢_subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> master_theorem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>


<span class="keyword1"><span class="command">corollary</span></span> master_theorem_restricted_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"language_ltln <span class="free">Ï†</span> <span class="main">=</span> <span class="main">â‹ƒ</span> <span class="main">{</span>L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="bound">X</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="bound">X</span> <span class="bound">Y</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="bound">X</span> <span class="bound">Y</span> <span class="main">|</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âˆ§</span> <span class="bound">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> language_ltln <span class="free">Ï†</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> language_ltln_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="skolem">w</span><span class="main">)</span><span class="main">[</span><span class="skolem">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">X</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="skolem">Y</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> <span class="skolem">Y</span><span class="main">.</span> <span class="skolem">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span><span class="skolem">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> master_theorem_restricted <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> L<span class="hidden">â‡©</span><sub>1</sub>_def L<span class="hidden">â‡©</span><sub>2</sub>_def L<span class="hidden">â‡©</span><sub>3</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> <span class="main">â‹ƒ</span> <span class="main">{</span>L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="bound">X</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="bound">X</span> <span class="bound">Y</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="bound">X</span> <span class="bound">Y</span> <span class="main">|</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âˆ§</span> <span class="bound">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">âˆˆ</span> language_ltln <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> language_ltln_def L<span class="hidden">â‡©</span><sub>1</sub>_def L<span class="hidden">â‡©</span><sub>2</sub>_def L<span class="hidden">â‡©</span><sub>3</sub>_def
    <span class="keyword1"><span class="command">using</span></span> master_theorem_restricted <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Definitions with Lists for Code Exportâ€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">restricted_advice_sets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> ltln list <span class="main">Ã—</span> <span class="tfree">'a</span> ltln list<span class="main">)</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">restricted_advice_sets</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">=</span> List.product <span class="main">(</span>subseqs <span class="main">(</span>List.filter <span class="main">(</span><span class="main">Î»</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> restricted_subformulas <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subseqs <span class="main">(</span>List.filter <span class="main">(</span><span class="main">Î»</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> restricted_subformulas <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subseqs_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_restricted_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">xs</span><span class="main">.</span> <span class="free">X</span> <span class="main">=</span> set <span class="bound">xs</span> <span class="main">âˆ§</span> <span class="bound">xs</span> <span class="main">âˆˆ</span> set <span class="main">(</span>subseqs <span class="main">(</span>List.filter <span class="main">(</span><span class="main">Î»</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> restricted_subformulas <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_subseqs inf_commute inter_set_filter subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_list_set subset_subseq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subseqs_subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_restricted_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">ys</span><span class="main">.</span> <span class="free">Y</span> <span class="main">=</span> set <span class="bound">ys</span> <span class="main">âˆ§</span> <span class="bound">ys</span> <span class="main">âˆˆ</span> set <span class="main">(</span>subseqs <span class="main">(</span>List.filter <span class="main">(</span><span class="main">Î»</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> restricted_subformulas <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span>subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_subseqs inf_commute inter_set_filter subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_list_set subset_subseq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> restricted_advice_sets_subformulas<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âˆ§</span> <span class="free">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">X</span> <span class="main">=</span> set <span class="bound">xs</span> <span class="main">âˆ§</span> <span class="free">Y</span> <span class="main">=</span> set <span class="bound">ys</span> <span class="main">âˆ§</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">âˆˆ</span> set <span class="main">(</span>restricted_advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> restricted_advice_sets_def set_product subseqs_subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_restricted_list subseqs_subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_restricted_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> restricted_advice_sets_not_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"restricted_advice_sets <span class="free">Ï†</span> <span class="main">â‰ </span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> restricted_advice_sets_def <span class="keyword1"><span class="command">using</span></span> subseqs_not_empty product_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Transition_Functions">
<div class="head">
<h1>Theory Transition_Functions</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Transition Functions for Deterministic Automataâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> Transition_Functions
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="After.html">../Logical_Characterization/After</a>"</span>
  <span class="quoted">"<a href="Advice.html">../Logical_Characterization/Advice</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  This theory defines three functions based on the ``after''-function
  which we use as transition functions for deterministic automata.
â€º</span></span>

<span class="keyword1"><span class="command">locale</span></span> transition_functions <span class="main">=</span>
  af_congruent <span class="main">+</span> GF_advice_congruent
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹After Functions with Resets for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">GF</span></span><span class="main"><span class="main">(</span></span>Î¼LTL<span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">FG</span></span><span class="main"><span class="main">(</span></span>Î½LTL<span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>â€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">af_letter<span class="hidden">â‡©</span><sub>F</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">af_letter<span class="hidden">â‡©</span><sub>F</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">then</span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">else</span> af_letter <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">af_letter<span class="hidden">â‡©</span><sub>G</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">af_letter<span class="hidden">â‡©</span><sub>G</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">then</span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">else</span> af_letter <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">af<span class="hidden">â‡©</span><sub>F</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set list <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">af<span class="hidden">â‡©</span><sub>F</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">â‰¡</span> foldl <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>F</sub> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">af<span class="hidden">â‡©</span><sub>G</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set list <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">af<span class="hidden">â‡©</span><sub>G</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">â‰¡</span> foldl <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>G</sub> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_step<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="main">[</span><span class="free">Î½</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_step<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="main">[</span><span class="free">Î½</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_segments<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main">=</span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ¹</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="free">w'</span><span class="main">)</span> <span class="main">=</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">w'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_segments<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main">=</span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ¹</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="free">w'</span><span class="main">)</span> <span class="main">=</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">w'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> af_not_true_implies_af_equals_af<span class="hidden">â‡©</span><sub>F</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">â‹€</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">ys</span> <span class="main">âŸ¹</span> <span class="main">Â¬</span> af <span class="free">Ïˆ</span> <span class="bound">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span> <span class="main">âŸ¹</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="skolem">xs</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> af <span class="free">Ïˆ</span> <span class="skolem">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_def foldl_Cons foldl_Nil foldl_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> af_not_false_implies_af_equals_af<span class="hidden">â‡©</span><sub>G</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">â‹€</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">ys</span> <span class="main">âŸ¹</span> <span class="main">Â¬</span> af <span class="free">Ïˆ</span> <span class="bound">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span> <span class="main">âŸ¹</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="skolem">xs</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> af <span class="free">Ïˆ</span> <span class="skolem">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_def foldl_Cons foldl_Nil foldl_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_not_true_implies_af_equals_af<span class="hidden">â‡©</span><sub>F</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">â‹€</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">ys</span> <span class="main">âŸ¹</span> <span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="bound">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span> <span class="main">âŸ¹</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="skolem">xs</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="skolem">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_def foldl_Cons foldl_Nil foldl_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_not_false_implies_af_equals_af<span class="hidden">â‡©</span><sub>G</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">â‹€</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">ys</span> <span class="main">âŸ¹</span> <span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="bound">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span> <span class="main">âŸ¹</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="skolem">xs</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="skolem">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_def foldl_Cons foldl_Nil foldl_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_true_implies_af_true<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_append_true af_not_true_implies_af_equals_af<span class="hidden">â‡©</span><sub>F</sub><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_false_implies_af_false<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> af <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_append_false af_not_false_implies_af_equals_af<span class="hidden">â‡©</span><sub>G</sub><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> af_equiv_true_af<span class="hidden">â‡©</span><sub>F</sub>_prefix_true<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">ys</span> <span class="main">âˆ§</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="bound">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">a</span> <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"af <span class="free">Ïˆ</span> <span class="skolem">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="skolem">w</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">ys</span> <span class="main">âŸ¹</span> <span class="main">Â¬</span> af <span class="free">Ïˆ</span> <span class="bound">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> af_append_true <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="skolem">w</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> af_not_true_implies_af_equals_af<span class="hidden">â‡©</span><sub>F</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False af_letter<span class="hidden">â‡©</span><sub>F</sub>_def<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 snoc.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> snoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> const_implies_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_equiv_false_af<span class="hidden">â‡©</span><sub>G</sub>_prefix_false<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af <span class="free">Ïˆ</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">ys</span> <span class="main">âˆ§</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="bound">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">a</span> <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"af <span class="free">Ïˆ</span> <span class="skolem">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="skolem">w</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">ys</span> <span class="main">âŸ¹</span> <span class="main">Â¬</span> af <span class="free">Ïˆ</span> <span class="bound">xs</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> af_append_false <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="skolem">w</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> af_not_false_implies_af_equals_af<span class="hidden">â‡©</span><sub>G</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> af <span class="free">Ïˆ</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False af_letter<span class="hidden">â‡©</span><sub>G</sub>_def<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 snoc.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> snoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> const_implies_eq<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> append_take_drop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">âŸ·</span> <span class="free">xs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">w</span> <span class="main">âˆ§</span> <span class="free">ys</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_conv_conj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subsequence_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">j</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">âŸ¹</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">i</span> <span class="main">+</span> length <span class="free">xs</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_take_drop<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left' subsequence_length subsequence_prefix_suffix<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subsequence_append_general<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">â‰¤</span> <span class="free">k</span> <span class="main">âŸ¹</span> <span class="free">k</span> <span class="main">â‰¤</span> <span class="free">j</span> <span class="main">âŸ¹</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">j</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">i</span> <span class="main">â†’</span> <span class="free">k</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="free">k</span> <span class="main">â†’</span> <span class="free">j</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_Suc_ex map_append subsequence_def upt_add_eq_append<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_semantics_rtl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">i</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="skolem">j</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> Suc_le_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span>Suc <span class="skolem">j</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_segments<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_Suc_ex le_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsequence_append<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span>Suc <span class="skolem">j</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_true_implies_af_true <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">i</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> af_F_prefix_lang_equiv_true eq_implies_lang subsequence_append_general Suc_le_eq <span class="quoted"><span class="quoted">â€¹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>â€º</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>â€º</span></span> less_SucI order.order_iff_strict<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_semantics_ltr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">i</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">resets</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">resets</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">i</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">resets</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">(</span>Max <span class="skolem">resets</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">resets</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> infinite_nat_iff_unbounded resets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">resets</span> <span class="main">â‰ </span> <span class="main">{}</span> <span class="main">âŸ¹</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Max <span class="skolem">resets</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> resets_def <span class="keyword1"><span class="command">using</span></span> Max_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m_reset<span class="main">:</span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">â‰¥</span> <span class="skolem">m</span>"</span></span>

    <span class="keyword1"><span class="command">with</span></span> m_reset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Max_ge_iff Suc_n_not_le_n <span class="quoted"><span class="quoted">â€¹finite <span class="skolem">resets</span>â€º</span></span> empty_Collect_eq m_def mem_Collect_eq resets_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> m_reset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span>  <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">m</span> <span class="main">â†’</span> <span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">m</span> <span class="main">â‰¤</span> <span class="skolem">i</span>â€º</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_segments bot_nat_def le0 subsequence_append_general<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ„</span><span class="bound">j</span><span class="main">.</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">m</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_cases subseq_to_smaller<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ„</span><span class="bound">j</span><span class="main">.</span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">m</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_equiv_true_af<span class="hidden">â‡©</span><sub>F</sub>_prefix_true subsequence_split<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_semantics_rtl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> <span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">j</span><span class="main">.</span> <span class="main">Â¬</span> af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">i</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">resets</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">resets</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">i</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">resets</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">(</span>Max <span class="skolem">resets</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">resets</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> infinite_nat_iff_unbounded mem_Collect_eq resets_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">resets</span> <span class="main">â‰ </span> <span class="main">{}</span> <span class="main">âŸ¹</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Max <span class="skolem">resets</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> resets_def <span class="keyword1"><span class="command">using</span></span> Max_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m_reset<span class="main">:</span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">â‰¥</span> <span class="skolem">m</span>"</span></span>

    <span class="keyword1"><span class="command">with</span></span> m_reset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Max_ge_iff Suc_n_not_le_n <span class="quoted"><span class="quoted">â€¹finite <span class="skolem">resets</span>â€º</span></span> empty_Collect_eq m_def mem_Collect_eq resets_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> m_reset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">m</span> <span class="main">â†’</span> <span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">m</span> <span class="main">â‰¤</span> <span class="skolem">i</span>â€º</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_segments bot_nat_def le0 subsequence_append_general<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">j</span><span class="main">.</span> <span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">m</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_cases subseq_to_smaller<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">j</span><span class="main">.</span> <span class="main">Â¬</span> af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">m</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_equiv_false_af<span class="hidden">â‡©</span><sub>G</sub>_prefix_false subsequence_split<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_semantics_ltr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">j</span><span class="main">.</span> <span class="main">Â¬</span> af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="bound">i</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> <span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">j</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="skolem">j</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">using</span></span> Suc_le_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span>Suc <span class="skolem">j</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_segments<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_Suc_ex le_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsequence_append<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span>Suc <span class="skolem">j</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_false_implies_af_false <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span>Suc <span class="skolem">j</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq_implies_lang <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">i</span> <span class="main">â†’</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> af_G_prefix_lang_equiv_false subsequence_append_general Suc_le_eq <span class="quoted"><span class="quoted">â€¹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>â€º</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>â€º</span></span> less_SucI order.order_iff_strict<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">j</span><span class="main">.</span> af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">i</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹After Function using GF-adviceâ€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">af_letter<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln set <span class="main">â‡’</span> <span class="tfree">'a</span> ltln <span class="main">Ã—</span> <span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set <span class="main">â‡’</span> <span class="tfree">'a</span> ltln <span class="main">Ã—</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">af_letter<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> snd <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>
    <span class="keyword1">then</span> <span class="main">(</span>af_letter <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="main">(</span>af_letter <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="main">(</span>af_letter <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">,</span> af_letter <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">af<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln set <span class="main">â‡’</span> <span class="tfree">'a</span> ltln <span class="main">Ã—</span> <span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set list <span class="main">â‡’</span> <span class="tfree">'a</span> ltln <span class="main">Ã—</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">af<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">â‰¡</span> foldl <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_fst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fst <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">Î½</span><span class="main">)</span> <span class="main">=</span> af_letter <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">Î½</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_snd<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="free">p</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> snd <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">Î½</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">normalise</span> <span class="main">(</span>af_letter <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">Î½</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> snd <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">Î½</span><span class="main">)</span> <span class="main">=</span> af_letter <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="free">Î½</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_fst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fst <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> af <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_snd<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> af <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="free">w</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> af <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_snd<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> af_letter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> af_letter_congruent<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_snd'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="main">(</span>take <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> af <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_snd<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_is_0_eq foldl_Nil le_cases take_all take_eq_Nil<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_step<span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Î¾</span><span class="main">,</span> <span class="free">Î¶</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Î¾</span><span class="main">,</span> <span class="free">Î¶</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="main">[</span><span class="free">Î½</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">normalise</span> <span class="main">(</span>af <span class="free">Î¾</span> <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="main">[</span><span class="free">Î½</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_fst<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_segments<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Î¾</span><span class="main">,</span> <span class="free">Î¶</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span>af <span class="free">Î¾</span> <span class="free">w</span><span class="main">,</span> <span class="main">(</span>af <span class="free">Î¾</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">âŸ¹</span> af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Î¾</span><span class="main">,</span> <span class="free">Î¶</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="free">w'</span><span class="main">)</span> <span class="main">=</span> af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span>af <span class="free">Î¾</span> <span class="free">w</span><span class="main">,</span> <span class="main">(</span>af <span class="free">Î¾</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="free">w'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_semantics_ltr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">m</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="bound">m</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">resets</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">resets</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">resets</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">(</span>Max <span class="skolem">resets</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">â‰¤</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">âˆˆ</span> <span class="skolem">resets</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ï†</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">n</span><span class="main">.</span> suffix <span class="bound">n</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free">normalise</span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="skolem">i</span> <span class="free">w</span> <span class="main">@</span> prefix <span class="bound">n</span> <span class="main">(</span>suffix <span class="skolem">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> normalise_monotonic <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GF_advice_af<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free">normalise</span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">i</span> <span class="main">â‰¤</span> <span class="skolem">j</span>â€º</span></span> add.right_neutral le_SucI le_Suc_ex subsequence_append subsequence_shift suffix_suffix<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="skolem">j</span><span class="main">.</span> <span class="main">Â¬</span> af <span class="main">(</span><span class="main">(</span><span class="free">normalise</span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span>Suc <span class="skolem">j</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltl_implies_satisfiable_prefix subsequence_prefix_suffix<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="skolem">j</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="var">?Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="var">?Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span>Suc <span class="skolem">j</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af<span class="hidden">â‡©</span><sub>Î½</sub>_snd snd_eqD<span class="main">)</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?Ï†</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_fst<span class="main">)</span>

      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="skolem">j</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">j</span> <span class="main">âˆˆ</span> <span class="skolem">resets</span>â€º</span></span> resets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="var">?Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_step prod.collapse subseq_to_Suc zero_le<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="skolem">j</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="skolem">j</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span>Suc <span class="skolem">j</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_segments<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="skolem">j</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="bound">k</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI le0 subsequence_append_general<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">k</span> <span class="main">âˆˆ</span> <span class="skolem">resets</span><span class="main">.</span> <span class="bound">k</span> <span class="main">â‰¤</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">j</span> <span class="main">âˆˆ</span> <span class="skolem">resets</span>â€º</span></span> resets_def le_less_linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">resets</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_nat_set_iff_bounded_le infinite_nat_iff_unbounded_le<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">resets</span> <span class="main">â‰ </span> <span class="main">{}</span> <span class="main">âŸ¹</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Max <span class="skolem">resets</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Max_in resets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="skolem">m</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="bound">k</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Max_ge Suc_n_not_le_n <span class="quoted"><span class="quoted">â€¹finite <span class="skolem">resets</span>â€º</span></span> empty_Collect_eq m_def mem_Collect_eq order.trans resets_def<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="skolem">m</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_SucI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_semantics_rtl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">n</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="bound">n</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">resets</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">resets</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">resets</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">(</span>Max <span class="skolem">resets</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="skolem">n</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="bound">k</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_SucE lessE less_imp_le_nat<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">resets</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> infinite_nat_iff_unbounded mem_Collect_eq resets_def<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound"><span class="bound">i</span></span><span class="main">â‰¥</span><span class="skolem">m</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> resets_def m_def <span class="keyword1"><span class="command">using</span></span> Max_ge not_less_eq_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">m</span> <span class="main">â†’</span> <span class="bound">i</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le0 nat_le_linear subseq_to_smaller subsequence_append_general<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ï†</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="skolem">m</span> <span class="free">w</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">resets</span> <span class="main">â‰ </span> <span class="main">{}</span> <span class="main">âŸ¹</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Max <span class="skolem">resets</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Max_in <span class="quoted"><span class="quoted">â€¹finite <span class="skolem">resets</span>â€º</span></span> resets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> prefix_Ï†'<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="skolem">m</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">normalise</span> <span class="var">?Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> GF_advice_congruent m_def af<span class="hidden">â‡©</span><sub>Î½</sub>_fst<span class="main">)</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="var">?Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="var">?Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">m</span> <span class="main">â†’</span> <span class="bound">i</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af<span class="hidden">â‡©</span><sub>Î½</sub>_fst foldl_append fst_conv prod.collapse<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">i</span><span class="main">.</span> <span class="main">Â¬</span> af <span class="main">(</span><span class="main">(</span><span class="free">normalise</span> <span class="var">?Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">[</span><span class="skolem">m</span> <span class="main">â†’</span> <span class="bound">i</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prefix_Ï†' af<span class="hidden">â‡©</span><sub>Î½</sub>_fst af<span class="hidden">â‡©</span><sub>Î½</sub>_snd' fst_conv prod.collapse subsequence_take<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">m</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="free">normalise</span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="skolem">m</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice_Î½LTL<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> satisfiable_prefix_implies_Î½LTL add.right_neutral subsequence_shift<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> normalise_eventually_equivalent<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute af_subsequence_append le_add1 le_add_same_cancel1 prefix_suffix_subsequence suffix_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Reachability Boundsâ€º</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  We show that the reach of each after-function is bounded by the atomic
  propositions of the input formula.
â€º</span></span>

<span class="keyword1"><span class="command">locale</span></span> transition_functions_size <span class="main">=</span> transition_functions <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    normalise_nested_propos<span class="main">:</span> <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ï†</span> <span class="main">âŠ‡</span> nested_prop_atoms <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_nested_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> nested_prop_atoms <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">Î½</span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ïˆ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> af_letter_nested_prop_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_nested_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> nested_prop_atoms <span class="main">(</span>af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_nested_prop_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> range <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> range <span class="main">(</span>af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_nested_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> nested_prop_atoms <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">Î½</span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ïˆ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> af_letter_nested_prop_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_nested_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> nested_prop_atoms <span class="main">(</span>af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_nested_prop_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> range <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> range <span class="main">(</span>af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_snd_nested_prop_atoms_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="free">p</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> nested_prop_atoms <span class="main">(</span>snd <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">Î½</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">Â¬</span> snd <span class="free">p</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">âŸ¹</span> nested_prop_atoms <span class="main">(</span>snd <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">Î½</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af_letter_nested_prop_atoms nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_def<span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> GF_advice_nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> af_letter_nested_prop_atoms nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_subset dual_order.trans nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_def normalise_nested_propos<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_fst_nested_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="main">(</span>fst <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">Î½</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af_letter_nested_prop_atoms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_snd_nested_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="main">(</span>snd <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">Î½</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">âˆª</span> <span class="main">(</span>nested_prop_atoms <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_snd_nested_prop_atoms_helper <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_fst_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"range <span class="main">(</span>fst <span class="main">âˆ˜</span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_fst_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_snd_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"range <span class="main">(</span>snd <span class="main">âˆ˜</span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">âˆª</span> nested_prop_atoms <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_snd_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"range <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span><span class="main">}</span> <span class="main">Ã—</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">âˆª</span> nested_prop_atoms <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span> <span class="main">âŠ†</span> range <span class="main">(</span>fst <span class="main">âˆ˜</span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span> <span class="main">Ã—</span> range <span class="main">(</span>snd <span class="main">âˆ˜</span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_subset_iff mem_Times_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span><span class="main">}</span> <span class="main">Ã—</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">âˆª</span> nested_prop_atoms <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_fst_range af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_snd_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_fst_nested_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="main">(</span>fst <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> af_letter_nested_prop_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter_nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>af_letter <span class="free">Ï†</span> <span class="free">Î½</span><span class="main">)</span> <span class="free">X</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_fst_nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> af_letter_nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_fst_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"range <span class="main">(</span>fst <span class="main">âˆ˜</span> af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_fst_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_snd_nested_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="main">(</span>snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">âˆª</span> <span class="main">(</span>nested_prop_atoms <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="skolem">p</span> <span class="skolem">xs</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="main">(</span>snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="var">?p</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">âˆª</span> <span class="main">(</span>nested_prop_atoms <span class="main">(</span>snd <span class="var">?p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_snd_nested_prop_atoms<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc af<span class="hidden">â‡©</span><sub>Î½</sub>_fst_nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_snd_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"range <span class="main">(</span>snd <span class="main">âˆ˜</span> af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">âˆª</span> nested_prop_atoms <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_snd_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"range <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span><span class="main">}</span> <span class="main">Ã—</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">âˆª</span> nested_prop_atoms <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span> <span class="main">âŠ†</span> range <span class="main">(</span>fst <span class="main">âˆ˜</span> af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span> <span class="main">Ã—</span> range <span class="main">(</span>snd <span class="main">âˆ˜</span> af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_subset_iff mem_Times_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span><span class="main">}</span> <span class="main">Ã—</span> <span class="main">{</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">âˆª</span> nested_prop_atoms <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_fst_range af<span class="hidden">â‡©</span><sub>Î½</sub>_snd_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Quotient_Type">
<div class="head">
<h1>Theory Quotient_Type</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Quotient Type Emulation for Localesâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quotient_Type
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> quotient <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">â‡’</span> <span class="tfree">'a</span> <span class="main">â‡’</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Rep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">â‡’</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Abs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">â‡’</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Rep_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Abs</span> <span class="main">(</span><span class="free">Rep</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    Abs_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Abs</span> <span class="free">x</span> <span class="main">=</span> <span class="free">Abs</span> <span class="free">y</span> <span class="main">âŸ·</span> <span class="free">eq</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_inject<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Rep</span> <span class="free">x</span> <span class="main">=</span> <span class="free">Rep</span> <span class="free">y</span> <span class="main">âŸ·</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">eq</span> <span class="free">x</span> <span class="main">(</span><span class="free">Rep</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abs_eq Rep_inverse<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Omega_Words_Fun_Stream">
<div class="head">
<h1>Theory Omega_Words_Fun_Stream</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Convert between $\omega$-Words and Streamsâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> Omega_Words_Fun_Stream
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Omega_Words_Fun.html">HOL-Library.Omega_Words_Fun</a>"</span> <span class="quoted">"<a href="../../HOL/HOL-Library/Stream.html">HOL-Library.Stream</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TODO add to HOL-Library.Omega_Words_Fun *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">to_omega</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stream <span class="main">â‡’</span> <span class="tfree">'a</span> word"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_omega</span> <span class="main">â‰¡</span> snth"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">to_stream</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> word <span class="main">â‡’</span> <span class="tfree">'a</span> stream"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_stream</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">â‰¡</span> smap <span class="free"><span class="bound"><span class="entity">w</span></span></span> nats"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> to_omega_to_stream<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_omega <span class="main">(</span>to_stream <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> to_omega_def to_stream_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> to_stream_to_omega<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_stream <span class="main">(</span>to_omega <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> to_omega_def to_stream_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> stream_smap_nats<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bij_to_omega<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij to_omega"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bijI' to_omega_to_stream to_stream_to_omega<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bij_to_stream<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij to_stream"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bijI' to_omega_to_stream to_stream_to_omega<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> image_intersection<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_omega <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">âˆ©</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> to_omega <span class="main">`</span> <span class="free">A</span> <span class="main">âˆ©</span> to_omega <span class="main">`</span> <span class="free">B</span>"</span></span>
  <span class="quoted"><span class="quoted">"to_stream <span class="main">`</span> <span class="main">(</span><span class="free">C</span> <span class="main">âˆ©</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> to_stream <span class="main">`</span> <span class="free">C</span> <span class="main">âˆ©</span> to_stream <span class="main">`</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_is_inj bij_to_omega bij_to_stream image_Int<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> to_stream_snth<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>to_stream <span class="free">w</span><span class="main">)</span> <span class="main">!!</span> <span class="free">k</span> <span class="main">=</span> <span class="free">w</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_stream_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> to_omega_index<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>to_omega <span class="free">s</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="free">s</span> <span class="main">!!</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_stream_snth to_stream_to_omega<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> to_stream_stake<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"stake <span class="free">k</span> <span class="main">(</span>to_stream <span class="free">w</span><span class="main">)</span> <span class="main">=</span> prefix <span class="free">k</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_stream_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> to_omega_prefix<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"prefix <span class="free">k</span> <span class="main">(</span>to_omega <span class="free">s</span><span class="main">)</span> <span class="main">=</span> stake <span class="free">k</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_stream_stake to_stream_to_omega<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_image<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">âˆˆ</span> to_omega <span class="main">`</span> <span class="free">X</span> <span class="main">âŸ·</span> to_stream <span class="free">x</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">âˆˆ</span> to_stream <span class="main">`</span> <span class="free">Y</span> <span class="main">âŸ·</span> to_omega <span class="free">y</span> <span class="main">âˆˆ</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DRA_Construction">
<div class="head">
<h1>Theory DRA_Construction</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Constructing DRAs for LTL Formulasâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> DRA_Construction
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Transition_Functions.html">Transition_Functions</a>

    <span class="quoted">"<a href="Quotient_Type.html">../Quotient_Type</a>"</span>
    <span class="quoted">"<a href="Omega_Words_Fun_Stream.html">../Omega_Words_Fun_Stream</a>"</span>

    <span class="quoted">"<a href="../../HOL/HOL-Library/Log_Nat.html">HOL-Library.Log_Nat</a>"</span>

    <span class="quoted">"<a href="Master_Theorem.html">../Logical_Characterization/Master_Theorem</a>"</span>
    <span class="quoted">"<a href="Restricted_Master_Theorem.html">../Logical_Characterization/Restricted_Master_Theorem</a>"</span>

    <a href="../Transition_Systems_and_Automata/DBA_Combine.html">Transition_Systems_and_Automata.DBA_Combine</a>
    <a href="../Transition_Systems_and_Automata/DCA_Combine.html">Transition_Systems_and_Automata.DCA_Combine</a>
    <a href="../Transition_Systems_and_Automata/DRA_Combine.html">Transition_Systems_and_Automata.DRA_Combine</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">â€• â€¹We use prefix and suffix on infinite words.â€º</span>
<span class="keyword1"><span class="command">hide_const</span></span> Sublist.prefix Sublist.suffix

<span class="keyword1"><span class="command">locale</span></span> dra_construction <span class="main">=</span> transition_functions <span class="quoted"><span class="free">eq</span></span> <span class="quoted"><span class="free">normalise</span></span> <span class="main">+</span> quotient <span class="quoted"><span class="free">eq</span></span> <span class="quoted"><span class="free">Rep</span></span> <span class="quoted"><span class="free">Abs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln <span class="main">â‡’</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">âˆ¼</span>"</span> 75<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">normalise</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Rep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'ltlq</span> <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Abs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'ltlq</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Lifting Setupâ€º</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">true<span class="hidden">â‡©</span><sub>n</sub>_lifted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'ltlq</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">â†‘true<span class="hidden">â‡©</span><sub>n</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">â†‘true<span class="hidden">â‡©</span><sub>n</sub></span></span> <span class="main">â‰¡</span> <span class="free">Abs</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">false<span class="hidden">â‡©</span><sub>n</sub>_lifted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'ltlq</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">â†‘false<span class="hidden">â‡©</span><sub>n</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">â†‘false<span class="hidden">â‡©</span><sub>n</sub></span></span> <span class="main">â‰¡</span> <span class="free">Abs</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">af_letter_lifted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">â‡’</span> <span class="tfree">'ltlq</span> <span class="main">â‡’</span> <span class="tfree">'ltlq</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">â†‘afletter</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">â†‘afletter</span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">â‰¡</span> <span class="free">Abs</span> <span class="main">(</span>af_letter <span class="main">(</span><span class="free">Rep</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">af_lifted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'ltlq</span> <span class="main">â‡’</span> <span class="tfree">'a</span> set list <span class="main">â‡’</span> <span class="tfree">'ltlq</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">â†‘af</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">â†‘af</span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">â‰¡</span> fold <span class="keyword1">â†‘afletter</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">GF_advice_lifted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'ltlq</span> <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set <span class="main">â‡’</span> <span class="tfree">'ltlq</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">â†‘[</span>_<span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span> <span class="main">[</span>90<span class="main">,</span>60<span class="main">]</span> 89<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main"><span class="free">â†‘[</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">â‡©</span><sub>Î½</sub></span></span> <span class="main">â‰¡</span> <span class="free">Abs</span> <span class="main">(</span><span class="main">(</span><span class="free">Rep</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> af_letter_lifted_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">â†‘afletter</span> <span class="free">Î½</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">(</span>af_letter <span class="free">Ï†</span> <span class="free">Î½</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_Abs_eq af_letter_congruent Abs_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_lifted_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">â†‘af</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">(</span>af <span class="free">Ï†</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Abs_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Rep_Abs_eq af_letter_congruent eq_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_lifted_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="keyword1">â†‘af</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af_lifted_semantics af_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">af_letter<span class="hidden">â‡©</span><sub>F</sub>_lifted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set <span class="main">â‡’</span> <span class="tfree">'ltlq</span> <span class="main">â‡’</span> <span class="tfree">'ltlq</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>F</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">â†‘afletter<span class="hidden">â‡©</span><sub>F</sub></span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="main">â‰¡</span> <span class="free">Abs</span> <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>F</sub> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">(</span><span class="free">Rep</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">af_letter<span class="hidden">â‡©</span><sub>G</sub>_lifted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> set <span class="main">â‡’</span> <span class="tfree">'ltlq</span> <span class="main">â‡’</span> <span class="tfree">'ltlq</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>G</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">â†‘afletter<span class="hidden">â‡©</span><sub>G</sub></span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="main">â‰¡</span> <span class="free">Abs</span> <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>G</sub> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">(</span><span class="free">Rep</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_lifted_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>F</sub></span> <span class="free">Ï†</span> <span class="free">Î½</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">Î½</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_lifted_def Rep_inverse af_letter<span class="hidden">â‡©</span><sub>F</sub>_def af_letter_congruent Abs_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_lifted_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>G</sub></span> <span class="free">Ï†</span> <span class="free">Î½</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">Î½</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_lifted_def Rep_inverse af_letter<span class="hidden">â‡©</span><sub>G</sub>_def af_letter_congruent Abs_eq<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">af<span class="hidden">â‡©</span><sub>F</sub>_lifted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'ltlq</span> <span class="main">â‡’</span> <span class="tfree">'a</span> set list <span class="main">â‡’</span> <span class="tfree">'ltlq</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">â†‘af<span class="hidden">â‡©</span><sub>F</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">â†‘af<span class="hidden">â‡©</span><sub>F</sub></span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">â‰¡</span> fold <span class="main">(</span><span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>F</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">af<span class="hidden">â‡©</span><sub>G</sub>_lifted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'ltlq</span> <span class="main">â‡’</span> <span class="tfree">'a</span> set list <span class="main">â‡’</span> <span class="tfree">'ltlq</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">â†‘af<span class="hidden">â‡©</span><sub>G</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">â†‘af<span class="hidden">â‡©</span><sub>G</sub></span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">â‰¡</span> fold <span class="main">(</span><span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>G</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_lifted_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">â†‘af<span class="hidden">â‡©</span><sub>F</sub></span> <span class="free">Ï†</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">(</span>af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_lifted_semantics<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_lifted_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">â†‘af<span class="hidden">â‡©</span><sub>G</sub></span> <span class="free">Ï†</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ïˆ</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">(</span>af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="free">Ïˆ</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_lifted_semantics<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln set <span class="main">â‡’</span> <span class="tfree">'a</span> set <span class="main">â‡’</span> <span class="tfree">'ltlq</span> <span class="main">Ã—</span> <span class="tfree">'ltlq</span> <span class="main">â‡’</span> <span class="tfree">'ltlq</span> <span class="main">Ã—</span> <span class="tfree">'ltlq</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">â†‘afletter<span class="hidden">â‡©</span><sub>Î½</sub></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">â‰¡</span>
    <span class="main">(</span><span class="free">Abs</span> <span class="main">(</span>fst <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span><span class="free">Rep</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free">Rep</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
     <span class="free">Abs</span> <span class="main">(</span>snd <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span><span class="free">Rep</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free">Rep</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Î½</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">af<span class="hidden">â‡©</span><sub>Î½</sub>_lifted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln set <span class="main">â‡’</span> <span class="tfree">'ltlq</span> <span class="main">Ã—</span> <span class="tfree">'ltlq</span> <span class="main">â‡’</span> <span class="tfree">'a</span> set list <span class="main">â‡’</span> <span class="tfree">'ltlq</span> <span class="main">Ã—</span> <span class="tfree">'ltlq</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">â†‘af<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">â†‘af<span class="hidden">â‡©</span><sub>Î½</sub></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">â‰¡</span> fold <span class="main">(</span><span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free">X</span> <span class="free">Î½</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">x</span><span class="main">,</span> <span class="free">Abs</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Abs</span> <span class="main">(</span>fst <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="free">Î½</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">Abs</span> <span class="main">(</span>snd <span class="main">(</span>af_letter<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="free">Î½</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_def af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_def<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> GF_advice_congruent Rep_Abs_eq Rep_inverse af_letter_lifted_semantics eq_trans Abs_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">â†‘af<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free">X</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Î¾</span><span class="main">,</span> <span class="free">Abs</span> <span class="free">Î¶</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">Abs</span> <span class="main">(</span>fst <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Î¾</span><span class="main">,</span> <span class="free">Î¶</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">Abs</span> <span class="main">(</span>snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Î¾</span><span class="main">,</span> <span class="free">Î¶</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_def af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics af_letter_lifted_semantics<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_def af<span class="hidden">â‡©</span><sub>Î½</sub>_fst af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics eq_fst_iff prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹BÃ¼chi automata for basic languagesâ€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'ltlq</span><span class="main">)</span> dba"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">=</span> dba UNIV <span class="main">(</span><span class="free">Abs</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="keyword1">â†‘afletter</span> <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="keyword1">â†‘true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'ltlq</span><span class="main">)</span> dba"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">=</span> dba UNIV <span class="main">(</span><span class="free">Abs</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>F</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="keyword1">â†‘true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ğ”„<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'ltlq</span><span class="main">)</span> dca"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ğ”„<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">=</span> dca UNIV <span class="main">(</span><span class="free">Abs</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="keyword1">â†‘afletter</span> <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="keyword1">â†‘false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'ltlq</span><span class="main">)</span> dca"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">=</span> dca UNIV <span class="main">(</span><span class="free">Abs</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>G</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="keyword1">â†‘false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> dba_run<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DBA.run <span class="main">(</span>dba UNIV <span class="free">p</span> <span class="free">Î´</span> <span class="free">Î±</span><span class="main">)</span> <span class="main">(</span>to_stream <span class="free">w</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dba.run_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> dca_run<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DCA.run <span class="main">(</span>dca UNIV <span class="free">p</span> <span class="free">Î´</span> <span class="free">Î±</span><span class="main">)</span> <span class="main">(</span>to_stream <span class="free">w</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dca.run_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL <span class="main">âŸ¹</span> to_stream <span class="free">w</span> <span class="main">âˆˆ</span> DBA.language <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ·</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">n</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="bound">n</span><span class="main">.</span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> af_Î¼LTL af_prefix_true le_cases<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">n</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="bound">n</span><span class="main">.</span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> af_prefix_true le_SucI order_refl<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> infs <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="keyword1">â†‘true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span> <span class="main">(</span>DBA.trace <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span>to_stream <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infs_snth ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_def DBA.transition_def af_lifted_semantics Abs_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> af_letter_lifted_semantics<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> to_stream <span class="free">w</span> <span class="main">âˆˆ</span> DBA.language <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_def dba.initial_def dba.accepting_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dba_run<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL <span class="main">âŸ¹</span> to_stream <span class="free">w</span> <span class="main">âˆˆ</span> DBA.language <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ·</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTL"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">n</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> af <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="bound">n</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ltl_lang_equivalence.af_Î¼LTL_GF <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">n</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="bound">n</span><span class="main">.</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_semantics_ltr af<span class="hidden">â‡©</span><sub>F</sub>_semantics_rtl
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î¼LTLâ€º</span></span> af_Î¼LTL_GF calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆ€</span><span class="bound">n</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="bound">n</span><span class="main">.</span> af<span class="hidden">â‡©</span><sub>F</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_Suc_eq_le less_imp_Suc_add<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> infs <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="keyword1">â†‘true<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span> <span class="main">(</span>DBA.trace <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span>to_stream <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">Abs</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infs_snth ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_def DBA.transition_def af<span class="hidden">â‡©</span><sub>F</sub>_lifted_semantics Abs_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_lifted_semantics<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> to_stream <span class="free">w</span> <span class="main">âˆˆ</span> DBA.language <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF <span class="free">Ï†</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_def dba.initial_def dba.accepting_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dba_run<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL <span class="main">âŸ¹</span> to_stream <span class="free">w</span> <span class="main">âˆˆ</span> DCA.language <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ·</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">n</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="bound">n</span><span class="main">.</span> <span class="main">Â¬</span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> af_Î½LTL af_prefix_false le_cases order_refl<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">n</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="bound">n</span><span class="main">.</span> <span class="main">Â¬</span> af <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> af_prefix_false le_SucI order_refl<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> fins <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="keyword1">â†‘false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span> <span class="main">(</span>DCA.trace <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span>to_stream <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infs_snth ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_def DBA.transition_def af_lifted_semantics Abs_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> af_letter_lifted_semantics<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> to_stream <span class="free">w</span> <span class="main">âˆˆ</span> DCA.language <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_def dca.initial_def dca.rejecting_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dca_run<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL <span class="main">âŸ¹</span> to_stream <span class="free">w</span> <span class="main">âˆˆ</span> DCA.language <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ·</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTL"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">k</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound">j</span><span class="main">.</span> <span class="main">Â¬</span> af <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="bound">k</span> <span class="main">â†’</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ltl_lang_equivalence.af_Î½LTL_FG <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">n</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_semantics_ltr af<span class="hidden">â‡©</span><sub>G</sub>_semantics_rtl
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="free">Ï†</span> <span class="main">âˆˆ</span> Î½LTLâ€º</span></span> af_Î½LTL_FG calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">n</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="bound">n</span><span class="main">.</span> <span class="main">Â¬</span> af<span class="hidden">â‡©</span><sub>G</sub> <span class="free">Ï†</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span><span class="main">[</span><span class="main">0</span> <span class="main">â†’</span> Suc <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_Suc_eq_le less_imp_Suc_add<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> fins <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">=</span> <span class="keyword1">â†‘false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span> <span class="main">(</span>DCA.trace <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG <span class="free">Ï†</span><span class="main">)</span> <span class="main">(</span>to_stream <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">Abs</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infs_snth ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_def DBA.transition_def af<span class="hidden">â‡©</span><sub>G</sub>_lifted_semantics Abs_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_lifted_semantics<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> to_stream <span class="free">w</span> <span class="main">âˆˆ</span> DCA.language <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG <span class="free">Ï†</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_def dca.initial_def dca.rejecting_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dca_run<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹A DCA checking the GF-advice Functionâ€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">â„­</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln set <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'ltlq</span> <span class="main">Ã—</span> <span class="tfree">'ltlq</span><span class="main">)</span> dca"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">â„­</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> dca UNIV <span class="main">(</span><span class="free">Abs</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">,</span> <span class="free">Abs</span> <span class="main">(</span><span class="main">(</span><span class="free">normalise</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">â†‘afletter<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">Î»</span><span class="bound">p</span><span class="main">.</span> snd <span class="bound">p</span> <span class="main">=</span> <span class="keyword1">â†‘false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> â„­_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_stream <span class="free">w</span> <span class="main">âˆˆ</span> DCA.language <span class="main">(</span>â„­ <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span> <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span>
        <span class="main">âŸ·</span> <span class="main">(</span><span class="main">âˆƒ</span><span class="bound">m</span><span class="main">.</span> <span class="main">âˆ€</span><span class="bound"><span class="bound">k</span></span><span class="main">â‰¥</span><span class="bound">m</span><span class="main">.</span> <span class="main">Â¬</span> snd <span class="main">(</span>af<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">X</span> <span class="main">(</span><span class="free">Ï†</span><span class="main">,</span> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span> <span class="main">(</span>prefix <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">âˆ¼</span></span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_semantics_ltr af<span class="hidden">â‡©</span><sub>Î½</sub>_semantics_rtl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> fins <span class="main">(</span><span class="main">Î»</span><span class="bound">p</span><span class="main">.</span> snd <span class="bound">p</span> <span class="main">=</span> <span class="keyword1">â†‘false<span class="hidden">â‡©</span><sub>n</sub></span><span class="main">)</span> <span class="main">(</span>DCA.trace <span class="main">(</span>â„­ <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>to_stream <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ï†</span><span class="main">,</span> <span class="free">Abs</span> <span class="main">(</span><span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infs_snth â„­_def DCA.transition_def af<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics Abs_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">âŸ·</span> to_stream <span class="free">w</span> <span class="main">âˆˆ</span> DCA.language <span class="main">(</span>â„­ <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> â„­_def dca.initial_def dca.rejecting_def dca.language_def dca_run<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹A DRA for each combination of sets X and Yâ€º</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dba_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">â‹€</span><span class="bound">w</span><span class="main">.</span> to_stream <span class="bound">w</span> <span class="main">âˆˆ</span> DBA.language <span class="free">ğ”„</span> <span class="main">âŸ·</span> <span class="bound">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> DBA.language <span class="free">ğ”„</span> <span class="main">=</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> to_omega <span class="bound">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong dba.language_def mem_Collect_eq to_stream_to_omega<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dca_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">â‹€</span><span class="bound">w</span><span class="main">.</span> to_stream <span class="bound">w</span> <span class="main">âˆˆ</span> DCA.language <span class="free">ğ”„</span> <span class="main">âŸ·</span> <span class="bound">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> DCA.language <span class="free">ğ”„</span> <span class="main">=</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> to_omega <span class="bound">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong dca.language_def mem_Collect_eq to_stream_to_omega<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ğ”„<span class="hidden">â‡©</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln list <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'ltlq</span> <span class="main">Ã—</span> <span class="tfree">'ltlq</span><span class="main">)</span> dca"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ğ”„<span class="hidden">â‡©</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> â„­ <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_omega <span class="main">`</span> DCA.language <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_def L<span class="hidden">â‡©</span><sub>1</sub>_def set_eq_iff â„­_language<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_alphabet<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DCA.alphabet <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_def â„­_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ğ”„<span class="hidden">â‡©</span><sub>2</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln list <span class="main">â‡’</span> <span class="tfree">'a</span> ltln list <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'ltlq</span> list degen<span class="main">)</span> dba"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ğ”„<span class="hidden">â‡©</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> DBA_Combine.intersect_list <span class="main">(</span>map <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span>set <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_omega <span class="main">`</span> DBA.language <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>2</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>set <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_def L<span class="hidden">â‡©</span><sub>2</sub>_def set_eq_iff dba_language<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_language<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> FG_advice_Î¼LTL<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_alphabet<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DBA.alphabet <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>2</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_def ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_def<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ğ”„<span class="hidden">â‡©</span><sub>3</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln list <span class="main">â‡’</span> <span class="tfree">'a</span> ltln list <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'ltlq</span> list<span class="main">)</span> dca"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ğ”„<span class="hidden">â‡©</span><sub>3</sub></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> DCA_Combine.intersect_list <span class="main">(</span>map <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>3</sub>_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_omega <span class="main">`</span> DCA.language <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>3</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>set <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ğ”„<span class="hidden">â‡©</span><sub>3</sub>_def L<span class="hidden">â‡©</span><sub>3</sub>_def set_eq_iff dca_language<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_language<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> GF_advice_Î½LTL<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>3</sub>_alphabet<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DCA.alphabet <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>3</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ğ”„<span class="hidden">â‡©</span><sub>3</sub>_def ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_def<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ğ”„'</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> intersect_bc <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>2</sub> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">(</span>DCA_Combine.intersect <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>1</sub> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>3</sub> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„'_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_omega <span class="main">`</span> DRA.language <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>set <span class="free">ys</span><span class="main">)</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>set <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ğ”„'_def ğ”„<span class="hidden">â‡©</span><sub>1</sub>_language ğ”„<span class="hidden">â‡©</span><sub>2</sub>_language ğ”„<span class="hidden">â‡©</span><sub>3</sub>_language<span class="main">)</span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„'_alphabet<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DRA.alphabet <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ğ”„'_def ğ”„<span class="hidden">â‡©</span><sub>1</sub>_alphabet ğ”„<span class="hidden">â‡©</span><sub>2</sub>_alphabet ğ”„<span class="hidden">â‡©</span><sub>3</sub>_alphabet<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹A DRA for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">L</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">Ï†</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>â€º</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  This is the final constant constructing a deterministic Rabin automaton
  using the pure version of the  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> master_theorem<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
â€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ltl_to_dra</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">=</span> DRA_Combine.union_list <span class="main">(</span>map <span class="main">(</span><span class="main">Î»</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span><span class="main">.</span> ğ”„' <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">(</span>advice_sets <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_omega <span class="main">`</span> DRA.language <span class="main">(</span>ltl_to_dra <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> language_ltln <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">â‹‚</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">âˆˆ</span>set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">.</span> dra.alphabet <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">â‹ƒ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">âˆˆ</span>set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">.</span> dra.alphabet <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> advice_sets_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ğ”„'_alphabet<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"DRA.language <span class="main">(</span>DRA_Combine.union_list <span class="main">(</span>map <span class="main">(</span><span class="main">Î»</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> ğ”„' <span class="free">Ï†</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">â‹ƒ</span> <span class="main">(</span>DRA.language <span class="main">`</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">Î»</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> ğ”„' <span class="free">Ï†</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"language_ltln <span class="free">Ï†</span> <span class="main">=</span> <span class="main">â‹ƒ</span> <span class="main">{</span><span class="main">(</span>L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="bound">X</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="bound">X</span> <span class="bound">Y</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="bound">X</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">|</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ§</span> <span class="bound">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> master_theorem_language <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="main">â‹ƒ</span> <span class="main">{</span>L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="main">(</span>set <span class="bound">xs</span><span class="main">)</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="main">(</span>set <span class="bound">xs</span><span class="main">)</span> <span class="main">(</span>set <span class="bound">ys</span><span class="main">)</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="main">(</span>set <span class="bound">xs</span><span class="main">)</span> <span class="main">(</span>set <span class="bound">ys</span><span class="main">)</span> <span class="main">|</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">âˆˆ</span> set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> advice_sets_subformulas <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="main">â‹ƒ</span> <span class="main">{</span>to_omega <span class="main">`</span> DRA.language <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">|</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">âˆˆ</span> set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ğ”„'_language<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_to_dra_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_alphabet<span class="main">:</span>
  <span class="quoted"><span class="quoted">"alphabet <span class="main">(</span>ltl_to_dra <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ltl_to_dra_def ğ”„'_alphabet<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹A DRA for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">L</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">Ï†</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with Restricted Advice Setsâ€º</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  The following constant uses the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> master_theorem_restricted<span class="antiquote"><span class="antiquote">}</span></span></span></span> to reduce
  the size of the resulting automaton.
â€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ltl_to_dra_restricted</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">=</span> DRA_Combine.union_list <span class="main">(</span>map <span class="main">(</span><span class="main">Î»</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span><span class="main">.</span> ğ”„' <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">(</span>restricted_advice_sets <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_restricted_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_omega <span class="main">`</span> DRA.language <span class="main">(</span>ltl_to_dra_restricted <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> language_ltln <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">â‹‚</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">âˆˆ</span>set <span class="main">(</span>restricted_advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">.</span> dra.alphabet <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">â‹ƒ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">âˆˆ</span>set <span class="main">(</span>restricted_advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">.</span> dra.alphabet <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> restricted_advice_sets_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ğ”„'_alphabet<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"DRA.language <span class="main">(</span>DRA_Combine.union_list <span class="main">(</span>map <span class="main">(</span><span class="main">Î»</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> ğ”„' <span class="free">Ï†</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>restricted_advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">â‹ƒ</span> <span class="main">(</span>DRA.language <span class="main">`</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">Î»</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> ğ”„' <span class="free">Ï†</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>restricted_advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"language_ltln <span class="free">Ï†</span> <span class="main">=</span> <span class="main">â‹ƒ</span> <span class="main">{</span><span class="main">(</span>L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="bound">X</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="bound">X</span> <span class="bound">Y</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="bound">X</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">|</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">X</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span> <span class="main">âˆ§</span> <span class="bound">Y</span> <span class="main">âŠ†</span> subformulas<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">âˆ©</span> restricted_subformulas <span class="free">Ï†</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> master_theorem_restricted_language <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="main">â‹ƒ</span> <span class="main">{</span>L<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="main">(</span>set <span class="bound">xs</span><span class="main">)</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>2</sub> <span class="main">(</span>set <span class="bound">xs</span><span class="main">)</span> <span class="main">(</span>set <span class="bound">ys</span><span class="main">)</span> <span class="main">âˆ©</span> L<span class="hidden">â‡©</span><sub>3</sub> <span class="main">(</span>set <span class="bound">xs</span><span class="main">)</span> <span class="main">(</span>set <span class="bound">ys</span><span class="main">)</span> <span class="main">|</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">âˆˆ</span> set <span class="main">(</span>restricted_advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> restricted_advice_sets_subformulas <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="main">â‹ƒ</span> <span class="main">{</span>to_omega <span class="main">`</span> DRA.language <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">|</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">âˆˆ</span> set <span class="main">(</span>restricted_advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ğ”„'_language<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_to_dra_restricted_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_restricted_alphabet<span class="main">:</span>
  <span class="quoted"><span class="quoted">"alphabet <span class="main">(</span>ltl_to_dra_restricted <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ltl_to_dra_restricted_def ğ”„'_alphabet<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹A DRA for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">L</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">Ï†</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with a finite alphabetâ€º</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  Until this point, we use <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as the alphabet in all places.
  To explore the automaton, however, we need a way to fix the alphabet
  to some finite set.
â€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dra_set_alphabet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dra <span class="main">â‡’</span> <span class="tfree">'a</span> set set <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dra"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dra_set_alphabet</span> <span class="free"><span class="bound"><span class="entity">ğ”„</span></span></span> <span class="free"><span class="bound"><span class="entity">Î£</span></span></span> <span class="main">=</span> dra <span class="free"><span class="bound"><span class="entity">Î£</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">ğ”„</span></span></span><span class="main">)</span> <span class="main">(</span>transition <span class="free"><span class="bound"><span class="entity">ğ”„</span></span></span><span class="main">)</span> <span class="main">(</span>condition <span class="free"><span class="bound"><span class="entity">ğ”„</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dra_set_alphabet_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Î£</span> <span class="main">âŠ†</span> alphabet <span class="free">ğ”„</span> <span class="main">âŸ¹</span> language <span class="main">(</span>dra_set_alphabet <span class="free">ğ”„</span> <span class="free">Î£</span><span class="main">)</span> <span class="main">=</span> language <span class="free">ğ”„</span> <span class="main">âˆ©</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> sset <span class="bound">s</span> <span class="main">âŠ†</span> <span class="free">Î£</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dra_set_alphabet_def dra.language_def set_eq_iff dra.run_alt_def streams_iff_sset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dra_set_alphabet_alphabet<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"alphabet <span class="main">(</span>dra_set_alphabet <span class="free">ğ”„</span> <span class="free">Î£</span><span class="main">)</span> <span class="main">=</span> <span class="free">Î£</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dra_set_alphabet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> dra_set_alphabet_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Î£</span> <span class="main">âŠ†</span> alphabet <span class="free">ğ”„</span> <span class="main">âŸ¹</span> DRA.nodes <span class="main">(</span>dra_set_alphabet <span class="free">ğ”„</span> <span class="free">Î£</span><span class="main">)</span> <span class="main">âŠ†</span> DRA.nodes <span class="free">ğ”„</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dra_set_alphabet_def dra.nodes_alt_def dra.reachable_alt_def dra.path_alt_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ltl_to_dra_alphabet</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="free"><span class="bound"><span class="entity">Ap</span></span></span> <span class="main">=</span> dra_set_alphabet <span class="main">(</span>ltl_to_dra_restricted <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span>Pow <span class="free"><span class="bound"><span class="entity">Ap</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_alphabet_language<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"atoms_ltln <span class="free">Ï†</span> <span class="main">âŠ†</span> <span class="free">Ap</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"to_omega <span class="main">`</span> language <span class="main">(</span>ltl_to_dra_alphabet <span class="free">Ï†</span> <span class="free">Ap</span><span class="main">)</span> <span class="main">=</span> language_ltln <span class="free">Ï†</span> <span class="main">âˆ©</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> range <span class="bound">w</span> <span class="main">âŠ†</span> Pow <span class="free">Ap</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Pow <span class="free">Ap</span> <span class="main">âŠ†</span> alphabet <span class="main">(</span>ltl_to_dra_restricted <span class="free">Ï†</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltl_to_dra_restricted_alphabet <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltl_to_dra_alphabet_def dra_set_alphabet_language<span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_to_dra_restricted_language sset_range<span class="main">)</span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_alphabet_alphabet<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"alphabet <span class="main">(</span>ltl_to_dra_alphabet <span class="free">Ï†</span> <span class="free">Ap</span><span class="main">)</span> <span class="main">=</span> Pow <span class="free">Ap</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_to_dra_alphabet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_alphabet_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DRA.nodes <span class="main">(</span>ltl_to_dra_alphabet <span class="free">Ï†</span> <span class="free">Ap</span><span class="main">)</span> <span class="main">âŠ†</span> DRA.nodes <span class="main">(</span>ltl_to_dra_restricted <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_to_dra_alphabet_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dra_set_alphabet_nodes<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_to_dra_restricted_alphabet<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Verified Bounds for Number of Nodesâ€º</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  Using two additional assumptions, we can show a double-exponential size bound
  for the constructed automaton.
â€º</span></span>

<span class="comment1">(* TODO add to HOL/Groups_List.thy *)</span>
<span class="keyword1"><span class="command">lemma</span></span> list_prod_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">â‰¤</span> <span class="free">g</span> <span class="main">âŸ¹</span> <span class="main">(</span><span class="main">âˆ</span><span class="bound">x</span><span class="main">â†</span><span class="free">xs</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="main">(</span><span class="main">âˆ</span><span class="bound">x</span><span class="main">â†</span><span class="free">xs</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">â‡’</span> nat"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_funD mult_le_mono<span class="main">)</span>

<span class="comment1">(* TODO add to HOL/Groups_List.thy *)</span>
<span class="keyword1"><span class="command">lemma</span></span> list_prod_const<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">â‹€</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> set <span class="free">xs</span> <span class="main">âŸ¹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">â‰¤</span> <span class="free">c</span><span class="main">)</span> <span class="main">âŸ¹</span> <span class="main">(</span><span class="main">âˆ</span><span class="bound">x</span><span class="main">â†</span><span class="free">xs</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">c</span> <span class="main">^</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">â‡’</span> nat"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_le_mono<span class="main">)</span>

<span class="comment1">(* TODO add to HOL/Finite_Set.thy *)</span>
<span class="keyword1"><span class="command">lemma</span></span> card_insert_Suc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="free">x</span> <span class="free">S</span><span class="main">)</span> <span class="main">â‰¤</span> Suc <span class="main">(</span>card <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_n_not_le_n card.infinite card_insert_if finite_insert linear<span class="main">)</span>

<span class="comment1">(* TODO add to HOL/Power.thy *)</span>
<span class="keyword1"><span class="command">lemma</span></span> nat_power_le_imp_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">âŸ¹</span> <span class="free">a</span> <span class="main">â‰¤</span> <span class="free">b</span> <span class="main">âŸ¹</span> <span class="free">x</span> <span class="main">^</span> <span class="free">a</span> <span class="main">â‰¤</span> <span class="free">x</span> <span class="main">^</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leD linorder_le_less_linear nat_power_less_imp_less neq0_conv power_eq_0_iff<span class="main">)</span>

<span class="comment1">(* TODO add to HOL/Power.thy *)</span>
<span class="keyword1"><span class="command">lemma</span></span> const_less_power<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_trans_Suc<span class="main">)</span>

<span class="comment1">(* TODO add to HOL-Library/Log_Nat.thy *)</span>
<span class="keyword1"><span class="command">lemma</span></span> floorlog_le_const<span class="main">:</span>
  <span class="quoted"><span class="quoted">"floorlog <span class="free">x</span> <span class="free">n</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> floorlog_eq_zero_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Suc_lessI floorlog_le_iff le_SucI power_inject_exp<span class="main">)</span>


<span class="keyword1"><span class="command">locale</span></span> dra_construction_size <span class="main">=</span> dra_construction <span class="main">+</span> transition_functions_size <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    equiv_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">âŸ¹</span> finite <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    equiv_card<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">âŸ¹</span> card <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="free">P</span><span class="main">}</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="free">P</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_lifted_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> range <span class="main">(</span><span class="keyword1">â†‘af<span class="hidden">â‡©</span><sub>F</sub></span> <span class="free">Ï†</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ïˆ</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ†</span>  <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_lifted_semantics af<span class="hidden">â‡©</span><sub>F</sub>_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_lifted_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> range <span class="main">(</span><span class="keyword1">â†‘af<span class="hidden">â‡©</span><sub>G</sub></span> <span class="free">Ï†</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">Ïˆ</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ†</span>  <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_lifted_semantics af<span class="hidden">â‡©</span><sub>G</sub>_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_def
  <span class="keyword1"><span class="command">using</span></span> af_lifted_semantics af_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_def dba.nodes_alt_def dba.reachable_alt_def
  <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_nested_prop_atoms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> af<span class="hidden">â‡©</span><sub>F</sub>_lifted_semantics<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_def
  <span class="keyword1"><span class="command">using</span></span> af_lifted_semantics af_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_def dca.nodes_alt_def dca.reachable_alt_def
  <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_nested_prop_atoms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> af<span class="hidden">â‡©</span><sub>G</sub>_lifted_semantics<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> â„­_nodes_normalise<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DCA.nodes <span class="main">(</span>â„­ <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span><span class="main">}</span> <span class="main">Ã—</span> <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="main">(</span><span class="free">normalise</span> <span class="free">Ï†</span><span class="main">)</span> <span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„­_def dca.nodes_alt_def dca.reachable_alt_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_fst_nested_prop_atoms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice_nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> af<span class="hidden">â‡©</span><sub>Î½</sub>_snd_nested_prop_atoms Abs_eq af<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics fst_conv normalise_eq snd_conv sup.absorb_iff1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> â„­_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DCA.nodes <span class="main">(</span>â„­ <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span><span class="main">}</span> <span class="main">Ã—</span> <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> â„­_def dca.nodes_alt_def dca.reachable_alt_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> af<span class="hidden">â‡©</span><sub>Î½</sub>_fst_nested_prop_atoms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> GF_advice_nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> af<span class="hidden">â‡©</span><sub>Î½</sub>_snd_nested_prop_atoms fst_eqD nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_subset normalise_nested_propos order_refl order_trans snd_eqD sup.order_iff<span class="main">)</span>



<span class="keyword1"><span class="command">lemma</span></span> equiv_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span><span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="free">P</span><span class="main">}</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span><span class="bound">Ïˆ</span><span class="main">.</span> prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prop_atoms_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_finite'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">âŸ¹</span> finite <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> equiv_finite equiv_subset finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_card'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">âŸ¹</span> card <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="free">P</span><span class="main">}</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> equiv_card equiv_subset equiv_finite card_mono le_trans<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> equiv_finite'<span class="main">[</span><span class="operator">OF</span> Equivalence_Relations.nested_prop_atoms_finite<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span><span class="main">}</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>nested_prop_atoms <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> equiv_card'<span class="main">[</span><span class="operator">OF</span> Equivalence_Relations.nested_prop_atoms_finite<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> equiv_finite'<span class="main">[</span><span class="operator">OF</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_finite<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span><span class="main">}</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>nested_prop_atoms <span class="free">Ï†</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">â‰¤</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_finite Advice.nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_finite equiv_finite<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">â‰¤</span> card <span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_mono equiv_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_card<span class="main">[</span><span class="operator">OF</span> Advice.nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_finite<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_nodes_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_nodes nested_prop_atoms_finite<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_nodes_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_nodes nested_prop_atoms_finite<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_nodes_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_trans<span class="main">[</span><span class="operator">OF</span> card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nested_prop_atoms_finite ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_nodes<span class="main"><span class="main">]</span></span> nested_prop_atoms_card<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_nodes_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_trans<span class="main">[</span><span class="operator">OF</span> card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nested_prop_atoms_finite ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_nodes<span class="main"><span class="main">]</span></span> nested_prop_atoms_card<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_nodes_finite_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_all <span class="main">(</span>finite <span class="main">âˆ˜</span> DBA.nodes<span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span>set <span class="free">ys</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list.pred_map list_all_iff ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_nodes_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_nodes_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>2</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_def <span class="keyword1"><span class="command">using</span></span> DBA_Combine.intersect_list_nodes_finite ğ”„<span class="hidden">â‡©</span><sub>2</sub>_nodes_finite_helper <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>3</sub>_nodes_finite_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_all <span class="main">(</span>finite <span class="main">âˆ˜</span> DCA.nodes<span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span>set <span class="free">xs</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list.pred_map list_all_iff ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_nodes_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>3</sub>_nodes_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>3</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>3</sub>_def <span class="keyword1"><span class="command">using</span></span> DCA_Combine.intersect_list_nodes_finite ğ”„<span class="hidden">â‡©</span><sub>3</sub>_nodes_finite_helper <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_nodes_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="free">xs</span> <span class="main">âŸ¹</span> card <span class="main">(</span>nested_prop_atoms <span class="bound">Ïˆ</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"card <span class="main">(</span>DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>2</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="free">xs</span> <span class="main">âŸ¹</span> card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="bound">Ïˆ</span><span class="main">[</span>set <span class="free">ys</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> Suc <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="free">xs</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ</span><span class="main">[</span>set <span class="free">ys</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">â‰¤</span> Suc <span class="main">(</span>card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="skolem">Ïˆ</span><span class="main">[</span>set <span class="free">ys</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_Suc<span class="main">)</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> Suc <span class="main">(</span>card <span class="main">(</span>nested_prop_atoms <span class="skolem">Ïˆ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FG_advice_nested_prop_atoms_card<span class="main">)</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> Suc <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="free">xs</span>â€º</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="skolem">Ïˆ</span><span class="main">[</span>set <span class="free">ys</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">âˆ</span><span class="bound">Ïˆ</span><span class="main">â†</span><span class="free">xs</span><span class="main">.</span> card <span class="main">(</span>DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span>set <span class="free">ys</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">â‰¤</span> <span class="main">(</span><span class="main">âˆ</span><span class="bound">Ïˆ</span><span class="main">â†</span><span class="free">xs</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span>set <span class="free">ys</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_prod_mono<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF_nodes_card le_fun_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">^</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_prod_const<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> 1 Suc_leI nat_power_le_imp_le nat_power_eq_Suc_0_iff neq0_conv pos2 zero_less_power<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> nat_power_le_imp_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Groups.mult_ac<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> power_mult<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> floorlog_bounds less_imp_le_nat<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">âˆ</span><span class="bound">Ïˆ</span><span class="main">â†</span><span class="free">xs</span><span class="main">.</span> card <span class="main">(</span>DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span>set <span class="free">ys</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>2</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> max <span class="main">1</span> <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">âˆ</span><span class="bound">Ïˆ</span><span class="main">â†</span><span class="free">xs</span><span class="main">.</span> card <span class="main">(</span>DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span>set <span class="free">ys</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î¼</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> DBA_Combine.intersect_list_nodes_card<span class="main">[</span><span class="operator">OF</span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_nodes_finite_helper<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_def comp_def<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> max <span class="main">1</span> <span class="free">n</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_mono<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>floorlog <span class="numeral">2</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> floorlog_bounds less_imp_le_nat<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> floorlog_le_const<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> const_less_power Suc_1 add_Suc_right add_leE lessI less_imp_le_nat power_Suc<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>3</sub>_nodes_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="free">ys</span> <span class="main">âŸ¹</span> card <span class="main">(</span>nested_prop_atoms <span class="bound">Ïˆ</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"card <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>3</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="free">ys</span> <span class="main">âŸ¹</span> card <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span>set <span class="free">xs</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ïˆ</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="free">ys</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span>set <span class="free">xs</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span>
          <span class="main">â‰¤</span> Suc <span class="main">(</span>card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="skolem">Ïˆ</span><span class="main">[</span>set <span class="free">xs</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_Suc<span class="main">)</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> Suc <span class="main">(</span>card <span class="main">(</span>nested_prop_atoms <span class="skolem">Ïˆ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GF_advice_nested_prop_atoms_card<span class="main">)</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> Suc <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="free">ys</span>â€º</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nested_prop_atoms <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ïˆ</span><span class="main">[</span>set <span class="free">xs</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">Ïˆ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG_nodes_card<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> one_le_numeral power_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>3</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="main">(</span><span class="main">âˆ</span><span class="bound">Ïˆ</span><span class="main">â†</span><span class="free">ys</span><span class="main">.</span> card <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG <span class="main">(</span><span class="bound">Ïˆ</span><span class="main">[</span>set <span class="free">xs</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>3</sub>_def <span class="keyword1"><span class="command">using</span></span> DCA_Combine.intersect_list_nodes_card<span class="main">[</span><span class="operator">OF</span> ğ”„<span class="hidden">â‡©</span><sub>3</sub>_nodes_finite_helper<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">^</span> length <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_prod_const<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> power_increasing<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_refl mult.commute power_mult<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">â€¹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>â€º</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> floorlog_bounds less_imp_le_nat<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_nodes_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> finite_subset â„­_nodes finite_SigmaI nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_finite nested_prop_atoms_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_nodes_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"card <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fst</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?snd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">Abs</span> <span class="bound">Ïˆ</span> <span class="main">|</span> <span class="bound">Ïˆ</span><span class="main">.</span> nested_prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub> <span class="free">Ï†</span> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nested_prop_atoms <span class="free">Ï†</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subfrmlsn_finite nested_prop_atoms_subfrmlsn<span class="main"><span class="main">]</span></span> assms le_trans<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">(</span><span class="var">?fst</span> <span class="main">Ã—</span> <span class="var">?snd</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> â„­_nodes nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_finite nested_prop_atoms_finite<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> card <span class="var">?fst</span> <span class="main">*</span> card <span class="var">?snd</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_finite card_cartesian_product <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>nested_prop_atoms <span class="free">Ï†</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>nested_prop_atoms <span class="free">Ï†</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nested_prop_atoms<span class="hidden">â‡©</span><sub>Î½</sub>_card nested_prop_atoms_card mult_le_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>card <span class="main">(</span>nested_prop_atoms <span class="free">Ï†</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>36<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ğ”„'_nodes_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>DRA.nodes <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ğ”„'_def
  <span class="keyword1"><span class="command">using</span></span> intersect_nodes_finite intersect_bc_nodes_finite
  <span class="keyword1"><span class="command">using</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_nodes_finite ğ”„<span class="hidden">â‡©</span><sub>2</sub>_nodes_finite ğ”„<span class="hidden">â‡©</span><sub>3</sub>_nodes_finite
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> ğ”„'_nodes_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="free">xs</span> <span class="main">âŸ¹</span> card <span class="main">(</span>nested_prop_atoms <span class="bound">Ïˆ</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">Ïˆ</span><span class="main">.</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="free">ys</span> <span class="main">âŸ¹</span> card <span class="main">(</span>nested_prop_atoms <span class="bound">Ïˆ</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"card <span class="main">(</span>DRA.nodes <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">â‰¤</span> <span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_le_numeral power_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>DRA.nodes <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> card <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>2</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>DCA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>3</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">â‰¤</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> ğ”„'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>DBA.nodes <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>2</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>DCA.nodes <span class="main">(</span>DCA_Combine.intersect <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>3</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="var">?rhs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intersect_nodes_card<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_nodes_finite ğ”„<span class="hidden">â‡©</span><sub>3</sub>_nodes_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>DRA.nodes <span class="main">(</span>intersect_bc <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>2</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">(</span>DCA_Combine.intersect <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>1</sub> <span class="free">Ï†</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>ğ”„<span class="hidden">â‡©</span><sub>3</sub> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="var">?rhs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> intersect_bc_nodes_card<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_nodes_finite intersect_nodes_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_nodes_finite ğ”„<span class="hidden">â‡©</span><sub>3</sub>_nodes_finite<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> basic_trans_rules<span class="main"><span class="main">(</span></span>23<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub>_nodes_card<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> ğ”„<span class="hidden">â‡©</span><sub>2</sub>_nodes_card<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> ğ”„<span class="hidden">â‡©</span><sub>3</sub>_nodes_card<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_le_mono<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power_add<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> power_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subformula_nested_prop_atoms_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ïˆ</span> <span class="main">âˆˆ</span> subfrmlsn <span class="free">Ï†</span> <span class="main">âŸ¹</span> nested_prop_atoms <span class="free">Ïˆ</span> <span class="main">âŠ†</span> subfrmlsn <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nested_prop_atoms_subfrmlsn subfrmlsn_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_nodes_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>DRA.nodes <span class="main">(</span>ltl_to_dra <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_to_dra_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DRA_Combine.union_list_nodes_finite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_def ğ”„'_alphabet advice_sets_not_empty<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list.pred_set split_def ğ”„'_nodes_finite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_restricted_nodes_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>DRA.nodes <span class="main">(</span>ltl_to_dra_restricted <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_to_dra_restricted_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DRA_Combine.union_list_nodes_finite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_def ğ”„'_alphabet advice_sets_not_empty<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list.pred_set split_def ğ”„'_nodes_finite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_alphabet_nodes_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>DRA.nodes <span class="main">(</span>ltl_to_dra_alphabet <span class="free">Ï†</span> <span class="free">AP</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_to_dra_alphabet_nodes ltl_to_dra_restricted_nodes_finite finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_nodes_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"card <span class="main">(</span>DRA.nodes <span class="main">(</span>ltl_to_dra <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?map</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">Î»</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> ğ”„' <span class="free">Ï†</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">âŸ¹</span> <span class="bound">x</span> <span class="main">^</span> length <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> advice_sets_length linorder_not_less nat_power_less_imp_less<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>DRA.nodes <span class="main">(</span>ltl_to_dra <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> prod_list <span class="main">(</span>map <span class="main">(</span>card <span class="main">âˆ˜</span> DRA.nodes<span class="main">)</span> <span class="var">?map</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltl_to_dra_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DRA_Combine.union_list_nodes_card<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> list.pred_set <span class="keyword1"><span class="command">using</span></span> ğ”„'_nodes_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="main">(</span><span class="main">âˆ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">â†</span>advice_sets <span class="free">Ï†</span><span class="main">.</span> card <span class="main">(</span>DRA.nodes <span class="main">(</span>ğ”„' <span class="free">Ï†</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"advice_sets <span class="free">Ï†</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_apply split_def<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> length <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> list_prod_const<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> split_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ğ”„'_nodes_card<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> length <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> advice_sets_element_length assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span> <span class="bound">Ïˆ</span><span class="main">.</span> <span class="main">âŸ¦</span><span class="bound">x</span> <span class="main">âˆˆ</span> set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">;</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> card <span class="main">(</span>nested_prop_atoms <span class="bound">Ïˆ</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> advice_sets_element_subfrmlsn<span class="main">(</span>1<span class="main">)</span> assms subformula_nested_prop_atoms_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î¼</sub>_subfrmlsn
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> card_mono subfrmlsn_finite subset_iff sup.absorb_iff2 sup.coboundedI1 surjective_pairing<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŸ¹</span> length <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> advice_sets_element_length assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span> <span class="bound">Ïˆ</span><span class="main">.</span> <span class="main">âŸ¦</span><span class="bound">x</span> <span class="main">âˆˆ</span> set <span class="main">(</span>advice_sets <span class="free">Ï†</span><span class="main">)</span><span class="main">;</span> <span class="bound">Ïˆ</span> <span class="main">âˆˆ</span> set <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> card <span class="main">(</span>nested_prop_atoms <span class="bound">Ïˆ</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> advice_sets_element_subfrmlsn<span class="main">(</span>2<span class="main">)</span> assms subformula_nested_prop_atoms_subfrmlsn subformulas<span class="hidden">â‡©</span><sub>Î½</sub>_subfrmlsn
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> card_mono subfrmlsn_finite subset_iff sup.absorb_iff2 sup.coboundedI1 surjective_pairing<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>subfrmlsn <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">â‰¤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms power_increasing<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> power_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">â€¦</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_2 power_add<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹We verify the size bound of the automaton to be double exponential.â€º</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ltl_to_dra_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>DRA.nodes <span class="main">(</span>ltl_to_dra <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> size <span class="free">Ï†</span> <span class="main">+</span> floorlog <span class="numeral">2</span> <span class="main">(</span>size <span class="free">Ï†</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_to_dra_nodes_card subfrmlsn_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DRA_Implementation">
<div class="head">
<h1>Theory DRA_Implementation</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Implementation of the DRA Constructionâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> DRA_Implementation
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="DRA_Construction.html">DRA_Construction</a>
  <a href="../LTL/Rewriting.html">LTL.Rewriting</a>
  <a href="../Transition_Systems_and_Automata/DRA_Translate.html">Transition_Systems_and_Automata.DRA_Translate</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Generating the Explicit Automatonâ€º</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  We convert the implicit automaton to its explicit representation
  and afterwards proof the final correctness theorem and the overall
  size bound.
â€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dra_to_drai</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dra <span class="main">â‡’</span> <span class="tfree">'a</span> list <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> drai"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dra_to_drai</span> <span class="free"><span class="bound"><span class="entity">ğ”„</span></span></span> <span class="free"><span class="bound"><span class="entity">Î£</span></span></span> <span class="main">=</span> drai <span class="free"><span class="bound"><span class="entity">Î£</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">ğ”„</span></span></span><span class="main">)</span> <span class="main">(</span>transition <span class="free"><span class="bound"><span class="entity">ğ”„</span></span></span><span class="main">)</span> <span class="main">(</span>condition <span class="free"><span class="bound"><span class="entity">ğ”„</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dra_to_drai_language<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">Î£</span> <span class="main">=</span> alphabet <span class="free">ğ”„</span> <span class="main">âŸ¹</span> language <span class="main">(</span>drai_dra <span class="main">(</span>dra_to_drai <span class="free">ğ”„</span> <span class="free">Î£</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> language <span class="free">ğ”„</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dra_to_drai_def drai_dra_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">drai_to_draei</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">::</span> hashable<span class="main">)</span> drai <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> nat<span class="main">)</span> draei"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">drai_to_draei</span> <span class="free"><span class="bound"><span class="entity">hms</span></span></span> <span class="main">=</span> to_draei_impl <span class="main">(=)</span> bounded_hashcode_nat <span class="free"><span class="bound"><span class="entity">hms</span></span></span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> dra_to_drai_rel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Î£</span><span class="main">,</span> alphabet <span class="free">A</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">âŸ¨</span>Id<span class="main">âŸ©</span> list_set_rel"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>dra_to_drai <span class="free">A</span> <span class="free">Î£</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">âŸ¨</span>Id<span class="main">,</span> Id<span class="main">âŸ©</span>drai_dra_rel"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">âŸ¨</span>Id<span class="main">,</span> Id<span class="main">âŸ©</span>dra_rel"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dra_to_drai <span class="free">A</span> <span class="free">Î£</span><span class="main">,</span> dra <span class="main">(</span>alphabet <span class="free">A</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">A</span><span class="main">)</span> <span class="main">(</span>transition <span class="free">A</span><span class="main">)</span> <span class="main">(</span>condition <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">âŸ¨</span>Id<span class="main">,</span> Id<span class="main">âŸ©</span>drai_dra_rel"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dra_to_drai_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">parametricity</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> draei_language_rel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'label</span><span class="main">,</span> <span class="tfree">'state</span> <span class="main">::</span> hashable<span class="main">)</span> dra"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Î£</span><span class="main">,</span> alphabet <span class="free">A</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">âŸ¨</span>Id<span class="main">âŸ©</span> list_set_rel"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="main">(</span>DRA.nodes <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"is_valid_def_hm_size <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'state</span><span class="main">)</span> <span class="free">hms</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"DRA.language <span class="main">(</span>drae_dra <span class="main">(</span>draei_drae <span class="main">(</span>drai_to_draei <span class="free">hms</span> <span class="main">(</span>dra_to_drai <span class="free">A</span> <span class="free">Î£</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> DRA.language <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dra_to_drai <span class="free">A</span> <span class="free">Î£</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">âŸ¨</span>Id<span class="main">,</span> Id<span class="main">âŸ©</span>drai_dra_rel"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dra_to_drai_rel assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>drai_to_draei <span class="free">hms</span> <span class="main">(</span>dra_to_drai <span class="free">A</span> <span class="free">Î£</span><span class="main">)</span><span class="main">,</span> to_draei <span class="free">A</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">âŸ¨</span>Id_on <span class="main">(</span>dra.alphabet <span class="free">A</span><span class="main">)</span><span class="main">,</span> rel <span class="main">(</span>dra_to_drai <span class="free">A</span> <span class="free">Î£</span><span class="main">)</span> <span class="free">A</span> <span class="main">(=)</span> bounded_hashcode_nat <span class="free">hms</span><span class="main">âŸ©</span> draei_dra_rel"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> drai_to_draei_def
    <span class="keyword1"><span class="command">using</span></span> to_draei_impl_refine<span class="main">[</span><span class="operator">unfolded</span> <span class="dynamic"><span class="dynamic">autoref_tag_defs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">parametricity</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms is_bounded_hashcode_def bounded_hashcode_nat_bounds<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DRA.language <span class="main">(</span><span class="main">(</span>drae_dra <span class="main">âˆ˜</span> draei_drae<span class="main">)</span> <span class="main">(</span>drai_to_draei <span class="free">hms</span> <span class="main">(</span>dra_to_drai <span class="free">A</span> <span class="free">Î£</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> DRA.language <span class="main">(</span>id <span class="main">(</span>to_draei <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">âŸ¨</span><span class="main">âŸ¨</span>Id_on <span class="main">(</span>dra.alphabet <span class="free">A</span><span class="main">)</span><span class="main">âŸ©</span> stream_rel<span class="main">âŸ©</span> set_rel"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">parametricity</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_draei_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Defining the Alphabetâ€º</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">atoms_ltlc_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc <span class="main">â‡’</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="keyword1">true<span class="hidden">â‡©</span><sub>c</sub></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="keyword1">false<span class="hidden">â‡©</span><sub>c</sub></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="keyword1">prop<span class="hidden">â‡©</span><sub>c</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="main">(</span><span class="keyword1">not<span class="hidden">â‡©</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">implies<span class="hidden">â‡©</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">â‡©</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">â‡©</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">â‡©</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> List.union <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">atoms_ltlc_list</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> atoms_ltlc_list_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>atoms_ltlc_list <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> atoms_ltlc <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> atoms_ltlc_list_distinct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>atoms_ltlc_list <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ltl_alphabet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">â‡’</span> <span class="tfree">'a</span> set list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltl_alphabet</span> <span class="free"><span class="bound"><span class="entity">AP</span></span></span> <span class="main">=</span> map set <span class="main">(</span>subseqs <span class="free"><span class="bound"><span class="entity">AP</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹The Final Constantâ€º</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  We require the quotient type to be hashable in order to efficiently explore the automaton.
â€º</span></span>

<span class="keyword1"><span class="command">locale</span></span> dra_implementation <span class="main">=</span> dra_construction_size _ _ _ <span class="quoted"><span class="free">Abs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Abs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'ltlq</span> <span class="main">::</span> hashable"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ltln_to_draei</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">â‡’</span> <span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> nat<span class="main">)</span> draei"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltln_to_draei</span> <span class="free"><span class="bound"><span class="entity">AP</span></span></span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">=</span> drai_to_draei <span class="main">(</span>Suc <span class="main">(</span>size <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>dra_to_drai <span class="main">(</span>ltl_to_dra_alphabet <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">AP</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ltl_alphabet <span class="free"><span class="bound"><span class="entity">AP</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ltlc_to_draei</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> nat<span class="main">)</span> draei"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_draei</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">=</span> ltln_to_draei <span class="main">(</span>atoms_ltlc_list <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="main">(</span>simplify Slow <span class="main">(</span>ltlc_to_ltln <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ltl_to_dra_alphabet_rel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"distinct <span class="free">AP</span> <span class="main">âŸ¹</span> <span class="main">(</span>ltl_alphabet <span class="free">AP</span><span class="main">,</span> alphabet <span class="main">(</span>ltl_to_dra_alphabet <span class="free">Ïˆ</span> <span class="main">(</span>set <span class="free">AP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">âŸ¨</span>Id<span class="main">âŸ©</span> list_set_rel"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_to_dra_alphabet_alphabet ltl_alphabet_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_set_rel_def in_br_conv subseqs_powset distinct_set_subseqs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltlc_to_ltln_simplify_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>simplify Slow <span class="main">(</span>ltlc_to_ltln <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ†</span> atoms_ltlc <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltlc_to_ltln_atoms simplify_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_def_hm_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_valid_def_hm_size <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'state</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>size <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">Ï†</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_valid_def_hm_size_def
  <span class="keyword1"><span class="command">using</span></span> ltln.size_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> final_correctness<span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_omega <span class="main">`</span> language <span class="main">(</span>drae_dra <span class="main">(</span>draei_drae <span class="main">(</span>ltlc_to_draei <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> language_ltlc <span class="free">Ï†</span> <span class="main">âˆ©</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> range <span class="bound">w</span> <span class="main">âŠ†</span> Pow <span class="main">(</span>atoms_ltlc <span class="free">Ï†</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltlc_to_draei_def ltln_to_draei_def
  <span class="keyword1"><span class="command">unfolding</span></span> draei_language_rel<span class="main">[</span><span class="operator">OF</span> ltl_to_dra_alphabet_rel<span class="main"><span class="main">[</span></span><span class="operator">OF</span> atoms_ltlc_list_distinct<span class="main"><span class="main">]</span></span> ltl_to_dra_alphabet_nodes_finite valid_def_hm_size<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> atoms_ltlc_list_set
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_to_dra_alphabet_language<span class="main">[</span><span class="operator">OF</span> ltlc_to_ltln_simplify_atoms<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltlc_to_ltln_atoms language_ltln_def language_ltlc_def ltlc_to_ltln_semantics simplify_correct <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Extra_Equivalence_Relations">
<div class="head">
<h1>Theory Extra_Equivalence_Relations</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Salomon Sickert
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Additional Equivalence Relationsâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> Extra_Equivalence_Relations
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../LTL/LTL.html">LTL.LTL</a> <a href="../LTL/Equivalence_Relations.html">LTL.Equivalence_Relations</a> <a href="After.html">After</a> <a href="Advice.html">Advice</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Propositional Equivalence with Implicit LTL Unfoldingâ€º</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Unf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Unf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Unf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">W<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Unf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Unf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">R<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Unf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">and<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Unf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1">or<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Unf</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unf_sound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> Unf <span class="free">Ï†</span> <span class="main">âŸ·</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> less_linear not_less0 suffix_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> less_linear not_less0 suffix_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> bot.extremum_unique bot_nat_def less_eq_nat.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> suffix_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Unf_lang_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> Unf <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Unf_sound ltl_lang_equiv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Unf_idem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Unf <span class="main">(</span>Unf <span class="free">Ï†</span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> Unf <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ltl_prop_equiv_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ltl_prop_unfold_equiv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">â‡’</span> <span class="tfree">'a</span> ltln <span class="main">â‡’</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span>"</span> 75<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="keyword1"><span class="free">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span></span> <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span> <span class="main">â‰¡</span> <span class="main">(</span>Unf <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> <span class="main">(</span>Unf <span class="free"><span class="bound"><span class="entity">Ïˆ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_unfold_equiv_equivp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivp <span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>Q</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltl_prop_equiv_equivp ltl_prop_unfold_equiv_def equivpI equivp_def reflpI sympI transpI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unfolding_prop_unfold_idem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Unf <span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span> <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_prop_unfold_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Unf_idem<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unfolding_is_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"Unf <span class="free">Ï†</span> <span class="main">=</span> subst <span class="free">Ï†</span> <span class="main">(</span><span class="main">Î»</span><span class="bound">Ïˆ</span><span class="main">.</span> Some <span class="main">(</span>Unf <span class="bound">Ïˆ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_implies_ltl_prop_unfold_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span> <span class="free">Ïˆ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltl_prop_unfold_equiv_def unfolding_is_subst subst_respects_ltl_prop_entailment<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_unfold_equiv_implies_ltl_lang_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span> <span class="free">Ïˆ</span> <span class="main">âŸ¹</span> <span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>L</sub></span> <span class="free">Ïˆ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltl_prop_equiv_implies_ltl_lang_equiv ltl_lang_equiv_def Unf_sound ltl_prop_unfold_equiv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_unfold_equiv_gt_and_lt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>C</sub>)</span> <span class="main">â‰¤</span> <span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>Q</sub>)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>P</sub>)</span> <span class="main">â‰¤</span> <span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>Q</sub>)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>Q</sub>)</span> <span class="main">â‰¤</span> <span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>L</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_prop_equiv_implies_ltl_prop_unfold_equiv ltl_prop_equivalence.ge_const_equiv ltl_prop_unfold_equiv_implies_ltl_lang_equiv
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">quotient_type</span></span> <span class="tfree">'a</span> ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span> <span class="main">/</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>Q</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ltl_prop_unfold_equiv_equivp<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">equal</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ltln<span class="hidden">â‡©</span><sub>Q</sub>_eq_test <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">â‡’</span> <span class="tfree">'a</span> ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">â‡’</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">Î»</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltln<span class="hidden">â‡©</span><sub>Q</sub>.abs_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  eq<span class="hidden">â‡©</span><sub>Q</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"equal_class.equal <span class="main">â‰¡</span> ltln<span class="hidden">â‡©</span><sub>Q</sub>_eq_test"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="hidden">â‡©</span><sub>Q</sub> ltln<span class="hidden">â‡©</span><sub>Q</sub>_eq_test.rep_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Quotient_ltln<span class="hidden">â‡©</span><sub>Q</sub> Quotient_rel_rep<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter_unfolding<span class="main">:</span>
  <span class="quoted"><span class="quoted">"af_letter <span class="main">(</span>Unf <span class="free">Ï†</span><span class="main">)</span> <span class="free">Î½</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> af_letter <span class="free">Ï†</span> <span class="free">Î½</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_equiv_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> af_letter_prop_unfold_congruent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span> <span class="free">Ïˆ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"af_letter <span class="free">Ï†</span> <span class="free">Î½</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span> af_letter <span class="free">Ïˆ</span> <span class="free">Î½</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Unf <span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> Unf <span class="free">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_unfold_equiv_def ltl_prop_equiv_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af_letter <span class="main">(</span>Unf <span class="free">Ï†</span><span class="main">)</span> <span class="free">Î½</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> af_letter <span class="main">(</span>Unf <span class="free">Ïˆ</span><span class="main">)</span> <span class="free">Î½</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prop_af_congruent.af_letter_congruent<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"af_letter <span class="free">Ï†</span> <span class="free">Î½</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> af_letter <span class="free">Ïˆ</span> <span class="free">Î½</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> af_letter_unfolding ltl_prop_equivalence.eq_sym ltl_prop_equivalence.eq_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"af_letter <span class="free">Ï†</span> <span class="free">Î½</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span> af_letter <span class="free">Ïˆ</span> <span class="free">Î½</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ltl_prop_equiv_implies_ltl_prop_unfold_equiv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_advice_prop_unfold_congruent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span> <span class="free">Ïˆ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Unf <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span> <span class="main">(</span>Unf <span class="free">Ïˆ</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Unf <span class="free">Ï†</span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> Unf <span class="free">Ïˆ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_unfold_equiv_def ltl_prop_equiv_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Unf <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>P</sub></span> <span class="main">(</span>Unf <span class="free">Ïˆ</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GF_advice_prop_congruent<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Unf <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="keyword1">âˆ¼<span class="hidden">â‡©</span><sub>Q</sub></span> <span class="main">(</span>Unf <span class="free">Ïˆ</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_equiv_implies_ltl_prop_unfold_equiv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> prop_unfold_equivalence<span class="main">:</span> ltl_equivalence <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>Q</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> ltl_prop_unfold_equiv_equivp ltl_prop_unfold_equiv_gt_and_lt<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> af_congruent <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>Q</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">rule</span> af_letter_prop_unfold_congruent<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unfolding_monotonic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âŸ¹</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>Unf <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">U<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ltln_expand_Release <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ltln_expand_WeakUntil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Ï†1</span> <span class="keyword1">M<span class="hidden">â‡©</span><sub>n</sub></span> <span class="skolem">Ï†2</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> unfolding_next_step_equivalent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>Unf <span class="free">Ï†</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âŸ¹</span> suffix <span class="main">1</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> <span class="main">(</span>af_letter <span class="free">Ï†</span> <span class="main">(</span><span class="free">w</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">Ï†</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Unf.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice_af_letter build_split<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Unf.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> GF_advice.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> GF_advice_af_letter af_letter.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> build_split semantics_ltln.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Unf.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> GF_advice.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> GF_advice_af_letter One_nat_def af_letter.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> build_first semantics_ltln.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Unf.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> GF_advice.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> GF_advice_af_letter af_letter.simps<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> build_split semantics_ltln.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">Ï†1</span> <span class="skolem">Ï†2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Unf.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GF_advice.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> GF_advice.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> GF_advice_af_letter af_letter.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> build_split semantics_ltln.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms_Unf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="main">(</span>Unf <span class="free">Ï†</span><span class="main">)</span> <span class="main">âŠ†</span> nested_prop_atoms <span class="free">Ï†</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ï†</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(* TODO move somewhere?? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> refine_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">âŸ¶</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">â‰¥</span> card <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">âŠ†</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">X</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_subset_image subset_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="free">g</span> <span class="main">`</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="free">X</span>â€º</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Y_def image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`</span> <span class="free">X</span> <span class="main">=</span> <span class="free">g</span> <span class="main">`</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">â€¹<span class="skolem">Y</span> <span class="main">âŠ†</span> <span class="free">X</span>â€º</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">â€¹finite <span class="skolem">Y</span>â€º</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">â‰¥</span> card <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">F</span> <span class="main">âŸ¹</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="free">g</span> <span class="main">`</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_if<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span> card_insert_if<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">â‰¥</span> card <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def <span class="quoted"><span class="quoted">â€¹<span class="free">g</span> <span class="main">`</span> <span class="free">X</span> <span class="main">=</span> <span class="free">g</span> <span class="main">`</span> <span class="skolem">Y</span>â€º</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_ltln<span class="hidden">â‡©</span><sub>P</sub>_implies_abs_ltln<span class="hidden">â‡©</span><sub>Q</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_ltln<span class="hidden">â‡©</span><sub>P</sub> <span class="free">Ï†</span> <span class="main">=</span> abs_ltln<span class="hidden">â‡©</span><sub>P</sub> <span class="free">Ïˆ</span> <span class="main">âŸ¶</span> abs_ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="free">Ï†</span> <span class="main">=</span> abs_ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="free">Ïˆ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_equiv_implies_ltl_prop_unfold_equiv ltln<span class="hidden">â‡©</span><sub>P</sub>.abs_eq_iff ltln<span class="hidden">â‡©</span><sub>Q</sub>.abs_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> prop_unfold_equiv_helper <span class="main">=</span> refine_image<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">abs_ltln<span class="hidden">â‡©</span><sub>P</sub></span></span> <span class="quoted"><span class="quoted">abs_ltln<span class="hidden">â‡©</span><sub>Q</sub></span></span><span class="main">,</span> <span class="operator">OF</span> abs_ltln<span class="hidden">â‡©</span><sub>P</sub>_implies_abs_ltln<span class="hidden">â‡©</span><sub>Q</sub><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> prop_unfold_equiv_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">âŸ¹</span> finite <span class="main">{</span>abs_ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="bound">Ïˆ</span> <span class="main">|</span><span class="bound">Ïˆ</span><span class="main">.</span> prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prop_unfold_equiv_helper<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> prop_equiv_finite<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> image_Collect<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> image_Collect<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prop_unfold_equiv_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">âŸ¹</span> card <span class="main">{</span>abs_ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="bound">Ïˆ</span> <span class="main">|</span><span class="bound">Ïˆ</span><span class="main">.</span> prop_atoms <span class="bound">Ïˆ</span> <span class="main">âŠ†</span> <span class="free">P</span><span class="main">}</span> <span class="main">â‰¤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prop_unfold_equiv_helper<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> prop_equiv_finite<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> image_Collect<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> prop_equiv_card
  <span class="keyword1"><span class="command">unfolding</span></span> image_Collect<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> Unf_eventually_equivalent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> Unf <span class="free">Ï†</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span> <span class="main">âŸ¹</span> <span class="main">âˆƒ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">âŠ¨<span class="hidden">â‡©</span><sub>n</sub></span> af <span class="free">Ï†</span> <span class="main">(</span>prefix <span class="bound">i</span> <span class="free">w</span><span class="main">)</span><span class="main">[</span><span class="free">X</span><span class="keyword1">]<span class="hidden">â‡©</span><sub>Î½</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> One_nat_def foldl.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> foldl.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsequence_singleton unfolding_next_step_equivalent<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> prop_unfold_GF_advice_compatible<span class="main">:</span> GF_advice_congruent <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>Q</sub>)</span>"</span></span> <span class="quoted">Unf</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unfolding_prop_unfold_idem prop_unfold_equivalence.eq_sym unfolding_monotonic Unf_eventually_equivalent GF_advice_prop_unfold_congruent<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="DRA_Instantiation">
<div class="head">
<h1>Theory DRA_Instantiation</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Instantiation of the LTL to DRA constructionâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> DRA_Instantiation
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="DRA_Implementation.html">DRA_Implementation</a>
  <a href="../LTL/Equivalence_Relations.html">LTL.Equivalence_Relations</a>
  <a href="../LTL/Disjunctive_Normal_Form.html">LTL.Disjunctive_Normal_Form</a>
  <span class="quoted">"<a href="Extra_Equivalence_Relations.html">../Logical_Characterization/Extra_Equivalence_Relations</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Log_Nat.html">HOL-Library.Log_Nat</a>"</span>
  <a href="../Deriving/Derive.html">Deriving.Derive</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Hash Functions for Quotient Typesâ€º</span></span>

<span class="keyword1"><span class="command">derive</span></span> hashable <span class="quoted">ltln</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cube</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> set <span class="main">::</span> <span class="main">(</span><span class="quoted">hashable</span><span class="main">)</span> <span class="quoted">hashable</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hashcode <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">=</span> Finite_Set.fold <span class="main">(</span>plus <span class="keyword1">o</span> cube <span class="keyword1">o</span> hashcode<span class="main">)</span> <span class="main">(</span>uint32_of_nat <span class="main">(</span>card <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"def_hashmap_size <span class="main">=</span> <span class="main">(</span><span class="main">Î»</span><span class="main"><span class="bound">_</span></span> <span class="main">::</span> <span class="tfree">'a</span> set itself<span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> def_hashmap_size <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> def_hashmap_size<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> def_hashmap_size <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> def_hashmap_size_set_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> fset <span class="main">::</span> <span class="main">(</span><span class="quoted">hashable</span><span class="main">)</span> <span class="quoted">hashable</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hashcode <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> fset<span class="main">)</span> <span class="main">=</span> hashcode <span class="main">(</span>fset <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"def_hashmap_size <span class="main">=</span> <span class="main">(</span><span class="main">Î»</span><span class="main"><span class="bound">_</span></span> <span class="main">::</span> <span class="tfree">'a</span> fset itself<span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> def_hashmap_size <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> def_hashmap_size<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> def_hashmap_size <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span> fset<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> def_hashmap_size_fset_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> ltln<span class="hidden">â‡©</span><sub>P</sub><span class="main">::</span> <span class="main">(</span><span class="quoted">hashable</span><span class="main">)</span> <span class="quoted">hashable</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hashcode <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> ltln<span class="hidden">â‡©</span><sub>P</sub><span class="main">)</span> <span class="main">=</span> hashcode <span class="main">(</span>min_dnf <span class="main">(</span>rep_ltln<span class="hidden">â‡©</span><sub>P</sub> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"def_hashmap_size <span class="main">=</span> <span class="main">(</span><span class="main">Î»</span><span class="main"><span class="bound">_</span></span> <span class="main">::</span> <span class="tfree">'a</span> ltln<span class="hidden">â‡©</span><sub>P</sub> itself<span class="main">.</span> def_hashmap_size <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span> ltln<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> def_hashmap_size<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> def_hashmap_size <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span> ltln<span class="hidden">â‡©</span><sub>P</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> def_hashmap_size_ltln<span class="hidden">â‡©</span><sub>P</sub>_def def_hashmap_size_ltln_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">::</span> <span class="main">(</span><span class="quoted">hashable</span><span class="main">)</span> <span class="quoted">hashable</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hashcode <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ï†</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> ltln<span class="hidden">â‡©</span><sub>Q</sub><span class="main">)</span> <span class="main">=</span> hashcode <span class="main">(</span>min_dnf <span class="main">(</span>Unf <span class="main">(</span>rep_ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="free"><span class="bound"><span class="entity">Ï†</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"def_hashmap_size <span class="main">=</span> <span class="main">(</span><span class="main">Î»</span><span class="main"><span class="bound">_</span></span> <span class="main">::</span> <span class="tfree">'a</span> ltln<span class="hidden">â‡©</span><sub>Q</sub> itself<span class="main">.</span> def_hashmap_size <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span> ltln<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> def_hashmap_size<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> def_hashmap_size <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span> ltln<span class="hidden">â‡©</span><sub>Q</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> def_hashmap_size_ltln<span class="hidden">â‡©</span><sub>Q</sub>_def def_hashmap_size_ltln_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Interpretations with Equivalence Relationsâ€º</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  We instantiate the construction locale with propositional equivalence
  and obtain a function converting a formula into an abstract automaton.
â€º</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub><span class="main">:</span> dra_implementation <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>P</sub>)</span>"</span></span> <span class="quoted">id</span> <span class="quoted">rep_ltln<span class="hidden">â‡©</span><sub>P</sub></span> <span class="quoted">abs_ltln<span class="hidden">â‡©</span><sub>P</sub></span>
  <span class="keyword2"><span class="keyword">defines</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ltl_to_dra</span>
    <span class="keyword2"><span class="keyword">and</span></span> ltl_to_dra_restricted<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ltl_to_dra_restricted</span>
    <span class="keyword2"><span class="keyword">and</span></span> ltl_to_dra_alphabet<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ltl_to_dra_alphabet</span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„'<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ğ”„'</span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub><span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ğ”„<span class="hidden">â‡©</span><sub>1</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„<span class="hidden">â‡©</span><sub>2</sub><span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ğ”„<span class="hidden">â‡©</span><sub>2</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„<span class="hidden">â‡©</span><sub>3</sub><span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ğ”„<span class="hidden">â‡©</span><sub>3</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG</span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF</span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub><span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.af_letter<span class="hidden">â‡©</span><sub>G</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub><span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.af_letter<span class="hidden">â‡©</span><sub>F</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_lifted<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.af_letter<span class="hidden">â‡©</span><sub>G</sub>_lifted</span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_lifted<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.af_letter<span class="hidden">â‡©</span><sub>F</sub>_lifted</span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted</span>
    <span class="keyword2"><span class="keyword">and</span></span> â„­<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.â„­</span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub><span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.af_letter<span class="hidden">â‡©</span><sub>Î½</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> ltln_to_draei<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ltln_to_draei</span>
    <span class="keyword2"><span class="keyword">and</span></span> ltlc_to_draei<span class="hidden">â‡©</span><sub>P</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ltlc_to_draei</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">meson</span> Quotient_abs_rep Quotient_ltln<span class="hidden">â‡©</span><sub>P</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Quotient_abs_rep Quotient_ltln<span class="hidden">â‡©</span><sub>P</sub> ltln<span class="hidden">â‡©</span><sub>P</sub>.abs_eq_iff prop_equiv_card prop_equiv_finite<span class="main">)</span>

<span class="keyword1"><span class="command">thm</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ltl_to_dra_language
<span class="keyword1"><span class="command">thm</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.ltl_to_dra_size
<span class="keyword1"><span class="command">thm</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.final_correctness

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  Similarly, we instantiate the locale with a different equivalence relation and obtain another
  constant for translation of LTL to deterministic Rabin automata.
â€º</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub><span class="main">:</span> dra_implementation <span class="quoted"><span class="quoted">"<span class="keyword1">(âˆ¼<span class="hidden">â‡©</span><sub>Q</sub>)</span>"</span></span> <span class="quoted">Unf</span> <span class="quoted">rep_ltln<span class="hidden">â‡©</span><sub>Q</sub></span> <span class="quoted">abs_ltln<span class="hidden">â‡©</span><sub>Q</sub></span>
  <span class="keyword2"><span class="keyword">defines</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ltl_to_dra</span>
    <span class="keyword2"><span class="keyword">and</span></span> ltl_to_dra_restricted<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ltl_to_dra_restricted</span>
    <span class="keyword2"><span class="keyword">and</span></span> ltl_to_dra_alphabet<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ltl_to_dra_alphabet</span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„'<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ğ”„'</span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„<span class="hidden">â‡©</span><sub>1</sub><span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ğ”„<span class="hidden">â‡©</span><sub>1</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„<span class="hidden">â‡©</span><sub>2</sub><span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ğ”„<span class="hidden">â‡©</span><sub>2</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„<span class="hidden">â‡©</span><sub>3</sub><span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ğ”„<span class="hidden">â‡©</span><sub>3</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ğ”„<span class="hidden">â‡©</span><sub>Î½</sub>_FG</span>
    <span class="keyword2"><span class="keyword">and</span></span> ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ğ”„<span class="hidden">â‡©</span><sub>Î¼</sub>_GF</span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub><span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.af_letter<span class="hidden">â‡©</span><sub>G</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub><span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.af_letter<span class="hidden">â‡©</span><sub>F</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>G</sub>_lifted<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.af_letter<span class="hidden">â‡©</span><sub>G</sub>_lifted</span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>F</sub>_lifted<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.af_letter<span class="hidden">â‡©</span><sub>F</sub>_lifted</span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted</span>
    <span class="keyword2"><span class="keyword">and</span></span> â„­<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.â„­</span>
    <span class="keyword2"><span class="keyword">and</span></span> af_letter<span class="hidden">â‡©</span><sub>Î½</sub><span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.af_letter<span class="hidden">â‡©</span><sub>Î½</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> ltln_to_draei<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ltln_to_draei</span>
    <span class="keyword2"><span class="keyword">and</span></span> ltlc_to_draei<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">=</span> <span class="quoted">ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ltlc_to_draei</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">meson</span> Quotient_abs_rep Quotient_ltln<span class="hidden">â‡©</span><sub>Q</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Quotient_abs_rep Quotient_ltln<span class="hidden">â‡©</span><sub>Q</sub> ltln<span class="hidden">â‡©</span><sub>Q</sub>.abs_eq_iff nested_prop_atoms_Unf prop_unfold_equiv_finite prop_unfold_equiv_card<span class="main">)</span>

<span class="keyword1"><span class="command">thm</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ltl_to_dra_language
<span class="keyword1"><span class="command">thm</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.ltl_to_dra_size
<span class="keyword1"><span class="command">thm</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.final_correctness


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
  We allow the user to choose one of the two equivalence relations.
â€º</span></span>

<span class="keyword1"><span class="command">datatype</span></span> equiv <span class="main">=</span> Prop <span class="main">|</span> PropUnfold

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ltlc_to_draei</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"equiv <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> hashable<span class="main">)</span> ltlc <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> nat<span class="main">)</span> draei"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_draei</span> Prop <span class="main">=</span> ltlc_to_draei<span class="hidden">â‡©</span><sub>P</sub>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_draei</span> PropUnfold <span class="main">=</span> ltlc_to_draei<span class="hidden">â‡©</span><sub>Q</sub>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Export">
<div class="head">
<h1>Theory Code_Export</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹Code export to Standard MLâ€º</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Export
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="DRA_Instantiation.html">LTL_to_DRA/DRA_Instantiation</a>"</span>
  <a href="../LTL/Code_Equations.html">LTL.Code_Equations</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Numeral.html">HOL-Library.Code_Target_Numeral</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Hashing Setsâ€º</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> comp_fun_commute <span class="quoted"><span class="quoted">"plus <span class="keyword1">o</span> cube <span class="keyword1">o</span> hashcode <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> hashable<span class="main">)</span> <span class="main">â‡’</span> hashcode <span class="main">â‡’</span> hashcode"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cube_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"hashcode <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> fold <span class="main">(</span>plus <span class="keyword1">o</span> cube <span class="keyword1">o</span> hashcode<span class="main">)</span> <span class="main">(</span>remdups <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>uint32_of_nat <span class="main">(</span>length <span class="main">(</span>remdups <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fold_set_fold_remdups length_remdups_card_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"hashcode <span class="main">(</span>abs_ltln<span class="hidden">â‡©</span><sub>P</sub> <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> hashcode <span class="main">(</span>min_dnf <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> min_dnf_rep_abs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_dnf <span class="main">(</span>Unf <span class="main">(</span>rep_ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="main">(</span>abs_ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> min_dnf <span class="main">(</span>Unf <span class="free">Ï†</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Quotient3_ltln<span class="hidden">â‡©</span><sub>Q</sub> ltl_prop_equiv_min_dnf ltl_prop_unfold_equiv_def rep_abs_rsp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"hashcode <span class="main">(</span>abs_ltln<span class="hidden">â‡©</span><sub>Q</sub> <span class="free">Ï†</span><span class="main">)</span> <span class="main">=</span> hashcode <span class="main">(</span>min_dnf <span class="main">(</span>Unf <span class="free">Ï†</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹LTL to DRAâ€º</span></span>

<span class="keyword1"><span class="command">declare</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.af_letter<span class="hidden">â‡©</span><sub>F</sub>_lifted_semantics <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.af_letter<span class="hidden">â‡©</span><sub>G</sub>_lifted_semantics <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>P</sub>.af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.af_letter<span class="hidden">â‡©</span><sub>F</sub>_lifted_semantics <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.af_letter<span class="hidden">â‡©</span><sub>G</sub>_lifted_semantics <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> ltl_to_dra<span class="hidden">â‡©</span><sub>Q</sub>.af_letter<span class="hidden">â‡©</span><sub>Î½</sub>_lifted_semantics <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">atoms_ltlc_list_literals</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"String.literal ltlc <span class="main">â‡’</span> String.literal list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">atoms_ltlc_list_literals</span> <span class="main">=</span> atoms_ltlc_list"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ltlc_to_draei_literals</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"equiv <span class="main">â‡’</span> String.literal ltlc <span class="main">â‡’</span> <span class="main">(</span>String.literal set<span class="main">,</span> nat<span class="main">)</span> draei"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_draei_literals</span> <span class="main">=</span> ltlc_to_draei"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sort_transitions</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">Ã—</span> String.literal set <span class="main">Ã—</span> nat<span class="main">)</span> list <span class="main">â‡’</span> <span class="main">(</span>nat <span class="main">Ã—</span> String.literal set <span class="main">Ã—</span> nat<span class="main">)</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sort_transitions</span> <span class="main">=</span> sort_key fst"</span></span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">True_ltlc</span></span> <span class="quoted"><span class="quoted">Iff_ltlc</span></span> <span class="quoted"><span class="quoted">ltlc_to_draei_literals</span></span> <span class="quoted"><span class="quoted">Prop</span></span> <span class="quoted"><span class="quoted">PropUnfold</span></span>
  <span class="quoted"><span class="quoted">alphabetei</span></span> <span class="quoted"><span class="quoted">initialei</span></span> <span class="quoted"><span class="quoted">transitionei</span></span> <span class="quoted"><span class="quoted">conditionei</span></span>
  <span class="quoted"><span class="quoted">integer_of_nat</span></span> <span class="quoted"><span class="quoted">atoms_ltlc_list_literals</span></span> <span class="quoted"><span class="quoted">sort_transitions</span></span> <span class="quoted"><span class="quoted">set</span></span>
  <span class="keyword2"><span class="keyword">in</span></span> SML <span class="keyword2"><span class="keyword">module_name</span></span> LTL <span class="keyword2"><span class="keyword">file_prefix</span></span> LTL_to_DRA



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹LTL to NBAâ€º</span></span>

<span class="comment1">(* TODO *)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹LTL to LDBAâ€º</span></span>

<span class="comment1">(* TODO *)</span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>