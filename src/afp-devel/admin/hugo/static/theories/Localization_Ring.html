<div id="Localization">
<div class="head">
<h1>Theory Localization</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Localization
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Algebra/Group.html">HOL-Algebra.Group</a>"</span> <span class="quoted">"<a href="../../HOL/HOL-Algebra/Ring.html">HOL-Algebra.Ring</a>"</span> <span class="quoted">"<a href="../../HOL/HOL-Algebra/AbelCoset.html">HOL-Algebra.AbelCoset</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Author: Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk .*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">â€¹
Contents: 
<span class="antiquoted"><span class="antiquoted">â–ª</span></span> We define the localization of a commutative ring R with respect to a multiplicative subset, 
i.e. with respect to a submonoid of R (seen as a multiplicative monoid), cf. [<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">â€¹</span></span>rec_rng_of_fracâ€º</span></span></span></span>]. 
<span class="antiquoted"><span class="antiquoted">â–ª</span></span> We prove that this localization is a commutative ring (cf. [<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">â€¹</span></span>crng_rng_of_fracâ€º</span></span></span></span>]) equipped with a 
homomorphism of rings from R (cf. [<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">â€¹</span></span>rng_to_rng_of_frac_is_ring_homâ€º</span></span></span></span>]).
â€º</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">â€¹The Localization of a Commutative Ringâ€º</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹Localizationâ€º</span></span>

<span class="keyword1"><span class="command">locale</span></span> submonoid <span class="main">=</span> monoid <span class="quoted"><span class="free">M</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">M</span> <span class="main">(</span><span class="keyword2"><span class="keyword">structure</span></span><span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subset <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">âŠ†</span> carrier <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> m_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">âŸ¦</span><span class="free">x</span> <span class="main">âˆˆ</span> <span class="free">S</span><span class="main">;</span> <span class="free">y</span> <span class="main">âˆˆ</span> <span class="free">S</span><span class="main">âŸ§</span> <span class="main">âŸ¹</span> <span class="free">x</span> <span class="main">âŠ—</span> <span class="free">y</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> one_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">ğŸ­</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> submonoid<span class="main">)</span> is_submonoid<span class="main">:</span> <span class="quoted"><span class="quoted">"submonoid <span class="free">M</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> submonoid_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> mult_submonoid_of_rng <span class="main">=</span> ring <span class="quoted"><span class="free">R</span></span> <span class="main">+</span> submonoid <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">S</span>

<span class="keyword1"><span class="command">locale</span></span> mult_submonoid_of_crng <span class="main">=</span> cring <span class="quoted"><span class="free">R</span></span> <span class="main">+</span> mult_submonoid_of_rng <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">S</span>

<span class="keyword1"><span class="command">locale</span></span> eq_obj_rng_of_frac <span class="main">=</span> cring <span class="quoted"><span class="free">R</span></span> <span class="main">+</span> mult_submonoid_of_crng <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span> <span class="main">(</span><span class="keyword2"><span class="keyword">structure</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">S</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">rel</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="main">â‰¡</span> <span class="main">â¦‡</span>carrier <span class="main">=</span> carrier <span class="free">R</span> <span class="main">Ã—</span> <span class="free">S</span><span class="main">,</span> eq <span class="main">=</span> <span class="main">Î»</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="bound">r'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">t</span><span class="main">âˆˆ</span><span class="free">S</span><span class="main">.</span> <span class="bound">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="bound">s'</span><span class="main">âŠ—</span> <span class="bound">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="bound">s</span> <span class="main">âŠ—</span> <span class="bound">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="main">â¦ˆ</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> abelian_group<span class="main">)</span> minus_to_eq <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"abelian_group <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">âˆˆ</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">âˆˆ</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">âŠ–</span> <span class="free">y</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inv_solve_right assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> l_zero minus_eq zero_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> eq_obj_rng_of_frac<span class="main">)</span> equiv_obj_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"equivalence <span class="free">rel</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span> <span class="main">âŸ¹</span> <span class="bound">x</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_def subset l_one minus_eq add.r_inv rev_subsetD 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">,</span> snd <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> rel_def one_closed f1 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="bound">y</span> <span class="main">âŸ¹</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span> <span class="main">âŸ¹</span> <span class="bound">y</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span> <span class="main">âŸ¹</span> <span class="bound">y</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abelian_group.minus_add abelian_group.minus_minus
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a2 a3 a_minus_def abelian_group.a_inv_closed add.inv_mult_group is_abelian_group 
          mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse 
          rel_def rev_subsetD subset<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> minus_zero r_minus f2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a2 a3 f1 mem_Sigma_iff minus_closed partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse 
          rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rev_subsetD subset<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 rel_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> 
    <span class="bound">x</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="bound">y</span> <span class="main">âŸ¹</span> <span class="bound">y</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="bound">z</span> <span class="main">âŸ¹</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span> <span class="main">âŸ¹</span> <span class="bound">y</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span> <span class="main">âŸ¹</span> <span class="bound">z</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span> <span class="main">âŸ¹</span> <span class="bound">x</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_def a2 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 subset r_distr f2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a3 a4 a_minus_def abelian_group.a_inv_closed is_abelian_group mem_Sigma_iff 
          monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse r_minus rel_def 
          subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f3 subset r_distr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a3 a4 a_minus_def f1 is_abelian_group mem_Sigma_iff minus_to_eq 
          partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse r_neg rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="skolem">z</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> snd <span class="skolem">z</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a5 rel_def r_distr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a3 a4 a_minus_def f1 f3 is_abelian_group mem_Sigma_iff minus_to_eq monoid.m_closed 
          monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse r_neg subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f3 f4 subset r_distr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a4 a5 a_minus_def abelian_group.a_inv_closed is_abelian_group mem_Sigma_iff 
          monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse r_minus rel_def 
          rev_subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 subset r_distr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a4 a5 a_minus_def f3 is_abelian_group mem_Sigma_iff minus_to_eq monoid.m_closed 
          monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse r_neg rel_def subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a3 rel_def r_distr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a4 a5 a_minus_def f1 f3 is_abelian_group mem_Sigma_iff minus_to_eq monoid.m_closed 
          monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse r_neg subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">z</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comm_monoid_axioms_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span> f1 f3 subset a3 a4 a5 m_assoc
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> m_lcomm mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> partial_object_ext_def rel_def 
          semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rev_subsetD surjective_pairing<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">z</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> snd <span class="skolem">z</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> 
      snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      snd <span class="skolem">z</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> add.l_inv
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a3 a4 a5 f1 f3 f5 is_abelian_group local.semiring_axioms mem_Sigma_iff minus_to_eq 
            monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse rel_def 
            semiring.semiring_simprules<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="skolem">z</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f5 f6
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">â€¹snd <span class="skolem">z</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>â€º</span></span> 
          <span class="quoted"><span class="quoted">â€¹<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>â€º</span></span> a4 a5 f3 is_abelian_group mem_Sigma_iff 
          minus_to_eq partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
          subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r_distr f1 f3 subset a3 a4 a5 rel_def a_minus_def r_minus
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> SigmaE abelian_group.a_inv_closed is_abelian_group monoid.m_closed monoid_axioms 
          partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> snd <span class="skolem">z</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m_assoc comm_monoid_axioms_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span> f1 f3 subset a3 a4 a5 rel_def rev_subsetD
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> SigmaE local.semiring_axioms m_lcomm partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
          prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> semiring.semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m_assoc comm_monoid_axioms_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span> f1 f3 subset a3 a4 a5 rel_def rev_subsetD
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> SigmaE m_comm monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
          prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f7 f8 f9 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> snd <span class="skolem">y</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 f3 a4 rel_def m_closed
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_Times_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span> <span class="main">âŠ–</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r_distr subset rev_subsetD f10 calculation<span class="main">(</span>2<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_def <span class="quoted"><span class="quoted">â€¹<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> snd <span class="skolem">y</span> <span class="main">âˆˆ</span> <span class="free">S</span>â€º</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">eq_class_of_rng_of_frac</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">â‡’</span> <span class="tfree">'a</span> <span class="main">â‡’</span> <span class="tfree">'b</span> <span class="main">â‡’</span> <span class="main">_</span>set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">|</span>Ä±"</span> 10<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="free">|</span></span><span class="hidden">â‡˜</span><sub><span class="free"><span class="bound"><span class="entity">rel</span></span></span></sub><span class="hidden">â‡™</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">â‰¡</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">r'</span></span><span class="main">,</span> <span class="bound"><span class="bound">s'</span></span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free"><span class="bound"><span class="entity">rel</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free"><span class="bound"><span class="entity">rel</span></span></span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="bound">r'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Localization-class_of_to_rel"><span class="command">lemma</span></span> class_of_to_rel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eq_class_of_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rel</span></span><span class="main">]</span> eq_class_of_rng_of_frac_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rel</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> eq_obj_rng_of_frac<span class="main">)</span> zero_in_mult_submonoid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">ğŸ¬</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">ğŸ¬</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span> <span class="main">âŠ–</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> l_zero subset rel_def a1 eq_class_of_rng_of_frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> abelian_group.minus_closed assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_abelian_group l_null mem_Collect_eq mem_Sigma_iff 
          monoid.m_closed monoid_axioms old.prod.case partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subset_iff surjective_pairing<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> rel_def eq_class_of_rng_of_frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> SigmaE a1 eq_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> l_null mem_Collect_eq minus_closed old.prod.case 
          partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ†</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">ğŸ¬</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span> <span class="main">âŠ–</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> l_zero subset rel_def a1 eq_class_of_rng_of_frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> l_null mem_Sigma_iff 
          minus_closed partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rev_subsetD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> rel_def eq_class_of_rng_of_frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> SigmaE a1 eq_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> l_null mem_Collect_eq minus_closed old.prod.case 
          partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.collapse semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set_eq_class_of_rng_of_frac</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">â‡’</span> <span class="main">_</span>set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">set'_class'_of</span>Ä±"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">set_class_of</span></span><span class="hidden">â‡˜</span><sub><span class="free"><span class="bound"><span class="entity">rel</span></span></span></sub><span class="hidden">â‡™</span> <span class="main">â‰¡</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free"><span class="bound"><span class="entity">rel</span></span></span></sub><span class="hidden">â‡™</span> <span class="bound">s</span><span class="main">)</span><span class="main">|</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free"><span class="bound"><span class="entity">rel</span></span></span><span class="main">}</span>"</span></span>

<span class="comment1">(* The lemma below should be moved to theory Congruence in HOL-Algebra *)</span>
<span class="keyword1" id="Localization-elem_eq_class"><span class="command">lemma</span></span> elem_eq_class<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equivalence <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">âˆˆ</span> carrier <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">âˆˆ</span> carrier <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">x</span> <span class="main">âŠ†</span> <span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">âˆˆ</span> <span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms eq_class_of_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> equivalence.sym<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> equivalence.trans
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">âˆˆ</span> <span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">z</span> <span class="main">âˆˆ</span> <span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">x</span>â€º</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_class_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">y</span> <span class="main">âŠ†</span> <span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">âˆˆ</span> <span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms eq_class_of_def equivalence.trans
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">âˆˆ</span> <span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">z</span> <span class="main">âˆˆ</span> <span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">S</span></sub><span class="hidden">â‡™</span> <span class="free">y</span>â€º</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_class_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> abelian_group<span class="main">)</span> four_elem_comm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">âˆˆ</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">âˆˆ</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">âˆˆ</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">âˆˆ</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">âŠ–</span> <span class="free">c</span> <span class="main">âŠ•</span> <span class="free">b</span> <span class="main">âŠ–</span> <span class="free">d</span> <span class="main">=</span> <span class="free">a</span> <span class="main">âŠ•</span> <span class="free">b</span> <span class="main">âŠ–</span> <span class="free">c</span> <span class="main">âŠ–</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms a_assoc a_comm
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_minus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> abelian_monoid<span class="main">)</span> right_add_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">âŠ•</span> <span class="free">a</span> <span class="main">=</span> <span class="free">c</span> <span class="main">âŠ•</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> abelian_monoid<span class="main">)</span> right_minus_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">âŠ–</span> <span class="free">a</span> <span class="main">=</span> <span class="free">c</span> <span class="main">âŠ–</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> abelian_group<span class="main">)</span> inv_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">âˆˆ</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">âˆˆ</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">âŠ–</span> <span class="main">(</span><span class="free">a</span> <span class="main">âŠ•</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">âŠ–</span> <span class="free">a</span> <span class="main">âŠ–</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms minus_add
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_minus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> abelian_group<span class="main">)</span> right_inv_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">âˆˆ</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">âˆˆ</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">âˆˆ</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">âŠ–</span> <span class="free">a</span> <span class="main">âŠ–</span> <span class="free">b</span> <span class="main">=</span> <span class="free">c</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">a</span> <span class="main">âŠ•</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_minus_def add.m_assoc local.minus_add<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> eq_obj_rng_of_frac 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">carrier_rng_of_frac</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> partial_object"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">carrier_rng_of_frac</span> <span class="main">â‰¡</span> <span class="main">â¦‡</span>carrier <span class="main">=</span> <span class="keyword1">set_class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span><span class="main">â¦ˆ</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_rng_of_frac</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">_</span>set<span class="main">,</span> <span class="main">_</span>set<span class="main">]</span> <span class="main">â‡’</span> <span class="main">_</span>set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_rng_of_frac</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">â‰¡</span> 
<span class="keyword1">let</span> <span class="bound">x'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="keyword1">in</span> 
<span class="keyword1">let</span> <span class="bound">y'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">âˆˆ</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="keyword1">in</span> 
<span class="main">(</span>fst <span class="bound">x'</span> <span class="main">âŠ—</span> fst <span class="bound">y'</span><span class="main">)</span><span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span>snd <span class="bound">x'</span> <span class="main">âŠ—</span> snd <span class="bound">y'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rec_monoid_rng_of_frac</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> monoid"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rec_monoid_rng_of_frac</span> <span class="main">â‰¡</span>  <span class="main">â¦‡</span>carrier <span class="main">=</span> <span class="keyword1">set_class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span><span class="main">,</span> mult <span class="main">=</span> mult_rng_of_frac<span class="main">,</span> one <span class="main">=</span> <span class="main">(</span><span class="main">ğŸ­</span><span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span><span class="main">â¦ˆ</span>"</span></span>

<span class="keyword1" id="Localization-member_class_to_carrier"><span class="command">lemma</span></span> member_class_to_carrier<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="free">x</span> <span class="main">âŠ—</span> fst <span class="free">y</span><span class="main">,</span> snd <span class="free">x</span> <span class="main">âŠ—</span> snd <span class="free">y</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms rel_def eq_class_of_rng_of_frac_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Product_Type.Collect_case_prodD m_closed mem_Sigma_iff 
      partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Localization-member_class_to_member_class"><span class="command">lemma</span></span> member_class_to_member_class<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="free">x</span> <span class="main">âŠ—</span> fst <span class="free">y</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> snd <span class="free">x</span> <span class="main">âŠ—</span> snd <span class="free">y</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="keyword1">set_class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms member_class_to_carrier<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">r'</span></span> <span class="quoted"><span class="free">s'</span></span><span class="main">]</span> set_eq_class_of_rng_of_frac_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rel</span></span><span class="main">]</span> 
    eq_class_of_rng_of_frac_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Localization-closed_mult_rng_of_frac"><span class="command">lemma</span></span> closed_mult_rng_of_frac <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">t</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">u</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="keyword1">set_class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> equiv_obj_rng_of_frac equivalence_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">rel</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">âˆˆ</span> <span class="main">(</span><span class="free">t</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> equiv_obj_rng_of_frac equivalence.refl eq_class_of_rng_of_frac_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">t</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">u</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="keyword1">set_class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 f2 rec_monoid_rng_of_frac_def mult_rng_of_frac_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">u</span><span class="main">)</span>"</span></span><span class="main">]</span> 
      set_eq_class_of_rng_of_frac_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">rel</span>"</span></span><span class="main">]</span> member_class_to_member_class<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x'</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">y'</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq member_class_to_carrier monoid.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        someI_ex<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-non_empty_class"><span class="command">lemma</span></span> non_empty_class<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">â‰ </span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms eq_class_of_rng_of_frac_def equiv_obj_rng_of_frac equivalence.refl 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Localization-mult_rng_of_frac_fundamental_lemma"><span class="command">lemma</span></span> mult_rng_of_frac_fundamental_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">â‰ </span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> non_empty_class 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">â‰ </span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> non_empty_class 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">x</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">x'</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span>fst <span class="bound">x</span> <span class="main">âŠ—</span> fst <span class="bound">x'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> snd <span class="bound">x</span> <span class="main">âŠ—</span> snd <span class="bound">x'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 rec_monoid_rng_of_frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoid.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_rng_of_frac_def some_in_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">,</span> snd <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Product_Type.Collect_case_prodD eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span>fst <span class="skolem">x'</span><span class="main">,</span> snd <span class="skolem">x'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def f3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Product_Type.Collect_case_prodD eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ–</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f4 subset rev_subsetD 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> subset rev_subsetD f2 assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def mem_Sigma_iff 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> subset rev_subsetD f2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD abelian_group.a_inv_closed 
        eq_class_of_rng_of_frac_def is_abelian_group mem_Sigma_iff monoid.m_closed monoid_axioms 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f8 f9 f10 f5 r_distr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> a_minus_def r_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def f2 mem_Sigma_iff 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def f2 f8 is_abelian_group 
        mem_Sigma_iff minus_to_eq monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f6 subset rev_subsetD 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> f3 subset rev_subsetD
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Product_Type.Collect_case_prodD eq_class_of_rng_of_frac_def 
        mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">âŠ–</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> f3 subset rev_subsetD
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD abelian_group.a_inv_closed 
        eq_class_of_rng_of_frac_def is_abelian_group mem_Sigma_iff monoid.m_closed monoid_axioms 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f12 f13 f14 f7 r_distr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">âŠ–</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">t'</span></span><span class="main">]</span> a_minus_def 
      r_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def f3 mem_Sigma_iff 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def f3 f12 is_abelian_group 
        mem_Sigma_iff minus_to_eq monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f4 f6 m_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f16<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset rev_subsetD 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms f2 f3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def mem_Sigma_iff 
        monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f18<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms f2 f3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def mem_Sigma_iff 
        monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f19<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f16 f17 f18 r_distr m_assoc r_minus a_minus_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def f14 f2 f3 
          m_comm mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def 
          subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f20<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> m_assoc m_comm f16 assms rel_def f2 f3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def mem_Sigma_iff 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> m_assoc assms f2 f3 rel_def f8 f12
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def mem_Sigma_iff monoid.m_closed 
        monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f11 m_assoc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def f12 f2 f3 f8 
        mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms f2 f3 f8 f12 m_assoc m_comm rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def mem_Sigma_iff monoid.m_closed 
        monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f15 m_assoc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def f12 f3 mem_Sigma_iff 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> m_assoc m_comm assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def f12 f2 f21 f3 f8 mem_Sigma_iff 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f23<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f19 f21 f22
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span>â€º</span></span> 
        a_minus_def f16 f18 r_neg semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f24<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f25<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">,</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 f3 member_class_to_carrier 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">,</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f23 f24 rel_def <span class="quoted"><span class="quoted">â€¹<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âˆˆ</span> <span class="free">S</span>â€º</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">,</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f24 f25 equiv_obj_rng_of_frac elem_eq_class<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rel</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">,</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span>"</span></span><span class="main">]</span> 
      eq_class_of_rng_of_frac_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> class_of_to_rel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rel</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> snd <span class="skolem">x</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span>â€º</span></span> 
      trans sym 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-member_class_to_assoc"><span class="command">lemma</span></span> member_class_to_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">t</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">u</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">v</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>fst <span class="free">x</span> <span class="main">âŠ—</span> fst <span class="free">y</span><span class="main">)</span> <span class="main">âŠ—</span> fst <span class="free">z</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span>snd <span class="free">x</span> <span class="main">âŠ—</span> snd <span class="free">y</span><span class="main">)</span> <span class="main">âŠ—</span> snd <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fst <span class="free">x</span> <span class="main">âŠ—</span> <span class="main">(</span>fst <span class="free">y</span> <span class="main">âŠ—</span> fst <span class="free">z</span><span class="main">)</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> snd <span class="free">x</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="free">y</span> <span class="main">âŠ—</span> snd <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms m_assoc subset rel_def rev_subsetD
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Localization-assoc_mult_rng_of_frac"><span class="command">lemma</span></span> assoc_mult_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">t</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">v</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">u</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">v</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">v</span><span class="main">,</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">u</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">t</span> <span class="main">âŠ—</span> <span class="free">v</span><span class="main">)</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">u</span> <span class="main">âŠ—</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms m_assoc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def rev_subsetD subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">v</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">u</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">t</span> <span class="main">âŠ—</span> <span class="free">v</span><span class="main">)</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">u</span> <span class="main">âŠ—</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">t</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">v</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">t</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">v</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">u</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_rng_of_frac_fundamental_lemma rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">u</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">v</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">t</span> <span class="main">âŠ—</span> <span class="free">v</span><span class="main">)</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">u</span> <span class="main">âŠ—</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_rng_of_frac_fundamental_lemma rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 f2 f3 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-left_unit_mult_rng_of_frac"><span class="command">lemma</span></span> left_unit_mult_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms subset rev_subsetD rec_monoid_rng_of_frac_def mult_rng_of_frac_fundamental_lemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">ğŸ­</span></span> <span class="quoted"><span class="main">ğŸ­</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> 
    l_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> l_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> rel_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Localization-right_unit_mult_rng_of_frac"><span class="command">lemma</span></span> right_unit_mult_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms subset rev_subsetD rec_monoid_rng_of_frac_def mult_rng_of_frac_fundamental_lemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="main">ğŸ­</span></span> <span class="quoted"><span class="main">ğŸ­</span></span><span class="main">]</span>
    r_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> r_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> rel_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Localization-monoid_rng_of_frac"><span class="command">lemma</span></span> monoid_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monoid <span class="main">(</span>rec_monoid_rng_of_frac<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier rec_monoid_rng_of_frac <span class="main">âŸ¹</span>
           <span class="bound">y</span> <span class="main">âˆˆ</span> carrier rec_monoid_rng_of_frac <span class="main">âŸ¹</span> <span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">y</span> <span class="main">âˆˆ</span> carrier rec_monoid_rng_of_frac"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rec_monoid_rng_of_frac_def closed_mult_rng_of_frac
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier rec_monoid_rng_of_frac <span class="main">âŸ¹</span>
             <span class="bound">y</span> <span class="main">âˆˆ</span> carrier rec_monoid_rng_of_frac <span class="main">âŸ¹</span>
             <span class="bound">z</span> <span class="main">âˆˆ</span> carrier rec_monoid_rng_of_frac <span class="main">âŸ¹</span>
             <span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">y</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">z</span> <span class="main">=</span>
             <span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="bound">y</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assoc_mult_rng_of_frac
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rec_monoid_rng_of_frac_def 
        set_eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">âˆˆ</span> carrier rec_monoid_rng_of_frac"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rec_monoid_rng_of_frac_def rel_def set_eq_class_of_rng_of_frac_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier rec_monoid_rng_of_frac <span class="main">âŸ¹</span> <span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> left_unit_mult_rng_of_frac
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rec_monoid_rng_of_frac_def set_eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier rec_monoid_rng_of_frac <span class="main">âŸ¹</span> <span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> right_unit_mult_rng_of_frac
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rec_monoid_rng_of_frac_def set_eq_class_of_rng_of_frac_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-comm_mult_rng_of_frac"><span class="command">lemma</span></span> comm_mult_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_monoid_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">=</span> <span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def m_comm 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD m_comm
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 f2 f3 f4 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-comm_monoid_rng_of_frac"><span class="command">lemma</span></span> comm_monoid_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"comm_monoid <span class="main">(</span>rec_monoid_rng_of_frac<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comm_monoid_def Group.comm_monoid_axioms_def monoid_rng_of_frac comm_mult_rng_of_frac
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rec_monoid_rng_of_frac_def set_eq_class_of_rng_of_frac_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_rng_of_frac</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">_</span>set<span class="main">,</span> <span class="main">_</span>set<span class="main">]</span> <span class="main">â‡’</span> <span class="main">_</span>set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_rng_of_frac</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">â‰¡</span> 
<span class="keyword1">let</span> <span class="bound">x'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="keyword1">in</span> 
<span class="keyword1">let</span> <span class="bound">y'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">âˆˆ</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="keyword1">in</span> 
<span class="main">(</span>snd <span class="bound">y'</span> <span class="main">âŠ—</span> fst <span class="bound">x'</span> <span class="main">âŠ•</span> snd <span class="bound">x'</span> <span class="main">âŠ—</span> fst <span class="bound">y'</span><span class="main">)</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span>snd <span class="bound">x'</span> <span class="main">âŠ—</span> snd <span class="bound">y'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rec_rng_of_frac</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> ring"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rec_rng_of_frac</span> <span class="main">â‰¡</span> 
<span class="main">â¦‡</span>carrier <span class="main">=</span> <span class="keyword1">set_class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span><span class="main">,</span> mult <span class="main">=</span> mult_rng_of_frac<span class="main">,</span> one <span class="main">=</span> <span class="main">(</span><span class="main">ğŸ­</span><span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span><span class="main">,</span> zero <span class="main">=</span> <span class="main">(</span><span class="main">ğŸ¬</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span><span class="main">,</span> add <span class="main">=</span> add_rng_of_frac <span class="main">â¦ˆ</span>"</span></span>

<span class="keyword1" id="Localization-add_rng_of_frac_fundamental_lemma"><span class="command">lemma</span></span> add_rng_of_frac_fundamental_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">x'</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span><span class="main">.</span> <span class="main">âˆƒ</span><span class="bound">y'</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span>snd <span class="bound">y'</span> <span class="main">âŠ—</span> fst <span class="bound">x'</span> <span class="main">âŠ•</span> snd <span class="bound">x'</span> <span class="main">âŠ—</span> fst <span class="bound">y'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> snd <span class="bound">x'</span> <span class="main">âŠ—</span> snd <span class="bound">y'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rec_rng_of_frac_def add_rng_of_frac_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> non_empty_class ring_record_simps<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> some_in_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">x'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 rel_def eq_class_of_rng_of_frac_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rel</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">y'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 rel_def eq_class_of_rng_of_frac_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rel</span></span> <span class="quoted"><span class="free">r'</span></span> <span class="quoted"><span class="free">s'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ–</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> m_closed f4 f6
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">,</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f6 assms<span class="main">(</span>2<span class="main">)</span> f2 subset rev_subsetD eq_class_of_rng_of_frac_def rel_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> f1 rel_def subset rev_subsetD
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Product_Type.Collect_case_prodD eq_class_of_rng_of_frac_def 
          mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> subset rev_subsetD f1 rel_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Product_Type.Collect_case_prodD eq_class_of_rng_of_frac_def 
          mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f9 f10 f11 f4 subset rev_subsetD r_distr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> a_minus_def 
        r_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> add.inv_closed monoid.m_closed monoid_axioms r_distr<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f9 r_distr<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span>"</span></span><span class="main">]</span> rel_def r_minus a_minus_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> abelian_group.minus_to_eq f10 f11 f4 f5 is_abelian_group m_assoc monoid.m_closed 
          monoid_axioms r_neg r_null subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms f1 f2 subset rev_subsetD
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def 
          mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms f1 f2 subset rev_subsetD
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def 
          mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f13 f14 f8 subset rev_subsetD r_distr rel_def r_minus a_minus_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> add.inv_closed semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f16<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 f2 rel_def subset rev_subsetD<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> monoid.m_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x'</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def 
          mem_Sigma_iff monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f4 subset rev_subsetD 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f18<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f6 subset rev_subsetD 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f19<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> rel_def subset 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f20<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> rel_def subset 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f21<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="skolem">y'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 rel_def subset rev_subsetD
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Product_Type.Collect_case_prodD eq_class_of_rng_of_frac_def 
          mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f22<span class="main">:</span><span class="quoted"><span class="quoted">"fst <span class="skolem">x'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 rel_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Product_Type.Collect_case_prodD eq_class_of_rng_of_frac_def mem_Sigma_iff 
          partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f23<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f17 f18 f19 f20 f21 m_assoc m_comm 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def f1 f4 f6 mem_Sigma_iff 
          partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset_iff<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> f24<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f17 f18 f20 f21 m_assoc m_comm
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def f1 f2 f4 f6 
          mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>
      <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f23 f24 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f25<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f12 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> f26<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def f1 f17 f18 f19 f2 
          m_assoc m_comm mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f27<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> f21 rel_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f28<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f20 assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def f2 
          mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ–</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f18 f27 f28 r_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_minus_def r_distr<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f29<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ–</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f17 f19 f1 subset assms<span class="main">(</span>1<span class="main">)</span> eq_class_of_rng_of_frac_def f4 rel_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f30<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ–</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f26 f29 r_distr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ–</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span>â€º</span></span> 
          a_minus_def abelian_group.minus_to_eq f18 f27 f28 f7 is_abelian_group m_assoc monoid.m_closed 
          monoid_axioms r_neg semiring_simprules<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f31<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ–</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f25 f30 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> f32<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f17 f18 r_distr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span>â€º</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f33<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r_distr<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span>"</span></span><span class="main">]</span> f17 f18 a_minus_def r_minus
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD abelian_group.a_inv_closed assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          eq_class_of_rng_of_frac_def f1 f2 is_abelian_group mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f34<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r_distr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def 
          f1 f2 mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def 
          subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def f1 f17 f18 
          f2 m_assoc mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
          r_distr rel_def subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f35<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r_distr f19 f20
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def f1 f2 
          mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f36<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq_class_of_rng_of_frac_def f1 f17 f18 f2 
          mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> r_distr rel_def 
          subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f37<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f13 f14 f17 f18<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f38<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>â€º</span></span> f30 f33 f7 zero_closed 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f39<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f32 f37<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 f2 subset rev_subsetD
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD eq_class_of_rng_of_frac_def 
          mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span>
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> 
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f32 f33 <span class="quoted"><span class="quoted">â€¹snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>â€º</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>â€º</span></span> assms<span class="main">(</span>2<span class="main">)</span> f17 f18 f19 
        f25 f30 f5 f7 f9 l_zero r_null rel_def zero_closed 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">using</span></span> l_zero semiring_simprules<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f40<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ–</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f31
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f32 f33<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f41<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f13 f14<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f42<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD abelian_group.minus_closed assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          eq_class_of_rng_of_frac_def f1 f2 is_abelian_group mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
          rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> 
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ–</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r_distr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span>"</span></span><span class="main">]</span>
      f17 f18  f40 f41 f42 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> four_elem_comm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> BNF_Def.Collect_case_prodD assms eq_class_of_rng_of_frac_def f1 f2 
          mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f43<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f34 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>â€º</span></span> assms<span class="main">(</span>2<span class="main">)</span> f19 rel_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD assms 
          eq_class_of_rng_of_frac_def f1 f2 mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def 
          semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f43bis<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_assoc a_minus_def f41 f43
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">â€¹snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>â€º</span></span> add.l_inv_ex add.m_closed minus_equality<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f44<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f14<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f45<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> BNF_Def.Collect_case_prodD assms 
          eq_class_of_rng_of_frac_def f1 f2 mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def 
          semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âŠ–</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">âŠ–</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f44 f45 inv_add  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âŠ–</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> l_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_minus_def f15 f16 f45<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> right_inv_add <span class="quoted"><span class="quoted">â€¹snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>â€º</span></span> assms<span class="main">(</span>2<span class="main">)</span> f13 f19 f34 f44 f45 rel_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r_distr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f35<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f43bis 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span>
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r_distr<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span>"</span></span><span class="main">]</span> f17 f18 <span class="quoted"><span class="quoted">â€¹<span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ–</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>â€º</span></span> f40 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> 
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ–</span> <span class="free">s'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f40 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span>snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f5 f7
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> snd <span class="skolem">x'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>â€º</span></span> f9<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_def f8 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms rel_def submonoid.m_closed
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> add.m_closed m_closed mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
          rev_subsetD subset<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">,</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_def f1 f2 subset submonoid.m_closed eq_class_of_rng_of_frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Product_Type.Collect_case_prodD add.m_closed mem_Sigma_iff member_class_to_carrier 
          partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rev_subsetD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> elem_eq_class<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rel</span></span><span class="main">]</span> equiv_obj_rng_of_frac
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">â€¹<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span>snd <span class="skolem">y'</span> <span class="main">âŠ—</span> fst <span class="skolem">x'</span> <span class="main">âŠ•</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> fst <span class="skolem">y'</span><span class="main">,</span> snd <span class="skolem">x'</span> <span class="main">âŠ—</span> snd <span class="skolem">y'</span><span class="main">)</span>â€º</span></span> 
          <span class="quoted"><span class="quoted">â€¹<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>â€º</span></span> class_of_to_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f3 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-closed_add_rng_of_frac"><span class="command">lemma</span></span> closed_add_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="keyword1">set_class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms add_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.m_closed mem_Sigma_iff monoid.m_closed monoid_axioms 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rev_subsetD subset<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def submonoid.m_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> f2 <span class="keyword2"><span class="keyword">and</span></span> f3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> set_eq_class_of_rng_of_frac_def f1 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-closed_rel_add"><span class="command">lemma</span></span> closed_rel_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def submonoid.m_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.m_closed mem_Sigma_iff monoid.m_closed monoid_axioms 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rev_subsetD subset<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">â€¹<span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âˆˆ</span> <span class="free">S</span>â€º</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-assoc_add_rng_of_frac"><span class="command">lemma</span></span> assoc_add_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span><span class="main">,</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span><span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> add_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span><span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms add_rng_of_frac_fundamental_lemma closed_rel_add 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ•</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> add_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ•</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms add_rng_of_frac_fundamental_lemma closed_rel_add 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">=</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> m_assoc subset assms rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rev_subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r''</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ•</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a_assoc assms m_comm mem_Sigma_iff monoid.m_assoc monoid.m_closed monoid_axioms 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> r_distr rel_def subset subset_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 f2 f3 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-add_rng_of_frac_zero"><span class="command">lemma</span></span> add_rng_of_frac_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">ğŸ¬</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="keyword1">set_class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> closed_mult_rng_of_frac mem_Sigma_iff monoid.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> one_closed 
      partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rec_monoid_rng_of_frac_def rel_def right_unit_mult_rng_of_frac semiring_simprules<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> zero_closed<span class="main">)</span>

<span class="keyword1" id="Localization-l_unit_add_rng_of_frac"><span class="command">lemma</span></span> l_unit_add_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">ğŸ¬</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="main">ğŸ¬</span> <span class="main">âŠ•</span> <span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms add_rng_of_frac_fundamental_lemma
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">ğŸ¬</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> rec_rng_of_frac_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-r_unit_add_rng_of_frac"><span class="command">lemma</span></span> r_unit_add_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">ğŸ¬</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">ğŸ¬</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms add_rng_of_frac_fundamental_lemma
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">ğŸ¬</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> rec_rng_of_frac_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-comm_add_rng_of_frac"><span class="command">lemma</span></span> comm_add_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms add_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ•</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> assms add_rng_of_frac_fundamental_lemma 
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 f2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.m_comm assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> m_comm mem_Sigma_iff 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rev_subsetD subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-class_of_zero_rng_of_frac"><span class="command">lemma</span></span> class_of_zero_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">ğŸ¬</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">ğŸ¬</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="main">ğŸ¬</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">ğŸ¬</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms local.ring_axioms rev_subsetD ring.ring_simprules<span class="main">(</span>14<span class="main">)</span> subset 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">ğŸ¬</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">ğŸ¬</span><span class="main">,</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def submonoid.one_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> elem_eq_class equiv_obj_rng_of_frac f1 rec_rng_of_frac_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> class_of_to_rel mem_Sigma_iff one_closed partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        rel_def ring_record_simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-r_inv_add_rng_of_frac"><span class="command">lemma</span></span> r_inv_add_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">âŠ–</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">âŠ–</span> <span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">âŠ–</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">âŠ–</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms add_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">âŠ–</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">ğŸ¬</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> assms rel_def subset rev_subsetD r_neg 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> class_of_zero_rng_of_frac assms rel_def submonoid.m_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-l_inv_add_rng_of_frac"><span class="command">lemma</span></span> l_inv_add_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">âŠ–</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">âŠ–</span> <span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">âŠ–</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="main">âŠ–</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms add_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">âŠ–</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">ğŸ¬</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> assms rel_def subset rev_subsetD l_neg 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> class_of_zero_rng_of_frac assms rel_def submonoid.m_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-abelian_group_rng_of_frac"><span class="command">lemma</span></span> abelian_group_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abelian_group <span class="main">(</span>rec_rng_of_frac<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">âŸ¦</span><span class="bound">x</span> <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span><span class="main">;</span>
            <span class="bound">y</span> <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span><span class="main">âŸ§</span>
           <span class="main">âŸ¹</span> <span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">y</span>
               <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> closed_add_rng_of_frac
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq monoid.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rec_rng_of_frac_def 
        set_eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span>
       <span class="main">âŸ¦</span><span class="bound">x</span> <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span><span class="main">;</span>
        <span class="bound">y</span> <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span><span class="main">;</span>
        <span class="bound">z</span> <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span><span class="main">âŸ§</span>
       <span class="main">âŸ¹</span> <span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">y</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">z</span> <span class="main">=</span>
           <span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="bound">y</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assoc_add_rng_of_frac
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq monoid.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rec_rng_of_frac_def 
        set_eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_rng_of_frac_zero <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rec_rng_of_frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span> <span class="main">âŸ¹</span>
         <span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l_unit_add_rng_of_frac
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq monoid.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> monoid.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        rec_rng_of_frac_def set_eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span> <span class="main">âŸ¹</span>
         <span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r_unit_add_rng_of_frac
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq monoid.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> monoid.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        rec_rng_of_frac_def set_eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">â‹€</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">âŸ¦</span><span class="bound">x</span> <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span><span class="main">;</span> <span class="bound">y</span> <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span><span class="main">âŸ§</span>
           <span class="main">âŸ¹</span> <span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>add_monoid rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comm_add_rng_of_frac
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq monoid.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rec_rng_of_frac_def 
        set_eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span> <span class="main">âŠ†</span> Units <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> Units <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> carrier <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="keyword1">set_class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that rec_rng_of_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_eq_class_of_rng_of_frac_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">âŠ–</span> <span class="skolem">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 r_inv_add_rng_of_frac<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">âŠ–</span> <span class="skolem">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 l_inv_add_rng_of_frac<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">y</span> <span class="main">âˆˆ</span> <span class="keyword1">set_class_of</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span><span class="main">.</span> <span class="bound">y</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">âˆ§</span> <span class="skolem">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f2 f3 f4
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> abelian_group.a_inv_closed class_of_zero_rng_of_frac 
            closed_add_rng_of_frac f1 is_abelian_group mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
            rel_def r_unit_add_rng_of_frac zero_closed<span class="main">)</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> Units <span class="main">(</span>add_monoid rec_rng_of_frac<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rec_rng_of_frac_def that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Units_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-r_distr_rng_of_frac"><span class="command">lemma</span></span> r_distr_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span><span class="main">,</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> add_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_rng_of_frac_fundamental_lemma
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closed_rel_add rec_monoid_rng_of_frac_def rec_rng_of_frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> mult_rng_of_frac_fundamental_lemma
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rec_monoid_rng_of_frac_def rec_rng_of_frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> mult_rng_of_frac_fundamental_lemma
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rec_monoid_rng_of_frac_def rec_rng_of_frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> submonoid.m_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">,</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> submonoid.m_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> f2 <span class="keyword2"><span class="keyword">and</span></span> f3 <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms f4 f5 submonoid.m_closed add_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span>  <span class="main">âŠ—</span> <span class="free">r''</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD l_distr
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span>  <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed r_distr
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed r_distr
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed m_assoc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed m_comm m_assoc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span>  <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed m_assoc m_comm
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD m_comm
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed m_comm m_assoc f9
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  f7 f8 f10 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a_minus_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> closed_rel_add mem_Sigma_iff 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> r_neg rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rev_subsetD subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms closed_rel_add rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closed_rel_add f4 f5<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">ğŸ­</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> submonoid.one_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span><span class="main">,</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def f11 f13 f12 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r'</span> <span class="main">âŠ—</span> <span class="free">r''</span><span class="main">)</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> elem_eq_class
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> class_of_to_rel equiv_obj_rng_of_frac f12 f13<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 f6 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-l_distr_rng_of_frac"><span class="command">lemma</span></span> l_distr_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span><span class="main">,</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> add_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_rng_of_frac_fundamental_lemma
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closed_rel_add rec_monoid_rng_of_frac_def rec_rng_of_frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> mult_rng_of_frac_fundamental_lemma
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rec_monoid_rng_of_frac_def rec_rng_of_frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> mult_rng_of_frac_fundamental_lemma
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rec_monoid_rng_of_frac_def rec_rng_of_frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">,</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> submonoid.m_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> submonoid.m_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> f2 <span class="keyword2"><span class="keyword">and</span></span> f3 <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r''</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms f4 f5 submonoid.m_closed add_rng_of_frac_fundamental_lemma 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD r_distr
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed r_distr
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed r_distr
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed m_assoc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed m_comm m_assoc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed m_assoc m_comm
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD m_comm
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def subset rev_subsetD submonoid.m_closed m_comm m_assoc f9
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Sigma_iff monoid.m_closed monoid_axioms partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  f7 f8 f10
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> m_assoc mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def 
        rev_subsetD subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a_minus_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> closed_rel_add mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        r_neg rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rev_subsetD subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">,</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms closed_rel_add rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">,</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closed_rel_add f4 f5<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">ğŸ­</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> submonoid.one_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">,</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span><span class="main">,</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_def f11 f13 f12 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ•</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">âŠ•</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">r''</span> <span class="main">âŠ—</span> <span class="free">r'</span><span class="main">)</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s''</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> elem_eq_class
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> class_of_to_rel equiv_obj_rng_of_frac f12 f13<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 f6 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-rng_rng_of_frac"><span class="command">lemma</span></span> rng_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ring <span class="main">(</span>rec_rng_of_frac<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier rec_rng_of_frac <span class="main">âŸ¶</span> <span class="bound">y</span> <span class="main">âˆˆ</span> carrier rec_rng_of_frac <span class="main">âŸ¶</span> <span class="bound">z</span> <span class="main">âˆˆ</span> carrier rec_rng_of_frac 
    <span class="main">âŸ¶</span> <span class="main">(</span><span class="bound">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">y</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">z</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">y</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r_distr_rng_of_frac rec_rng_of_frac_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier rec_rng_of_frac <span class="main">âŸ¶</span> <span class="bound">y</span> <span class="main">âˆˆ</span> carrier rec_rng_of_frac <span class="main">âŸ¶</span> <span class="bound">z</span> <span class="main">âˆˆ</span> carrier rec_rng_of_frac 
    <span class="main">âŸ¶</span> <span class="bound">z</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="bound">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">z</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l_distr_rng_of_frac rec_rng_of_frac_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring_axioms <span class="main">(</span>rec_rng_of_frac<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ring_axioms_def f1 f2 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
    <span class="keyword1"><span class="command">using</span></span> ring_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">rec_rng_of_frac</span><span class="main">]</span> abelian_group_rng_of_frac monoid_rng_of_frac rec_rng_of_frac_def 
      abelian_group_axioms_def rec_monoid_rng_of_frac_def eq_class_of_rng_of_frac_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Group.monoid_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-crng_rng_of_frac"><span class="command">lemma</span></span> crng_rng_of_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cring <span class="main">(</span>rec_rng_of_frac<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cring_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">rec_rng_of_frac</span><span class="main">]</span> rng_rng_of_frac comm_monoid_rng_of_frac rec_rng_of_frac_def 
    rec_monoid_rng_of_frac_def eq_class_of_rng_of_frac_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comm_monoid.m_comm monoid.monoid_comm_monoidI monoid.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
      partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ring.is_monoid<span class="main">)</span>

<span class="keyword1" id="Localization-simp_in_frac"><span class="command">lemma</span></span> simp_in_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">,</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rel_def submonoid.m_closed subset rev_subsetD 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s</span> <span class="main">âŠ—</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms subset rev_subsetD m_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> m_comm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">s'</span></span><span class="main">]</span> assms subset rev_subsetD rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> a_minus_def assms mem_Sigma_iff partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        r_neg rel_def semiring_simprules<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rev_subsetD subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span> <span class="main">âŠ—</span> <span class="free">r</span> <span class="main">âŠ–</span> <span class="free">s</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">r</span><span class="main">,</span> <span class="free">s'</span> <span class="main">âŠ—</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> f1 rel_def one_closed 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> elem_eq_class
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> class_of_to_rel equiv_obj_rng_of_frac f1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">â€¹The Natural Homomorphism from a Ring to Its Localizationâ€º</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rng_to_rng_of_frac</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">â‡’</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">Ã—</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rng_to_rng_of_frac</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">â‰¡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Localization-rng_to_rng_of_frac_is_ring_hom"><span class="command">lemma</span></span> rng_to_rng_of_frac_is_ring_hom <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="main">âˆˆ</span> ring_hom <span class="free">R</span> rec_rng_of_frac"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="main">âˆˆ</span> carrier <span class="free">R</span> <span class="main">â†’</span> carrier rec_rng_of_frac"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rng_to_rng_of_frac_def rec_rng_of_frac_def set_eq_class_of_rng_of_frac_def rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span> <span class="main">âˆ§</span> <span class="bound">y</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span> 
    <span class="main">âŸ¶</span> rng_to_rng_of_frac <span class="main">(</span><span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub><span class="free">R</span></sub><span class="hidden">â‡™</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> rng_to_rng_of_frac <span class="bound">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> rng_to_rng_of_frac <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span> <span class="main">âˆ§</span> <span class="skolem">y</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="main">(</span><span class="skolem">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub><span class="free">R</span></sub><span class="hidden">â‡™</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">âŠ—</span> <span class="skolem">y</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rng_to_rng_of_frac_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="skolem">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> rng_to_rng_of_frac <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rng_to_rng_of_frac_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="skolem">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> rng_to_rng_of_frac <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">âŠ—</span> <span class="skolem">y</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_rng_of_frac_fundamental_lemma
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">â€¹<span class="skolem">x</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span> <span class="main">âˆ§</span> <span class="skolem">y</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>â€º</span></span> rec_monoid_rng_of_frac_def rec_rng_of_frac_def rel_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="main">(</span><span class="skolem">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub><span class="free">R</span></sub><span class="hidden">â‡™</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> rng_to_rng_of_frac <span class="skolem">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> rng_to_rng_of_frac <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span> <span class="main">âˆ§</span> <span class="bound">y</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>
    <span class="main">âŸ¶</span> rng_to_rng_of_frac <span class="main">(</span><span class="bound">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub><span class="free">R</span></sub><span class="hidden">â‡™</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> rng_to_rng_of_frac <span class="bound">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> rng_to_rng_of_frac <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span> <span class="main">âˆ§</span> <span class="skolem">y</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="main">(</span><span class="skolem">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub><span class="free">R</span></sub><span class="hidden">â‡™</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">âŠ•</span> <span class="skolem">y</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rng_to_rng_of_frac_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="skolem">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> rng_to_rng_of_frac <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rng_to_rng_of_frac_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="skolem">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> rng_to_rng_of_frac <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="skolem">x</span> <span class="main">âŠ•</span> <span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="skolem">y</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_rng_of_frac_fundamental_lemma a 
        eq_obj_rng_of_frac.add_rng_of_frac_fundamental_lemma eq_obj_rng_of_frac.rng_to_rng_of_frac_def 
        eq_obj_rng_of_frac_axioms f1 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="skolem">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> rng_to_rng_of_frac <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">âŠ•</span> <span class="skolem">y</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> l_one a 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>     
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="main">(</span><span class="skolem">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub><span class="free">R</span></sub><span class="hidden">â‡™</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> rng_to_rng_of_frac <span class="skolem">x</span> <span class="main">âŠ•</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> rng_to_rng_of_frac <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="main">ğŸ­</span> <span class="main">=</span> <span class="main">(</span><span class="main">ğŸ­</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rng_to_rng_of_frac_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"rng_to_rng_of_frac <span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub><span class="free">R</span></sub><span class="hidden">â‡™</span> <span class="main">=</span> <span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rec_rng_of_frac_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ring_hom_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span> <span class="quoted">rec_rng_of_frac</span><span class="main">]</span> f1 f2 f3 f4 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-Im_rng_to_rng_of_frac_unit"><span class="command">lemma</span></span> Im_rng_to_rng_of_frac_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">âˆˆ</span> rng_to_rng_of_frac <span class="main">`</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">âˆˆ</span> Units rec_rng_of_frac"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rng_to_rng_of_frac_def rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">ğŸ­</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">âŠ—</span> <span class="main">ğŸ­</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">s</span> <span class="main">âŠ—</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_rng_of_frac_fundamental_lemma rec_monoid_rng_of_frac_def rec_rng_of_frac_def rel_def subset 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">ğŸ­</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">ğŸ­</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> simp_in_frac a1 rel_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">ğŸ­</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">âŠ—</span> <span class="main">ğŸ­</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">s</span> <span class="main">âŠ—</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_rng_of_frac_fundamental_lemma rec_monoid_rng_of_frac_def rec_rng_of_frac_def rel_def 
      subset a1 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">ğŸ­</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">ğŸ­</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> simp_in_frac  a1 rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">âˆƒ</span><span class="bound">y</span><span class="main">âˆˆ</span>carrier rec_rng_of_frac<span class="main">.</span> <span class="bound">y</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="free">x</span> <span class="main">=</span> <span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="main">âˆ§</span> 
    <span class="free">x</span> <span class="main">âŠ—</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">ğŸ­</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rec_rng_of_frac_def f1 f2 a2 rel_def a1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> class_of_zero_rng_of_frac closed_add_rng_of_frac l_unit_add_rng_of_frac 
        mem_Sigma_iff monoid.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_simprules<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> zero_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">âˆˆ</span> carrier rec_rng_of_frac"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 a1 subset rev_subsetD rec_rng_of_frac_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> ring_hom_closed rng_to_rng_of_frac_def rng_to_rng_of_frac_is_ring_hom<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Units_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">rec_rng_of_frac</span><span class="main">]</span> f3 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-eq_class_to_rel"><span class="command">lemma</span></span> eq_class_to_rel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span> <span class="main">Ã—</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span> <span class="main">Ã—</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> equiv_obj_rng_of_frac equivalence_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectI case_prodI eq_class_of_rng_of_frac_def 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">âˆˆ</span> <span class="main">(</span><span class="free">r'</span> <span class="main">|</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_class_of_rng_of_frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_obj_rng_of_frac equivalence_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Localization-rng_to_rng_of_frac_without_zero_div_is_inj"><span class="command">lemma</span></span> rng_to_rng_of_frac_without_zero_div_is_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">ğŸ¬</span> <span class="main">âˆ‰</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">âˆ€</span><span class="bound">a</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span><span class="main">.</span><span class="main">âˆ€</span><span class="bound">b</span> <span class="main">âˆˆ</span> carrier <span class="free">R</span><span class="main">.</span> <span class="bound">a</span> <span class="main">âŠ—</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">ğŸ¬</span> <span class="main">âŸ¶</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">ğŸ¬</span> <span class="main">âˆ¨</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"a_kernel <span class="free">R</span> rec_rng_of_frac rng_to_rng_of_frac <span class="main">=</span> <span class="main">{</span><span class="main">ğŸ¬</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">r</span></span><span class="main">âˆˆ</span> carrier <span class="free">R</span><span class="main">.</span> rng_to_rng_of_frac <span class="bound">r</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span><span class="main">}</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="main">ğŸ¬</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="main">{</span><span class="bound"><span class="bound">r</span></span> <span class="main">âˆˆ</span> carrier <span class="free">R</span><span class="main">.</span> rng_to_rng_of_frac <span class="bound">r</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="main">ğŸ­</span><span class="main">)</span> <span class="main">.=</span><span class="hidden">â‡˜</span><sub><span class="free">rel</span></sub><span class="hidden">â‡™</span> <span class="main">(</span><span class="main">ğŸ¬</span><span class="main">,</span> <span class="main">ğŸ­</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rng_to_rng_of_frac_def rec_rng_of_frac_def eq_class_to_rel 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âˆˆ</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="main">(</span><span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="skolem">x</span> <span class="main">âŠ–</span> <span class="main">ğŸ­</span> <span class="main">âŠ—</span> <span class="main">ğŸ¬</span><span class="main">)</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">âˆˆ</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">âŠ—</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> l_one r_zero f2 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_minus_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">â‰ </span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 assms<span class="main">(</span>1<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">ğŸ¬</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> f1 f3 f4 subset rev_subsetD 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">âˆˆ</span> <span class="main">{</span><span class="main">ğŸ¬</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">ğŸ¬</span><span class="main">}</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="bound"><span class="bound">r</span></span><span class="main">âˆˆ</span> carrier <span class="free">R</span><span class="main">.</span> rng_to_rng_of_frac <span class="bound">r</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subsetI rng_to_rng_of_frac_def rec_rng_of_frac_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">r</span></span><span class="main">âˆˆ</span> carrier <span class="free">R</span><span class="main">.</span> rng_to_rng_of_frac <span class="bound">r</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">ğŸ¬</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">â€¹<span class="main">{</span><span class="bound"><span class="bound">r</span></span><span class="main">âˆˆ</span> carrier <span class="free">R</span><span class="main">.</span> rng_to_rng_of_frac <span class="bound">r</span> <span class="main">=</span> <span class="main">ğŸ¬</span><span class="hidden">â‡˜</span><sub>rec_rng_of_frac</sub><span class="hidden">â‡™</span><span class="main">}</span> <span class="main">âŠ†</span> <span class="main">{</span><span class="main">ğŸ¬</span><span class="main">}</span>â€º</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_kernel_def kernel_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword2"><span class="keyword">end</span></span>




      






</pre>
</div>