<div id="Temporal">
<div class="head">
<h1>Theory Temporal</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Temporal <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Linear Temporal Logic›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    In this section we introduce an algebraic axiomatization of Linear Temporal Logic (LTL).
    We model LTL formulas semantically as predicates on traces. For example the LTL formula
    $\alpha = \Box\; \diamondsuit\; (x = 1)$ is modeled as a predicate 
    $\alpha : (nat \Rightarrow nat) \Rightarrow bool$, where 
    $\alpha \;x = True$ if $x\;i=1$ for infinitely many $i:nat$. In this formula $\Box$
    and $\diamondsuit$ denote the always and eventually operators, respectively. 
    Formulas with multiple variables are modeled similarly. For example a formula $\alpha$ in two 
    variables is modeled as $\alpha : (nat \Rightarrow \tv a) \Rightarrow (nat \Rightarrow \tv b) \Rightarrow bool$,
    and for example $(\Box\; \alpha) \; x\; y$ is defined as $(\forall i . \alpha \; x[i..]\; y[i..])$,
    where $x[i..]\;j = x\;(i+j)$. We would like to construct an algebraic structure (Isabelle class) 
    which has the temporal operators as operations, and which has instatiations to 
    $(nat \Rightarrow \tv a) \Rightarrow bool$, $(nat \Rightarrow \tv a) \Rightarrow (nat \Rightarrow \tv b) \Rightarrow bool$,
    and so on. Ideally our structure should be such that if we have this structure on a type $\tv a::temporal$,
    then we could extend it to $(nat \Rightarrow \tv b) \Rightarrow \tv a$ in a way similar to the
    way Boolean algebras are extended from a type $\tv a::boolean\_algebra$ to $\tv b\Rightarrow \tv a$.
    Unfortunately, if we use for example $\Box$ as primitive operation on our temporal structure,
    then we cannot extend $\Box$ from $\tv a::temporal$ to $(nat \Rightarrow \tv b) \Rightarrow \tv a$. A
    possible extension of $\Box$ could be
      $$(\Box\; \alpha)\;x = \bigwedge_{i:nat} \Box (\alpha\; x[i..]) \mbox{ and } \Box \; b = b$$
    where $\alpha: (nat \Rightarrow \tv b) \Rightarrow \tv a$ and $b:bool$. However, if we apply this
    definition to $\alpha : (nat \Rightarrow \tv a) \Rightarrow (nat \Rightarrow \tv b) \Rightarrow bool$,
    then we get
      $$(\Box\; \alpha) \; x\; y = (\forall i\;j. \alpha \; x[i..]\; y[j..])$$
    which is not correct.

    To evercome this problem we introduce as a primitive operation $!!:\tv a \Rightarrow nat \Rightarrow \tv a$,
    where $\tv a$ is the type of temporal formulas, and $\alpha !! i$ is the formula $\alpha$ at time point $i$.
    If $\alpha$ is a formula in two variables as before, then
      $$(\alpha !! i)\; x\;y = \alpha\; x[i..]\;y[i..].$$
    and we define for example the the operator always by
      $$\Box \alpha = \bigwedge_{i:nat} \alpha !! i$$
›</span></span>
  <span class="keyword1"><span class="command">notation</span></span>
    bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>

  <span class="keyword1"><span class="command">class</span></span> temporal <span class="main">=</span> complete_boolean_algebra <span class="main">+</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">at</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">!!</span></span></span>"</span> 150<span class="main">)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">!!</span></span> <span class="free">i</span> <span class="main"><span class="free">!!</span></span> <span class="free">j</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">!!</span></span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">!!</span></span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main"><span class="free">!!</span></span> <span class="free">i</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">!!</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">!!</span></span> <span class="free">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⊓</span> <span class="free">b</span><span class="main">)</span> <span class="main"><span class="free">!!</span></span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">!!</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="free">!!</span></span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">begin</span></span>
      <span class="keyword1"><span class="command">definition</span></span> <span class="entity">always</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">□</span> <span class="keyword3">(</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="main"><span class="free">□</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">i</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">definition</span></span> <span class="entity">eventually</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">◇</span> <span class="keyword3">(</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="main"><span class="free">◇</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity">next</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">○</span> <span class="keyword3">(</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="main"><span class="free">○</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">!!</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">definition</span></span> <span class="entity">until</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">until</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">until</span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span>Inf <span class="main">(</span>at <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">`</span> <span class="main">{</span><span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">!!</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Next lemma, in the context of complete boolean algebras, will be used 
to prove $-(p\ until\ -p) = \Box\; p$.
›</span></span>
  <span class="keyword1"><span class="command">context</span></span> complete_boolean_algebra
    <span class="keyword2"><span class="keyword">begin</span></span>
      <span class="keyword1" id="Temporal-until_always"><span class="command">lemma</span></span> until_always<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span> <span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> INF_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">...</span> <span class="main">≤</span> <span class="free">p</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> INF_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span> <span class="bound">i</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> INF_greatest<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span><span class="main">)</span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span>
                    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>›</span></span> compl_mono uminus_INF<span class="main">)</span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
                    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> INF_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
                    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inf_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
                    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span> <span class="skolem">i</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1 inf_compl_bot<span class="main">)</span>
                    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> INF_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span> <span class="main">.</span> <span class="main">-</span> <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>

     <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We prove now a number of results of the temporal class.
›</span></span>
  <span class="keyword1"><span class="command">context</span></span> temporal
    <span class="keyword2"><span class="keyword">begin</span></span>   
      <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">b</span><span class="main">)</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">!!</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">b</span> <span class="main">!!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> compl_eq_compl_iff <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

      <span class="keyword1" id="Temporal-always_less"><span class="command">lemma</span></span> always_less <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">!!</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> always_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> INF_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">!!</span> <span class="main">0</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1" id="Temporal-always_and"><span class="command">lemma</span></span> always_and<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">□</span> <span class="free">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def INF_inf_distrib<span class="main">)</span>

      <span class="keyword1" id="Temporal-eventually_or"><span class="command">lemma</span></span> eventually_or<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">◇</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊔</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">◇</span> <span class="free">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_def SUP_sup_distrib<span class="main">)</span>

      <span class="keyword1" id="Temporal-neg_until_always"><span class="command">lemma</span></span> neg_until_always<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">until</span> <span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">□</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">until</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">□</span> <span class="free">p</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> until_def always_def uminus_SUP uminus_INF<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> INF_greatest<span class="main"><span class="keyword3">,</span></span> <span class="operator">cut_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> <span class="free">p</span> <span class="main">!!</span> <span class="bound">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> until_always<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">□</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">!!</span> <span class="bound">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def INF_lower<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span> <span class="main">.</span> <span class="free">p</span> <span class="main">!!</span> <span class="bound">n</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span> <span class="main">!!</span> <span class="bound">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">until</span> <span class="main">-</span><span class="free">p</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> until_def uminus_SUP uminus_INF<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> INF_greatest<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1" id="Temporal-neg_always_eventually"><span class="command">lemma</span></span> neg_always_eventually<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="free">p</span> <span class="main">=</span> <span class="main">-</span> <span class="main">◇</span> <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff always_def eventually_def until_def uminus_SUP<span class="main">)</span>
        
      <span class="keyword1" id="Temporal-neg_true_until_always"><span class="command">lemma</span></span> neg_true_until_always<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">⊤</span> <span class="keyword1">until</span> <span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">□</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff always_def until_def uminus_SUP uminus_INF<span class="main">)</span>

      <span class="keyword1" id="Temporal-true_until_eventually"><span class="command">lemma</span></span> true_until_eventually<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊤</span> <span class="keyword1">until</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">◇</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cut_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> neg_always_eventually<span class="main"><span class="keyword3">,</span></span> <span class="operator">cut_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> neg_true_until_always<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Boolean algebras with $b!!i = b$ form a temporal class.
›</span></span>

  <span class="keyword1"><span class="command">instantiation</span></span> bool <span class="main">::</span> <span class="quoted">temporal</span>
    <span class="keyword2"><span class="keyword">begin</span></span>
      <span class="keyword1"><span class="command">definition</span></span> at_bool_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">::</span>bool<span class="main">)</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
    <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword2"><span class="keyword">end</span></span>

  <span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> trace <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Asumming that $\tv a::temporal$ is a type of class $temporal$, and $\tv b$ is an arbitrary type,
  we would like to create the instantiation of $\tv b\ trace \Rightarrow \tv a$ as a temporal
  class. However Isabelle allows only instatiations of functions from a class to another 
  class. To solve this problem we introduce a new class called trace with an operation
  $\mathit{suffix}::\tv a \Rightarrow nat \Rightarrow \tv a$ where 
  $\mathit{suffix}\;a\;i\;j = (a[i..])\; j = a\;(i+j)$ when
  $a$ is a trace with elements of some type $\tv b$ ($\tv a = nat \Rightarrow \tv b$). 
›</span></span>

  <span class="keyword1"><span class="command">class</span></span> trace <span class="main">=</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">suffix</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1">[</span></span></span>_ <span class="keyword1"><span class="keyword1"><span class="keyword1">..]</span></span></span>"</span> <span class="main">[</span>80<span class="main">,</span> 15<span class="main">]</span> 80<span class="main">)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main"><span class="free">[</span></span><span class="free">i</span><span class="main"><span class="free">..]</span></span><span class="main"><span class="free">[</span></span><span class="free">j</span><span class="main"><span class="free">..]</span></span> <span class="main">=</span> <span class="free">a</span><span class="main"><span class="free">[</span></span><span class="free">i</span> <span class="main">+</span> <span class="free">j</span><span class="main"><span class="free">..]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main"><span class="free">[</span></span><span class="main">0</span><span class="main"><span class="free">..]</span></span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">begin</span></span>
      <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity">next_trace</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">⊙</span> <span class="keyword3">(</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊙</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">[</span>Suc <span class="main">0</span><span class="main">..]</span>"</span></span>
    <span class="keyword2"><span class="keyword">end</span></span>

  <span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">trace</span><span class="main">,</span> <span class="quoted">temporal</span><span class="main">)</span> <span class="quoted">temporal</span>
    <span class="keyword2"><span class="keyword">begin</span></span>
      <span class="keyword1"><span class="command">definition</span></span> at_fun_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">x</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">..]</span><span class="main">)</span><span class="main">)</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>  <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> at_fun_def add.commute fun_eq_iff le_fun_def<span class="main">)</span>
    <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In the last part of our formalization, we need to instantiate the functions
  from $nat$ to some arbitrary type $\tv a$ as a trace class. However, this again is not
  possible using the instatiation mechanism of Isabelle. We solve this problem
  by creating another class called $nat$, and then we instatiate the functions
  from $\tv a::nat$ to $\tv b$ as traces. The class $nat$ is defined such that if we
  have a type $\tv a::nat$, then $\tv a$ is isomorphic to the type $nat$. 
›</span></span>

  <span class="keyword1"><span class="command">class</span></span> nat <span class="main">=</span> zero <span class="main">+</span> plus <span class="main">+</span> minus <span class="main">+</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">RepNat</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">AbsNat</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">RepNat</span> <span class="main">(</span><span class="free">AbsNat</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">AbsNat</span> <span class="main">(</span><span class="free">RepNat</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zero_Nat_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">AbsNat</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> plus_Nat_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="free">AbsNat</span> <span class="main">(</span><span class="free">RepNat</span> <span class="free">a</span> <span class="main">+</span> <span class="free">RepNat</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> minus_Nat_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">=</span> <span class="free">AbsNat</span> <span class="main">(</span><span class="free">RepNat</span> <span class="free">a</span> <span class="main">-</span> <span class="free">RepNat</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="keyword1" id="Temporal-AbsNat_plus"><span class="command">lemma</span></span> AbsNat_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"AbsNat <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> AbsNat <span class="free">i</span> <span class="main">+</span> AbsNat <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_Nat_def<span class="main">)</span>
    <span class="keyword1" id="Temporal-AbsNat_zero"><span class="command">lemma</span></span> AbsNat_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"AbsNat <span class="main">0</span> <span class="main">+</span> <span class="free">i</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_Nat_def<span class="main">)</span>

    <span class="keyword1"><span class="command">subclass</span></span> comm_monoid_diff 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_Nat_def zero_Nat_def minus_Nat_def add.assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The type natural numbers is an instantiation of the class $nat$.
›</span></span>

  <span class="keyword1"><span class="command">instantiation</span></span> nat <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword2"><span class="keyword">begin</span></span>
      <span class="keyword1"><span class="command">definition</span></span> RepNat_nat_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>RepNat<span class="main">::</span> nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">=</span> id"</span></span>
      <span class="keyword1"><span class="command">definition</span></span> AbsNat_nat_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>AbsNat<span class="main">::</span> nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">=</span> id"</span></span>
      <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Finally, functions from $\tv a::nat$ to some arbitrary type $\tv b$ are instatiated
  as a trace class. 
›</span></span>

  <span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">nat</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">trace</span>
    <span class="keyword2"><span class="keyword">begin</span></span>
      <span class="keyword1"><span class="command">definition</span></span> at_trace_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">..]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span>  <span class="main">(</span>AbsNat <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff AbsNat_plus add.assoc<span class="main">)</span>
    <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  By putting together all class definitions and instatiations introduced so far, we obtain the
  temporal class structure for predicates on traces with arbitrary number of parameters.

  For example in the next lemma $r$ and $r'$ are predicate relations, and the operator
  always is available for them as a consequence of the above construction.
›</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="main">□</span> <span class="free">r'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">□</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">OO</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_fun_def always_def at_fun_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Refinement">
<div class="head">
<h1>Theory Refinement</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Refinement <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Monotonic Predicate Transformers›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In this section we introduce the basics of refinement calculus \cite{back-wright-98}.
  Part of this theory is a reformulation of some definitions from \cite{preoteasa:back:2010a},
  but here they are given for predicates, while \cite{preoteasa:back:2010a} uses
  sets.
›</span></span>

  <span class="keyword1"><span class="command">notation</span></span>
    bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>

  <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic predicate transformers›</span></span>

  <span class="keyword1"><span class="command">definition</span></span>
    <span class="entity">demonic</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'b</span><span class="main">::</span>lattice<span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'b</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[:</span> _ <span class="keyword1">:]</span>"</span> <span class="main">[</span>0<span class="main">]</span> 1000<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[:</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">:]</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span>
    <span class="entity">assert</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>semilattice_inf <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">{.</span> _ <span class="keyword1">.}</span>"</span> <span class="main">[</span>0<span class="main">]</span> 1000<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main"><span class="free">{.</span></span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">.}</span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span>
    <span class="quoted">"<span class="entity">assume</span>"</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>boolean_algebra<span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[.</span> _ <span class="keyword1">.]</span>"</span> <span class="main">[</span>0<span class="main">]</span> 1000<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[.</span></span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">.]</span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span>
    <span class="entity">angelic</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>semilattice_inf<span class="main">,</span>order_bot<span class="main">}</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">{:</span> _ <span class="keyword1">:}</span>"</span> <span class="main">[</span>0<span class="main">]</span> 1000<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main"><span class="free">{:</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">:}</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">syntax</span></span>
    <span class="quoted">"_assert"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"patterns <span class="main">=&gt;</span> logic <span class="main">=&gt;</span> logic"</span></span>    <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">{.</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword1">.}</span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">translations</span></span>
    <span class="quoted">"_assert <span class="main">(</span>_patterns <span class="free">x</span> <span class="free">xs</span><span class="main">)</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> assert <span class="main">(</span><span class="keyword1">CONST</span> id <span class="main">(</span>_abs <span class="main">(</span>_pattern <span class="free">x</span> <span class="free">xs</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span>
    <span class="quoted">"_assert <span class="free">x</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> assert <span class="main">(</span><span class="keyword1">CONST</span> id <span class="main">(</span>_abs <span class="free">x</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span>

  <span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="main">{.</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">y</span><span class="main">.}</span>"</span></span>

  <span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_update"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"patterns <span class="main">=&gt;</span> patterns <span class="main">=&gt;</span> logic <span class="main">=&gt;</span> logic"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">↝</span> _ <span class="keyword1">.</span> _"</span> 0<span class="main">)</span>
  <span class="keyword1"><span class="command">translations</span></span>
    <span class="quoted">"_update <span class="main">(</span>_patterns <span class="free">x</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>_patterns <span class="free">y</span> <span class="free">ys</span><span class="main">)</span> <span class="free">t</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> id <span class="main">(</span>_abs
         <span class="main">(</span>_pattern <span class="free">x</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">CONST</span> id <span class="main">(</span>_abs <span class="main">(</span>_pattern <span class="free">y</span> <span class="free">ys</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span>
    <span class="quoted">"_update <span class="free">x</span> <span class="free">y</span> <span class="free">t</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> id <span class="main">(</span>_abs <span class="free">x</span> <span class="main">(</span><span class="keyword1">CONST</span> id <span class="main">(</span>_abs <span class="free">y</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span>

  <span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="bound">x</span> <span class="free">y</span> <span class="free">y'</span> <span class="bound">z</span> <span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">y</span> <span class="main">↝</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="bound">z</span> <span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="main">{:</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">y</span> <span class="main">↝</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="bound">z</span> <span class="main">:}</span>"</span></span>

  <span class="keyword1" id="Refinement-demonic_demonic"><span class="command">lemma</span></span> demonic_demonic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">r</span><span class="main">:]</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r'</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span><span class="free">r</span> <span class="keyword1">OO</span> <span class="free">r'</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff le_fun_def demonic_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Refinement-assert_demonic_comp"><span class="command">lemma</span></span> assert_demonic_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span> <span class="keyword1">o</span> <span class="main">{.</span><span class="free">p'</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r'</span><span class="main">:]</span> <span class="main">=</span> 
      <span class="main">{.</span><span class="bound">x</span> <span class="main">.</span> <span class="free">p</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">p'</span> <span class="bound">y</span><span class="main">)</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r</span> <span class="keyword1">OO</span> <span class="free">r'</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff le_fun_def assert_def demonic_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-demonic_assert_comp"><span class="command">lemma</span></span> demonic_assert_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">r</span><span class="main">:]</span> <span class="keyword1">o</span> <span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="main">=</span> <span class="main">{.</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="main">∀</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">p</span> <span class="bound">y</span><span class="main">)</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff le_fun_def assert_def demonic_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-assert_assert_comp"><span class="command">lemma</span></span> assert_assert_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{.</span><span class="free">p</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>lattice<span class="main">.}</span> <span class="keyword1">o</span> <span class="main">{.</span><span class="free">p'</span><span class="main">.}</span> <span class="main">=</span> <span class="main">{.</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">p'</span><span class="main">.}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff le_fun_def assert_def demonic_def inf_assoc<span class="main">)</span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">inpt</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">trs</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">{.</span> inpt <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">:]</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"trs <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="free">q</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trs_def fun_eq_iff assert_def demonic_def inpt_def bot_fun_def le_fun_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-assert_demonic_prop"><span class="command">lemma</span></span> assert_demonic_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span> <span class="main">=</span> <span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">r</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff assert_def demonic_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-relcompp_exists"><span class="command">lemma</span></span> relcompp_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"relcompp <span class="free">r</span> <span class="free">r'</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">u</span> <span class="main">.</span> <span class="free">r</span> <span class="free">x</span> <span class="bound">u</span> <span class="main">∧</span> <span class="free">r'</span> <span class="bound">u</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Refinement-trs_trs"><span class="command">lemma</span></span> trs_trs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trs <span class="free">r</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span>trs <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> trs <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="main">.</span> <span class="free">r</span> <span class="bound">s</span> <span class="bound">s'</span> <span class="main">⟶</span> <span class="main">(</span>inpt <span class="free">r'</span> <span class="bound">s'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">OO</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> inpt <span class="free">r'</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inpt <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="free">r</span> <span class="bound">s</span> <span class="bound">s'</span> <span class="main">⟶</span> inpt <span class="free">r'</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">r</span> <span class="keyword1">OO</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff inpt_def relcompp_exists<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> inpt <span class="free">r'</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">r</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="free">r</span> <span class="bound">s</span> <span class="bound">s'</span> <span class="main">⟶</span> inpt <span class="free">r'</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">r</span> <span class="keyword1">OO</span> <span class="free">r'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff inpt_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">{.</span> inpt <span class="free">r</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="free">r</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span> inpt <span class="free">r'</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="free">r'</span> <span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trs_def comp_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{.</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> inpt <span class="free">r'</span> <span class="bound">y</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="free">r</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assert_demonic_comp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">{.</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> inpt <span class="free">r'</span> <span class="bound">y</span><span class="main">)</span> <span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> inpt <span class="free">r'</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>  <span class="main">⊓</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">OO</span> <span class="free">r'</span><span class="main">)</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> assert_demonic_prop<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?T</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Refinement-assert_demonic_refinement"><span class="command">lemma</span></span> assert_demonic_refinement<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span> <span class="main">≤</span> <span class="main">{.</span><span class="free">p'</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r'</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">≤</span> <span class="free">p'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">.</span> <span class="free">p</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">r'</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">r</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_fun_def assert_def demonic_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-trs_refinement"><span class="command">lemma</span></span> trs_refinement<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>trs <span class="free">r</span> <span class="main">≤</span> trs <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">⟶</span> inpt <span class="free">r'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">r'</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">r</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trs_def assert_demonic_refinement<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_fun_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"trs <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> trs <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trs_def le_fun_def assert_def demonic_def inpt_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"trs <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">q</span> <span class="main">=</span> <span class="main">⊤</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">else</span> False<span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trs_def fun_eq_iff assert_def demonic_def inpt_def bot_fun_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">r</span><span class="main">:]</span> <span class="main">⊓</span> <span class="main">[:</span><span class="free">r'</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span><span class="free">r</span> <span class="main">⊔</span> <span class="free">r'</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff demonic_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-spec_demonic_choice"><span class="command">lemma</span></span> spec_demonic_choice<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">{.</span><span class="free">p'</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r'</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{.</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">p'</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r</span> <span class="main">⊔</span> <span class="free">r'</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff demonic_def assert_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-trs_demonic_choice"><span class="command">lemma</span></span> trs_demonic_choice<span class="main">:</span> <span class="quoted"><span class="quoted">"trs <span class="free">r</span> <span class="main">⊓</span> trs <span class="free">r'</span> <span class="main">=</span> trs <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">∧</span> inpt <span class="free">r'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">r</span> <span class="main">⊔</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inpt <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">∧</span> inpt <span class="free">r'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">r</span> <span class="main">⊔</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inpt <span class="free">r</span> <span class="main">⊓</span> inpt <span class="free">r'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff inpt_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trs <span class="free">r</span> <span class="main">⊓</span> trs <span class="free">r'</span> <span class="main">=</span> <span class="main">{.</span> inpt <span class="free">r</span> <span class="main">⊓</span> inpt <span class="free">r'</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="free">r</span> <span class="main">⊔</span> <span class="free">r'</span> <span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trs_def spec_demonic_choice<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{.</span> inpt <span class="free">r</span> <span class="main">⊓</span> inpt <span class="free">r'</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">∧</span> inpt <span class="free">r'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">r</span> <span class="main">⊔</span> <span class="free">r'</span><span class="main">)</span> <span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> assert_demonic_prop<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> trs <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">∧</span> inpt <span class="free">r'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">r</span> <span class="main">⊔</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="free">p'</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">{.</span><span class="free">p'</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r'</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{.</span><span class="free">p</span> <span class="main">⊔</span> <span class="free">p'</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">p</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">p'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff assert_def demonic_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Conjunctive predicate transformers›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">conjunctive</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>complete_lattice <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>complete_lattice<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">Q</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Inf <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> Inf <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">`</span> <span class="bound">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sconjunctive</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>complete_lattice <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>complete_lattice<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">Q</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Inf <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> Inf <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">`</span> <span class="bound">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjunctive <span class="free">S</span> <span class="main">⟹</span> sconjunctive <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjunctive_def sconjunctive_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjunctive <span class="main">⊤</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjunctive_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-conjuncive_demonic"><span class="command">lemma</span></span> conjuncive_demonic <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjunctive <span class="main">[:</span><span class="free">r</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjunctive_def fun_eq_iff demonic_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Q</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="skolem">x</span> <span class="main">≤</span> Inf <span class="skolem">Q</span>"</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="skolem">Q</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_lower<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Q</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="skolem">x</span> <span class="main">≤</span> Inf <span class="skolem">Q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_greatest<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Refinement-sconjunctive_assert"><span class="command">lemma</span></span> sconjunctive_assert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sconjunctive <span class="main">{.</span><span class="free">p</span><span class="main">.}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sconjunctive_def assert_def image_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> INF_cong_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> antisym<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">⟹</span> Inf <span class="skolem">Q</span> <span class="main">≤</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⊓</span> Inf <span class="skolem">Q</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⊓</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Inf <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> Inf <span class="skolem">Q</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="free">p</span> <span class="main">⊓</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_greatest<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="bound">x</span><span class="main">}</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⊓</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">cut_tac</span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="free">p</span> <span class="main">⊓</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> image_def<span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="free">p</span> <span class="main">⊓</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Inf <span class="skolem">Q</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_greatest<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
          <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="bound">x</span><span class="main">}</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⊓</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Inf_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="free">p</span> <span class="main">⊓</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> image_def<span class="main">)</span>
       <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Refinement-sconjunctive_simp"><span class="command">lemma</span></span> sconjunctive_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">⟹</span> sconjunctive <span class="free">S</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">(</span>Inf <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> Inf <span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sconjunctive_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-sconjunctive_INF_simp"><span class="command">lemma</span></span> sconjunctive_INF_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> sconjunctive <span class="free">S</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">(</span>Inf <span class="main">(</span><span class="free">Q</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Inf <span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="main">(</span><span class="free">Q</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cut_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">`</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sconjunctive_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Refinement-demonic_comp"><span class="command">lemma</span></span> demonic_comp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sconjunctive <span class="free">S</span> <span class="main">⟹</span> sconjunctive <span class="free">S'</span> <span class="main">⟹</span> sconjunctive <span class="main">(</span><span class="free">S</span> <span class="keyword1">o</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sconjunctive_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set"</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'c</span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sconjunctive <span class="free">S</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sconjunctive <span class="free">S'</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S'</span> <span class="main">(</span>Inf <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> Inf <span class="main">(</span><span class="free">S'</span> <span class="main">`</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sconjunctive_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">(</span>Inf <span class="main">(</span><span class="free">S'</span> <span class="main">`</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Inf <span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="main">(</span><span class="free">S'</span> <span class="main">`</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">S'</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sconjunctive_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span> <span class="keyword1">o</span> <span class="free">S'</span><span class="main">)</span> <span class="main">(</span>Inf <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> Inf <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">S'</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"conjunctive <span class="free">S</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">(</span>Inf <span class="main">(</span><span class="free">Q</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Inf <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="keyword1">o</span> <span class="free">Q</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> INF_image conjunctive_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-conjunctive_simp"><span class="command">lemma</span></span> conjunctive_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"conjunctive <span class="free">S</span> <span class="main">⟹</span>  <span class="free">S</span> <span class="main">(</span>Inf <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> Inf <span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjunctive_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-conjunctive_monotonic"><span class="command">lemma</span></span> conjunctive_monotonic<span class="main">:</span> <span class="quoted"><span class="quoted">"sconjunctive <span class="free">S</span> <span class="main">⟹</span> mono <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> monoI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sconjunctive <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⊓</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">S</span> <span class="skolem">a</span> <span class="main">⊓</span> <span class="free">S</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cut_tac</span> S <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sconjunctive_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">a</span> <span class="main">≤</span> <span class="free">S</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">grd</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊥</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"grd <span class="main">[:</span><span class="free">r</span><span class="main">:]</span> <span class="main">=</span> inpt <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff grd_def demonic_def le_fun_def inpt_def<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fail</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊤</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">term</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊤</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"fail <span class="main">(</span><span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fail_def fun_eq_iff assert_def demonic_def le_fun_def top_fun_def<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fail</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="free">S</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>boolean_algebra <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>boolean_algebra<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span> <span class="main">=</span> Fail<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fail <span class="free">S</span> <span class="main">=</span> <span class="main">⊤</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fail <span class="main">(</span>Fail<span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fail_def bot_apply compl_bot_eq fail_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">S</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"fail <span class="free">S</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> Fail"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≤</span> Fail"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> A B bot.extremum_unique compl_le_compl_iff fail_def le_fun_def monoD top_greatest<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Fail <span class="main">≤</span> <span class="free">S</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fail_def bot.extremum<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Skip</span> <span class="main">=</span> id"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{.</span><span class="main">⊤</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>bounded_lattice<span class="main">.}</span> <span class="main">=</span> Skip"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff assert_def Skip_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"Skip <span class="keyword1">o</span> <span class="free">S</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff assert_def Skip_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="keyword1">o</span> Skip <span class="main">=</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff assert_def Skip_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">S</span> <span class="main">⟹</span> mono <span class="free">S'</span> <span class="main">⟹</span> mono <span class="main">(</span><span class="free">S</span> <span class="keyword1">o</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">{.</span><span class="free">p</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjunctive_monotonic<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">[:</span><span class="free">r</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjunctive_monotonic<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{.</span> <span class="main">λ</span> <span class="bound">x</span> <span class="main">.</span> True <span class="main">.}</span> <span class="main">=</span> Skip"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff assert_def Skip_def<span class="main">)</span>
    
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="keyword1">o</span> <span class="free">S</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{.</span><span class="main">⊥</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>boolean_algebra<span class="main">.}</span>  <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff assert_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="keyword1">o</span> <span class="free">S</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

  <span class="keyword1" id="Refinement-left_comp"><span class="command">lemma</span></span> left_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="keyword1">o</span> <span class="free">U</span> <span class="main">=</span> <span class="free">T'</span> <span class="keyword1">o</span> <span class="free">U'</span> <span class="main">⟹</span> <span class="free">S</span> <span class="keyword1">o</span> <span class="free">T</span> <span class="keyword1">o</span> <span class="free">U</span> <span class="main">=</span> <span class="free">S</span> <span class="keyword1">o</span> <span class="free">T'</span> <span class="keyword1">o</span> <span class="free">U'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc<span class="main">)</span>

  <span class="keyword1" id="Refinement-assert_demonic"><span class="command">lemma</span></span> assert_demonic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span> <span class="main">=</span> <span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">p</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff assert_def demonic_def le_fun_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"trs <span class="free">r</span> <span class="main">⊓</span> trs <span class="free">r'</span> <span class="main">=</span> trs <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> inpt <span class="free">r</span> <span class="bound">x</span> <span class="main">∧</span> inpt <span class="free">r'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff trs_def assert_def demonic_def inpt_def<span class="main">)</span>

  <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Fusion of predicate transformers›</span></span>
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In this section we define the fusion operator from \cite{back:butler:1995}. The fusion
  of two programs $S$ and $T$ is intuitively equivalent with the parallel execution of the two
  programs. If $S$ and $T$ assign nondeterministically some value to some program variable
  $x$, then the fusion of $S$ and $T$ will assign a value to $x$ which can be assigned by
  both $S$ and $T$.
›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">fusion</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∥</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main"><span class="free">∥</span></span> <span class="free"><span class="bound"><span class="entity">S'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span>bool<span class="main">)</span> <span class="bound">p'</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">⊓</span> <span class="bound">p'</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S'</span></span></span> <span class="bound">p'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Refinement-fusion_spec"><span class="command">lemma</span></span> fusion_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">{.</span><span class="free">p'</span><span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span><span class="free">r'</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{.</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">p'</span><span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span><span class="free">r</span> <span class="main">⊓</span> <span class="free">r'</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff fusion_def assert_def demonic_def le_fun_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-fusion_assoc"><span class="command">lemma</span></span> fusion_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∥</span> <span class="main">(</span><span class="free">T</span> <span class="main">∥</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span> <span class="main">∥</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fusion_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">p'</span> <span class="skolem">q</span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">⊓</span> <span class="skolem">p'</span> <span class="main">≤</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊓</span> <span class="skolem">s'</span> <span class="main">≤</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">p</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">s</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="skolem">s'</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B  <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">⊓</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⊓</span> <span class="skolem">s'</span> <span class="main">≤</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v</span> <span class="main">⊓</span> <span class="bound">v'</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">⊓</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∧</span> <span class="free">S</span> <span class="bound">v</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="free">T</span> <span class="bound">v'</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C D order_refl<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="bound">u'</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">⊓</span> <span class="bound">u'</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v</span> <span class="main">⊓</span> <span class="bound">v'</span> <span class="main">≤</span> <span class="bound">u</span> <span class="main">∧</span> <span class="free">S</span> <span class="bound">v</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="free">T</span> <span class="bound">v'</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∧</span> <span class="free">U</span> <span class="bound">u'</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F C D E order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">p'</span> <span class="skolem">q</span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">⊓</span> <span class="skolem">p'</span> <span class="main">≤</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊓</span> <span class="skolem">s'</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">s</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">s'</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="skolem">p'</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B  <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">⊓</span> <span class="skolem">p'</span><span class="main">)</span>  <span class="main">≤</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v</span> <span class="main">⊓</span> <span class="bound">v'</span> <span class="main">≤</span> <span class="skolem">s'</span> <span class="main">⊓</span> <span class="skolem">p'</span> <span class="main">∧</span> <span class="free">T</span> <span class="bound">v</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="free">U</span> <span class="bound">v'</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D E eq_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="bound">u'</span><span class="main">.</span> <span class="bound">u</span> <span class="main">⊓</span> <span class="bound">u'</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="free">S</span> <span class="bound">u</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v</span> <span class="main">⊓</span> <span class="bound">v'</span> <span class="main">≤</span> <span class="bound">u'</span> <span class="main">∧</span> <span class="free">T</span> <span class="bound">v</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="free">U</span> <span class="bound">v'</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F C D E order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≤</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">P'</span> <span class="main">≤</span> <span class="free">Q'</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">∥</span> <span class="free">P'</span> <span class="main">≤</span> <span class="free">Q</span> <span class="main">∥</span> <span class="free">Q'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_fun_def fusion_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"conjunctive <span class="free">S</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∥</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff fusion_def le_fun_def conjunctive_def<span class="main">)</span>

  <span class="keyword1" id="Refinement-fusion_spec_local"><span class="command">lemma</span></span> fusion_spec_local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">{.</span><span class="free">p'</span><span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span><span class="free">r'</span><span class="main">:]</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span><span class="bound">u</span><span class="main">,</span><span class="bound">x</span> <span class="main">.</span> <span class="free">p</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">p'</span> <span class="bound">x</span><span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">:]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⟹</span> <span class="var">?S</span> <span class="main">=</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">p'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p'</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="free">r</span> <span class="main">⊓</span> <span class="free">r'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> 
        <span class="main">(</span><span class="main">{.</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">[:</span> <span class="free">r</span> <span class="main">:]</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">{.</span> <span class="free">p'</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="free">r'</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> demonic_assert_comp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">{.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p'</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="free">r</span> <span class="main">⊓</span> <span class="free">r'</span> <span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc demonic_demonic fusion_spec<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?T</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> demonic_assert_comp comp_assoc demonic_demonic fusion_spec<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Refinement-fusion_spec_local_a"><span class="command">lemma</span></span> fusion_spec_local_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">∥</span> <span class="main">[:</span><span class="free">r'</span><span class="main">:]</span> 
      <span class="main">=</span> <span class="main">(</span><span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cut_tac</span> p' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> init <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">init</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">r'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fusion_spec_local<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Refinement-fusion_local_refinement"><span class="command">lemma</span></span> fusion_local_refinement<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span> <span class="bound">x</span> <span class="bound">u</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> 
      <span class="main">{.</span><span class="free">p'</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">(</span><span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">∥</span> <span class="main">[:</span><span class="free">r'</span><span class="main">:]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span><span class="free">p</span><span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span><span class="free">r</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
     <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">init</span>"</span></span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">x</span> <span class="bound">u</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">{.</span> <span class="bound">x</span><span class="main">.</span> <span class="free">p'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">:]</span>
              <span class="main">≤</span> <span class="main">{.</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="free">r</span> <span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assert_demonic_refinement<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">{.</span> <span class="bound">x</span><span class="main">.</span> <span class="free">p'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">:]</span>
            <span class="main">≤</span> <span class="main">{.</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">[:</span> <span class="free">r</span> <span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc demonic_demonic<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{.</span> <span class="free">p'</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span> <span class="free">p</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span> 
            <span class="main">≤</span> <span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span> <span class="free">p</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="free">r</span> <span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> demonic_assert_comp assert_demonic_comp<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{.</span> <span class="free">p'</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">(</span><span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span> <span class="free">p</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span><span class="main">)</span> 
          <span class="main">≤</span> <span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span> <span class="free">p</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="free">r</span> <span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">unfold</span> fusion_spec_local_a<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Reactive">
<div class="head">
<h1>Theory Reactive</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Reactive
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Temporal.html">Temporal</a> <a href="Refinement.html">Refinement</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Reactive Systems›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    In this section we introduce reactive systems which are modeled as 
    monotonic property transformers where properties are predicates on
    traces. We start with introducing some examples that uses LTL to
    specify global behaviour on traces, and later we introduce property
    transformers based on symbolic transition systems.
›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">HAVOC</span> <span class="main">=</span> <span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> True<span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ASSERT_LIVE</span> <span class="main">=</span> <span class="main">{.</span> <span class="main">□</span> <span class="main">◇</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">0</span><span class="main">)</span><span class="main">.}</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">GUARANTY_LIVE</span> <span class="main">=</span> <span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">□</span> <span class="main">◇</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">0</span><span class="main">)</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">AE</span> <span class="main">=</span> ASSERT_LIVE <span class="keyword1">o</span> HAVOC"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SKIP</span> <span class="main">=</span> <span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">:]</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SKIP <span class="main">=</span> id"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff SKIP_def demonic_def<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">REQ_RESP</span> <span class="main">=</span> <span class="main">[:</span> <span class="main">□</span><span class="main">(</span><span class="main">λ</span> <span class="bound">xs</span> <span class="bound">ys</span> <span class="main">.</span> <span class="bound">xs</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">◇</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">ys</span> <span class="main">.</span> <span class="bound">ys</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"HAVOC <span class="keyword1">o</span> ASSERT_LIVE <span class="main">=</span> FAIL"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HAVOC_def AE_def FAIL_def ASSERT_LIVE_def fun_eq_iff assert_def demonic_def always_def at_fun_def le_fun_def eventually_def<span class="main">)</span>
    

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"HAVOC <span class="keyword1">o</span> AE <span class="main">=</span> FAIL"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HAVOC_def AE_def FAIL_def ASSERT_LIVE_def fun_eq_iff assert_def demonic_def always_def at_fun_def le_fun_def eventually_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"HAVOC <span class="keyword1">o</span> ASSERT_LIVE <span class="main">=</span> FAIL"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HAVOC_def AE_def FAIL_def ASSERT_LIVE_def fun_eq_iff assert_def demonic_def always_def  at_fun_def eventually_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"SKIP <span class="keyword1">o</span> AE <span class="main">=</span> AE"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>REQ_RESP <span class="keyword1">o</span> AE<span class="main">)</span> <span class="main">=</span> AE"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff HAVOC_def AE_def FAIL_def REQ_RESP_def ASSERT_LIVE_def  assert_def 
      demonic_def always_def le_fun_def eventually_def at_fun_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xb</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xb</span><span class="main">::</span>nat <span class="main">⇒</span> bool <span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">xa</span> <span class="bound">x</span> <span class="main">⟶</span> Ex <span class="main">(</span><span class="bound">xb</span><span class="main">[</span><span class="bound">x</span> <span class="main">..]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">xb</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> All <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">xa</span> <span class="bound">x</span> <span class="main">⟶</span> Ex <span class="main">(</span><span class="skolem">xa</span><span class="main">[</span><span class="bound">x</span> <span class="main">..]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">xa</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> All <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">xa</span> <span class="main">(</span><span class="skolem">xb</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xb</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xb</span><span class="main">::</span>nat <span class="main">⇒</span> bool <span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">xa</span> <span class="bound">x</span> <span class="main">⟶</span> Ex <span class="main">(</span><span class="bound">xb</span><span class="main">[</span><span class="bound">x</span> <span class="main">..]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">xb</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> All <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">xb</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> at_trace_def le0<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xc</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">xa</span> <span class="bound">x</span> <span class="main">⟶</span> Ex <span class="main">(</span><span class="skolem">xb</span><span class="main">[</span><span class="bound">x</span> <span class="main">..]</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">xb</span><span class="main">.</span> <span class="skolem">xa</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">xb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x1</span><span class="main">.</span> <span class="skolem">xc</span> <span class="main">≤</span> AbsNat <span class="bound">x1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> le_add2 plus_Nat_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">xb</span> <span class="main">(</span><span class="skolem">xc</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AbsNat_plus add.commute at_trace_def le_Suc_ex trans_le_add2<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Symbolic transition systems›</span></span>
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    In this section we introduce property transformers basend on symbolic
    transition systems. These are systems with local state. The execution
    starts in some initial state, and with some input value the system computes
    a new state and an output value. Then using the current state, and a 
    new input value the system computes a new state, and a new output, and
    so on. The system may fail if at some point the input and the current 
    state do not statisfy a required predicate.

    In the folowing definitions the variables $u$, $x$, $y$ stand for the
    state of the system, the input, and the output respectively. The $init$ 
    is the property that the initial state should satisfy. The predicate
    $p$ is the precondition of the input and the current state, and the
    relation $r$ gives the next state and the output based on the
    input and the current state.
›</span></span>
 
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fail_sys</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span> <span class="bound">u</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="bound">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="bound">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="bound">u</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="bound">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">LocalSystem</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> fail_sys <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">u</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="main">∧</span> run <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"fail <span class="main">(</span>LocalSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> fail_sys <span class="free">init</span> <span class="free">p</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff LocalSystem_def fail_def fail_sys_def run_def<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">inpt_st</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">lft_pred_st</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">lft_pred_loc_st</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">lft_rel_st</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">prec_st</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span>lft_pred_st <span class="main">(</span>inpt_st <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">until</span> <span class="main">-</span><span class="main">(</span>lft_pred_st <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Reactive-prec_st_simp"><span class="command">lemma</span></span> prec_st_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"prec_st <span class="free">p</span> <span class="free">r</span> <span class="free">u</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">.</span> inpt_st <span class="free">r</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prec_st_def until_def lft_pred_st_def inpt_st_def at_fun_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SymSystem</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">[:</span><span class="bound">z</span> <span class="main">↝</span>  <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span><span class="main">:]</span> <span class="keyword1">o</span> <span class="main">{.</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> prec_st <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">u</span> <span class="bound">x</span><span class="main">.}</span> <span class="keyword1">o</span> 
      <span class="main">[:</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="main">□</span> <span class="main">(</span>lft_rel_st <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span>"</span></span>

  <span class="keyword1" id="Reactive-SymSystem_rel"><span class="command">lemma</span></span> SymSystem_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"SymSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{.</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span> <span class="main">.}</span> <span class="main">∘</span> 
    <span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span> "</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SymSystem_def demonic_assert_comp comp_assoc demonic_demonic<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"SymSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span> <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> LocalSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span> <span class="free">q</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"SymSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span> <span class="free">q</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"LocalSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span> <span class="free">q</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SymSystem_def LocalSystem_def assert_def 
          demonic_def prec_st_simp lft_rel_st_def lft_pred_st_def inpt_st_def
          always_def  le_fun_def fail_sys_def run_def at_fun_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"LocalSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span> <span class="free">q</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SymSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span> <span class="free">q</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SymSystem_def LocalSystem_def assert_def 
          demonic_def prec_st_simp lft_rel_st_def lft_pred_st_def inpt_st_def
          always_def  le_fun_def fail_sys_def run_def at_fun_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">local_init</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> Inf <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">zip_set</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">u</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span>fst <span class="keyword1">o</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>snd <span class="keyword1">o</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">nzip</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'x</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">×</span><span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">||</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">||</span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">∘</span> <span class="free">x</span> <span class="main">||</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff nzip_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">∘</span> <span class="free">x</span> <span class="main">||</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff nzip_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">||</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> zip_set <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zip_set_def<span class="main">)</span>

  <span class="keyword1" id="Reactive-local_demonic_init"><span class="command">lemma</span></span> local_demonic_init<span class="main">:</span> <span class="quoted"><span class="quoted">"local_init <span class="free">init</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">u</span> <span class="main">.</span> <span class="main">{.</span> <span class="bound">x</span> <span class="main">.</span> <span class="free">p</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">[:</span><span class="bound">z</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span><span class="main">:]</span> <span class="keyword1">o</span> <span class="main">{.</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="free">p</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff demonic_def assert_def local_init_def le_fun_def<span class="main">)</span>

  <span class="keyword1" id="Reactive-local_init_comp"><span class="command">lemma</span></span> local_init_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">u</span><span class="main">.</span> sconjunctive <span class="main">(</span><span class="free">S</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>local_init <span class="free">init</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span>local_init <span class="free">init'</span> <span class="free">S'</span><span class="main">)</span> 
                       <span class="main">=</span> local_init <span class="main">(</span>zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">u</span> <span class="main">.</span> <span class="main">(</span><span class="free">S</span> <span class="main">(</span>fst <span class="keyword1">o</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="free">S'</span> <span class="main">(</span>snd <span class="keyword1">o</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> fun_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span>
        <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">∈</span> <span class="free">init'</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">u</span> <span class="main">.</span> sconjunctive <span class="main">(</span><span class="free">S</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">u</span> <span class="main">.</span> sconjunctive <span class="main">(</span><span class="free">S</span> <span class="bound">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">S</span> <span class="bound">y</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y'</span> <span class="main">∈</span> <span class="free">init'</span><span class="main">.</span> <span class="free">S'</span> <span class="bound">y'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y'</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">.</span> <span class="free">S</span> <span class="bound">y</span> <span class="main">(</span><span class="free">S'</span> <span class="bound">y'</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sconjunctive_INF_simp image_comp<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y'</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">.</span> <span class="free">S</span> <span class="bound">y</span> <span class="main">(</span><span class="free">S'</span> <span class="bound">y'</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">u</span> <span class="main">∈</span> zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span><span class="free">S'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> INF_greatest<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zip_set_def<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">×</span> <span class="tfree">'b</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">∘</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="free">init</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">∘</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="free">init'</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">init</span><span class="main">.</span> <span class="keyword1">INF</span> <span class="bound">y'</span> <span class="main">∈</span> <span class="free">init'</span><span class="main">.</span> <span class="free">S</span> <span class="bound">y</span> <span class="main">(</span><span class="free">S'</span> <span class="bound">y'</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y'</span> <span class="main">∈</span> <span class="free">init'</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span>fst <span class="keyword1">o</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span><span class="free">S'</span> <span class="bound">y'</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> INF_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">S</span> <span class="main">(</span>fst <span class="keyword1">o</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span><span class="free">S'</span> <span class="main">(</span>snd <span class="keyword1">o</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> INF_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">init</span><span class="main">.</span> <span class="keyword1">INF</span> <span class="bound">y'</span> <span class="main">∈</span> <span class="free">init'</span><span class="main">.</span> <span class="free">S</span> <span class="bound">y</span> <span class="main">(</span><span class="free">S'</span> <span class="bound">y'</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">S</span> <span class="main">(</span>fst <span class="keyword1">o</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span><span class="free">S'</span> <span class="main">(</span>snd <span class="keyword1">o</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">u</span> <span class="main">∈</span> zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span><span class="free">S'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y'</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">.</span> <span class="free">S</span> <span class="bound">y</span> <span class="main">(</span><span class="free">S'</span> <span class="bound">y'</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> INF_greatest<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> INF_greatest<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y'</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">init</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">∈</span> <span class="free">init'</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">u</span> <span class="main">∈</span> zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span><span class="free">S'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">S</span> <span class="main">(</span>fst <span class="keyword1">o</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">||</span> <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">S'</span> <span class="main">(</span>snd <span class="keyword1">o</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">||</span> <span class="skolem">y'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> INF_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span>  <span class="free">S</span> <span class="skolem">y</span> <span class="main">(</span><span class="free">S'</span> <span class="skolem">y'</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">u</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">×</span> <span class="tfree">'b</span> <span class="main">∈</span> zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span><span class="free">S'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">S</span> <span class="skolem">y</span> <span class="main">(</span><span class="free">S'</span> <span class="skolem">y'</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"local_init <span class="free">init</span> <span class="free">S</span> <span class="main">(</span>local_init <span class="free">init'</span> <span class="free">S'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">init</span><span class="main">.</span> <span class="free">S</span> <span class="bound">y</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y'</span> <span class="main">∈</span> <span class="free">init'</span><span class="main">.</span> <span class="free">S'</span> <span class="bound">y'</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local_init_def image_comp<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y'</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">.</span> <span class="free">S</span> <span class="bound">y</span> <span class="main">(</span><span class="free">S'</span> <span class="bound">y'</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">u</span> <span class="main">∈</span> zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∘</span> <span class="free">S'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> local_init <span class="main">(</span>zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">u</span> <span class="main">.</span> <span class="main">(</span><span class="free">S</span> <span class="main">(</span>fst <span class="keyword1">o</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="free">S'</span> <span class="main">(</span>snd <span class="keyword1">o</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local_init_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"local_init <span class="free">init</span> <span class="free">S</span> <span class="main">(</span>local_init <span class="free">init'</span> <span class="free">S'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> local_init <span class="main">(</span>zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∘</span> <span class="free">S'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Reactive-init_state"><span class="command">lemma</span></span> init_state<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="bound">z</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span><span class="main">:]</span> <span class="keyword1">o</span> <span class="main">{.</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="free">p</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span> 
      <span class="main">=</span> <span class="main">[:</span><span class="bound">z</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span><span class="main">:]</span> <span class="keyword1">o</span> <span class="main">{.</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> <span class="free">p</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff demonic_def assert_def local_init_def le_fun_def<span class="main">)</span>

  <span class="keyword1" id="Reactive-always_lft_rel_comp"><span class="command">lemma</span></span> always_lft_rel_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r'</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> 
              <span class="main">=</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff lft_rel_st_def always_def at_fun_def relcompp_exists<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span><span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="skolem">v</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="free">u</span> <span class="skolem">n</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  prod.case_eq_if relcompp.relcompI<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span><span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="skolem">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span> <span class="main">(</span><span class="skolem">z</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">u</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">::</span> nat<span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">::</span> nat<span class="main">.</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> pick_middlep prod.collapse split_conv tfl_some<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> pick_middlep prod.collapse split_conv tfl_some<span class="main">)</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

 <span class="keyword1"><span class="command">theorem</span></span> SymSystem_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">⟹</span> SymSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span> <span class="keyword1">o</span> SymSystem <span class="free">init'</span> <span class="free">p'</span> <span class="free">r'</span> 
                   <span class="main">=</span> <span class="main">[:</span><span class="bound">z</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> fst <span class="keyword1">o</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> snd <span class="keyword1">o</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span><span class="main">:]</span> 
                   <span class="keyword1">o</span> <span class="main">{.</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span> <span class="main">.}</span> 
                   <span class="keyword1">o</span> <span class="main">[:</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span>"</span></span>
                   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⟹</span> <span class="var">?S</span>  <span class="main">=</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> 
        <span class="main">[:</span> <span class="bound">z</span> <span class="main">↝</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">.</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.}</span> <span class="main">∘</span>
        <span class="main">[:</span> id <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> id <span class="main">(</span><span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">:]</span> <span class="main">∘</span>
        <span class="main">(</span><span class="main">[:</span> <span class="bound">z</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">.</span> prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.}</span> <span class="main">∘</span>
        <span class="main">[:</span> id <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> id <span class="main">(</span><span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r'</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> SymSystem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  local_init <span class="free">init</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'e</span><span class="main">.</span> <span class="main">{.</span> id <span class="main">(</span>prec_st <span class="free">p</span> <span class="free">r</span> <span class="bound">u</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> id <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> id <span class="main">(</span><span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">:]</span><span class="main">)</span> <span class="main">∘</span>
          local_init <span class="free">init'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">{.</span> id <span class="main">(</span>prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="bound">u</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> id <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">.</span> id <span class="main">(</span><span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r'</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> local_demonic_init <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> local_init <span class="main">(</span>zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">{.</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">(</span><span class="main">{.</span> prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r'</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local_init_comp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">...</span> <span class="main">=</span> local_init <span class="main">(</span>zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">)</span>
         <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">{.</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span> prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r'</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  local_init <span class="main">(</span>zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span><span class="main">{.</span> <span class="bound">x</span> <span class="main">.</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span> <span class="main">.}</span> <span class="main">∘</span>
            <span class="main">[:</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="bound">u</span> <span class="main">:]</span><span class="main">)</span> "</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assert_demonic_comp always_lft_rel_comp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> local_init <span class="main">(</span>zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">)</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span><span class="main">{.</span><span class="bound">x</span><span class="main">.</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">.}</span> <span class="main">∘</span>
         <span class="main">[:</span> id <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">.</span> id <span class="main">(</span><span class="main">(</span><span class="main">□</span> lft_rel_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?T</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> local_demonic_init<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zip_set_def<span class="main">)</span>
   <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Reactive-always_lft_rel_comp_a"><span class="command">lemma</span></span> always_lft_rel_comp_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="free">u</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r'</span><span class="main">)</span> <span class="free">v</span> 
              <span class="main">=</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">||</span> <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> always_lft_rel_comp <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


  <span class="keyword1"><span class="command">theorem</span></span> SymSystem_comp_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">⟹</span> SymSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span> <span class="keyword1">o</span> SymSystem <span class="free">init'</span> <span class="free">p'</span> <span class="free">r'</span> 
                   <span class="main">=</span> <span class="main">{.</span><span class="bound">x</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">u</span> <span class="bound">v</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">⟶</span> <span class="main">(</span>prec_st <span class="free">p</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">.}</span> 
                   <span class="keyword1">o</span> <span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">u</span> <span class="main">||</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span>"</span></span>
                   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⟹</span> <span class="var">?S</span> <span class="main">=</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">∈</span> <span class="free">init'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">⟶</span> prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="bound">u</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">⟶</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r'</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> 
        <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r'</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">{.</span><span class="bound">x</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">.}</span> <span class="main">∘</span> 
            <span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'e</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span> <span class="main">∘</span>
            <span class="main">(</span><span class="main">{.</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">⟶</span> prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r'</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SymSystem_rel<span class="main">)</span>
       <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{.</span> <span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟶</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span> <span class="main">∘</span> 
          <span class="main">{.</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">⟶</span> prec_st <span class="free">p'</span> <span class="free">r'</span> <span class="bound">u</span> <span class="bound">x</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r'</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?T</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assert_demonic_comp always_lft_rel_comp_a<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We show next that the composition of two SymSystem $S$ and $S'$ is not equal to the SymSystem of the 
  compostion of local transitions of $S$ and $S'$›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">initS</span> <span class="main">=</span> <span class="main">{</span><span class="bound">u</span> <span class="main">.</span> fst <span class="main">(</span><span class="bound">u</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">localPrecS</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊤</span><span class="main">::</span> nat <span class="main">×</span> nat  <span class="main">⇒</span> nat <span class="main">×</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">localRelS</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">u</span><span class="main">::</span>nat<span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">y</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">initS'</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊤</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">localPrecS'</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊥</span><span class="main">::</span> nat <span class="main">×</span> nat  <span class="main">⇒</span> nat <span class="main">×</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">localRelS'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">u</span><span class="main">::</span>nat<span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">y</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="bound">u'</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">symbS</span> <span class="main">=</span> SymSystem initS localPrecS localRelS"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">symbS'</span> <span class="main">=</span> SymSystem initS' localPrecS' localRelS'"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">localPrecSS'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">::</span>nat<span class="main">,</span> <span class="bound">v</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">localRelSS'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">::</span>nat<span class="main">,</span> <span class="bound">v'</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">z</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Reactive-localSS'_aux"><span class="command">lemma</span></span> localSS'_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">aa</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">b</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">,</span> <span class="bound">u</span><span class="main">::</span>nat<span class="main">,</span> <span class="bound">v</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="bound">ab</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ab</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">u'</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">aa</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>


  <span class="keyword1" id="Reactive-localSS'_aux_b"><span class="command">lemma</span></span> localSS'_aux_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">ab</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ab</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">u'</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="bound">u'</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff relcompp_exists<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">{.</span><span class="bound">x</span><span class="main">,</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">.</span> localPrecS <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="bound">x</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="bound">x</span><span class="main">,</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">y</span><span class="main">,</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span> <span class="main">.</span> localRelS <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">:]</span> <span class="keyword1">o</span> 
         <span class="main">{.</span><span class="bound">x</span><span class="main">,</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">.</span> localPrecS' <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">)</span> <span class="bound">x</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="bound">x</span><span class="main">,</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">y</span><span class="main">,</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span> <span class="main">.</span> localRelS' <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">:]</span>
       <span class="main">=</span> <span class="main">{.</span><span class="bound">x</span><span class="main">,</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">.</span> localPrecSS' <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="bound">x</span><span class="main">,</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">y</span><span class="main">,</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span> <span class="main">.</span> localRelSS' <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assert_demonic_comp localPrecS'_def localPrecS_def localRelS_def localRelS'_def 
      relcompp_exists localPrecSS'_def localRelSS'_def localSS'_aux localSS'_aux_b<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">⊥</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'c</span><span class="main">::</span>boolean_algebra<span class="main">)</span><span class="main">)</span> <span class="main">:]</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff demonic_def<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">symbSS'</span> <span class="main">=</span> SymSystem initS localPrecSS' localRelSS'"</span></span>

  <span class="keyword1" id="Reactive-symbSS'_aux"><span class="command">lemma</span></span> symbSS'_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> fst <span class="main">(</span><span class="bound">u</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span>
                <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> Ex <span class="main">(</span><span class="main">(</span><span class="keyword1">case</span> <span class="bound">u</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">u</span> <span class="bound">n</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span><span class="bound">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span> <span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">,</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1" id="Reactive-symbSS'"><span class="command">lemma</span></span> symbSS'<span class="main">:</span> <span class="quoted"><span class="quoted">"symbSS' <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symbSS'_def SymSystem_rel initS_def localPrecSS'_def localRelSS'_def prec_st_simp inpt_st_def symbSS'_aux<span class="main">)</span>

  <span class="keyword1" id="Reactive-symbS"><span class="command">lemma</span></span> symbS<span class="main">:</span> <span class="quoted"><span class="quoted">"symbS <span class="main">=</span> <span class="main">⊤</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symbS_def SymSystem_rel initS_def localPrecS_def localRelS_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> fst <span class="main">(</span><span class="bound">u</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> prec_st <span class="main">⊤</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff prec_st_def always_def lft_rel_st_def at_fun_def lft_pred_st_def inpt_st_def until_def<span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> fst <span class="main">(</span><span class="bound">u</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff always_def lft_rel_st_def at_fun_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">u</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">×</span> <span class="tfree">'c</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">u</span> <span class="bound">a</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">e</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xa</span> <span class="bound">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
        <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> fst <span class="main">(</span><span class="skolem">u</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">n</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> B <span class="main">=</span> this
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">u</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">u</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> fst <span class="main">(</span><span class="skolem">u</span> <span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{.</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> fst <span class="main">(</span><span class="bound">u</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> prec_st <span class="main">⊤</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="main">.}</span> <span class="main">∘</span>
            <span class="main">[:</span> <span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">.</span> fst <span class="main">(</span><span class="bound">u</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span> <span class="main">=</span>
            <span class="main">⊤</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"symbS <span class="keyword1">o</span> symbS' <span class="main">≠</span> symbSS'"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symbSS' symbS fun_eq_iff<span class="main">)</span>

  <span class="keyword1" id="Reactive-prec_st_inpt"><span class="command">lemma</span></span> prec_st_inpt<span class="main">:</span> <span class="quoted"><span class="quoted">"prec_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="main">(</span>lft_pred_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prec_st_def neg_until_always<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"grd <span class="main">(</span>SymSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> Sup <span class="main">(</span><span class="main">(</span><span class="main">-</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">□</span> <span class="main">(</span>lft_pred_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">init</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> fun_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> grd_def SymSystem_rel demonic_def assert_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">u</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">∈</span><span class="free">init</span><span class="main">.</span> prec_st <span class="free">p</span> <span class="free">r</span> <span class="bound">xa</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="bound">xa</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">init</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">x</span> <span class="skolem">xa</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def lft_pred_st_def inpt_st_def at_fun_def lft_rel_st_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> <span class="free">init</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="skolem">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⊥</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">y</span> <span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∉</span> <span class="free">init</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">u</span> <span class="skolem">x</span> <span class="bound">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">z</span> <span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="skolem">xa</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xa</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> B <span class="keyword2"><span class="keyword">and</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="skolem">xa</span> <span class="skolem">x</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xa</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def lft_pred_st_def inpt_st_def at_fun_def lft_rel_st_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> tfl_some<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>

 
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">guard</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{.</span><span class="main">(</span><span class="main">(</span>grd <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span>bool<span class="main">)</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>grd <span class="main">(</span>local_init <span class="free">init</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span>bool<span class="main">)</span> <span class="main">=</span> Sup <span class="main">(</span><span class="main">(</span>grd <span class="keyword1">o</span> <span class="free">S</span><span class="main">)</span> <span class="main">`</span> <span class="free">init</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff local_init_def assert_def grd_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟹</span> guard <span class="main">(</span><span class="main">[:</span><span class="bound">z</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span><span class="main">:]</span> <span class="keyword1">o</span> <span class="main">{.</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="free">p</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">[:</span><span class="bound">z</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span><span class="main">:]</span> <span class="keyword1">o</span> <span class="main">{.</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span> <span class="bound">a</span> <span class="bound">x</span> <span class="main">⟶</span> Ex <span class="main">(</span><span class="free">r</span> <span class="bound">a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">::</span>bool<span class="main">)</span> <span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff local_init_def guard_def grd_def assert_def demonic_def le_fun_def<span class="main">)</span>

  <span class="keyword1" id="Reactive-inpt_str_comp_aux"><span class="command">lemma</span></span> inpt_str_comp_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> inpt_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
        inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">.</span> inpt_st <span class="free">r</span> <span class="main">(</span><span class="main">(</span>fst <span class="keyword1">o</span> <span class="free">u</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>fst <span class="keyword1">o</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="var">?p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?q</span> <span class="free">n</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span>
          <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="var">?p</span> <span class="bound">n</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⟶</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.IH B comp_apply<span class="main">)</span>
           <span class="keyword1"><span class="command">next</span></span>
             <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
             <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
               <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span>"</span></span>
                <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> A <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">from</span></span> D <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?A</span>"</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">¬</span> inpt_st <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">.</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">j</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> j <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inpt_st_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> relcompp.relcompI<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'e</span></span></span>
          <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="var">?p</span> <span class="bound">n</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⟶</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
           <span class="keyword1"><span class="command">next</span></span>
             <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
             <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
               <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">from</span></span> D <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">¬</span> inpt_st <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">.</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">j</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> j <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="skolem">j</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inpt_st_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> relcompp.relcompI<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
                     
  <span class="keyword1" id="Reactive-inpt_str_comp_aux_a"><span class="command">lemma</span></span> inpt_str_comp_aux_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> inpt_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
        inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
        inpt_st <span class="free">r</span> <span class="main">(</span><span class="main">(</span>fst <span class="keyword1">o</span> <span class="free">u</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>fst <span class="keyword1">o</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="free">n</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cut_tac</span> n <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">r'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> u <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> inpt_str_comp_aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel_st</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">r'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">z</span> <span class="main">.</span> inpt_st <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free"><span class="bound"><span class="entity">r'</span></span></span> <span class="bound">v</span> <span class="bound">v'</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">r'</span></span></span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Reactive-inpt_str_comp_a"><span class="command">lemma</span></span> inpt_str_comp_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prec_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span> <span class="bound">y</span> <span class="main">⟶</span> prec_st <span class="main">(</span>inpt_st <span class="free">r'</span><span class="main">)</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    prec_st <span class="main">(</span><span class="main">λ</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="main">.</span> inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">u'</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">u'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span>inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">u'</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="free">u</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prec_st_inpt prec_st_simp<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def lft_pred_st_def at_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'c</span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> inpt_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="bound">v</span><span class="main">::</span><span class="tfree">'d</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="bound">v'</span><span class="main">::</span><span class="tfree">'d</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">then</span> <span class="skolem">y</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="main">(</span>fst <span class="keyword1">o</span> <span class="free">u</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>fst <span class="keyword1">o</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span> <span class="var">?y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="var">?y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span> <span class="var">?y</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def at_fun_def lft_rel_st_def lft_pred_st_def inpt_st_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> tfl_some<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> D <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def lft_pred_st_def at_fun_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> inpt_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="bound">v</span><span class="main">::</span><span class="tfree">'d</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="bound">v'</span><span class="main">::</span><span class="tfree">'d</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
            inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">::</span><span class="tfree">'c</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def lft_pred_st_def at_fun_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> inpt_str_comp_aux_a<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> inpt_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="bound">v</span><span class="main">::</span><span class="tfree">'d</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="bound">v'</span><span class="main">::</span><span class="tfree">'d</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
            inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">::</span><span class="tfree">'c</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def lft_pred_st_def at_fun_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> inpt_str_comp_aux_a<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  lft_rel_st_def<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Reactive-inpt_str_comp_b"><span class="command">lemma</span></span> inpt_str_comp_b<span class="main">:</span> <span class="quoted"><span class="quoted">"prec_st <span class="main">(</span><span class="main">λ</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="main">.</span> inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">u'</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">u'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span>inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">u'</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="free">u</span> <span class="free">x</span>
    <span class="main">=</span>  <span class="main">(</span><span class="main">□</span> <span class="main">(</span>lft_pred_st <span class="main">(</span>inpt_st <span class="main">(</span>rel_st <span class="free">r</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">u</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prec_st_simp always_def lft_pred_st_def at_fun_def rel_st_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> inpt_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                      inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span> 
                      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="var">?p</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="var">?q</span> <span class="bound">n</span> <span class="main">∧</span> <span class="var">?r</span> <span class="bound">n</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="skolem">m</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> n <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> inpt_str_comp_aux_a<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">(</span><span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inpt_st_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> n <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> inpt_str_comp_aux_a<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inpt_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'c</span><span class="main">)</span> <span class="bound">z</span><span class="main">.</span> inpt_st <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="bound">y</span> 
          <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="skolem">m</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>"</span></span><span class="main">)</span>     
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inpt_st_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> relcompp.relcompI<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span> <span class="bound">m</span><span class="main">.</span> inpt_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="bound">z</span><span class="main">.</span> inpt_st <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span> <span class="bound">y</span><span class="main">)</span> 
          <span class="main">∧</span> <span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">m</span> <span class="main">.</span> <span class="var">?p</span> <span class="bound">m</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" inpt_st <span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inpt_st_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="skolem">m</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'e</span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span> <span class="bound">m</span><span class="main">.</span> inpt_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="bound">z</span><span class="main">.</span> inpt_st <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> inpt_st <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span> <span class="bound">y</span><span class="main">)</span> 
          <span class="main">∧</span> <span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">m</span> <span class="main">.</span> <span class="var">?p</span> <span class="bound">m</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" inpt_st <span class="free">r'</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inpt_st_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="skolem">m</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Reactive-inpt_str_comp"><span class="command">lemma</span></span> inpt_str_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prec_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span> <span class="bound">y</span> <span class="main">⟶</span> prec_st <span class="main">(</span>inpt_st <span class="free">r'</span><span class="main">)</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="main">(</span>lft_pred_st <span class="main">(</span>inpt_st <span class="main">(</span>rel_st <span class="free">r</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">u</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inpt_str_comp_a inpt_str_comp_b<span class="main">)</span>

  <span class="keyword1" id="Reactive-RSysTmp_inpt_comp"><span class="command">lemma</span></span> RSysTmp_inpt_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">⟹</span> SymSystem <span class="free">init</span> <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span> <span class="free">r</span> <span class="keyword1">o</span> SymSystem <span class="free">init'</span><span class="main">(</span>inpt_st <span class="free">r'</span><span class="main">)</span> <span class="free">r'</span> 
      <span class="main">=</span>  SymSystem <span class="main">(</span>zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">)</span> <span class="main">(</span>inpt_st <span class="main">(</span>rel_st <span class="free">r</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rel_st <span class="free">r</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">∈</span> <span class="free">init'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="main">(</span>rel_st <span class="free">r</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">xa</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>
        <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="main">(</span>rel_st <span class="free">r</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">=</span> <span class="var">?b</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff always_def at_fun_def lft_pred_st_def lft_rel_st_def rel_st_def inpt_st_def<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'e</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted">nat</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">a</span> <span class="bound">xa</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">::</span><span class="tfree">'e</span><span class="main">,</span> <span class="bound">v</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u'</span><span class="main">::</span><span class="tfree">'e</span><span class="main">,</span> <span class="bound">v'</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">(</span>Suc <span class="bound">xa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">xa</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">xa</span> <span class="main">.</span> <span class="var">?P</span> <span class="bound">xa</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">xa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> Ex <span class="main">(</span><span class="main">(</span><span class="keyword1">case</span> <span class="skolem">a</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="bound">z</span><span class="main">.</span> Ex <span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> Ex <span class="main">(</span><span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">xa</span> <span class="main">.</span> <span class="var">?Q</span> <span class="bound">xa</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">xa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">a</span> <span class="skolem">xa</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="bound">z</span><span class="main">.</span> Ex <span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> Ex <span class="main">(</span><span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">xa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="skolem">xa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">xa</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">xa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">xa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'e</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted">nat</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">a</span> <span class="bound">xa</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">::</span><span class="tfree">'e</span><span class="main">,</span> <span class="bound">v</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u'</span><span class="main">::</span><span class="tfree">'e</span><span class="main">,</span> <span class="bound">v'</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'c</span><span class="main">)</span> <span class="bound">z</span><span class="main">::</span><span class="tfree">'b</span><span class="main">.</span> Ex <span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">::</span><span class="tfree">'d</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> Ex <span class="main">(</span><span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">(</span>Suc <span class="bound">xa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">xa</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">xa</span> <span class="main">.</span> <span class="var">?Q</span> <span class="bound">xa</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">xa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">a</span> <span class="skolem">xa</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">::</span><span class="tfree">'e</span><span class="main">,</span> <span class="bound">v</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u'</span><span class="main">::</span><span class="tfree">'e</span><span class="main">,</span> <span class="bound">v'</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">xa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="skolem">xa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">xa</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">xa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">xa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      
     <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SymSystem <span class="free">init</span> <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span> <span class="free">r</span> <span class="keyword1">o</span> SymSystem <span class="free">init'</span><span class="main">(</span>inpt_st <span class="free">r'</span><span class="main">)</span> <span class="free">r'</span> <span class="main">=</span> <span class="main">[:</span> <span class="bound">z</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> fst <span class="main">∘</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> snd <span class="main">∘</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">:]</span> <span class="main">∘</span>
      <span class="main">(</span><span class="main">{.</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> prec_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span> <span class="free">r</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> prec_st <span class="main">(</span>inpt_st <span class="free">r'</span><span class="main">)</span> <span class="free">r'</span> <span class="main">(</span>snd <span class="main">∘</span> <span class="bound">u</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">.}</span> <span class="main">∘</span>
      <span class="main">[:</span>  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span>  <span class="main">(</span><span class="main">(</span><span class="main">□</span> lft_rel_st <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="free">r</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="keyword1">OO</span> <span class="free">r'</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> SymSystem_comp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[:</span> <span class="bound">z</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> fst <span class="main">∘</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">∧</span> snd <span class="main">∘</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">init'</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">(</span><span class="main">{.</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="main">(</span>rel_st <span class="free">r</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="var">?b</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> assert_demonic<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inpt_str_comp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> SymSystem <span class="main">(</span>zip_set <span class="free">init</span> <span class="free">init'</span><span class="main">)</span> <span class="main">(</span>inpt_st <span class="main">(</span>rel_st <span class="free">r</span> <span class="free">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rel_st <span class="free">r</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SymSystem_def prec_st_inpt comp_assoc zip_set_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">GrdSymSystem</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">[:</span><span class="bound">z</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span><span class="main">:]</span> <span class="keyword1">o</span> trs <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="main">□</span><span class="main">(</span>lft_rel_st <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Reactive-inpt_always"><span class="command">lemma</span></span> inpt_always<span class="main">:</span> <span class="quoted"><span class="quoted">"inpt <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"inpt <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inpt_def lft_pred_st_def inpt_st_def always_def at_fun_def lft_rel_st_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_pred_st <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="var">?y</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def at_fun_def lft_rel_st_def inpt_st_def lft_pred_st_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> tfl_some<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inpt <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st <span class="free">r</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inpt_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"GrdSymSystem <span class="free">init</span> <span class="free">r</span> <span class="main">=</span> SymSystem <span class="free">init</span> <span class="main">(</span>inpt_st <span class="free">r</span><span class="main">)</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GrdSymSystem_def SymSystem_def trs_def  prec_st_inpt comp_assoc inpt_always<span class="main">)</span>

  <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Example: COUNTER›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    In this section we introduce an example counter that counts how many times
    the input variable $x$ is true. The input is a sequence of boolen values
    and the output is a sequence of natural numbers. The output at some moment in 
    time is the number of true values seen so far in the input.

    We defined the system counter in two different ways and we show that the
    two definitions are equivalent. The first definition takes the entire 
    input sequence and it computes the corresponding output sequence. We introduce
    the second version of the counter as a reactive system based on a symbolic
    transition system. We use a local variable to record the number of true
    values seen so far, and initially the local variable is zero. At every step
    we increase the local variable if the input is true. The output of the
    system at every step is equal to the local variable.
›</span></span>

  <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">count</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool trace <span class="main">⇒</span> nat trace"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">count</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">count</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">count</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free">count</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Counter_global</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">{.</span><span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">k</span> <span class="main">.</span> count <span class="bound">x</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">.}</span> <span class="keyword1">o</span> <span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> count <span class="bound">x</span><span class="main">:]</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">prec_count</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel_count</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="main">=</span> Suc <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Reactive-counter_a_aux"><span class="command">lemma</span></span> counter_a_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">.</span> count <span class="free">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
        <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="free">x</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Reactive-counter_b_aux"><span class="command">lemma</span></span> counter_b_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">xa</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="free">xa</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">xb</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> 
                <span class="main">⟹</span> count <span class="free">xa</span> <span class="free">n</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">COUNTER</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> SymSystem <span class="main">{</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">(</span>prec_count <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> rel_count"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"COUNTER <span class="main">=</span> Counter_global"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">::</span>nat <span class="main">⇒</span> nat<span class="main">.</span> <span class="bound">u</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> lft_rel_st rel_count<span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> count <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff lft_rel_st_def rel_count_def always_def at_fun_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">u</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xb</span> <span class="main">::</span> <span class="quoted">nat</span>
          <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xb</span> <span class="main">.</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">xb</span> <span class="main">⟶</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">xb</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="skolem">u</span> <span class="bound">xb</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">x</span> <span class="bound">xb</span> <span class="main">⟶</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">xb</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="bound">xb</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xa</span> <span class="bound">xb</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">xb</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="skolem">x</span> <span class="skolem">xb</span> <span class="main">=</span> <span class="skolem">xa</span> <span class="skolem">xb</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> counter_b_aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="skolem">xb</span> <span class="main">=</span> count <span class="skolem">x</span> <span class="skolem">xb</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xa</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> count <span class="skolem">x</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
          <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xb</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">xa</span> <span class="bound">xb</span> <span class="main">=</span> count <span class="skolem">x</span> <span class="bound">xb</span>"</span></span>
          <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xb</span><span class="main">::</span><span class="quoted">nat</span>
          <span class="keyword1"><span class="command">from</span></span> u_def <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">xb</span> <span class="main">⟶</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="skolem">xb</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="skolem">u</span> <span class="skolem">xb</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">x</span> <span class="skolem">xb</span> <span class="main">⟶</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="skolem">xb</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="skolem">xb</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xa</span> <span class="skolem">xb</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="skolem">xb</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">xb</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">::</span>nat <span class="main">⇒</span> nat<span class="main">.</span> <span class="bound">u</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">xb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">xb</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">(</span>Suc <span class="bound">xb</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="bound">u</span> <span class="bound">xb</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">x</span> <span class="bound">xb</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">(</span>Suc <span class="bound">xb</span><span class="main">)</span> <span class="main">=</span> <span class="bound">u</span> <span class="bound">xb</span><span class="main">)</span> <span class="main">∧</span> 
              <span class="skolem">xa</span> <span class="bound">xb</span> <span class="main">=</span> <span class="bound">u</span> <span class="main">(</span>Suc <span class="bound">xb</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">xa</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⟶</span> prec_st <span class="main">(</span>prec_count <span class="skolem">x</span><span class="main">)</span> rel_count <span class="bound">u</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">λ</span><span class="bound">xa</span><span class="main">::</span>nat <span class="main">⇒</span> bool<span class="main">.</span> <span class="main">∀</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> count <span class="bound">xa</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff lft_rel_st_def  prec_st_def until_def 
            lft_pred_st_def prec_count_def at_fun_def inpt_st_def rel_count_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">k</span><span class="main">::</span> <span class="quoted">nat</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">uu</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">uu</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> count <span class="skolem">xa</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">xb</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="bound">xb</span><span class="main">.</span> <span class="skolem">xa</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> Suc <span class="main">(</span><span class="bound">u</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">xa</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">u</span> <span class="bound">xb</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">u</span> <span class="main">.</span> <span class="var">?s</span> <span class="bound">u</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="skolem">uu</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">xb</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">x</span></span> <span class="main">&lt;</span> <span class="bound">xb</span> <span class="main">.</span> <span class="var">?q</span> <span class="bound">xb</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?r</span> <span class="bound">xb</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> uu_def  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">xb</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">x</span></span> <span class="main">&lt;</span> <span class="bound">xb</span> <span class="main">.</span> <span class="var">?q</span> <span class="bound">xb</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?r</span> <span class="bound">xb</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">x</span></span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">.</span> <span class="var">?q</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?r</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?q</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">xb</span> <span class="main">∨</span> <span class="var">?r</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> uu_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"count <span class="skolem">xa</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">xb</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">u</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xaa</span><span class="main">::</span><span class="quoted">nat</span>
          <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> count <span class="skolem">xa</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">u</span> <span class="skolem">xaa</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xaa</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le0 neq0_conv<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="skolem">xa</span> <span class="main">(</span><span class="skolem">xaa</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">u</span> <span class="skolem">xaa</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="skolem">xaa</span><span class="main">.</span> count <span class="skolem">xa</span> <span class="bound">i</span> <span class="main">≠</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_diff_1 diff_Suc_less<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="skolem">xaa</span><span class="main">.</span> <span class="main">(</span><span class="skolem">xa</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="skolem">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">xa</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="skolem">xaa</span><span class="main">.</span> count <span class="skolem">xa</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> counter_a_aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> A <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="skolem">xaa</span><span class="main">.</span> <span class="skolem">xa</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> Suc <span class="main">(</span><span class="skolem">u</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">xa</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">u</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> B <span class="main">=</span> this
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff COUNTER_def SymSystem_rel Counter_global_def A B<span class="main">)</span>

   <span class="keyword1"><span class="command">qed</span></span>
 

  <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Example: LIVE›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    The last example of this formalization introduces a system which does some
    local computation, and ensures some global liveness property.
    We show that this example is the fusion of a symbolic transition system and a demonic
    choice which ensures the liveness property of the output sequence.
    We also show that asumming some liveness property for the input, we can refine
    the example into an executable system that does not ensure the liveness
    property of the output on its own, but relies on the liveness of the input.
›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel_ex</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">prec_ex</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≤</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">LIVE</span> <span class="main">=</span> <span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x'</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x'</span><span class="main">:]</span> <span class="keyword1">o</span> <span class="main">{.</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">.</span> prec_st prec_ex rel_ex <span class="bound">u</span> <span class="bound">x</span><span class="main">.}</span> 
    <span class="keyword1">o</span> <span class="main">[:</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="main">□</span><span class="main">(</span><span class="main">λ</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> rel_ex <span class="main">(</span><span class="bound">u</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">u</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span>  <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="main">(</span><span class="main">◇</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span> <span class="main">:]</span>"</span></span>

  <span class="keyword1" id="Reactive-LIVE_fusion"><span class="command">lemma</span></span> LIVE_fusion<span class="main">:</span> <span class="quoted"><span class="quoted">"LIVE <span class="main">=</span> <span class="main">(</span>SymSystem <span class="main">{</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> prec_ex rel_ex<span class="main">)</span> <span class="main">∥</span> <span class="main">[:</span><span class="bound">x</span> <span class="main">↝</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="main">□</span> <span class="main">(</span><span class="main">◇</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">init</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">init</span> <span class="main">=</span> <span class="main">{</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">::</span>nat <span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">∈</span> <span class="skolem">init</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="skolem">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> prec_st prec_ex rel_ex <span class="bound">x</span> <span class="bound">y</span> <span class="main">.}</span> <span class="main">∘</span> <span class="main">[:</span> <span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st rel_ex<span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">:]</span><span class="main">)</span> <span class="main">∥</span>
          <span class="main">[:</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">□</span> <span class="main">◇</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">0</span><span class="main">)</span> <span class="main">:]</span> <span class="main">=</span>
          <span class="main">[:</span> <span class="bound">x</span> <span class="main">↝</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="skolem">init</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">:]</span> <span class="main">∘</span> <span class="main">{.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> prec_st prec_ex rel_ex <span class="bound">x</span> <span class="bound">y</span> <span class="main">.}</span> <span class="main">∘</span>
          <span class="main">[:</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">□</span> lft_rel_st rel_ex<span class="main">)</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="main">◇</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span> <span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> fusion_spec_local_a<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> init_def SymSystem_def<span class="main">)</span>
          <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LIVE_def lft_rel_st_def always_def at_fun_def<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">preca_ex</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Reactive-monotonic_SymSystem"><span class="command">lemma</span></span> monotonic_SymSystem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>SymSystem <span class="free">init</span> <span class="free">p</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SymSystem_def<span class="main">)</span>

  <span class="keyword1" id="Reactive-event_ex_aux_a"><span class="command">lemma</span></span> event_ex_aux_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">xa</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">xa</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> 
        <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">xa</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">xa</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> 
        <span class="main">(</span><span class="free">a</span> <span class="free">n</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟶</span> <span class="free">xa</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">xa</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="free">a</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">a</span> <span class="free">n</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_minus_one_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> minus_zero zero_le_one zero_neq_neg_one<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add_le_same_cancel2 not_one_le_zero zero_neq_neg_one<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> A <span class="main">=</span> this
      <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff le_iff_diff_le_0 not_one_le_zero<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> B <span class="main">=</span> this
      <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute monoid_add_class.add.left_neutral le_less not_le right_minus uminus_add_conv_diff zle_add1_eq_le<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> C <span class="main">=</span> this
      <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute le_minus_one_simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> monoid_add_class.add.right_neutral not_le right_minus zle_add1_eq_le<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> D <span class="main">=</span> this
      <span class="keyword1"><span class="command">from</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword1"><span class="command">have</span></span>  E<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff int_one_le_iff_zero_less le_iff_diff_le_0 le_less not_le zle_add1_eq_le<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> A B E F <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Reactive-event_ex_aux"><span class="command">lemma</span></span> event_ex_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">xa</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">xa</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> 
         <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">xa</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">xa</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> 
        <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟶</span> <span class="free">xa</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">xa</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> event_ex_aux_a<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">{.</span><span class="main">□</span> preca_ex<span class="main">.}</span> <span class="keyword1">o</span> LIVE <span class="main">≤</span> SymSystem <span class="main">{</span><span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> prec_ex rel_ex"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> LIVE_fusion SymSystem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fusion_local_refinement<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> preca_ex<span class="main">)</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">z</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">z</span> <span class="bound">x</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preca_ex_def lft_rel_st_def rel_ex_def always_def at_fun_def<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> lft_rel_st rel_ex<span class="main">)</span> <span class="skolem">u</span> <span class="skolem">z</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span> <span class="main">.</span> <span class="main">(</span><span class="skolem">z</span> <span class="bound">xa</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">xa</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="bound">xa</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">z</span> <span class="bound">xa</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">xa</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="bound">xa</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">xa</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="bound">xa</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">(</span>Suc <span class="bound">xa</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preca_ex_def lft_rel_st_def rel_ex_def always_def at_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="skolem">u</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟶</span> <span class="skolem">z</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="skolem">z</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cut_tac</span> A B C<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> event_ex_aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted">nat</span>
          <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>Suc <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">from</span></span> this A B C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span> <span class="main">.</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoid_add_class.add.right_neutral<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> this
          <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>Suc <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">from</span></span> this A B C D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span> <span class="main">.</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right diff_minus_eq_add diff_self monoid_add_class.add.right_neutral<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">note</span></span> 2 <span class="main">=</span> this
          <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>Suc <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">from</span></span> this A B C D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span> <span class="main">.</span> <span class="skolem">u</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right diff_self monoid_add_class.add.right_neutral<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">note</span></span> 3 <span class="main">=</span> this
          <span class="keyword1"><span class="command">from</span></span> 1 2 3 A B C D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span> <span class="main">.</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> diff_0 int_one_le_iff_zero_less le_less not_le zle_diff1_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="main">◇</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def eventually_def preca_ex_def at_fun_def rel_ex_def lft_rel_st_def<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>