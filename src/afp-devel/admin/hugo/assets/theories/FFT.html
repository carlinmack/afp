<div id="FFT">
<div class="head">
<h1>Theory FFT</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Fast Fourier Transform
    Author:     Clemens Ballarin &lt;ballarin at in.tum.de&gt;, started 12 April 2005
    Maintainer: Clemens Ballarin &lt;ballarin at in.tum.de&gt;
*)</span>

<span class="keyword1"><span class="command">theory</span></span> FFT
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We formalise a functional implementation of the FFT algorithm
  over the complex numbers, and its inverse.  Both are shown
  equivalent to the usual definitions
  of these operations through Vandermonde matrices.  They are also
  shown to be inverse to each other, more precisely, that composition
  of the inverse and the transformation yield the identity up to a
  scalar.

  The presentation closely follows Section 30.2 of Cormen \textit{et
  al.}, \emph{Introduction to Algorithms}, 2nd edition, MIT Press,
  2003.›</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following two lemmas are useful for experimenting with the
  transformations, at a vector length of four.›</span></span>

<span class="keyword1" id="FFT-Ivl4"><span class="command">lemma</span></span> Ivl4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeastLessThanSuc eval_nat_numeral insert_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FFT-Sum4"><span class="command">lemma</span></span> Sum4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">0</span> <span class="main">+</span> <span class="free">x</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">x</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ivl4 eval_nat_numeral<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A number of specialised lemmas for the summation operator,
  where the index set is the natural numbers›</span></span>

<span class="keyword1" id="FFT-sum_add_nat_ivl_singleton"><span class="command">lemma</span></span> sum_add_nat_ivl_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">m</span> <span class="main">+</span> sum <span class="free">f</span> <span class="main">{</span><span class="free">m</span><span class="main">&lt;..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">{</span><span class="free">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">m</span> <span class="main">+</span> sum <span class="free">f</span> <span class="main">{</span><span class="free">m</span><span class="main">&lt;..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">(</span><span class="main">{</span><span class="free">m</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">m</span><span class="main">&lt;..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.union_disjoint ivl_disj_int<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> less <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">{</span><span class="free">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ivl_disj_un<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FFT-sum_add_split_nat_ivl_singleton"><span class="command">lemma</span></span> sum_add_split_nat_ivl_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">i</span><span class="main">.</span> <span class="main">[|</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">;</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">m</span> <span class="main">+</span> sum <span class="free">g</span> <span class="main">{</span><span class="free">m</span><span class="main">&lt;..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">{</span><span class="free">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> less g
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_add_nat_ivl_singleton <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> sum.cong_simp<span class="main">)</span>

<span class="keyword1" id="FFT-sum_add_split_nat_ivl"><span class="command">lemma</span></span> sum_add_split_nat_ivl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;=</span> <span class="main">(</span><span class="free">k</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;=</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">i</span><span class="main">.</span> <span class="main">[|</span> <span class="free">m</span> <span class="main">&lt;=</span> <span class="bound">i</span><span class="main">;</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">i</span><span class="main">.</span> <span class="main">[|</span> <span class="free">k</span> <span class="main">&lt;=</span> <span class="bound">i</span><span class="main">;</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">h</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">g</span> <span class="main">{</span><span class="free">m</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span> <span class="main">+</span> sum <span class="free">h</span> <span class="main">{</span><span class="free">k</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">{</span><span class="free">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le g h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.atLeastLessThan_concat <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> sum.cong_simp<span class="main">)</span>

<span class="keyword1" id="FFT-ivl_splice_Un"><span class="command">lemma</span></span> ivl_splice_Un<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">(*)</span> <span class="numeral">2</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> Suc <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> image_def Bex_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="FFT-ivl_splice_Int"><span class="command">lemma</span></span> ivl_splice_Int<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(*)</span> <span class="numeral">2</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> Suc <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">arith</span>

<span class="keyword1" id="FFT-double_inj_on"><span class="command">lemma</span></span> double_inj_on<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>

<span class="keyword1" id="FFT-Suc_double_inj_on"><span class="command">lemma</span></span> Suc_double_inj_on<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> Suc <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="FFT-sum_splice"><span class="command">lemma</span></span> sum_splice<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">::</span>nat <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">::</span>nat <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>
    sum <span class="free">f</span> <span class="main">(</span><span class="main">(*)</span> <span class="numeral">2</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ivl_splice_Un ivl_splice_Int sum.union_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.reindex <span class="main"><span class="main">[</span></span><span class="operator">OF</span> double_inj_on<span class="main"><span class="main">]</span></span>
      sum.reindex <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc_double_inj_on<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Complex Roots of Unity›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">cis</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> from the complex library returns the
  point on the unity circle corresponding to the argument angle.  It
  is the base for our definition of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>root›</span></span></span></span>.  The main property,
  De Moirve's formula is already there in the library.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">root</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">==</span> cis <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="main">(</span>real <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="FFT-sin_periodic_pi_diff"><span class="command">lemma</span></span> sin_periodic_pi_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="free">x</span> <span class="main">-</span> pi<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> sin <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> sin_minus_pi<span class="main">)</span>

<span class="keyword1" id="FFT-sin_cos_between_zero_two_pi"><span class="command">lemma</span></span> sin_cos_between_zero_two_pi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">x</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> pi"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sin_gt_zero<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> pi"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> pi1<span class="main">:</span> <span class="quoted"><span class="quoted">"pi <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pi2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">-</span> pi"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> pi <span class="main">&lt;</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="free">x</span> <span class="main">-</span> pi<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sin_gt_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> pi1 pi2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 pi <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Lemmas›</span></span>

<span class="keyword1" id="FFT-root_nonzero"><span class="command">lemma</span></span> root_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff root_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sin_zero_abs_cos_one<span class="main">)</span>

<span class="keyword1" id="FFT-root_unity"><span class="command">lemma</span></span> root_unity<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff root_def DeMoivre<span class="main">)</span>

<span class="keyword1" id="FFT-root_cancel"><span class="command">lemma</span></span> root_cancel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">==&gt;</span> root <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> root <span class="free">n</span> <span class="main">^</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> root_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DeMoivre<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="FFT-root_summation"><span class="command">lemma</span></span> root_summation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>root <span class="free">n</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> k <span class="keyword1"><span class="command">have</span></span> real0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> real <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> real <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_divide_iff
      mult_strict_right_mono <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> k mult_strict_right_mono <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"real <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
    b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">/</span> real <span class="free">n</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> realk<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> real <span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_divide_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Main part of the proof›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>root <span class="free">n</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span>root <span class="free">n</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>root <span class="free">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> atLeast0LessThan
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> geometric_sum<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> root_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DeMoivre<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> real0 realk sin_cos_between_zero_two_pi
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>root <span class="free">n</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>root <span class="free">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_unity<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FFT-root_summation_inv"><span class="command">lemma</span></span> root_summation_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> k <span class="keyword1"><span class="command">have</span></span> real0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> real <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> real <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_divide_iff
      mult_strict_right_mono <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> k mult_strict_right_mono <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"real <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
    b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">/</span> real <span class="free">n</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> realk<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> real <span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_divide_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Main part of the proof›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> atLeast0LessThan
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> geometric_sum<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonzero_inverse_eq_divide <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> root_nonzero<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> root_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DeMoivre<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> real0 realk sin_cos_between_zero_two_pi
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide root_unity<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FFT-root0"><span class="command">lemma</span></span> root0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"root <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff root_def<span class="main">)</span>

<span class="keyword1" id="FFT-root1"><span class="command">lemma</span></span> root1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"root <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff root_def<span class="main">)</span>

<span class="keyword1" id="FFT-root2"><span class="command">lemma</span></span> root2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"root <span class="numeral">2</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff root_def<span class="main">)</span>

<span class="keyword1" id="FFT-root4"><span class="command">lemma</span></span> root4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"root <span class="numeral">4</span> <span class="main">=</span> <span class="keyword1">𝗂</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff root_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Derived Lemmas›</span></span>

<span class="keyword1" id="FFT-root_cancel1"><span class="command">lemma</span></span> root_cancel1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> root <span class="free">m</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> root <span class="free">m</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FFT-root_cancel2"><span class="command">lemma</span></span> root_cancel2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">==&gt;</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Note the space between <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>-›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>1›</span></span></span></span>.›</span></span>
  <span class="keyword1"><span class="command">using</span></span> root_cancel <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Discrete Fourier Transformation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define operations  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DFT›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IDFT›</span></span></span></span> for the discrete
  Fourier Transform and its inverse.  Vectors are simply functions of
  type <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat =&gt; complex›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DFT n a›</span></span></span></span> is the transform of vector <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span>
  of length <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IDFT›</span></span></span></span> its inverse.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">DFT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">=&gt;</span> complex<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">=&gt;</span> complex<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">DFT</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="main">(</span>root <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">IDFT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">=&gt;</span> complex<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">=&gt;</span> complex<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">IDFT</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>root <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>DFT <span class="numeral">4</span> <span class="free">a</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">=</span> <span class="var">?x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DFT_def Sum4<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemmas for the correctness proof.›</span></span>

<span class="keyword1" id="FFT-DFT_lower"><span class="command">lemma</span></span> DFT_lower<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DFT <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="free">a</span> <span class="free">i</span> <span class="main">=</span>
  DFT <span class="free">m</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">+</span>
  <span class="main">(</span>root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">i</span> <span class="main">*</span> DFT <span class="free">m</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> DFT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">.</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_splice<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> root <span class="free">m</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="free">i</span> <span class="main">*</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> root <span class="free">m</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?t</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹First pair of sums›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_cancel1<span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Second pair of sums›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_cancel1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FFT-DFT_upper"><span class="command">lemma</span></span> DFT_upper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mbound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ibound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;=</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"DFT <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="free">a</span> <span class="free">i</span> <span class="main">=</span>
    DFT <span class="free">m</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">-</span>
    root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> DFT <span class="free">m</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> DFT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">.</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_splice<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> root <span class="free">m</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
    root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> root <span class="free">m</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?t</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹First pair of sums›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_cancel1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_unity ibound root_nonzero power_diff power_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Second pair of sums›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mbound root_cancel2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_cancel1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FFT-IDFT_lower"><span class="command">lemma</span></span> IDFT_lower<span class="main">:</span>
  <span class="quoted"><span class="quoted">"IDFT <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="free">a</span> <span class="free">i</span> <span class="main">=</span>
  IDFT <span class="free">m</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">+</span>
  <span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">i</span> <span class="main">*</span> IDFT <span class="free">m</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> IDFT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">.</span> <span class="free">a</span> <span class="bound">j</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_splice<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span> <span class="main">/</span> root <span class="free">m</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    <span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">i</span> <span class="main">*</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> root <span class="free">m</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?t</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹First pair of sums›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_cancel1<span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Second pair of sums›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide root_nonzero<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_cancel1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FFT-IDFT_upper"><span class="command">lemma</span></span> IDFT_upper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mbound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ibound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;=</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IDFT <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="free">a</span> <span class="free">i</span> <span class="main">=</span>
    IDFT <span class="free">m</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">-</span>
    <span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span>
    IDFT <span class="free">m</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> IDFT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">.</span> <span class="free">a</span> <span class="bound">j</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_splice<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span> <span class="main">/</span> root <span class="free">m</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
    <span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> root <span class="free">m</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?t</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹First pair of sums›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_cancel1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_unity ibound root_nonzero power_diff power_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Second pair of sums›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide root_nonzero<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mbound root_cancel2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_divide_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_cancel1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DFT›</span></span></span></span> und <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IDFT›</span></span></span></span> are inverses.›</span></span>

<span class="keyword1"><span class="command">declare</span></span> divide_divide_eq_right <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  divide_divide_eq_left <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="FFT-power_diff_inverse"><span class="command">lemma</span></span> power_diff_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="main">~=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;=</span> <span class="free">n</span> <span class="main">==&gt;</span> <span class="main">(</span>inverse <span class="free">a</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="free">m</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> diff_induct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_inverse
      nonzero_inverse_eq_divide <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> nz<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nz<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="FFT-power_diff_rev_if"><span class="command">lemma</span></span> power_diff_rev_if<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="main">~=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="free">m</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">&lt;=</span> <span class="free">m</span> <span class="keyword1">then</span> <span class="free">a</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span><span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">a</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;=</span> <span class="free">m</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> nz <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_diff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> nz <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_diff_inverse nonzero_inverse_eq_divide <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FFT-power_divides_special"><span class="command">lemma</span></span> power_divides_special<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="main">~=</span> <span class="main">0</span> <span class="main">==&gt;</span>
  <span class="free">a</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">*</span> <span class="free">j</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">j</span> <span class="main">/</span> <span class="free">a</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide power_mult <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> DFT_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"IDFT <span class="free">n</span> <span class="main">(</span>DFT <span class="free">n</span> <span class="free">a</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="main">*</span> <span class="free">a</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">linarith_split_limit</span> <span class="main"><span class="main">=</span></span> 0<span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DFT_def IDFT_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_divide_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum.swap<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> times_divide_eq_left <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_divides_special <span class="main"><span class="main">[</span></span><span class="operator">OF</span> root_nonzero<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_diff_rev_if root_nonzero<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_divide_distrib <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span>
    sum_distrib_right <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> i_less <span class="keyword1"><span class="command">have</span></span> i_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">k</span><span class="main">.</span> <span class="free">i</span> <span class="main">-</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">have</span></span> diff_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">==&gt;</span> <span class="bound">k</span> <span class="main">-</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sum</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">.</span> sum <span class="main">(</span><span class="main">(^)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;=</span> <span class="bound">j</span> <span class="keyword1">then</span> root <span class="bound">n</span> <span class="main">^</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span>
                  <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="bound">n</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span> <span class="main">*</span> <span class="free">a</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sum1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">.</span> sum <span class="main">(</span><span class="main">(^)</span> <span class="main">(</span>root <span class="bound">n</span> <span class="main">^</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span> <span class="main">*</span> <span class="free">a</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sum2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">n</span><span class="main">.</span> sum <span class="main">(</span><span class="main">(^)</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="bound">n</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span> <span class="main">*</span> <span class="free">a</span> <span class="bound">j</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> i_less <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="var">?sum</span> <span class="free">i</span> <span class="bound">j</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">.</span> <span class="var">?sum2</span> <span class="free">i</span> <span class="bound">j</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="var">?sum1</span> <span class="free">i</span> <span class="bound">j</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_summation_inv nat_dvd_not_less
        sum_add_split_nat_ivl <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="var">?sum</span> <span class="free">i</span> <span class="bound">j</span> <span class="free">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i_less i_diff
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="var">?sum1</span> <span class="free">i</span> <span class="bound">j</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_summation_inv nat_dvd_not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i_less <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">i</span><span class="main">&lt;..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="var">?sum1</span> <span class="free">i</span> <span class="bound">j</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ivl_disj_un<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
      <span class="main">(</span><span class="var">?sum1</span> <span class="free">i</span> <span class="free">i</span> <span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">&lt;..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="var">?sum1</span> <span class="free">i</span> <span class="bound">j</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.union_disjoint ivl_disj_int<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i_less diff_i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?sum1</span> <span class="free">i</span> <span class="free">i</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_summation nat_dvd_not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i_less <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="main">*</span> <span class="free">a</span> <span class="free">i</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?t</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Discrete, Fast Fourier Transformation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FFT k a›</span></span></span></span> is the transform of vector <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span>
  of length <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>2 ^ k›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IFFT›</span></span></span></span> its inverse.›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">FFT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">=&gt;</span> complex<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">=&gt;</span> complex<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FFT</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FFT</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">FFT</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">FFT</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">in</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">k</span></span></span>
            <span class="keyword1">then</span> <span class="bound">x</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">(</span>root <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">y</span> <span class="bound">i</span>
            <span class="keyword1">else</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>root <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">IFFT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">=&gt;</span> complex<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">=&gt;</span> complex<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">IFFT</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">IFFT</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">IFFT</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">IFFT</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">in</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">k</span></span></span>
            <span class="keyword1">then</span> <span class="bound">x</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">y</span> <span class="bound">i</span>
            <span class="keyword1">else</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">-</span>
              <span class="main">(</span><span class="main">1</span> <span class="main">/</span> root <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally, for vectors of length <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>2 ^ k›</span></span></span></span>,
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DFT›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FFT›</span></span></span></span>, and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IDFT›</span></span></span></span> and
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IFFT›</span></span></span></span> are equivalent.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> DFT_FFT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">a</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span> <span class="main">==&gt;</span> DFT <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">i</span> <span class="main">=</span> FFT <span class="free">k</span> <span class="bound">a</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DFT_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">k</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DFT_lower<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> False i <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DFT_upper<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> IDFT_IFFT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">a</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span> <span class="main">==&gt;</span> IDFT <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">i</span> <span class="main">=</span> IFFT <span class="free">k</span> <span class="bound">a</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IDFT_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">k</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IDFT_lower<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> False i <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IDFT_upper<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>FFT <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">=</span> <span class="var">?x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>