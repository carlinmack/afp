<div id="Digits">
<div class="head">
<h1>Theory Digits</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Digits
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Representation of integers in different bases›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ First, we look at some useful lemmas for splitting sums. ›</span></span>
<span class="keyword1" id="Digits-split_sum_first_elt_less"><span class="command">lemma</span></span> split_sum_first_elt_less<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span><span class="free">m</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="free">n</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span>Suc <span class="free">n</span> <span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum.atLeast_Suc_lessThan assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Digits-split_sum_mid_less"><span class="command">lemma</span></span> split_sum_mid_less<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In order to use representation of numbers in a basis <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>base›</span></span></span></span> and to calculate the conversion 
to and from integers, we introduce the following locale.›</span></span>
<span class="keyword1"><span class="command">locale</span></span> digits <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">base</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> base_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">base</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Conversion from basis base to integers: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>from_digits n d›</span></span></span></span>

\begin{tabular}{lcp{8cm}}
  n:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; length of representation in basis base\\
  d:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat ⇒ nat›</span></span></span></span>&amp; function of digits in basis base where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d i›</span></span></span></span> is the $i$-th digit in basis base\\
  output:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; natural number corresponding to $d(n-1) \dots d(0)$ as integer\\
\end{tabular}
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">from_digits</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">from_digits</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">from_digits</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">0</span> <span class="main">+</span> <span class="free">base</span> <span class="main">*</span> <span class="free">from_digits</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∘</span> Suc<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Alternative definition using sum:›</span></span>
<span class="keyword1" id="Digits-from_digits_altdef"><span class="command">lemma</span></span> from_digits_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"from_digits <span class="free">n</span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> from_digits.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.lessThan_Suc_shift o_def sum_distrib_left 
       sum_distrib_right mult_ac <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sum.lessThan_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Digit in basis base of some integer number: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>digit x i›</span></span></span></span>

\begin{tabular}{lcp{8cm}}
  x:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; integer\\
  i:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; index\\
  output:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; $i$-th digit of representation in basis base of $x$\\
\end{tabular}
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">digit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">digit</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">digit</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">digit</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Alternative definition using divisor and modulo:›</span></span>
<span class="keyword1" id="Digits-digit_altdef"><span class="command">lemma</span></span> digit_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"digit <span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">base</span> <span class="main">^</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> digit.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_mult2_eq<span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every digit must be smaller that the base.›</span></span>
<span class="keyword1" id="Digits-digit_less_base"><span class="command">lemma</span></span> digit_less_base<span class="main">:</span> <span class="quoted"><span class="quoted">"digit <span class="free">x</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">base</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> base_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> digit_altdef<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A representation in basis <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>base›</span></span></span></span> of length $n$ must be less than $<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>base›</span></span></span></span> ^ n$.›</span></span>
<span class="keyword1" id="Digits-from_digits_less"><span class="command">lemma</span></span> from_digits_less<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">base</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"from_digits <span class="free">n</span> <span class="free">d</span> <span class="main">&lt;</span> <span class="free">base</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> from_digits.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">n</span> <span class="skolem">d</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"from_digits <span class="skolem">n</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">≤</span> <span class="free">base</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_leI Suc_pred base_pos comp_apply 
        less_Suc_eq_le zero_less_power<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">base</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_pred base_pos less_Suc_eq_0_disj 
        less_Suc_eq_le<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">0</span> <span class="main">+</span> <span class="free">base</span> <span class="main">*</span> from_digits <span class="skolem">n</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">≤</span> 
      <span class="free">base</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="free">base</span> <span class="main">*</span> <span class="main">(</span><span class="free">base</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mono_thms_linordered_semiring<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_digits <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">&lt;</span> <span class="free">base</span> <span class="main">^</span> Suc <span class="skolem">n</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> base_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>comp_def<span class="main">)</span> 
    <span class="main">(</span><span class="operator">metis</span> Suc_pred add_gr_0 le_imp_less_Suc mult_Suc_right 
      zero_less_power<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemmas for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>mod›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>div›</span></span></span></span> in number systems of basis <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>base›</span></span></span></span>:›</span></span>
<span class="keyword1" id="Digits-mod_base"><span class="command">lemma</span></span> mod_base<span class="main">:</span>  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">⟹</span> <span class="free">d</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">base</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"from_digits <span class="free">n</span> <span class="free">d</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> <span class="free">d</span> <span class="main">0</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mod_sum_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms 
      sum.lessThan_Suc_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">d</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> from_digits_altdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digits-mod_base_i"><span class="command">lemma</span></span> mod_base_i<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">⟹</span> <span class="free">d</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">base</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> <span class="free">d</span> <span class="free">i</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> 
        <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mod_sum_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms split_sum_first_elt_less<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> 
        f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> from_digits_altdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digits-div_base_i"><span class="command">lemma</span></span> div_base_i<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">⟹</span> <span class="free">d</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">base</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"from_digits <span class="free">n</span> <span class="free">d</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">base</span> <span class="main">^</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> from_digits_altdef <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> base_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">base</span><span class="main">^</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span>  <span class="free">base</span><span class="main">^</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">base</span><span class="main">^</span><span class="free">i</span>"</span></span> 
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_diff_assoc2 add_diff_cancel_right' atLeastLessThan_iff 
        power_add that<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> first<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">i</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span><span class="main">&lt;</span> <span class="free">base</span> <span class="main">^</span> <span class="free">i</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms from_digits_less<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> from_digits_altdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">i</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms split_sum_mid_less<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> split_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">i</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="free">base</span><span class="main">^</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> base_exp mult.assoc sum_distrib_right 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> mult.commute sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">base</span> <span class="main">^</span> <span class="free">i</span> <span class="main">=</span> 
              <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="free">i</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> first <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>split_sum base_pos<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Conversions are inverse to each other.›</span></span>
<span class="keyword1" id="Digits-digit_from_digits"><span class="command">lemma</span></span> digit_from_digits<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">⟹</span> <span class="free">d</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">base</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"digit <span class="main">(</span>from_digits <span class="free">n</span> <span class="free">d</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="free">d</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> digits.mod_base digits_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"from_digits <span class="free">n</span> <span class="free">d</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> <span class="free">d</span> <span class="free">i</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_base_i mod_base_i<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"digit <span class="main">(</span>from_digits <span class="free">n</span> <span class="free">d</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="free">d</span> <span class="free">i</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> digit_altdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digits-div_distrib"><span class="command">lemma</span></span> div_distrib<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">base</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">base</span><span class="main">^</span><span class="free">i</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">base</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_imp_power_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">base</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI assms dvd_imp_mod_0 dvd_mult 
        dvd_mult_imp_div le_imp_power_dvd power_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral div_mult_mod_eq 
        div_plus_div_distrib_dvd_left mod_mult_self3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digits-from_digits_digit"><span class="command">lemma</span></span> from_digits_digit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">base</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"from_digits <span class="free">n</span> <span class="main">(</span>digit <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> digit_altdef from_digits_altdef 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x_less</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x_less</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x_n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x_n</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x_less</span> <span class="main">&lt;</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> x_less_def base_pos mod_less_divisor <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH_x_less<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">x_less</span> <span class="keyword1">div</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x_less</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x_n</span> <span class="main">&lt;</span> <span class="free">base</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">&lt;</span><span class="free">base</span><span class="main">^</span>Suc <span class="skolem">n</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> less_mult_imp_div_less x_n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x_n</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> <span class="skolem">x_n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> x_less_i_eq_x_i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="free">base</span> <span class="main">^</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> 
    <span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> div_mult_mod_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">base</span><span class="main">^</span><span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> div_distrib<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span>"</span></span><span class="main">]</span>
        that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x_n</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">)</span><span class="main">*</span><span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">x_less</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x_n</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">=</span><span class="skolem">x_n</span>›</span></span> 
    <span class="keyword1"><span class="command">using</span></span> x_n_def x_less_def div_mod_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">)</span> <span class="main">*</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> 
                <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH_x_less x_less_def x_less_i_eq_x_i x_n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> sum.atMost_Suc 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Stronger formulation of above lemma.›</span></span>
<span class="keyword1" id="Digits-from_digits_digit'"><span class="command">lemma</span></span> from_digits_digit'<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"from_digits <span class="free">n</span> <span class="main">(</span>digit <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">base</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> from_digits_altdef digit_altdef 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x_less</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x_less</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x_n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x_n</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x_less</span> <span class="main">&lt;</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_less_def base_pos 
      mod_less_divisor <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH_x_less<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">x_less</span> <span class="keyword1">div</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x_less</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x_n</span> <span class="main">&lt;</span> <span class="free">base</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> base_pos mod_less_divisor x_n_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x_n</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> <span class="skolem">x_n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> x_less_i_eq_x_i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="free">base</span> <span class="main">^</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> 
    <span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> div_mult_mod_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">base</span><span class="main">^</span><span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="free">base</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> div_distrib<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span>"</span></span><span class="main">]</span> 
        that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">^</span>Suc <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x_n</span><span class="main">*</span><span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">x_less</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_mult2_eq mult.commute power_Suc2 x_less_def x_n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="keyword1">mod</span> <span class="free">base</span><span class="main">)</span> <span class="main">*</span> <span class="free">base</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> 
                <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">base</span> <span class="main">*</span> <span class="free">base</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH_x_less x_less_def x_less_i_eq_x_i x_n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> sum.atMost_Suc 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Van_der_Waerden">
<div class="head">
<h1>Theory Van_der_Waerden</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Van_der_Waerden
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span> <a href="#Digits">Digits</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Van der Waerden's Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In combinatorics, Van der Waerden's Theorem is about arithmetic progressions of a certain
length of the same colour in a colouring of an interval. In order to state the theorem and to
prove it, we need to formally introduce arithmetic progressions. We will express $k$-colourings as
functions mapping an integer interval to the set $\{0,\dots , k-1 \}$ of colours.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Arithmetic progressions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A sequence of integer numbers with the same step size is called an arithmetic progression.
 We say an  $m$-fold arithmetic progression is an arithmetic progression with multiple step 
lengths.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Arithmetic progressions are defined in the following using the variables:

\begin{tabular}{lcp{8cm}}
$start$:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>int›</span></span></span></span>&amp; starting value\\
$step$:&amp;  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; positive integer for step length\\
$i$:&amp;     <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; $i$-th value in the arithmetic progression \\
\end{tabular}›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">arith_prog</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">arith_prog</span> <span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="main">+</span> int <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">step</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ An $m$-fold arithmetic progression (which we will also call a multi-arithmetic progression)
is defined in the following using the variables:

\begin{tabular}{lcp{8cm}}
$dims$:&amp;   <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; number of dimensions/step directions of $m$-fold arithmetic progression\\
$start$:&amp;  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>int›</span></span></span></span>&amp; starting value\\
$steps$:&amp;  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat ⇒ nat›</span></span></span></span>&amp; function of steps, returns step in $i$-th dimension for $i\in[0..&lt;dims]$\\
$c$:&amp;      <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat ⇒ nat›</span></span></span></span>&amp; function of coefficients, returns coefficient in $i$-th dimension for 
           $i\in[0..&lt;dims]$ \\
\end{tabular}›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">multi_arith_prog</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">multi_arith_prog</span> <span class="free"><span class="bound"><span class="entity">dims</span></span></span> <span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="free"><span class="bound"><span class="entity">steps</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> 
           <span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="main">+</span> int <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">dims</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">i</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">steps</span></span></span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹An $m$-fold arithmetic progression of dimension $1$ is also an arithmetic progression and 
  vice versa. This is shown in the following lemmas.›</span></span>
<span class="keyword1" id="Van_der_Waerden-multi_to_arith_prog"><span class="command">lemma</span></span> multi_to_arith_prog<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"multi_arith_prog <span class="main">1</span> <span class="free">start</span> <span class="free">steps</span> <span class="free">c</span> <span class="main">=</span> 
    arith_prog <span class="free">start</span> <span class="main">(</span><span class="free">steps</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> multi_arith_prog_def arith_prog_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Van_der_Waerden-arith_prog_to_multi"><span class="command">lemma</span></span> arith_prog_to_multi<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"arith_prog <span class="free">start</span> <span class="free">step</span> <span class="free">c</span> <span class="main">=</span> 
    multi_arith_prog <span class="main">1</span> <span class="free">start</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">step</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> multi_arith_prog_def arith_prog_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To show that an arithmetic progression is well-defined, we introduce the following predicate.
It assures that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>arith_prog start step ` [0..&lt;l]›</span></span></span></span> is contained in the integer interval $[a..b]$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_arith_prog_on</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int <span class="main">⇒</span> nat <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_arith_prog_on</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> arith_prog <span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Furthermore, we have monotonicity for arithmetic progressions.›</span></span>
<span class="keyword1" id="Van_der_Waerden-arith_prog_mono"><span class="command">lemma</span></span> arith_prog_mono<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">c'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"arith_prog <span class="free">start</span> <span class="free">step</span> <span class="free">c</span> <span class="main">≤</span> arith_prog <span class="free">start</span> <span class="free">step</span> <span class="free">c'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_mono<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now, we state the well-definedness of an arithmetic progression of length $l$ in an integer
interval $[a..b]$. 
Indeed, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_arith_prog_on›</span></span></span></span> guarantees that every element of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>arith_prog start step›</span></span></span></span> of length $l$ 
  lies in $[a..b]$.›</span></span>
<span class="keyword1" id="Van_der_Waerden-is_arith_prog_onD"><span class="command">lemma</span></span> is_arith_prog_onD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_arith_prog_on <span class="free">l</span> <span class="free">start</span> <span class="free">step</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">l</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"arith_prog <span class="free">start</span> <span class="free">step</span> <span class="free">c</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="free">start</span> <span class="free">step</span> <span class="main">0</span> <span class="main">≤</span> arith_prog <span class="free">start</span> <span class="free">step</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arith_prog_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="free">start</span> <span class="free">step</span> <span class="free">c</span> <span class="main">≥</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arith_prog_def is_arith_prog_on_def 
                      add_increasing2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="free">start</span> <span class="free">step</span> <span class="main">(</span><span class="free">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≥</span> 
                   arith_prog <span class="free">start</span> <span class="free">step</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arith_prog_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="free">start</span> <span class="free">step</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def is_arith_prog_on_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We also need a predicate for an $m$-fold arithmetic progression to be well-defined. 
It assures that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>multi_arith_prog start step ` [0..&lt;l]^m›</span></span></span></span> is contained in $[a..b]$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_multi_arith_prog_on</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> int <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_multi_arith_prog_on</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="free"><span class="bound"><span class="entity">steps</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span>
     <span class="main">(</span><span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> multi_arith_prog <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="free"><span class="bound"><span class="entity">steps</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Moreover, we have monotonicity for $m$-fold arithmetic progressions as well.›</span></span>
<span class="keyword1" id="Van_der_Waerden-multi_arith_prog_mono"><span class="command">lemma</span></span> multi_arith_prog_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">c</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">c'</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multi_arith_prog <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span> <span class="free">c</span> <span class="main">≤</span> 
            multi_arith_prog <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span> <span class="free">c'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> multi_arith_prog_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_mono <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_right_mono<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally, we get the well-definedness for $m$-fold arithmetic progressions of length $l$.
Here, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_multi_arith_prog_on›</span></span></span></span> guarantees that every element of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>multi_arith_prog start step›</span></span></span></span> 
  of length $l$ lies in $[a..b]$.›</span></span>
<span class="keyword1" id="Van_der_Waerden-is_multi_arith_prog_onD"><span class="command">lemma</span></span> is_multi_arith_prog_onD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_multi_arith_prog_on <span class="free">l</span> <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">l</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multi_arith_prog <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span> <span class="free">c</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multi_arith_prog <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> 
          multi_arith_prog <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multi_arith_prog_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"multi_arith_prog <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span> <span class="free">c</span> <span class="main">≥</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multi_arith_prog_def 
       is_multi_arith_prog_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multi_arith_prog <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≥</span> 
                   multi_arith_prog <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multi_arith_prog_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"multi_arith_prog <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multi_arith_prog_def 
        is_multi_arith_prog_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Van der Waerden's Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The property for a number $n$ to fulfill Van der Waerden's theorem is the following:\\
For a $k$-colouring col of $[a..b]$ there exist
\begin{itemize}
\item $start$: starting value of an arithmetic progression
\item $step$:  step length of an arithmetic progression
\item $j$: colour 
\end{itemize}
such that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>arith_prog start step›</span></span></span></span> is a valid arithmetic progression of length $l$ lying 
in $[a..b]$ of the same colour $j$.

The following variables will be used:\\
\begin{tabular}{lcp{8cm}}
$k$:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; number of colours in segment colouring on $[a..b]$\\
$l$:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; length of arithmetic progression\\
$n$:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; number fulfilling Van der Waerden's Theorem\\
\end{tabular}
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vdw</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vdw</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟷</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">col</span><span class="main">.</span> <span class="bound">b</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≥</span> <span class="bound">a</span> <span class="main">+</span> int <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">col</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">}</span> <span class="main">⟶</span>
       <span class="main">(</span><span class="main">∃</span><span class="bound">j</span> <span class="bound">start</span> <span class="bound">step</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> <span class="bound">step</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> 
        is_arith_prog_on <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="bound">start</span> <span class="bound">step</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">∧</span>
        arith_prog <span class="bound">start</span> <span class="bound">step</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">}</span> <span class="main">⊆</span> <span class="bound">col</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To better work with the property of Van der Waerden's theorem, we introduce an 
  elimination rule.›</span></span>
<span class="keyword1" id="Van_der_Waerden-vdwE"><span class="command">lemma</span></span> vdwE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vdw <span class="free">k</span> <span class="free">l</span> <span class="free">n</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">+</span> int <span class="free">n</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="free">col</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">j</span> <span class="free">start</span> <span class="free">step</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="quoted"><span class="quoted">"is_arith_prog_on <span class="free">l</span> <span class="free">start</span> <span class="free">step</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"arith_prog <span class="free">start</span> <span class="free">step</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">l</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">col</span> <span class="main">-`</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">unfolding</span></span> vdw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Van der Waerden's theorem implies that the number fulfilling it is positive. This is show 
in the following lemma.›</span></span>
<span class="keyword1" id="Van_der_Waerden-vdw_imp_pos"><span class="command">lemma</span></span> vdw_imp_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vdw <span class="free">k</span> <span class="free">l</span> <span class="free">n</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Nat.gr0I<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> vdwE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> col <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="bound"><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lessThan_empty_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Van der Waerden's Theorem is trivial for a non-existent colouring. 
It also makes no sense for arithmetic progressions of length 0.›</span></span>
<span class="keyword1" id="Van_der_Waerden-vdw_0_left"><span class="command">lemma</span></span> vdw_0_left <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> vdw <span class="main">0</span> <span class="free">l</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vdw_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the case of $k=1$, Van der Waerden's Theorem holds. Then every number has the same colour,
hence also the arithmetic progression. A possible choice for the number fulfilling Van der 
Waerden Theorem is $l$.›</span></span>
<span class="keyword1" id="Van_der_Waerden-vdw_1_left"><span class="command">lemma</span></span> vdw_1_left<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vdw <span class="main">1</span> <span class="free">l</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vdw_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">col</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">a</span> <span class="main">1</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">l</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">-`</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">a</span> <span class="main">1</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">l</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">col</span> <span class="main">-`</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_arith_prog_on <span class="free">l</span> <span class="skolem">a</span> <span class="main">1</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> is_arith_prog_on_def arith_prog_def <span class="keyword1"><span class="command">using</span></span> 1 assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span> <span class="bound">start</span> <span class="bound">step</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">step</span> <span class="main">∧</span> 
        is_arith_prog_on <span class="free">l</span> <span class="bound">start</span> <span class="bound">step</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span>
        arith_prog <span class="bound">start</span> <span class="bound">step</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">l</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">col</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the case $l=1$, Van der Waerden's Theorem holds. As the length of the arithmetic 
progression is $1$, it consists of just one element. Thus every nonempty integer interval fulfills 
the Van der Waerden property. We can prove $N_{k,1}$ to be $1$.›</span></span>
<span class="keyword1" id="Van_der_Waerden-vdw_1_right"><span class="command">lemma</span></span> vdw_1_right<span class="main">:</span> <span class="quoted"><span class="quoted">"vdw <span class="free">k</span> <span class="main">1</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vdw_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">col</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> nat"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> int <span class="main">1</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">a</span> <span class="main">1</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">col</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">col</span> <span class="skolem">a</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">a</span> <span class="main">1</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">col</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">col</span> <span class="skolem">a</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_arith_prog_on <span class="main">1</span> <span class="skolem">a</span> <span class="main">1</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> is_arith_prog_on_def arith_prog_def
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span> <span class="bound">start</span> <span class="bound">step</span><span class="main">.</span>
          <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">step</span> <span class="main">∧</span> is_arith_prog_on <span class="main">1</span> <span class="bound">start</span> <span class="bound">step</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span>
          arith_prog <span class="bound">start</span> <span class="bound">step</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">col</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">col</span> <span class="skolem">a</span> <span class="main">&lt;</span><span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the case $l=2$, Van der Waerden's Theorem holds as well. Here, any two distinct numbers 
form an arithmetic progression of length $2$. Thus we only have to find two numbers with the same 
colour.
Using the pigeonhole principle on $k+1$ values, we can find two integers with the same colour.›</span></span>
<span class="keyword1" id="Van_der_Waerden-vdw_2_right"><span class="command">lemma</span></span> vdw_2_right<span class="main">:</span> <span class="quoted"><span class="quoted">"vdw <span class="free">k</span> <span class="numeral">2</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vdw_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">col</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> nat"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> int <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> card <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">col</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_lessThan card_mono finite_lessThan le_less_trans 
        less_add_one not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inj_on <span class="skolem">col</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pigeonhole<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">col</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">start</span></span> <span class="skolem"><span class="skolem">start_step</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> pigeon<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="skolem">start</span> <span class="main">=</span> <span class="skolem">col</span> <span class="skolem">start_step</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">start</span> <span class="main">&lt;</span> <span class="skolem">start_step</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">start</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">start_step</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> inj_onI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">col</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_less_iff_gr_or_eq<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">step</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">step</span> <span class="main">=</span> nat <span class="main">(</span><span class="skolem">start_step</span> <span class="main">-</span> <span class="skolem">start</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">col</span> <span class="skolem">start</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>2<span class="main">)</span> pigeon<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">step</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> step_def <span class="keyword1"><span class="command">using</span></span> pigeon<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_arith_prog_on <span class="numeral">2</span> <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> is_arith_prog_on_def arith_prog_def step_def 
    <span class="keyword1"><span class="command">using</span></span> pigeon <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">start</span><span class="main">,</span> <span class="skolem">start_step</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that arith_prog_def step_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_2_cases_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="skolem">col</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pigeon <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="numeral">2</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">col</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span> <span class="bound">start</span> <span class="bound">step</span><span class="main">.</span>
          <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">∧</span>
          <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">step</span> <span class="main">∧</span>
          is_arith_prog_on <span class="numeral">2</span> <span class="bound">start</span> <span class="bound">step</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span>
          arith_prog <span class="bound">start</span> <span class="bound">step</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="numeral">2</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">col</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In order to prove Van der Waerden's Theorem, we first prove a slightly different lemma.
The statement goes as follows:\\
For a $k$-colouring $col$ on $[a..b]$ there exist
\begin{itemize}
\item  $start$: starting value of an arithmetic progression
\item  $steps$: step length of an arithmetic progression
\end{itemize}
such that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f = multi_arith_prog m start step›</span></span></span></span> is a valid $m$-fold arithmetic progression of 
length $l$ lying in $[a..b]$ such that for every $s&lt;m$ have: if $c j &lt; l$ for all $j\leq s$ then
$f(c_0, c_1, \dots, c_{m-1})$ and $f(0,\dots,0, c_{s+1},\dots, c_{m-1})$ have the same colour.

The property of the lemma uses the following variables:\\
\begin{tabular}{lcp{8cm}}
$k$:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; number of colours in segment colouring of $[a..b]$\\
$m$:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; dimension of $m$-fold arithmetic progression\\
$l$:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; $l+1$ is length of $m$-fold arithmetic progression\\
$n$:&amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat›</span></span></span></span>&amp; number fulfilling <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vdw_lemma›</span></span></span></span>\\
\end{tabular}
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vdw_lemma</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vdw_lemma</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟷</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">col</span><span class="main">.</span> <span class="bound">b</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≥</span> <span class="bound">a</span> <span class="main">+</span> int <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">col</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">}</span> <span class="main">⟶</span>
       <span class="main">(</span><span class="main">∃</span><span class="bound">start</span> <span class="bound">steps</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">.</span> <span class="bound">steps</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> 
        is_multi_arith_prog_on <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">start</span> <span class="bound">steps</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span>
           <span class="keyword1">let</span> <span class="bound">f</span> <span class="main">=</span> multi_arith_prog <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">start</span> <span class="bound">steps</span>
           <span class="keyword1">in</span>  <span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≤</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">c</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">⟶</span>
                  <span class="bound">col</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="bound">col</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="bound">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To better work with this property, we introduce an elimination rule for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vdw_lemma›</span></span></span></span>.›</span></span>
<span class="keyword1" id="Van_der_Waerden-vdw_lemmaE"><span class="command">lemma</span></span> vdw_lemmaE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vdw_lemma <span class="free">k</span> <span class="free">m</span> <span class="free">l</span> <span class="free">n</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">+</span> int <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">col</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">start</span> <span class="free">steps</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">steps</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"is_multi_arith_prog_on <span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">f</span> <span class="main">=</span> multi_arith_prog <span class="free">m</span> <span class="free">start</span> <span class="free">steps</span>
     <span class="keyword1">in</span>  <span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≤</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">c</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">)</span> <span class="main">⟶</span>
            <span class="free">col</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">col</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="bound">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">unfolding</span></span> vdw_lemma_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To simplify the following proof, we show the following formula.›</span></span>
<span class="keyword1" id="Van_der_Waerden-sum_mod_poly"><span class="command">lemma</span></span> sum_mod_poly<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">::</span>nat<span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">n</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> <span class="free">k</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">^</span><span class="free">q</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="free">q</span><span class="main">.</span> <span class="free">k</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span>int <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="free">q</span><span class="main">.</span> int <span class="free">k</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="free">k</span> <span class="main">^</span> <span class="free">q</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> int <span class="main">(</span><span class="free">k</span> <span class="main">^</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The proof of Van der Waerden's Theorem now proceeds in three steps:\\
\begin{itemize}
\item Firstly, we show that the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vdw›</span></span></span></span> property for all $k$ proves the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vdw_lemma›</span></span></span></span> for fixed $l$ but 
arbitrary $k$ and $m$. This is done by induction over $m$.
\item Secondly, we show that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vdw_lemma›</span></span></span></span> implies the induction step of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vdw›</span></span></span></span> using the pigeonhole 
principle.
\item Lastly, we combine the previous steps in an induction over $l$ to show Van der Waerden's 
Theorem in the general setting.
\end{itemize}›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Firstly, we need to show that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vdw›</span></span></span></span> for arbitrary $k$ implies <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vdw_lemma›</span></span></span></span> for fixed $l$.
As mentioned earlier, we use induction over $m$.›</span></span>
<span class="keyword1" id="Van_der_Waerden-vdw_imp_vdw_lemma"><span class="command">lemma</span></span> vdw_imp_vdw_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> vdw_assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k'</span><span class="main">.</span> <span class="bound">k'</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n_k'</span><span class="main">.</span> vdw <span class="bound">k'</span> <span class="free">l</span> <span class="bound">n_k'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> vdw_lemma <span class="free">k</span> <span class="free">m</span> <span class="free">l</span> <span class="bound">N</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">consider</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Case $m=1$: Show <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vdw_lemma›</span></span></span></span> for arithmetic progression, Induction start. ›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> vdw<span class="main">:</span> <span class="quoted"><span class="quoted">"vdw <span class="free">k</span> <span class="free">l</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vdw_assms <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span><span class="main">≥</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vdw_lemma <span class="free">k</span> <span class="skolem">m</span> <span class="free">l</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> vdw_lemma_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">col</span><span class="main">)</span>
      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Divide $[a..b]$ in two intervals $I_1$, $I_2$ of same length and obtain arithmetic 
        progression of length $l$ in $I_1$. ›</span></span>
      <span class="keyword1"><span class="command">have</span></span> col_restr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">start</span></span> <span class="skolem"><span class="skolem">step</span></span> <span class="keyword2"><span class="keyword">where</span></span> prog<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">step</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
        <span class="quoted"><span class="quoted">"is_arith_prog_on <span class="free">l</span> <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">l</span><span class="main">}</span> <span class="main">⊆</span> 
          <span class="skolem">col</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vdw 1 <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> vdwE<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>is_arith_prog_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> range_prog_lessThan_l<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">using</span></span> that prog <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">⊆</span><span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N_def <span class="quoted">"1"</span><span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span> int <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> N_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Show that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>arith_prog start step›</span></span></span></span> is an arithmetic progression of length $l+1$
         in $[a..b]$. ›</span></span>
      <span class="keyword1"><span class="command">have</span></span> prog_in_ivl<span class="main">:</span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="free">l</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> range_prog_lessThan_l <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">⊆</span><span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Show $<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>step›</span></span></span></span>\leq |I_1|$ then have <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>arith_prog start step (l+1)∈[a..b]›</span></span></span></span> as 
           <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>arith_prog start step (l+1) = arith_prog start step l + step›</span></span></span></span> ›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">start</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> range_prog_lessThan_l<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">start</span> <span class="main">+</span> int <span class="skolem">step</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> range_prog_lessThan_l<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="free">l</span>›</span></span> mult.left_neutral<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">step</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="main">(</span><span class="free">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> range_prog_lessThan_l<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span>›</span></span> diff_less less_numeral_extra<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="free">l</span> <span class="main">=</span> 
                        arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="main">(</span><span class="free">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> int <span class="skolem">step</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span>›</span></span> mult_eq_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="free">l</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">step</span><span class="main">≤</span><span class="skolem">n</span>›</span></span> N_def <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span> int <span class="skolem">n</span> <span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> range_prog_lessThan_l <span class="keyword1"><span class="command">using</span></span> True 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> col_prog_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span>arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">using</span></span> prog that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">steps</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> steps_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">steps</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">step</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> multi_arith_prog <span class="main">1</span> <span class="skolem">start</span> <span class="skolem">steps</span>"</span></span>
      
      <span class="keyword1"><span class="command">have</span></span> rel_prop_1<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">s</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">s</span> 
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> arith_prog_on<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"is_multi_arith_prog_on <span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">m</span> <span class="skolem">start</span> <span class="skolem">steps</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prog<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> is_arith_prog_on_def is_multi_arith_prog_on_def
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">=</span><span class="main">1</span>›</span></span> arith_prog_to_multi steps_def prog_in_ivl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">start</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">steps</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">use</span> rel_prop_1 <span class="quoted"><span class="quoted">‹<span class="skolem">step</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> <span class="main">1</span>›</span></span> arith_prog_on col_prog_eq
             multi_to_arith_prog <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> f_def Let_def steps_def›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Case $m&gt;1$: Show <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vdw_lemma›</span></span></span></span> for $m$-fold arithmetic progression, 
          Induction step $(m-1) \longrightarrow m$. ›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&gt;</span><span class="main">1</span>"</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> vdw_lemma_IH<span class="main">:</span><span class="quoted"><span class="quoted">"vdw_lemma <span class="free">k</span> <span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span> <span class="skolem">q</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">^</span><span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n_kq</span></span> <span class="keyword2"><span class="keyword">where</span></span> vdw<span class="main">:</span> <span class="quoted"><span class="quoted">"vdw <span class="main">(</span><span class="free">k</span><span class="main">^</span><span class="skolem">q</span><span class="main">)</span> <span class="free">l</span> <span class="skolem">n_kq</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> vdw_assms <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">^</span><span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n_kq</span>"</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Idea: $[a..b] = I_1 \cup I_2$ where $|I_1| = 2*n_{k,q}$ and $|I_2| = q$.
                Divide $I_1$ into blocks of length $q$ and define a new colouring on the set of 
                $q$-blocks where the colour of the block is the $k$-basis representation where 
                the $i$-th digit corresponds to the colour of the $i$-th element in the block. 
                Get an arithmetic progression of $q$-blocks of length $l+1$ in $I_1$, such that
                the first $l$ $q$-blocks have the same colour. 
                The step of the block-arithmetic progression is going to be the additional 
                step in the induction over $m$. ›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vdw_lemma <span class="free">k</span> <span class="skolem">m</span> <span class="free">l</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> vdw_lemma_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">col</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n_kq</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vdw_imp_pos vdw <span class="quoted"><span class="quoted">‹<span class="free">l</span><span class="main">≥</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>N_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≤</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Nat.gr0I<span class="main">)</span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span><span class="main">≥</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">interpret</span></span> digits <span class="quoted"><span class="free">k</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span>›</span></span> digits_def<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">col1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> from_digits <span class="skolem">q</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">col</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> range_col1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col1</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n_kq</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">^</span><span class="skolem">q</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> Pi_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n_kq</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> col_xn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> int <span class="skolem">n</span><span class="main">)</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span><span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
          <span class="keyword1"><span class="command">using</span></span> that 1 PiE N_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> col_xn_upper_bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> int <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span><span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="main">::</span><span class="quoted">nat</span>
          <span class="keyword1"><span class="command">using</span></span> that col_xn<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="skolem">q</span><span class="main">.</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> int <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span><span class="main">≤</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="skolem">q</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span>  <span class="free">k</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> col_xn_upper_bound <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_right_mono<span class="main">)</span> 
            <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="skolem">q</span><span class="main">.</span> <span class="free">k</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_distrib_left<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">^</span><span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum_mod_poly <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col1</span> <span class="skolem">x</span> <span class="main">&lt;</span><span class="free">k</span><span class="main">^</span><span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> col1_def from_digits_altdef 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">start</span></span> <span class="skolem"><span class="skolem">step</span></span> <span class="keyword2"><span class="keyword">where</span></span> prog<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">^</span><span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">step</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
        <span class="quoted"><span class="quoted">"is_arith_prog_on <span class="free">l</span> <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n_kq</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">l</span><span class="main">}</span> <span class="main">⊆</span> 
          <span class="skolem">col1</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n_kq</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vdw range_col1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> vdwE<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">)</span> 

      <span class="keyword1"><span class="command">have</span></span> range_prog_lessThan_l<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n_kq</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">using</span></span> that prog <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> prog_in_ivl<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> int <span class="skolem">n_kq</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="free">l</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> prog <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">start</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n_kq</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> range_prog_lessThan_l<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">start</span> <span class="main">+</span> <span class="skolem">step</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n_kq</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> range_prog_lessThan_l<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="free">l</span>›</span></span> mult.left_neutral<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">step</span> <span class="main">≤</span> <span class="skolem">n_kq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="main">(</span><span class="free">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">n_kq</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> range_prog_lessThan_l<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span>›</span></span> diff_less less_numeral_extra<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="free">l</span> <span class="main">=</span> 
            arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="main">(</span><span class="free">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">step</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span>›</span></span> mult_eq_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="free">l</span> <span class="main">∈</span> 
            <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> int <span class="skolem">n_kq</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">step</span><span class="main">≤</span><span class="skolem">n_kq</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> range_prog_lessThan_l <span class="keyword1"><span class="command">using</span></span> True 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> col_prog_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col1</span> <span class="main">(</span>arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">using</span></span> prog that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> digit_col1<span class="main">:</span><span class="quoted"><span class="quoted">"digit <span class="main">(</span><span class="skolem">col1</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">x</span><span class="main">+</span>int <span class="skolem">y</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>int <span class="skolem">n_kq</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">q</span><span class="main">}</span>"</span></span> 
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword1"><span class="command">unfolding</span></span> col1_def <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j'</span><span class="main">.</span> <span class="bound">j'</span><span class="main">&lt;</span><span class="skolem">q</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main">+</span><span class="bound">j'</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span><span class="main">(</span>1<span class="main">)</span> N_def that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j'</span><span class="main">.</span> <span class="bound">j'</span><span class="main">&lt;</span><span class="skolem">q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">x</span><span class="main">+</span>int <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">j'</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> 1 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"digit <span class="main">(</span>from_digits <span class="skolem">q</span> <span class="main">(</span><span class="main">λ</span><span class="bound">xa</span><span class="main">.</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> int <span class="bound">xa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> 
                    <span class="skolem">col</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> int <span class="skolem">y</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> digit_from_digits that 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Impact on the colour when taking the block-step. ›</span></span>
      <span class="keyword1"><span class="command">have</span></span> one_step_more<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span>arith_prog <span class="skolem">start'</span> <span class="skolem">step</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> digit <span class="skolem">j</span> <span class="main">(</span>nat <span class="main">(</span><span class="skolem">start'</span><span class="main">-</span><span class="skolem">start</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">start'</span><span class="main">∈</span><span class="main">{</span><span class="skolem">start</span><span class="main">..&lt;</span><span class="skolem">start</span><span class="main">+</span><span class="skolem">q</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">l</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">start'</span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">start</span> <span class="main">≤</span> <span class="skolem">start'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> shift_arith_prog<span class="main">:</span>
          <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">start'</span> <span class="main">-</span> <span class="skolem">start</span><span class="main">)</span> <span class="main">=</span> 
            arith_prog <span class="skolem">start'</span> <span class="skolem">step</span> <span class="skolem">i</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">diff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">diff</span> <span class="main">=</span> nat <span class="main">(</span><span class="skolem">start'</span><span class="main">-</span><span class="skolem">start</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">diff</span> <span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> diff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span>arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">diff</span><span class="main">)</span> <span class="main">=</span> digit <span class="skolem">j</span> <span class="skolem">diff</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col1</span> <span class="main">(</span>arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> col1_def prog that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> int <span class="skolem">n_kq</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> prog<span class="main">(</span>4<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> digit_col1<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="skolem">i</span>"</span></span> 
                <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">diff</span>"</span></span><span class="main">]</span> 
              prog 1 <span class="quoted"><span class="quoted">‹<span class="skolem">diff</span> <span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">q</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> diff_def 1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">start</span><span class="main">≤</span><span class="skolem">start'</span>›</span></span> shift_arith_prog<span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> one_step_more'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span>arith_prog <span class="skolem">start'</span> <span class="skolem">step</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span>
        <span class="skolem">col</span> <span class="main">(</span>arith_prog <span class="skolem">start'</span> <span class="skolem">step</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">start'</span><span class="main">∈</span><span class="main">{</span><span class="skolem">start</span><span class="main">..&lt;</span><span class="skolem">start</span><span class="main">+</span><span class="skolem">q</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">l</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">start'</span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">using</span></span> that one_step_more<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">start'</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 
          one_step_more<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">start'</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> start_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">start</span> <span class="main">+</span> int <span class="skolem">q</span> <span class="main">≤</span> <span class="skolem">start</span> <span class="main">+</span> int <span class="skolem">q</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">start</span><span class="main">..</span><span class="skolem">start</span> <span class="main">+</span> int <span class="skolem">q</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prog N_def 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def is_arith_prog_on_def<span class="main">)</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> col'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">start</span><span class="main">..</span><span class="skolem">start</span> <span class="main">+</span> int <span class="skolem">q</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 prog<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Obtain an $(m-1)$-fold arithmetic progression in the starting $q$-bolck of the 
             block arithmetic progression. ›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">start_m</span></span> <span class="skolem"><span class="skolem">steps_m</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        step_m_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">steps_m</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        is_multi_arith_prog<span class="main">:</span> <span class="quoted"><span class="quoted">"is_multi_arith_prog_on <span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> 
          <span class="skolem">start_m</span> <span class="skolem">steps_m</span> <span class="skolem">start</span> <span class="main">(</span><span class="skolem">start</span> <span class="main">+</span> int <span class="skolem">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        g_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">g</span> <span class="main">=</span> multi_arith_prog <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">start_m</span> <span class="skolem">steps_m</span>
          <span class="keyword1">in</span>  <span class="main">∀</span><span class="bound">c</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">&lt;</span><span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">s</span><span class="main">.</span> <span class="bound">c</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="skolem">col</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="bound">g</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="bound">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> vdw_lemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vdw_lemma_IH start_q col'<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">blast</span>
        
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> multi_arith_prog <span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="skolem">start_m</span> <span class="skolem">steps_m</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">≤</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="keyword1"><span class="command">using</span></span> g_aux that <span class="keyword1"><span class="command">unfolding</span></span> g_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> range_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">c</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">start</span><span class="main">..</span><span class="skolem">start</span> <span class="main">+</span> int <span class="skolem">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span>
        <span class="keyword1"><span class="command">using</span></span> is_multi_arith_prog_onD<span class="main">[</span><span class="operator">OF</span> is_multi_arith_prog that<span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Obtain an $m$-fold arithmetic progression by adding the block-step.›</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">steps</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> steps_def<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">steps</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span>  <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">step</span> <span class="keyword1">else</span> <span class="skolem">steps_m</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> multi_arith_prog <span class="skolem">m</span> <span class="skolem">start_m</span> <span class="skolem">steps</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> f_step_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">c</span> <span class="main">=</span> int <span class="main">(</span><span class="skolem">c</span> <span class="main">0</span><span class="main">*</span><span class="skolem">step</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">start_m</span> <span class="main">+</span> int <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">steps</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f_def <span class="keyword1"><span class="command">unfolding</span></span> multi_arith_prog_def 
          <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">start_m</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">c</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">steps</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> 
                       int <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">steps</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sum.lessThan_Suc_shift<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">start_m</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">c</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">step</span><span class="main">)</span> <span class="main">+</span> 
                       int <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">steps_m</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> steps_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> multi_arith_prog_def g_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Show that this $m$-fold arithmetic progression fulfills all needed properties. ›</span></span>
      <span class="keyword1"><span class="command">have</span></span> steps_gr_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">steps</span> <span class="bound">i</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> steps_def <span class="keyword1"><span class="command">using</span></span> step_m_pos prog <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> is_multi_on_f<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"is_multi_arith_prog_on <span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">m</span> <span class="skolem">start_m</span> <span class="skolem">steps</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">start_m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_multi_arith_prog 
          <span class="keyword1"><span class="command">unfolding</span></span> is_multi_arith_prog_on_def
          <span class="keyword1"><span class="command">using</span></span> is_arith_prog_on_def prog<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> arith_prog <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">l</span><span class="main">)</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span> <span class="skolem">step</span> <span class="free">l</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> f_step_g <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">l</span><span class="main">)</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">≤</span> <span class="skolem">start</span> <span class="main">+</span> <span class="skolem">q</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> range_g<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">l</span><span class="main">)</span> <span class="main">∘</span> Suc"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">l</span><span class="main">)</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span> <span class="skolem">step</span> <span class="free">l</span> <span class="main">≤</span> 
            arith_prog <span class="skolem">start</span> <span class="skolem">step</span> <span class="free">l</span> <span class="main">+</span> <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prog_in_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> is_multi_arith_prog <span class="keyword1"><span class="command">unfolding</span></span> is_multi_arith_prog_on_def
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span><span class="main">(</span>1<span class="main">)</span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">l</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">}</span></span>
         <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
           <span class="keyword1"><span class="command">unfolding</span></span> is_multi_arith_prog_on_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Show the relational property for all $s$. ›</span></span>
      <span class="keyword1"><span class="command">have</span></span> rel_prop_1<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&lt;</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">s</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">s</span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>3<span class="main">)</span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> range_c_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∘</span> Suc <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">c</span> <span class="main">=</span> arith_prog <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span> <span class="skolem">step</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> f_step_g <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span>arith_prog <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span> <span class="skolem">step</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> one_step_more'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span>›</span></span>
            range_g<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∘</span> Suc"</span></span><span class="main">]</span> range_c_Suc 
            atLeastLessThanSuc_atLeastAtMost <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span><span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> int <span class="main">(</span><span class="skolem">c</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> int <span class="main">(</span><span class="skolem">steps_m</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                   <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">.</span> int<span class="main">(</span><span class="skolem">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
              <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> steps_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span> 
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> int <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> 
            int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_cong_left<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span> <span class="skolem">step</span> <span class="main">0</span> <span class="main">=</span> 
            <span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def multi_arith_prog_def arith_prog_def
            <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> s_greater_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> range_c_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∘</span> Suc <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> g_IH<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">c'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">s'</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c'</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">s'</span><span class="main">.</span> <span class="skolem">c'</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> 
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c'</span> <span class="skolem">s'</span> 
          <span class="keyword1"><span class="command">using</span></span> g_aux that <span class="keyword1"><span class="command">unfolding</span></span> multi_arith_prog_def g_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> g_shift_IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="skolem">col</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">t</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> Suc"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>fun_eq_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> right<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">t</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> 
             <span class="skolem">g</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∘</span> Suc<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">-</span><span class="main">1</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">t</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            <span class="skolem">col</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">t</span><span class="main">-</span><span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> g_IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> right <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span>int <span class="main">(</span><span class="skolem">c</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">step</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> f_step_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="skolem">c</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">step</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">=</span> 
          arith_prog <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span> <span class="skolem">step</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arith_prog_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">…</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span>arith_prog <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span> <span class="skolem">step</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> one_step_more'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span>›</span></span> 
            range_g<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∘</span> Suc"</span></span><span class="main">]</span> range_c_Suc 
            atLeastLessThanSuc_atLeastAtMost <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span>  <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">s</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∘</span>
          Suc<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g_shift_IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span>"</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> int <span class="main">(</span><span class="bound">c</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">step</span><span class="main">)</span> <span class="main">+</span> 
          <span class="skolem">g</span> <span class="main">(</span><span class="bound">c</span> <span class="main">∘</span> Suc<span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">≤</span><span class="skolem">s</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def multi_arith_prog_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> f_step_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">start_m</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">steps</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">use</span> steps_gr_0 is_multi_on_f rel_prop_1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> 
             <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> f_def Let_def steps_def›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Secondly, we show that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vdw_lemma›</span></span></span></span> implies the induction step of Van der Waerden's Theorem
using the pigeonhole principle. ›</span></span>
<span class="keyword1" id="Van_der_Waerden-vdw_lemma_imp_vdw"><span class="command">lemma</span></span> vdw_lemma_imp_vdw<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vdw_lemma <span class="free">k</span> <span class="free">k</span> <span class="free">l</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"vdw <span class="free">k</span> <span class="main">(</span>Suc <span class="free">l</span><span class="main">)</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vdw_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Idea: Proof uses pigeonhole principle to guarantee the existence of an arithmetic 
            progression of length $l+1$ with the same colour. ›</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">col</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">start</span></span> <span class="skolem"><span class="skolem">steps</span></span> <span class="keyword2"><span class="keyword">where</span></span> prog<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="skolem">steps</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"is_multi_arith_prog_on <span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="skolem">start</span> <span class="skolem">steps</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">f</span> <span class="main">=</span> multi_arith_prog <span class="free">k</span> <span class="skolem">start</span> <span class="skolem">steps</span>
     <span class="keyword1">in</span>  <span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≤</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">c</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">)</span> <span class="main">⟶</span>
            <span class="skolem">col</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="bound">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms 1 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> vdw_lemmaE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> col<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">col</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> 
          <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> l<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">N</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Obtain a $k$-fold arithmetic progression $f$ of length $l$ from assumptions. ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> multi_arith_prog <span class="free">k</span> <span class="skolem">start</span> <span class="skolem">steps</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> rel_propE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&lt;</span><span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≤</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">using</span></span> prog<span class="main">(</span>3<span class="main">)</span> that <span class="keyword1"><span class="command">unfolding</span></span> f_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹There are $k+1$ values $a_r = f(0,\dots,0,l,\dots,l)$ with $0\leq r\leq k$ zeros.›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a_r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a_r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">r</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> range_col_a_r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">a_r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a_r</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_r_def f_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> is_multi_arith_prog_onD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prog<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">col</span> <span class="main">∘</span> <span class="skolem">a_r</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="skolem">col</span> <span class="main">∘</span> <span class="skolem">a_r</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inj_on <span class="main">(</span><span class="skolem">col</span> <span class="main">∘</span> <span class="skolem">a_r</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pigeonhole<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">∘</span> <span class="skolem">a_r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Using the pigeonhole principle get $r_1$ and $r_2$ where $a_{r_1}$ and $a_{r_2}$ have the 
    same colour.›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="keyword2"><span class="keyword">where</span></span> pigeon_cols<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">&lt;</span> <span class="skolem">r2</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">col</span> <span class="main">∘</span> <span class="skolem">a_r</span><span class="main">)</span> <span class="skolem">r1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">col</span> <span class="main">∘</span> <span class="skolem">a_r</span><span class="main">)</span> <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> linear linorder_inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Show that the following function $h$ is an arithmetic progression which fulfills all
         properties for Van der Waerden's Theorem. ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">&lt;</span><span class="skolem">r1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">&lt;</span><span class="skolem">r2</span> <span class="keyword1">then</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">a_r</span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def a_r_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span><span class="main">&lt;</span><span class="skolem">r2</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="free">l</span> <span class="main">=</span> <span class="skolem">a_r</span> <span class="skolem">r1</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> h_def a_r_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span><span class="main">&lt;</span><span class="skolem">r2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_eq_less_or_eq less_le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">h</span> <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pigeon_cols<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> h_col<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">h</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="free">l</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">col</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">h</span> <span class="free">l</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">idx</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">idx</span> <span class="main">&lt;</span> <span class="skolem">r1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">idx</span> <span class="main">&lt;</span> <span class="skolem">r2</span> <span class="keyword1">then</span> <span class="skolem">i</span> <span class="keyword1">else</span> <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">l</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">r2</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="var">?c</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&lt;</span><span class="free">l</span>›</span></span> pigeon_cols<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">col</span> <span class="main">(</span><span class="skolem">f</span> <span class="var">?c</span><span class="main">)</span> <span class="main">=</span> 
      <span class="skolem">col</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">r2</span><span class="main">-</span><span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="var">?c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_propE<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> pigeon_cols <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def f_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> Nat.lessE One_nat_def add_diff_cancel_left' 
          le_less less_Suc_eq_le multi_arith_prog_mono plus_1_eq_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h_start</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h_start</span> <span class="main">=</span> <span class="skolem">start</span> <span class="main">+</span> <span class="free">l</span><span class="main">*</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="skolem">r2</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> <span class="skolem">steps</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h_step</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h_step</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="skolem">r1</span><span class="main">..&lt;</span><span class="skolem">r2</span><span class="main">}</span><span class="main">.</span> <span class="skolem">steps</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> h_arith_prog<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> arith_prog <span class="skolem">h_start</span> <span class="skolem">h_step</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> int <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r2</span> <span class="keyword1">then</span> <span class="skolem">y</span> <span class="keyword1">else</span> <span class="free">l</span><span class="main">)</span>
        <span class="main">*</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      int <span class="free">l</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="skolem">r2</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> 
        int <span class="skolem">y</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="skolem">r1</span><span class="main">..&lt;</span><span class="skolem">r2</span><span class="main">.</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">=</span> <span class="free">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">&lt;</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pigeon_cols <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> int <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r2</span> <span class="keyword1">then</span> <span class="skolem">y</span> <span class="keyword1">else</span> <span class="free">l</span><span class="main">)</span>
           <span class="main">*</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> int <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span><span class="skolem">r1</span><span class="main">.</span> int <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span>
          int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="skolem">r1</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> int <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">y</span><span class="main">)</span>
          <span class="main">*</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> split_sum_mid_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r1</span></span> <span class="quoted"><span class="free">k</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> int <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> 
            <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span><span class="main">&lt;</span><span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="skolem">r1</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> int <span class="skolem">y</span> <span class="main">*</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="skolem">y</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="skolem">r1</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="skolem">y</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">&lt;</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pigeon_cols <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">aux_left</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aux_left</span> <span class="main">=</span> 
        <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> int <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r2</span> <span class="keyword1">then</span> <span class="skolem">y</span> <span class="keyword1">else</span> <span class="free">l</span><span class="main">)</span>
          <span class="main">*</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="skolem">aux_left</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="skolem">r1</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> <span class="skolem">aux_left</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> aux_left_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">r1</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">r1</span><span class="main">..&lt;</span><span class="skolem">r2</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">r2</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span> <span class="main">&lt;</span> <span class="skolem">r2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">&lt;</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="skolem">aux_left</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="skolem">r1</span><span class="main">..&lt;</span><span class="skolem">r2</span><span class="main">.</span> <span class="skolem">aux_left</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> 
        <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="skolem">r2</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> <span class="skolem">aux_left</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="skolem">r1</span><span class="main">..&lt;</span><span class="skolem">r2</span><span class="main">.</span> <span class="skolem">aux_left</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="skolem">r1</span><span class="main">..&lt;</span><span class="skolem">r2</span><span class="main">.</span> int <span class="skolem">y</span> <span class="main">*</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> aux_left_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="skolem">r2</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> <span class="skolem">aux_left</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="skolem">r2</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> int <span class="free">l</span> <span class="main">*</span> int <span class="main">(</span><span class="skolem">steps</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span> <span class="main">&lt;</span> <span class="skolem">r2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> aux_left_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_left_def sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> arith_prog_def h_start_def h_step_def h_def f_def
        multi_arith_prog_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> case_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 range_col_a_r <span class="quoted"><span class="quoted">‹<span class="skolem">col</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">col</span> <span class="main">(</span><span class="skolem">h</span> <span class="free">l</span><span class="main">)</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="free">l</span> <span class="main">=</span> <span class="skolem">a_r</span> <span class="skolem">r1</span>›</span></span> j_def pigeon_cols<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> case_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h_step</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_step_def
    <span class="keyword1"><span class="command">using</span></span> pigeon_cols <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_pos prog<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> range_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">l</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">unfolding</span></span> h_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_multi_arith_prog_onD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prog<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> case_on<span class="main">:</span> <span class="quoted"><span class="quoted">"is_arith_prog_on <span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">h_start</span> <span class="skolem">h_step</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_arith_prog_on_def h_arith_prog 
    <span class="keyword1"><span class="command">using</span></span> range_h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> range_h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Max_ge<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> Min_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> 
        h_arith_prog arith_prog_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> case_col<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> <span class="main">{..&lt;</span>Suc <span class="free">l</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">col</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> h_col range_h <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> case_j case_step case_on case_col 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_arith_prog<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Lastly, we assemble all lemmas to finally prove Van der Waerden's Theorem by induction on 
$l$. The cases $l=1$ and the induction start $l=2$ are treated separately and have been shown 
earlier.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> van_der_Waerden<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> vdw <span class="free">k</span> <span class="free">l</span> <span class="bound">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">consider</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">&gt;</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vdw_1_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vdw_2_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">≤</span><span class="skolem">l</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> less.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">&gt;</span><span class="numeral">2</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k'</span><span class="main">.</span> <span class="bound">k'</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> vdw <span class="bound">k'</span> <span class="main">(</span><span class="skolem">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> vdw_imp_vdw_lemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">-</span><span class="main">1</span><span class="main">≥</span><span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vdw_lemma <span class="skolem">k</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vdw <span class="skolem">k</span> <span class="skolem">l</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vdw_lemma_imp_vdw<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="skolem">N</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>