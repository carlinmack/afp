<div id="MoreGraph">
<div class="head">
<h1>Theory MoreGraph</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: MoreGraph.thy
Author:Wenda Li
*)</span>

<span class="keyword1"><span class="command">theory</span></span> MoreGraph <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a> <a href="../../dijkstra_shortest_path/theories/#Graph">Dijkstra_Shortest_Path.Graph</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Undirected Multigraph and undirected trails›</span></span>

<span class="keyword1"><span class="command">locale</span></span> valid_unMultigraph<span class="main">=</span>valid_graph <span class="quoted"><span class="free">G</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> graph"</span></span><span class="main">+</span>
              <span class="keyword2"><span class="keyword">assumes</span></span> corres<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">u'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">u'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span>   no_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∉</span> edges <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> <span class="entity">is_trail</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> path <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">is_trail</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">∈</span> V"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">is_trail</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">∈</span>E <span class="main">∧</span> 
                <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">∉</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span><span class="main">∉</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">∧</span> <span class="free">is_trail</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span>"</span></span>

<span class="comment1">(*This section mainly includes lemmas related to degrees of nodes, especially when edges and paths 
are removed from an undirected graph*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Degrees and related properties›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">degree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">degree</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">≡</span> card<span class="main">(</span><span class="main">{</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span>edges <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> fst <span class="bound">e</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">odd_nodes_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">odd_nodes_set</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>nodes <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> odd<span class="main">(</span>degree <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="comment1">(*return the number of nodes with an odd degree in the current valid multigraph*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">num_of_odd_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">num_of_odd_nodes</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">≡</span> card<span class="main">(</span> odd_nodes_set <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">num_of_even_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">num_of_even_nodes</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">≡</span> card<span class="main">(</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>nodes <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> even<span class="main">(</span>degree <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">del_unEdge</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">del_unEdge</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>
    nodes <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rev_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> path <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> path"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">rev_path</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rem_unPath</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> path <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">rem_unPath</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span>"</span></span><span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">rem_unPath</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">=</span> 
        <span class="free">rem_unPath</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">(</span>del_unEdge <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span> 
    
<span class="keyword1" id="MoreGraph-del_undirected"><span class="command">lemma</span></span> del_undirected<span class="main">:</span> <span class="quoted"><span class="quoted">"del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">g</span> <span class="main">=</span> delete_edge <span class="free">v'</span> <span class="free">e</span> <span class="free">v</span> <span class="main">(</span>delete_edge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def delete_edge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="MoreGraph-delete_edge_sym"><span class="command">lemma</span></span> delete_edge_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">g</span> <span class="main">=</span> del_unEdge <span class="free">v'</span> <span class="free">e</span> <span class="free">v</span> <span class="free">g</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="MoreGraph-del_unEdge_valid"><span class="command">lemma</span></span> del_unEdge_valid<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">g</span>"</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> valid_unMultigraph <span class="quoted"><span class="free">g</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E_validD<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

 
<span class="keyword1" id="MoreGraph-set_compre_diff"><span class="command">lemma</span></span> set_compre_diff<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span><span class="main">=</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">B</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="MoreGraph-set_compre_subset"><span class="command">lemma</span></span> set_compre_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1" id="MoreGraph-del_edge_undirected_degree_plus"><span class="command">lemma</span></span> del_edge_undirected_degree_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span> 
    <span class="main">⟹</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span>  <span class="main">⟹</span> degree <span class="free">v</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">=</span>degree <span class="free">v</span> <span class="free">g</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span> "</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">v</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>
          <span class="main">=</span> card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span>  edges <span class="free">g</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span>  edges <span class="free">g</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> 
      fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span><span class="main">)</span><span class="main">+</span><span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_compre_diff<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span>  edges <span class="free">g</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> card<span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> 
      fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span><span class="main">)</span><span class="main">+</span><span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> edges <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span>  edges <span class="free">g</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span> edges <span class="free">g</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> 
          fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span><span class="main">)</span><span class="main">=</span>card <span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span> edges <span class="free">g</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span> <span class="main">-</span> card <span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span>
          fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> card_Diff_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span>  edges <span class="free">g</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span> edges <span class="free">g</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Collect_empty_eq assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          card_eq_0_iff fst_conv mem_Collect_eq rev_finite_subset subsetI<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">v</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">=</span>card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">ea</span></span> <span class="main">∈</span>  edges <span class="free">g</span><span class="main">.</span> fst <span class="bound">ea</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="MoreGraph-del_edge_undirected_degree_plus'"><span class="command">lemma</span></span> del_edge_undirected_degree_plus'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span> 
    <span class="main">⟹</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span> <span class="main">⟹</span> degree <span class="free">v'</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">=</span>degree <span class="free">v'</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_edge_undirected_degree_plus delete_edge_sym<span class="main">)</span> 

<span class="keyword1" id="MoreGraph-del_edge_undirected_degree_minus"><span class="command">lemma</span></span> del_edge_undirected_degree_minus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span> 
    <span class="main">⟹</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span> <span class="main">⟹</span> degree <span class="free">v</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span>degree <span class="free">v</span> <span class="free">g</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> del_edge_undirected_degree_plus <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left' add.commute<span class="main">)</span>

<span class="keyword1" id="MoreGraph-del_edge_undirected_degree_minus'"><span class="command">lemma</span></span> del_edge_undirected_degree_minus'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span> 
    <span class="main">⟹</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">g</span> <span class="main">⟹</span> degree <span class="free">v'</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span>degree <span class="free">v'</span> <span class="free">g</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_edge_undirected_degree_minus delete_edge_sym<span class="main">)</span> 


<span class="keyword1" id="MoreGraph-del_unEdge_com"><span class="command">lemma</span></span> del_unEdge_com<span class="main">:</span> <span class="quoted"><span class="quoted">"del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="main">(</span>del_unEdge <span class="free">n</span> <span class="free">e</span> <span class="free">n'</span> <span class="free">g</span><span class="main">)</span>
          <span class="main">=</span> del_unEdge <span class="free">n</span> <span class="free">e</span> <span class="free">n'</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">g</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="MoreGraph-rem_unPath_com"><span class="command">lemma</span></span> rem_unPath_com<span class="main">:</span> <span class="quoted"><span class="quoted">"rem_unPath <span class="free">ps</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">g</span><span class="main">)</span> 
            <span class="main">=</span> del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">g</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ps'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> del_unEdge_com 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3 rem_unPath.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="MoreGraph-rem_unPath_valid"><span class="command">lemma</span></span> rem_unPath_valid<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">g</span> <span class="main">⟹</span> valid_unMultigraph <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> valid_unMultigraph 
         <span class="main">(</span>del_unEdge <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rem_unPath_com <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.collapse rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>valid_unMultigraph <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">g</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps Cons.prems del_unEdge_valid<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>True"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?case</span><span class="main">=</span>True"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> degree_frame<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span> <span class="free">v'</span><span class="main">}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">x</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">x</span> <span class="free">G</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span>card<span class="main">(</span><span class="main">{</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span>edges <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> fst <span class="bound">e</span><span class="main">=</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>del_unEdge_def degree_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>card<span class="main">(</span><span class="main">{</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span>edges <span class="free">G</span> <span class="main">∧</span> fst <span class="bound">e</span><span class="main">=</span><span class="free">x</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> fst <span class="bound">e</span><span class="main">=</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  set_compre_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>card<span class="main">(</span><span class="main">{</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span>edges <span class="free">G</span> <span class="main">∧</span> fst <span class="bound">e</span><span class="main">=</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∉</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span> <span class="free">v'</span><span class="main">}</span>›</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">v</span> <span class="main">∧</span> <span class="free">x</span><span class="main">≠</span> <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>›</span></span><span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> fst <span class="bound">e</span><span class="main">=</span><span class="free">x</span><span class="main">}</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>degree_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">∉</span>E"</span></span> <span class="keyword1"><span class="command">using</span></span> corres <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"E<span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">=</span>E"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">=</span><span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>del_unEdge_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rev_path <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rev_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="MoreGraph-rev_path_append"><span class="command">lemma</span></span> rev_path_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rev_path <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rev_path <span class="free">ys</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>rev_path <span class="free">xs</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> rev_path_def rev_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="MoreGraph-rev_path_double"><span class="command">lemma</span></span> rev_path_double<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rev_path<span class="main">(</span>rev_path <span class="free">xs</span><span class="main">)</span><span class="main">=</span><span class="free">xs</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> rev_path_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="MoreGraph-del_UnEdge_node"><span class="command">lemma</span></span> del_UnEdge_node<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="free">u</span> <span class="free">e</span> <span class="free">u'</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">v</span><span class="main">∈</span>nodes <span class="free">G</span>  "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_unEdge_def select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>edges <span class="main">(</span>del_unEdge <span class="free">u</span> <span class="free">e</span> <span class="free">u'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_unEdge_def finite_Diff select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>nodes <span class="main">(</span>del_unEdge <span class="free">u</span> <span class="free">e</span> <span class="free">u'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_unEdge_def select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
 
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>edges <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">G</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> finite <span class="main">(</span>edges <span class="main">(</span>del_unEdge 
          <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com surjective_pairing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>finite <span class="main">(</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> del_unEdge_def  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  finite.emptyI finite_Diff2 finite_Diff_insert select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>True"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?case</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="MoreGraph-del_UnEdge_frame"><span class="command">lemma</span></span> del_UnEdge_frame<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>edges <span class="free">g</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">⟹</span><span class="free">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>odd_nodes_set <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq odd_nodes_set_def rev_finite_subset subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>del_unEdge <span class="free">u</span> <span class="free">e</span> <span class="free">u'</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>nodes <span class="free">G</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_unEdge_def select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>nodes <span class="main">(</span>del_unEdge 
        <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com surjective_pairing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>nodes <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="MoreGraph-in_set_rev_path"><span class="command">lemma</span></span> in_set_rev_path<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span> <span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span> "</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rev_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>set <span class="main">(</span><span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> rev_path_def 
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">=</span> set <span class="skolem">xs</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.set_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> insert_is_Un sup_commute x<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="MoreGraph-rem_unPath_edges"><span class="command">lemma</span></span> rem_unPath_edges<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"edges<span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span>set <span class="free">ps</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rev_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"edges<span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span> edges<span class="main">(</span>del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>edges<span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">-</span><span class="main">{</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_unEdge_def select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span>set <span class="skolem">xs</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">{</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">}</span><span class="main">=</span>set <span class="main">(</span><span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.set_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> empty_set set_append<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rev_path_def <span class="keyword1"><span class="command">using</span></span>  x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">}</span><span class="main">=</span>set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">}</span><span class="main">=</span>set <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.set_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> insert_is_Un sup_commute x<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span>set <span class="skolem">xs</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">{</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                      edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>set <span class="skolem">xs</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="MoreGraph-rem_unPath_graph"><span class="command">lemma</span></span> rem_unPath_graph <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
    <span class="quoted"><span class="quoted">"rem_unPath <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="free">G</span><span class="main">=</span>rem_unPath <span class="free">ps</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes<span class="main">(</span>rem_unPath <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>nodes<span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges<span class="main">(</span>rem_unPath <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>edges<span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="free">ps</span> <span class="main">∪</span>  set <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> "</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath_edges<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="MoreGraph-distinct_rev_path"><span class="command">lemma</span></span> distinct_rev_path<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="main">⟷</span>distinct <span class="free">ps</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>distinct <span class="main">(</span><span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> rev_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span> <span class="main">(</span>distinct <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∉</span>set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> distinct1_rotate rotate1.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>distinct <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> in_set_rev_path x<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>distinct <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> is_path_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path <span class="free">v'</span> <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="free">v</span> <span class="main">⟷</span> is_path <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_path <span class="free">v'</span> <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">v</span><span class="main">=</span>is_path <span class="free">v'</span> <span class="main">(</span><span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">v</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> rev_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span>is_path <span class="free">v'</span> <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">x3</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∈</span>E <span class="main">∧</span> is_path <span class="skolem">x1</span> <span class="main">[]</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span>is_path <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∈</span>E <span class="main">∧</span> is_path <span class="skolem">x1</span> <span class="main">[]</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>is_path <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">v'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> corres is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_path_memb x<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path <span class="free">v'</span> <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">v</span><span class="main">=</span>is_path <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> singleton_distinct_path <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>E <span class="main">⟹</span> is_trail <span class="free">v</span> <span class="main">[</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">]</span> <span class="free">v'</span>"</span></span> 
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> all_not_in_conv is_trail.simps set_empty<span class="main">)</span> 
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> is_trail_path<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span> <span class="main">⟷</span> is_path <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span> <span class="main">∧</span> distinct <span class="free">ps</span> <span class="main">∧</span> <span class="main">(</span>set <span class="free">ps</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">v'</span><span class="main">=</span> <span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="skolem">x1</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>E <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span> <span class="main">∧</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span> <span class="main">∧</span> is_trail <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="skolem">x1</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>E <span class="main">∧</span>  <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span> <span class="main">∧</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span> <span class="main">∧</span> is_path <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span> 
                  <span class="main">∧</span> distinct <span class="skolem">xs</span> <span class="main">∧</span> <span class="main">(</span>set <span class="skolem">xs</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span>is_path <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">v'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span> 
                  <span class="main">∧</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span> <span class="main">∧</span> distinct <span class="skolem">xs</span> <span class="main">∧</span> <span class="main">(</span>set <span class="skolem">xs</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_path_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_path_split' no_id x<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span>is_path <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">v'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span> 
                  <span class="main">∧</span> distinct <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>set <span class="skolem">xs</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span>is_path <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">v'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span> <span class="main">∧</span> distinct <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> 
                  <span class="main">∧</span> <span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span> <span class="main">∧</span> set <span class="skolem">xs</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span><span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span>is_path <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">v'</span><span class="main">∧</span> distinct <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∉</span> set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_set_rev_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>set <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> rev_path_def <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span> 
                        <span class="main">⟷</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∉</span> set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Int_iff Int_insert_left_if0 List.set_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> empty_iff insertI1 x<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">v'</span><span class="main">⟷</span><span class="main">(</span>is_path <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">v'</span><span class="main">∧</span> distinct <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> 
                  <span class="main">∧</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>      
 
<span class="keyword1"><span class="command">lemma</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> is_trail_rev<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"is_trail <span class="free">v'</span> <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="free">v</span> <span class="main">⟷</span> is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> rev_path_append is_trail_path  is_path_rev distinct_rev_path
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute distinct_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> is_trail_intro<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_trail <span class="free">v'</span> <span class="free">ps</span> <span class="free">v</span> <span class="main">⟹</span> is_path <span class="free">v'</span> <span class="free">ps</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v'</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>   

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> is_trail_split<span class="main">:</span>
      <span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="main">(</span><span class="free">p1</span><span class="main">@</span><span class="free">p2</span><span class="main">)</span> <span class="free">v'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> is_trail <span class="free">v</span> <span class="free">p1</span> <span class="bound">u</span> <span class="main">∧</span> is_trail <span class="bound">u</span> <span class="free">p2</span> <span class="free">v'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> is_trail_intro is_path_memb<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> is_trail_split'<span class="main">:</span><span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="main">(</span><span class="free">p1</span><span class="main">@</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">u'</span><span class="main">)</span><span class="main">#</span><span class="free">p2</span><span class="main">)</span> <span class="free">v'</span> 
    <span class="main">⟹</span> is_trail <span class="free">v</span> <span class="free">p1</span> <span class="free">u</span> <span class="main">∧</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">u'</span><span class="main">)</span><span class="main">∈</span>E <span class="main">∧</span> is_trail <span class="free">u'</span> <span class="free">p2</span> <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_trail_split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> distinct_elim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="main">(</span><span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps</span><span class="main">)</span> <span class="free">v'</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∈</span>edges<span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∈</span>E"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v2</span><span class="main">)</span> <span class="main">∈</span> E"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v2</span><span class="main">)</span> <span class="main">∈</span> E"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∉</span>set <span class="free">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">∉</span>set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∉</span>set <span class="free">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∉</span>set <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∉</span>set <span class="free">ps</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span>set <span class="free">ps</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v1</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v2</span><span class="main">)</span> <span class="main">∈</span> E›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∈</span>edges<span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath_edges<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="MoreGraph-distinct_path_subset"><span class="command">lemma</span></span> distinct_path_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">G1</span>"</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">G2</span>"</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G1</span> <span class="main">⊆</span>edges <span class="free">G2</span>"</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">G1</span> <span class="main">⊆</span>nodes <span class="free">G2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> distinct_G1<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="free">G1</span> <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="free">G2</span> <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_G1
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="free">v'</span><span class="main">∧</span><span class="free">v'</span><span class="main">∈</span>nodes <span class="free">G1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="free">v'</span><span class="main">∧</span><span class="free">v'</span><span class="main">∈</span>nodes <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="free">G1</span> <span class="main">⊆</span> nodes <span class="free">G2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="free">G1</span> <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="free">G2</span> <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>edges <span class="free">G1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>edges <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹edges <span class="free">G1</span> <span class="main">⊆</span> edges <span class="free">G2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="skolem">x1</span><span class="main">∧</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span><span class="main">∧</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> distinct_path_intro'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="main">(</span>rem_unPath <span class="free">p</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_trail  <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> valid<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>rem_unPath <span class="free">p</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rem_unPath_valid<span class="main">[</span><span class="operator">OF</span> valid_unMultigraph_axioms<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>rem_unPath <span class="free">p</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>rem_unPath <span class="free">p</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> E"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> rem_unPath_edges <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> distinct_path_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rem_unPath <span class="free">p</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> valid_unMultigraph_axioms assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> distinct_path_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="main">(</span>del_unEdge <span class="free">x1</span> <span class="free">x2</span> <span class="free">x3</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_trail  <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms distinct_path_intro' rem_unPath.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
    rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> distinct_elim_rev<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="main">(</span><span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps</span><span class="main">)</span> <span class="free">v'</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">∈</span>edges<span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">∈</span>E"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">∈</span>edges<span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">⟷</span><span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∈</span>edges<span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_unMultigraph.corres<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">∈</span>E<span class="main">⟷</span><span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∈</span>E"</span></span> <span class="keyword1"><span class="command">using</span></span> corres <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> distinct_elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> del_UnEdge_even<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> E"</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span> even <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">v</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">=</span>degree <span class="free">v</span> <span class="free">G</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> del_edge_undirected_degree_plus corres <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> even <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> E_validD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> del_UnEdge_node<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> del_UnEdge_even'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> E"</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∈</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span> even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms corres del_UnEdge_even delete_edge_sym<span class="main">)</span>          
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="MoreGraph-del_UnEdge_even_even"><span class="command">lemma</span></span> del_UnEdge_even_even<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> parity_assms<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span>valid_unMultigraph <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G.del_UnEdge_even assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> parity_assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∈</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G.del_UnEdge_even' assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> parity_assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> extra_odd_nodes<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⊆</span> odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span>odd_nodes_set <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∉</span>odd_nodes_set <span class="free">G</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> parity_assms <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">hence</span></span> vv'_odd_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">∩</span> odd_nodes_set <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span><span class="main">⊆</span>odd_nodes_set <span class="free">G</span> "</span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x_odd_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span> <span class="free">v'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">x</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> degree <span class="skolem">x</span> <span class="free">G</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff G.degree_frame assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_odd_set
        <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_odd_set <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="free">G</span> <span class="main">⊆</span> odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x_odd_set<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span> odd<span class="main">(</span>degree <span class="skolem">x</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> G.degree_frame assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mem_Collect_eq odd_nodes_set_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main">∈</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> x_odd_set del_UnEdge_node <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main">∈</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> extra_odd_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>odd_nodes_set <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> num_of_odd_nodes <span class="free">G</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>odd_nodes_set <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G.no_id <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card<span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" odd_nodes_set <span class="free">G</span> <span class="main">∩</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> vv'_odd_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>odd_nodes_set <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mem_Collect_eq odd_nodes_set_def rev_finite_subset subsetI<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def <span class="keyword1"><span class="command">using</span></span> card_Un_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="MoreGraph-del_UnEdge_even_odd"><span class="command">lemma</span></span> del_UnEdge_even_odd<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> parity_assms<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G <span class="main">:</span> valid_unMultigraph <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> odd_v<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G.del_UnEdge_even assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> parity_assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span>  not_odd_v'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∉</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G.del_UnEdge_even' assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> parity_assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span> <span class="main">⊆</span>odd_nodes_set <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
      <span class="keyword3"><span class="command">assume</span></span> x_prems<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">v'</span> <span class="main">⟹</span><span class="skolem">x</span><span class="main">∈</span>odd_nodes_set <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> parity_assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> G.E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Un_def assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mem_Collect_eq odd_nodes_set_def <span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">v</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main">∈</span>odd_nodes_set <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insertI1 insert_is_Un sup_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> x_prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def
        <span class="keyword1"><span class="command">using</span></span> G.degree_frame <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main">∈</span>odd_nodes_set <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">v</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnI1 odd_v<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">v'</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span>  <span class="skolem">x</span><span class="main">∈</span>odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def
        <span class="keyword1"><span class="command">using</span></span> G.degree_frame <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span> <span class="main">=</span> odd_nodes_set <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" odd_nodes_set <span class="free">G</span> <span class="main">∩</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> parity_assms <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span><span class="main">=</span><span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_insert_left_if0 inf_bot_left inf_commute not_odd_v'<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>odd_nodes_set <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card<span class="main">(</span>odd_nodes_set <span class="free">G</span><span class="main">)</span> <span class="main">+</span> card <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="main">=</span> 
                   card<span class="main">(</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> card <span class="main">{</span><span class="free">v'</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> card_Un_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">v'</span><span class="main">}</span>"</span></span><span class="main">]</span> 
      card_Un_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1" id="MoreGraph-del_UnEdge_odd_even"><span class="command">lemma</span></span> del_UnEdge_odd_even<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> parity_assms<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span>"</span></span>  
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms del_UnEdge_even_odd delete_edge_sym parity_assms valid_unMultigraph.corres<span class="main">)</span>
 
<span class="keyword1" id="MoreGraph-del_UnEdge_odd_odd"><span class="command">lemma</span></span> del_UnEdge_odd_odd<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> parity_assms<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span><span class="main">=</span>num_of_odd_nodes<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">+</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span>valid_unMultigraph <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∉</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G.del_UnEdge_even assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> parity_assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∉</span>odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G.del_UnEdge_even' assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> parity_assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> vv'_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">∩</span> odd_nodes_set<span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Int_insert_left_if0 inf_bot_left<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> extra_odd_nodes<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⊆</span> odd_nodes_set<span class="main">(</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> G.E_validD empty_subsetI insert_subset mem_Collect_eq parity_assms<span class="main">)</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="free">G</span> <span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span><span class="main">⊆</span>odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> "</span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x_odd_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span> <span class="free">v'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">x</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">x</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff G.degree_frame assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_odd_set 
        <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> x_odd_set <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> odd_nodes_set <span class="free">G</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x_odd_set<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span> odd<span class="main">(</span>degree <span class="skolem">x</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms G.degree_frame <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main">∈</span>odd_nodes_set <span class="free">G</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> x_odd_set del_UnEdge_node <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main">∈</span>odd_nodes_set <span class="free">G</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> extra_odd_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> odd_nodes_set <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="free">G</span><span class="main">=</span>odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="free">G</span><span class="main">=</span>odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> vv'_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>odd_nodes_set <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms del_UnEdge_node finite_subset <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card<span class="main">(</span>odd_nodes_set <span class="free">G</span><span class="main">)</span>
                       <span class="main">=</span> card<span class="main">(</span>odd_nodes_set  <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> card<span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def 
        <span class="keyword1"><span class="command">using</span></span> card_Un_disjoint 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G.no_id <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card<span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> rem_UnPath_parity_v'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>  <span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">≠</span><span class="free">v'</span> <span class="main">⟷</span> <span class="main">(</span>odd <span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> even<span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rem_unPath.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword1"><span class="command">print_cases</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> rem_x<span class="main">:</span><span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> odd<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>del_unEdge
            <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span><span class="main">=</span><span class="free">v'</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="free">v'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span><span class="main">=</span><span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> True is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x3</span><span class="main">=</span><span class="free">v'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> no_id x<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span><span class="main">=</span><span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>odd<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>
            del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rem_x <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>odd<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_Diff rem_unPath_edges<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span> <span class="main">∈</span>edges<span class="main">(</span> rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> distinct_elim is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span> <span class="main">∈</span>edges<span class="main">(</span> rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> corres distinct_elim_rev is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x3</span> <span class="main">=</span> <span class="free">v'</span>›</span></span> del_edge_undirected_degree_minus delete_edge_sym  x<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>even<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>E"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> corres distinct_elim_rev x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">v'</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x3</span><span class="main">=</span><span class="free">v'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> fst_conv mem_Collect_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">v'</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite E›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x3</span> <span class="main">=</span> <span class="free">v'</span>›</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Cons.hyps Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span><span class="main">⟹</span><span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="free">v'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>odd<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>
            del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rem_x <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>odd<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_Diff rem_unPath_edges<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span> <span class="main">∈</span>edges<span class="main">(</span> rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> distinct_elim is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span> <span class="main">∈</span>edges<span class="main">(</span> rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> corres distinct_elim_rev is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> True x
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> del_edge_undirected_degree_minus is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>even<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>E"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> distinct_elim x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">v'</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">=</span><span class="free">v'</span>›</span></span> x  Cons
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> fst_conv is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span> 
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">v'</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite E›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">≠</span>even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x3</span> <span class="main">≠</span> <span class="free">v'</span>›</span></span> assms 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">≠</span>even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>odd<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>
            del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rem_x <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>odd<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="skolem">x1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∉</span><span class="main">{</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">x3</span> <span class="main">≠</span> <span class="free">v'</span>›</span></span> empty_iff insert_iff<span class="main">)</span> 
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_Diff rem_unPath_edges<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">v'</span> <span class="main">(</span>del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">=</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_frame 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_unMultigraph.degree_frame<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms x <span class="quoted"><span class="quoted">‹<span class="skolem">x3</span> <span class="main">≠</span> <span class="free">v'</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> rem_UnPath_parity_v<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>  <span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">≠</span><span class="free">v'</span> <span class="main">⟷</span> <span class="main">(</span>odd <span class="main">(</span>degree <span class="free">v</span> <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> even<span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_trail_rev rem_UnPath_parity_v' rem_unPath_graph<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> rem_UnPath_parity_others<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>  <span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" even <span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> even<span class="main">(</span>degree <span class="free">n</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> even <span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>
          del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span><span class="skolem">x3</span> <span class="main">⟹</span><span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span><span class="skolem">x3</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> even <span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>
          del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com x<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>even<span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_Diff rem_unPath_edges<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span> <span class="main">∈</span>edges<span class="main">(</span> rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> distinct_elim is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span> <span class="main">∈</span>edges<span class="main">(</span> rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> corres distinct_elim_rev is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="skolem">x3</span>›</span></span> del_edge_undirected_degree_minus' 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>odd<span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>E"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> corres distinct_elim_rev x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span><span class="main">=</span><span class="skolem">x3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> fst_conv mem_Collect_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite E›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">n</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>even<span class="main">(</span>degree <span class="free">n</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="skolem">x3</span>›</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> insert_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Cons assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v x<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span><span class="main">=</span><span class="skolem">x3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>even<span class="main">(</span>degree <span class="free">n</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≠</span><span class="skolem">x3</span> <span class="main">⟹</span><span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≠</span><span class="skolem">x3</span>"</span></span>
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> even <span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>
          del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com x<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>even<span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="skolem">x1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">∉</span><span class="main">{</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">≠</span> <span class="skolem">x3</span>›</span></span> insertE insertI1 singletonE<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_Diff rem_unPath_edges<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">n</span> <span class="main">(</span>del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">=</span>degree <span class="free">n</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_frame 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_unMultigraph.degree_frame<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>even<span class="main">(</span>degree <span class="free">n</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons assms <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">≠</span> <span class="skolem">x3</span>›</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">n</span> <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>even<span class="main">(</span>degree <span class="free">n</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> rem_UnPath_even<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> parity_assms<span class="main">:</span>  <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> num_of_odd_nodes <span class="free">G</span> 
          <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span><span class="main">∧</span> <span class="free">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> fin_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fin_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> valid_rem_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_axioms 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> x_in<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> distinct_elim is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">⟹</span> even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> parity_x1_x3<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span> num_of_odd_nodes 
         <span class="main">(</span>del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com x<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">+</span><span class="numeral">2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  parity_x1_x3  fin_nodes fin_edges valid_rem_xs x_in del_UnEdge_even_even 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">)</span><span class="main">+</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons.hyps<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x3</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_trail <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">v'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>›</span></span> x 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="numeral">2</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="main">⟷</span> odd <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> parity_x1_x3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v x<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> parity_x1_x3<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="skolem">x3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_rem_xs valid_unMultigraph.no_id x_in<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="free">v'</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons assms  
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>  parity_x1_x3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v' x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">∉</span><span class="main">{</span><span class="skolem">x3</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> parity_x1_x3<span class="main">(</span>1<span class="main">)</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_others x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x1</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="free">v'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>
                        num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>       
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
                    odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> parity_x1_x3<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span> num_of_odd_nodes 
         <span class="main">(</span>del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com x<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  parity_x1_x3  fin_nodes fin_edges valid_rem_xs x_in 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_UnEdge_even_odd<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  Cons.hyps Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span>  parity_assms x
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="numeral">2</span>"</span></span> 
         <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="main">⟷</span> odd <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> parity_x1_x3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v x<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> parity_x1_x3<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="skolem">x3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_rem_xs valid_unMultigraph.no_id x_in<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="free">v'</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons assms  
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>  parity_x1_x3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v' x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">∉</span><span class="main">{</span><span class="skolem">x3</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> parity_x1_x3<span class="main">(</span>1<span class="main">)</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_others x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x1</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="free">v'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>
                        num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>         
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
                    even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>             
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> parity_x1_x3<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span> num_of_odd_nodes 
         <span class="main">(</span>del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com x<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  parity_x1_x3  fin_nodes fin_edges valid_rem_xs x_in 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_UnEdge_odd_even<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  Cons.hyps Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> parity_assms x
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="main">⟷</span> odd <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> parity_x1_x3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v x<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> parity_x1_x3<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="skolem">x3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_rem_xs valid_unMultigraph.no_id x_in<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span> "</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">⟷</span> odd<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span>  
            <span class="keyword1"><span class="command">using</span></span> True parity_x1_x3<span class="main">(</span>1<span class="main">)</span> rem_UnPath_parity_others x Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parity_x1_x3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Nat.add_0_right is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>    
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>
                        num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>         
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
                    odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> parity_x1_x3<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span> num_of_odd_nodes 
         <span class="main">(</span>del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com x<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> del_UnEdge_odd_odd
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_implies_diff  fin_edges fin_nodes parity_x1_x3 valid_rem_xs x_in<span class="main">)</span>  
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons assms 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="main">⟷</span> odd <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> parity_x1_x3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v x<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> parity_x1_x3<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="skolem">x3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_rem_xs valid_unMultigraph.no_id x_in<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span> "</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">⟷</span> odd<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span>  
            <span class="keyword1"><span class="command">using</span></span> True Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> parity_x1_x3<span class="main">(</span>1<span class="main">)</span> rem_UnPath_parity_others x 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parity_x1_x3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Nat.add_0_right is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> add_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>    
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>
                        num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>       
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> rem_UnPath_odd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> parity_assms<span class="main">:</span>  <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> num_of_odd_nodes <span class="free">G</span> 
          <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> odd <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span><span class="main">∧</span> <span class="free">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> fin_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fin_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> valid_rem_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_axioms 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> x_in<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> distinct_elim is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">⟹</span> even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> parity_x1_x3<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span> num_of_odd_nodes 
         <span class="main">(</span>del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com x<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">+</span><span class="numeral">2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  parity_x1_x3  fin_nodes fin_edges valid_rem_xs x_in del_UnEdge_even_even 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">)</span><span class="main">+</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons.hyps<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x3</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_trail <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">v'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹odd <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>›</span></span> x
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="main">⟷</span> even <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> parity_x1_x3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v x<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> parity_x1_x3<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="skolem">x3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_rem_xs valid_unMultigraph.no_id x_in<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span> "</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">⟷</span> even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span>  
            <span class="keyword1"><span class="command">using</span></span> True Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> parity_x1_x3<span class="main">(</span>1<span class="main">)</span> 
                rem_UnPath_parity_others x
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parity_x1_x3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>  
                monoid_add_class.add.right_neutral x<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>    
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>
                        num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>       
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
                    odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> parity_x1_x3<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span> num_of_odd_nodes 
         <span class="main">(</span>del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com x<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  parity_x1_x3  fin_nodes fin_edges valid_rem_xs x_in 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_UnEdge_even_odd<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  Cons.hyps<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x3</span></span><span class="main">]</span> Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> 
          parity_assms x
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span>"</span></span> 
         <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="main">⟷</span> even <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> parity_x1_x3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v x<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> parity_x1_x3<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span> num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="skolem">x3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_rem_xs valid_unMultigraph.no_id x_in<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span> "</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">⟷</span> even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span>  
            <span class="keyword1"><span class="command">using</span></span> True Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> parity_x1_x3<span class="main">(</span>1<span class="main">)</span> 
                rem_UnPath_parity_others x
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parity_x1_x3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> x <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>   
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>
                        num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>         
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
                    even<span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>             
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> parity_x1_x3<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span> num_of_odd_nodes 
         <span class="main">(</span>del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com x<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  parity_x1_x3  fin_nodes fin_edges valid_rem_xs x_in 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_UnEdge_odd_even<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  Cons.hyps Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> parity_assms x
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="main">⟷</span> even <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> parity_x1_x3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parity_x1_x3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="skolem">x3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_rem_xs valid_unMultigraph.no_id x_in<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="free">v'</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons assms  
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>  parity_x1_x3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v' x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">∉</span><span class="main">{</span><span class="skolem">x3</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> parity_x1_x3<span class="main">(</span>1<span class="main">)</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_others x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x1</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="free">v'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>
                        num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>         
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
                    odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> parity_x1_x3<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x1</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span> num_of_odd_nodes 
         <span class="main">(</span>del_unEdge <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_unPath_com x<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> del_UnEdge_odd_odd
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_implies_diff  fin_edges fin_nodes parity_x1_x3 valid_rem_xs x_in<span class="main">)</span>  
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="main">⟷</span> even <span class="main">(</span>degree <span class="skolem">x3</span> <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> parity_x1_x3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parity_x1_x3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>  
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">xs</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span> 
                  num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> parity_assms x<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>odd <span class="main">(</span>degree <span class="skolem">x3</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x3</span> <span class="main">≠</span> <span class="free">v'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="skolem">x3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_rem_xs valid_unMultigraph.no_id x_in<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="free">v'</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons assms  
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>  parity_x1_x3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v' x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">∉</span><span class="main">{</span><span class="skolem">x3</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> parity_x1_x3<span class="main">(</span>1<span class="main">)</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span>  is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_others x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">x1</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x1</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="free">v'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>odd_nodes_set <span class="free">G</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> E_validD<span class="main">(</span>1<span class="main">)</span>  x <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∈</span>odd_nodes_set <span class="free">G</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span>  is_path_memb<span class="main">[</span><span class="operator">OF</span> is_trail_intro<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>  parity_assms
            <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span><span class="main">⊆</span>odd_nodes_set <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹odd <span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="free">v'</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card<span class="main">{</span><span class="skolem">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>odd_nodes_set <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span><span class="main">≥</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_mono num_of_odd_nodes_def<span class="main">)</span>  
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹odd <span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="free">v'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>
                        num_of_odd_nodes <span class="free">G</span><span class="main">+</span><span class="main">(</span><span class="keyword1">if</span> odd<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>       
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> rem_UnPath_cycle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> num_of_odd_nodes <span class="free">G</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> num_of_odd_nodes <span class="free">G</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span><span class="main">∧</span> <span class="free">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rem_UnPath_even<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> num_of_odd_nodes <span class="free">G</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> odd <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span><span class="main">∧</span> <span class="free">v</span><span class="main">≠</span><span class="free">v'</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rem_UnPath_odd<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">=</span> <span class="free">v'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Connectivity›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> <span class="entity">connected</span><span class="main">::</span><span class="quoted">bool</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">connected</span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> <span class="main">∀</span><span class="bound">v'</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">v</span><span class="main">≠</span><span class="bound">v'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> is_path <span class="bound">v</span> <span class="bound">ps</span> <span class="bound">v'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> <span class="quoted"><span class="quoted">"connected <span class="main">⟹</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> <span class="main">∀</span><span class="bound">v'</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">v</span><span class="main">≠</span><span class="bound">v'</span><span class="main">⟶</span><span class="main">(</span><span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> is_trail <span class="bound">v</span> <span class="bound">ps</span> <span class="bound">v'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">v'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="skolem">v'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted">connected</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path <span class="skolem">v</span> <span class="skolem">ps</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹connected›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> V›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">∈</span> V›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">≠</span><span class="skolem">v'</span>›</span></span>  connected_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">v</span> <span class="skolem">ps'</span> <span class="skolem">v'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">v</span></span> <span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps'</span><span class="main">.</span> is_trail <span class="skolem">x3</span> <span class="bound">ps'</span> <span class="skolem">v'</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps'</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">x3</span> <span class="skolem">ps'</span> <span class="skolem">v'</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">ps'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∉</span>set <span class="skolem">ps'</span> <span class="main">⟹</span>is_trail <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">ps'</span><span class="main">)</span> <span class="skolem">v'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">ps'</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ps1</span><span class="main">.</span> is_trail <span class="skolem">v</span> <span class="bound">ps1</span> <span class="skolem">v'</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">ps'</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span><span class="main">=</span><span class="skolem">ps1</span><span class="main">@</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">#</span><span class="skolem">ps2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> split_list<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">v</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">ps2</span><span class="main">)</span> <span class="skolem">v'</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_trail <span class="skolem">x3</span> <span class="skolem">ps'</span> <span class="skolem">v'</span>›</span></span> x
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                    is_trail_split is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">ps'</span> <span class="main">⟹</span>  <span class="main">∃</span><span class="bound">ps1</span><span class="main">.</span> is_trail <span class="skolem">v</span> <span class="bound">ps1</span> <span class="skolem">v'</span>"</span></span> 
             <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">ps'</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span><span class="main">=</span><span class="skolem">ps1</span><span class="main">@</span><span class="main">(</span><span class="skolem">x3</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x1</span><span class="main">)</span><span class="main">#</span><span class="skolem">ps2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> split_list<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">v</span> <span class="skolem">ps2</span> <span class="skolem">v'</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_trail <span class="skolem">x3</span> <span class="skolem">ps'</span> <span class="skolem">v'</span>›</span></span> x
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                    is_trail_split is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span> 
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> is_trail <span class="skolem">v</span> <span class="bound">ps</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> no_rep_length<span class="main">:</span> <span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span><span class="main">⟹</span>length <span class="free">ps</span><span class="main">=</span>card<span class="main">(</span>set <span class="free">ps</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> path_in_edges<span class="main">:</span><span class="quoted"><span class="quoted">"is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span> <span class="main">⟹</span> set <span class="free">ps</span> <span class="main">⊆</span> E"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" set <span class="skolem">xs</span> <span class="main">⊆</span> E"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>E"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail_intro is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> trail_bound<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="quoted"><span class="quoted">" is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ps</span> <span class="main">≤</span>card E"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> card_mono no_rep_length path_in_edges<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> <span class="entity">exist_path_length</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> nat <span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">exist_path_length</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">≡</span><span class="main">∃</span><span class="bound">v'</span> <span class="bound">ps</span><span class="main">.</span> is_trail <span class="bound">v'</span> <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> length <span class="bound">ps</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">l</span></span></span>"</span></span>   

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> longest_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> V"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">max_path</span><span class="main">.</span> is_trail <span class="bound">v</span> <span class="bound">max_path</span> <span class="free">n</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="main">∀</span><span class="bound">v'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">e</span><span class="main">∈</span>E<span class="main">.</span> <span class="main">¬</span>is_trail <span class="bound">v'</span> <span class="main">(</span><span class="bound">e</span><span class="main">#</span><span class="bound">max_path</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span>  contro<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">max_path</span><span class="main">.</span> is_trail <span class="bound">v</span> <span class="bound">max_path</span> <span class="free">n</span> 
           <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">e</span><span class="main">∈</span>E<span class="main">.</span> <span class="main">¬</span>is_trail <span class="bound">v'</span> <span class="main">(</span><span class="bound">e</span><span class="main">#</span><span class="bound">max_path</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span>  induct<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="bound">max_path</span><span class="main">.</span>  is_trail <span class="bound">v</span> <span class="bound">max_path</span> <span class="free">n</span> 
           <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">e</span><span class="main">∈</span>E<span class="main">.</span> is_trail <span class="bound">v'</span> <span class="main">(</span><span class="bound">e</span><span class="main">#</span><span class="bound">max_path</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="free">n</span> <span class="main">[]</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">∈</span> V›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"exist_path_length <span class="free">n</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> exist_path_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> exist_path_length <span class="free">n</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">≤</span> card E"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> trail_bound<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> exist_path_length_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> exist_path_length <span class="free">n</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">≤</span> card E"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exist_path_length <span class="free">n</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">x</span><span class="main">.</span> exist_path_length <span class="free">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GreatestI_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">max_path</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    max_path<span class="main">:</span><span class="quoted"><span class="quoted">"is_trail <span class="skolem">v</span> <span class="skolem">max_path</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">max_path</span><span class="main">=</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">x</span><span class="main">.</span> exist_path_length <span class="free">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> exist_path_length_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">v'</span> <span class="bound">e</span><span class="main">.</span> is_trail <span class="bound">v'</span> <span class="main">(</span><span class="bound">e</span><span class="main">#</span><span class="skolem">max_path</span><span class="main">)</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"exist_path_length <span class="free">n</span> <span class="main">(</span>length <span class="skolem">max_path</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def exist_path_length_def list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">max_path</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">x</span><span class="main">.</span> exist_path_length <span class="free">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Greatest_le_nat bound<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">max_path</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> length <span class="skolem">max_path</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> max_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="MoreGraph-even_card'"><span class="command">lemma</span></span> even_card'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>card <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">y</span><span class="main">≠</span><span class="free">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">y</span><span class="main">=</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_not_in_conv assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> insertI2 mk_disjoint_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹even<span class="main">(</span>card <span class="free">A</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="MoreGraph-odd_card"><span class="command">lemma</span></span> odd_card<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>card <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_not_in_conv assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> card.empty even_zero<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> extend_distinct_path<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>  <span class="quoted"><span class="quoted">"is_trail <span class="free">v'</span> <span class="free">ps</span> <span class="free">v</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> parity_assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">∧</span><span class="free">v'</span><span class="main">≠</span><span class="free">v</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span>odd <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">∧</span><span class="free">v'</span><span class="main">=</span><span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="bound">v1</span><span class="main">.</span> is_trail <span class="bound">v1</span> <span class="main">(</span><span class="bound">e</span><span class="main">#</span><span class="free">ps</span><span class="main">)</span> <span class="free">v</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">∧</span><span class="free">v'</span><span class="main">≠</span><span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> odd<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath  <span class="free">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>odd <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">∧</span><span class="free">v'</span><span class="main">=</span><span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> odd<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath  <span class="free">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rem_UnPath_parity_v'<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>rem_unPath  <span class="free">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> parity_assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>card <span class="main">{</span><span class="bound">e</span><span class="main">.</span> fst <span class="bound">e</span><span class="main">=</span><span class="free">v'</span> <span class="main">∧</span> <span class="bound">e</span><span class="main">∈</span>edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span>set <span class="free">ps</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span>  rem_unPath_edges <span class="keyword1"><span class="command">unfolding</span></span> degree_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Collect_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">e</span><span class="main">.</span> fst <span class="bound">e</span><span class="main">=</span><span class="free">v'</span> <span class="main">∧</span> <span class="bound">e</span><span class="main">∈</span>E <span class="main">-</span> <span class="main">(</span>set <span class="free">ps</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">≠</span><span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff finite.emptyI odd_card<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v0</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> v0w<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v0</span><span class="main">)</span><span class="main">∈</span>E"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v0</span><span class="main">)</span><span class="main">∉</span>set <span class="free">ps</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">v0</span> <span class="main">(</span><span class="main">(</span><span class="skolem">v0</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">#</span><span class="free">ps</span><span class="main">)</span> <span class="free">v</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Un_iff assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> corres in_set_rev_path is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹replace an edge (or its reverse in a path) by another path (in an undirected graph)›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">replace_by_UnPath</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> path <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">×</span><span class="tfree">'w</span> <span class="main">×</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> path <span class="main">⇒</span>  <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> path"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">replace_by_UnPath</span> <span class="main">[]</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">replace_by_UnPath</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">=</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">@</span><span class="free">replace_by_UnPath</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">=</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>rev_path <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">@</span><span class="free">replace_by_UnPath</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span>
     <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free">replace_by_UnPath</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> del_unEdge_connectivity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="bound">ps</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> valid_unMulti<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> valid_graph<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> valid_graph_axioms del_undirected <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> delete_edge_valid<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ex_path</span></span> <span class="keyword2"><span class="keyword">where</span></span> ex_path<span class="main">:</span><span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">ex_path</span> <span class="free">v'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph.connected_def<span class="main">[</span><span class="operator">OF</span> valid_unMulti<span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">n'</span> 
    <span class="keyword3"><span class="command">assume</span></span>  n <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span>  n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="skolem">n'</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps<span class="main">:</span><span class="quoted"><span class="quoted">"is_path <span class="skolem">n</span> <span class="skolem">ps</span> <span class="skolem">n'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≠</span><span class="skolem">n'</span>›</span></span> n n' <span class="quoted"><span class="quoted">‹connected›</span></span> connected_def del_UnEdge_node<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> 
           <span class="skolem">n</span> <span class="main">(</span>replace_by_UnPath <span class="skolem">ps</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="skolem">ex_path</span><span class="main">)</span> <span class="skolem">n'</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n' replace_by_UnPath.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_graph 
          valid_graph.is_path_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> 
                <span class="skolem">n</span> <span class="main">(</span>replace_by_UnPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="skolem">ex_path</span><span class="main">)</span> <span class="skolem">n'</span>
                <span class="main">=</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> 
                <span class="skolem">n</span> <span class="main">(</span><span class="skolem">ex_path</span><span class="main">@</span><span class="main">(</span>replace_by_UnPath <span class="skolem">xs</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="skolem">ex_path</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n'</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> replace_by_UnPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>True"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps Cons.prems <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span>›</span></span> ex_path is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_graph 
                  valid_graph.is_path_split<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> 
                <span class="skolem">n</span> <span class="main">(</span>replace_by_UnPath <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="skolem">ex_path</span><span class="main">)</span> <span class="skolem">n'</span>
                <span class="main">=</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> 
                <span class="skolem">n</span> <span class="main">(</span><span class="main">(</span>rev_path <span class="skolem">ex_path</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>replace_by_UnPath <span class="skolem">xs</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="skolem">ex_path</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n'</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> no_id replace_by_UnPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>True"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps Cons.prems <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span>›</span></span> is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ex_path valid_graph 
                  valid_graph.is_path_split valid_unMulti valid_unMultigraph.is_path_rev<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∧</span><span class="skolem">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">⟹</span><span class="var">?case</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps Cons.prems del_UnEdge_frame is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> replace_by_UnPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
              valid_graph valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n</span> <span class="bound">ps</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> path_between_odds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span><span class="main">=</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> is_trail <span class="free">v</span> <span class="bound">ps</span> <span class="free">v'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>V"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∉</span>V"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> E<span class="main">.</span> fst <span class="bound">e</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> E_valid<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> imageI subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">v</span> <span class="free">G</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite E›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹odd<span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∈</span>V"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∉</span>V"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> E<span class="main">.</span> fst <span class="bound">e</span> <span class="main">≠</span> <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> E_valid<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> imageI subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">v'</span> <span class="free">G</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite E›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹odd<span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">max_path</span></span> <span class="skolem"><span class="skolem">v0</span></span> <span class="keyword2"><span class="keyword">where</span></span> max_path<span class="main">:</span>
      <span class="quoted"><span class="quoted">"is_trail  <span class="skolem">v0</span> <span class="skolem">max_path</span> <span class="free">v'</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>E<span class="main">.</span> <span class="main">¬</span>is_trail <span class="bound">n</span> <span class="main">(</span><span class="bound">w</span><span class="main">#</span><span class="skolem">max_path</span><span class="main">)</span> <span class="free">v'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> longest_path<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">v0</span> <span class="free">G</span><span class="main">)</span><span class="main">⟹</span><span class="skolem">v0</span><span class="main">=</span><span class="free">v'</span> <span class="main">⟹</span> <span class="skolem">v0</span><span class="main">=</span><span class="free">v</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">v0</span> <span class="free">G</span><span class="main">)</span><span class="main">⟹</span><span class="skolem">v0</span><span class="main">≠</span><span class="free">v'</span> <span class="main">⟹</span> <span class="skolem">v0</span><span class="main">=</span><span class="free">v</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span><span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">v0</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span><span class="main">≠</span><span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">v1</span><span class="main">.</span> is_trail 
            <span class="bound">v1</span> <span class="main">(</span><span class="bound">w</span><span class="main">#</span><span class="skolem">max_path</span><span class="main">)</span> <span class="free">v'</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> extend_distinct_path max_path<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> is_trail.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> max_path<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prod.exhaust<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">v0</span> <span class="free">G</span><span class="main">)</span><span class="main">⟹</span><span class="skolem">v0</span><span class="main">=</span><span class="free">v'</span><span class="main">⟹</span><span class="skolem">v0</span><span class="main">=</span><span class="free">v</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span><span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">v0</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span><span class="main">=</span><span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">v1</span><span class="main">.</span> is_trail <span class="bound">v1</span> <span class="main">(</span><span class="bound">w</span><span class="main">#</span><span class="skolem">max_path</span><span class="main">)</span> <span class="free">v'</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> extend_distinct_path max_path<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> List.set_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> insert_subset max_path<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> path_in_edges<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">v0</span> <span class="free">G</span><span class="main">)</span><span class="main">⟹</span><span class="skolem">v0</span><span class="main">≠</span><span class="free">v'</span><span class="main">⟹</span><span class="skolem">v0</span><span class="main">=</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">v0</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span><span class="main">≠</span><span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>odd_nodes_set <span class="free">G</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> V›</span></span> <span class="quoted"><span class="quoted">‹ odd <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∈</span>odd_nodes_set <span class="free">G</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v'</span> <span class="main">∈</span> V›</span></span> <span class="quoted"><span class="quoted">‹odd <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">,</span><span class="skolem">v0</span><span class="main">}</span> <span class="main">⊆</span> odd_nodes_set <span class="free">G</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>   is_path_memb<span class="main">[</span><span class="operator">OF</span> is_trail_intro<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹is_trail <span class="skolem">v0</span> <span class="skolem">max_path</span> <span class="free">v'</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> max_path<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">,</span><span class="skolem">v0</span><span class="main">}</span><span class="main">=</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span><span class="main">≠</span><span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">≠</span><span class="free">v'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span><span class="main">≠</span><span class="free">v'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>odd_nodes_set <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> card_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="free">G</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">≤</span>card<span class="main">(</span>odd_nodes_set <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹num_of_odd_nodes <span class="free">G</span><span class="main">=</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span><span class="main">=</span><span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max_path<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> del_unEdge_even_connectivity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="quoted"><span class="quoted">"connected"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> even<span class="main">(</span>degree <span class="bound">n</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>E"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> valid_unMulti<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> valid_graph<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> valid_graph_axioms del_undirected <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> delete_edge_valid<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fin_E'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> del_undirected delete_edge_def 
        finite_Diff select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fin_V'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> del_undirected delete_edge_def select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> all_even<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">n</span><span class="main">∉</span><span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>
                  <span class="main">⟶</span>even<span class="main">(</span>degree <span class="bound">n</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> degree_frame del_UnEdge_node<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> E_validD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> even<span class="main">(</span>degree <span class="bound">n</span> <span class="free">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> del_UnEdge_even_even<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">v'</span></span><span class="main">,</span><span class="operator">OF</span> valid_unMultigraph_axioms<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> monoid_add_class.add.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" odd <span class="main">(</span>degree <span class="free">v</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹even <span class="main">(</span>degree <span class="free">v</span> <span class="free">G</span><span class="main">)</span>›</span></span> del_UnEdge_even<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>E›</span></span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">v'</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹even <span class="main">(</span>degree <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>›</span></span> del_UnEdge_even'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>E›</span></span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite E›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">≠</span><span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_id <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>E›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_unMultigraph.is_trail <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="bound">ps</span> <span class="free">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.path_between_odds<span class="main">[</span><span class="operator">OF</span> valid_unMulti<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v'</span></span><span class="main">]</span>    
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> del_unEdge_connectivity valid_unMulti 
      valid_unMultigraph.is_trail_intro<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_graph<span class="main">)</span> path_end<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">≠</span><span class="main">[]</span> <span class="main">⟹</span> is_path <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span> <span class="main">⟹</span> <span class="free">v'</span><span class="main">=</span>snd <span class="main">(</span>snd<span class="main">(</span>last <span class="free">ps</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> connectivity_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>E"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">G1</span> <span class="free">G2</span> <span class="keyword2"><span class="keyword">where</span></span>
         <span class="quoted"><span class="quoted">"nodes <span class="free">G1</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">ps</span> <span class="free">v</span><span class="main">}</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G1</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> 
            <span class="main">∧</span> <span class="bound">n</span><span class="main">∈</span>nodes <span class="free">G1</span> <span class="main">∧</span> <span class="bound">n'</span><span class="main">∈</span>nodes <span class="free">G1</span><span class="main">}</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">G2</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">ps</span> <span class="free">v'</span><span class="main">}</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G2</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> 
            <span class="main">∧</span> <span class="bound">n</span><span class="main">∈</span>nodes <span class="free">G2</span> <span class="main">∧</span> <span class="bound">n'</span><span class="main">∈</span>nodes <span class="free">G2</span><span class="main">}</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G1</span> <span class="main">∪</span> edges <span class="free">G2</span> <span class="main">=</span> edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G1</span> <span class="main">∩</span> edges <span class="free">G2</span><span class="main">=</span><span class="main">{}</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">G1</span> <span class="main">∪</span> nodes <span class="free">G2</span><span class="main">=</span>nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">G1</span> <span class="main">∩</span> nodes <span class="free">G2</span><span class="main">=</span><span class="main">{}</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">G1</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">G2</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="free">G1</span>"</span></span>  
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="free">G2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> valid0<span class="main">:</span><span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_graph_axioms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_undirected delete_edge_valid<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> valid0'<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_axioms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_unEdge_valid<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G1_nodes</span></span> <span class="keyword2"><span class="keyword">where</span></span> G1_nodes<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">G1_nodes</span><span class="main">=</span> 
      <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">ps</span> <span class="free">v</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G1</span></span> <span class="keyword2"><span class="keyword">where</span></span> G1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">G1</span><span class="main">=</span>
      <span class="main">⦇</span>nodes<span class="main">=</span><span class="skolem">G1_nodes</span><span class="main">,</span> edges<span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="bound">n</span><span class="main">∈</span><span class="skolem">G1_nodes</span> <span class="main">∧</span> <span class="bound">n'</span><span class="main">∈</span><span class="skolem">G1_nodes</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G2_nodes</span></span> <span class="keyword2"><span class="keyword">where</span></span> G2_nodes<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">G2_nodes</span><span class="main">=</span> 
      <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">ps</span> <span class="free">v'</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G2</span></span> <span class="keyword2"><span class="keyword">where</span></span> G2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">G2</span><span class="main">=</span>
      <span class="main">⦇</span>nodes<span class="main">=</span><span class="skolem">G2_nodes</span><span class="main">,</span> edges<span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="bound">n</span><span class="main">∈</span><span class="skolem">G2_nodes</span> <span class="main">∧</span> <span class="bound">n'</span><span class="main">∈</span><span class="skolem">G2_nodes</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">have</span></span> valid_G1<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="skolem">G1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> G1 valid_unMultigraph.corres<span class="main">[</span><span class="operator">OF</span> valid0'<span class="main">]</span> valid_unMultigraph.no_id<span class="main">[</span><span class="operator">OF</span> valid0'<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> valid_G1'<span class="main">:</span><span class="quoted"><span class="quoted">"valid_graph <span class="skolem">G1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> valid_G2<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="skolem">G2</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> G2 valid_unMultigraph.corres<span class="main">[</span><span class="operator">OF</span> valid0'<span class="main">]</span> valid_unMultigraph.no_id<span class="main">[</span><span class="operator">OF</span> valid0'<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> valid_G2'<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="skolem">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">ps</span> <span class="free">v</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> G1_nodes G1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> 
                 <span class="main">∧</span> <span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span> <span class="main">∧</span> <span class="bound">n'</span><span class="main">∈</span>nodes <span class="skolem">G1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> G1_nodes G1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G2</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">ps</span> <span class="free">v'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> G2_nodes G2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G2</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> 
                 <span class="main">∧</span> <span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span> <span class="main">∧</span> <span class="bound">n'</span><span class="main">∈</span>nodes <span class="skolem">G2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> G2_nodes G2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>               
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">∪</span> nodes <span class="skolem">G2</span><span class="main">=</span>nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">∪</span> nodes <span class="skolem">G2</span> <span class="main">≠</span> nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">⊆</span> nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_graph.is_path_memb<span class="main">[</span><span class="operator">OF</span> valid0<span class="main">]</span> G1 G1_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G2</span> <span class="main">⊆</span> nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_graph.is_path_memb<span class="main">[</span><span class="operator">OF</span> valid0<span class="main">]</span> G2 G2_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∉</span>nodes <span class="skolem">G1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∉</span>nodes <span class="skolem">G2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> n_neg_v <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n</span> <span class="bound">ps</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            n_neg_v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n</span> <span class="bound">ps</span> <span class="free">v'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> G1 G1_nodes G2 G2_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid0 valid_graph.is_path_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> nvs<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path <span class="skolem">n</span> <span class="skolem">nvs</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹connected›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> E_validD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> connected_def del_UnEdge_node n<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nvs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> nvs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nvs'</span><span class="main">=</span>takeWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∧</span><span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">nvs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> nvs_nvs'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">nvs</span><span class="main">=</span><span class="skolem">nvs'</span><span class="main">@</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∧</span><span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">nvs</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> nvs' takeWhile_dropWhile_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> is_path_nvs'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path <span class="skolem">n</span> <span class="skolem">nvs'</span> <span class="skolem">n'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_path <span class="skolem">n'</span> <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∧</span><span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">nvs</span><span class="main">)</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nvs is_path_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">nvs'</span></span> <span class="quoted"><span class="quoted">"dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∧</span><span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">nvs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">=</span><span class="free">v</span> <span class="main">∨</span> <span class="skolem">n'</span><span class="main">=</span><span class="free">v'</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∧</span><span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">nvs</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Nil
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nvs</span><span class="main">=</span><span class="skolem">nvs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nvs_nvs' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">=</span><span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  nvs is_path_nvs' path_end <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∧</span><span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">nvs</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∧</span><span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">nvs</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span>
                 <span class="main">∨</span> hd <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∧</span><span class="bound">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">nvs</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> full_types<span class="main"><span class="main">)</span></span> hd_dropWhile<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∨</span><span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_path <span class="skolem">n'</span> <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">nvs</span><span class="main">)</span> <span class="free">v</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons  is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n</span> <span class="skolem">nvs'</span> <span class="skolem">n'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> is_path_nvs' nvs'
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">nvs'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">nvs</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Nil
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_UnEdge_node is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid0 valid_graph.is_path_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_path <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> takeWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">nvs</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">=</span> takeWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">nvs</span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> append_Cons list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> takeWhile.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                takeWhile_dropWhile_id list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="skolem">n'</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>3<span class="main">)</span> set_takeWhileD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">nvs</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.set_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> insertI1<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> del_UnEdge_frame is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> x 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> n_neg_v n_neg_v' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span><span class="main">=</span><span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nvs</span></span> <span class="skolem"><span class="skolem">nv's</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          nvs  <span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n</span> <span class="skolem">nvs</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          nv's <span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n</span> <span class="skolem">nv's</span> <span class="free">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> G1 G2 G1_nodes G2_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="main">(</span><span class="main">(</span>rev_path <span class="skolem">nvs</span><span class="main">)</span><span class="main">@</span><span class="skolem">nv's</span><span class="main">)</span> <span class="free">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.is_path_rev<span class="main">[</span><span class="operator">OF</span> valid0'<span class="main">]</span> valid_graph.is_path_split<span class="main">[</span><span class="operator">OF</span> valid0<span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> del_unEdge_connectivity<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span> <span class="main">=</span> edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span> <span class="main">≠</span> edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span> <span class="main">⊆</span> edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G2</span> <span class="main">⊆</span> edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          nen'<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">n'</span><span class="main">)</span><span class="main">∉</span>edges <span class="skolem">G1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">n'</span><span class="main">)</span><span class="main">∉</span>edges <span class="skolem">G2</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nen'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid0 valid_graph.E_validD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nen'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid0 valid_graph.E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span> <span class="main">∧</span> <span class="skolem">n'</span><span class="main">∈</span>nodes <span class="skolem">G2</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="skolem">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span><span class="main">∧</span><span class="skolem">n'</span><span class="main">∈</span>nodes <span class="skolem">G1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> G1 G2 <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∪</span> nodes <span class="skolem">G2</span><span class="main">=</span>nodes <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span> <span class="main">⟹</span> <span class="skolem">n'</span><span class="main">∈</span>nodes <span class="skolem">G2</span> <span class="main">⟹</span> False"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nvs</span></span> <span class="skolem"><span class="skolem">nv's</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
              nvs  <span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n</span> <span class="skolem">nvs</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              nv's <span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n'</span> <span class="skolem">nv's</span> <span class="free">v'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> G1 G2 G1_nodes G2_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> 
                  <span class="main">(</span><span class="main">(</span>rev_path <span class="skolem">nvs</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">n'</span><span class="main">)</span><span class="main">#</span><span class="skolem">nv's</span><span class="main">)</span> <span class="free">v'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.is_path_rev<span class="main">[</span><span class="operator">OF</span> valid0'<span class="main">]</span> valid_graph.is_path_split'<span class="main">[</span><span class="operator">OF</span> valid0<span class="main">]</span>
                  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> del_unEdge_connectivity<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span> <span class="main">⟹</span> <span class="skolem">n'</span><span class="main">∈</span>nodes <span class="skolem">G1</span> <span class="main">⟹</span> False"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">∈</span>nodes <span class="skolem">G1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'vs</span></span> <span class="skolem"><span class="skolem">nvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
              n'vs  <span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n'</span> <span class="skolem">n'vs</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              nvs <span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n</span> <span class="skolem">nvs</span> <span class="free">v'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> G1 G2 G1_nodes G2_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nen'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid0' valid_unMultigraph.corres<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> 
                  <span class="main">(</span><span class="main">(</span>rev_path <span class="skolem">n'vs</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span><span class="main">#</span><span class="skolem">nvs</span><span class="main">)</span> <span class="free">v'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.is_path_rev<span class="main">[</span><span class="operator">OF</span> valid0'<span class="main">]</span> valid_graph.is_path_split'<span class="main">[</span><span class="operator">OF</span> valid0<span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> del_unEdge_connectivity<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span> <span class="main">∩</span> edges <span class="skolem">G2</span><span class="main">=</span><span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span> <span class="main">∩</span> edges <span class="skolem">G2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G1 G2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span><span class="main">=</span><span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="skolem">G1</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph.connected_def<span class="main">[</span><span class="operator">OF</span> valid_G1<span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">n'</span> 
      <span class="keyword3"><span class="command">assume</span></span>  n <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span>nodes <span class="skolem">G1</span>"</span></span> 
      <span class="keyword3"><span class="command">assume</span></span>  n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">∈</span>nodes <span class="skolem">G1</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="skolem">n'</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n</span> <span class="skolem">ps</span> <span class="free">v</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> G1 G1_nodes n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> ps<span class="main">:</span><span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G1</span> <span class="skolem">n</span> <span class="skolem">ps</span> <span class="free">v</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Nil
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>nodes <span class="skolem">G1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G1 G1_nodes valid0 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> calculation mem_Collect_eq select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid0 valid_G1 valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>  valid_unMultigraph.is_trail_intro<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">∈</span>nodes <span class="skolem">G1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G1 G1_nodes Cons.prems x 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G1</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> G1 G2 <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span><span class="main">=</span><span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span><span class="main">=</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> IntI Un_iff  bex_empty   valid_G2' valid_graph.E_validD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G1</span> <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> x valid_G1' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>   
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n'</span> <span class="skolem">ps'</span> <span class="free">v</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> G1 G1_nodes n' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> ps'<span class="main">:</span><span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G1</span> <span class="skolem">n'</span> <span class="skolem">ps'</span> <span class="free">v</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ps'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Nil
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>nodes <span class="skolem">G1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G1 G1_nodes valid0 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> calculation mem_Collect_eq select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid0 valid_G1 valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>  valid_unMultigraph.is_trail_intro<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">∈</span>nodes <span class="skolem">G1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G1 G1_nodes Cons.prems x 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G1</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> G1 G2 <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span><span class="main">=</span><span class="main">{}</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span><span class="main">=</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> IntI Un_iff  bex_empty  valid_G2' valid_graph.E_validD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G1</span> <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> x valid_G1' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>   
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G1</span> <span class="free">v</span> <span class="main">(</span>rev_path <span class="skolem">ps'</span><span class="main">)</span> <span class="skolem">n'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.is_path_rev<span class="main">[</span><span class="operator">OF</span> valid_G1<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G1</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">@</span><span class="main">(</span>rev_path <span class="skolem">ps'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> ps valid_graph.is_path_split<span class="main">[</span><span class="operator">OF</span> valid_G1'<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quoted"><span class="quoted">"rev_path <span class="skolem">ps'</span>"</span></span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="skolem">G1</span> <span class="skolem">n</span> <span class="bound">ps</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="skolem">G2</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph.connected_def<span class="main">[</span><span class="operator">OF</span> valid_G2<span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">n'</span> 
      <span class="keyword3"><span class="command">assume</span></span>  n <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span> 
      <span class="keyword3"><span class="command">assume</span></span>  n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="skolem">n'</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n</span> <span class="skolem">ps</span> <span class="free">v'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> G2 G2_nodes n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> ps<span class="main">:</span><span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G2</span> <span class="skolem">n</span> <span class="skolem">ps</span> <span class="free">v'</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Nil
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G2 G2_nodes valid0 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> calculation mem_Collect_eq select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid0 valid_G2 valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>  valid_unMultigraph.is_trail_intro<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G2 G2_nodes Cons.prems x 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G2</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span><span class="main">=</span><span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span><span class="main">=</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntI Un_iff assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bex_empty connected_def del_UnEdge_node valid0 valid0'
              valid_G1' valid_graph.E_validD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_graph.E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_unMultigraph.no_id<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G2</span> <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> x valid_G2' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>   
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">n'</span> <span class="skolem">ps'</span> <span class="free">v'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> G2 G2_nodes n' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> ps'<span class="main">:</span><span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G2</span> <span class="skolem">n'</span> <span class="skolem">ps'</span> <span class="free">v'</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ps'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Nil
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G2 G2_nodes valid0 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> calculation mem_Collect_eq select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid0 valid_G2 valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>  valid_unMultigraph.is_trail_intro<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G2 G2_nodes Cons.prems x 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G2</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span><span class="main">=</span><span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span><span class="main">=</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntI Un_iff assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bex_empty connected_def del_UnEdge_node valid0 valid0' 
              valid_G1' valid_graph.E_validD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_graph.E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_unMultigraph.no_id<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G2</span> <span class="skolem">x3</span> <span class="skolem">xs</span> <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems valid0 valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> x valid_G2' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>   
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G2</span> <span class="free">v'</span> <span class="main">(</span>rev_path <span class="skolem">ps'</span><span class="main">)</span> <span class="skolem">n'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.is_path_rev<span class="main">[</span><span class="operator">OF</span> valid_G2<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G2</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">@</span><span class="main">(</span>rev_path <span class="skolem">ps'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> ps valid_graph.is_path_split<span class="main">[</span><span class="operator">OF</span> valid_G2'<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quoted"><span class="quoted">"rev_path <span class="skolem">ps'</span>"</span></span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="skolem">G2</span> <span class="skolem">n</span> <span class="bound">ps</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_G1 valid_G2 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="MoreGraph-sub_graph_degree_frame"><span class="command">lemma</span></span> sub_graph_degree_frame<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="free">G2</span>"</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G1</span> <span class="main">∪</span> edges <span class="free">G2</span> <span class="main">=</span>edges <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">G1</span> <span class="main">∩</span> nodes <span class="free">G2</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">∈</span>nodes <span class="free">G1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">n</span> <span class="free">G</span><span class="main">=</span>degree <span class="free">n</span> <span class="free">G1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">⊆</span><span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free">G1</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span>edges <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e</span><span class="main">=</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">∉</span>nodes <span class="free">G2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="free">G1</span> <span class="main">∩</span> nodes <span class="free">G2</span><span class="main">=</span><span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span><span class="main">∈</span>nodes <span class="free">G1</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∉</span>edges <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_graph.E_validD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹valid_graph <span class="free"><span class="free">G2</span></span>›</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">e</span><span class="main">=</span><span class="free">n</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.exhaust fst_conv<span class="main">)</span>  
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span>edges <span class="free">G1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹edges <span class="free">G1</span> <span class="main">∪</span> edges <span class="free">G2</span> <span class="main">=</span>edges <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free">G1</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">e</span><span class="main">=</span><span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free">G1</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">⊆</span><span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> Collect_mono Un_iff assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1" id="MoreGraph-odd_nodes_no_edge"><span class="command">lemma</span></span> odd_nodes_no_edge<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> num_of_odd_nodes <span class="main">(</span><span class="free">g</span> <span class="main">⦇</span>edges<span class="main">:=</span><span class="main">{}</span> <span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span>  num_of_odd_nodes_def odd_nodes_set_def degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Adjacent nodes›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> <span class="entity">adjacent</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">adjacent</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span><span class="main">∈</span>E"</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> adjacent_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"adjacent <span class="free">v</span> <span class="free">v'</span> <span class="main">⟷</span> adjacent <span class="free">v'</span> <span class="free">v</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> adjacent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> adjacent_no_loop<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"adjacent <span class="free">v</span> <span class="free">v'</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">≠</span><span class="free">v'</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> adjacent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> adjacent_V<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="free">v</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∈</span>V"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms E_validD <span class="keyword1"><span class="command">unfolding</span></span> adjacent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> adjacent_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite E <span class="main">⟹</span> finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="free">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="skolem">v</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span> <span class="main">⟹</span> finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">∈</span><span class="skolem">S</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> empty
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod_cases3<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="skolem">v</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="skolem">v</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">}</span><span class="main">=</span>insert <span class="skolem">x3</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="skolem">v</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="skolem">v</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">}</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> aux<span class="main">=</span>this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> aux<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">unfolding</span></span> adjacent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Undirected simple graph›</span></span>

<span class="keyword1"><span class="command">locale</span></span> valid_unSimpGraph<span class="main">=</span>valid_unMultigraph <span class="quoted"><span class="free">G</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> graph"</span></span><span class="main">+</span>
              <span class="keyword2"><span class="keyword">assumes</span></span> no_multi<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">u</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w'</span><span class="main">,</span><span class="free">u</span><span class="main">)</span> <span class="main">∈</span>edges <span class="free">G</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w'</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> finV_to_finE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> adjacent <span class="bound">v1</span> <span class="bound">v2</span><span class="main">}</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"E<span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> adjacent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> adjacent <span class="bound">v1</span> <span class="bound">v2</span><span class="main">}</span> <span class="main">⊆</span> V <span class="main">×</span> V"</span></span> <span class="keyword1"><span class="command">using</span></span> adjacent_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>V <span class="main">×</span> V<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> adjacent <span class="bound">v1</span> <span class="bound">v2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> adjacent <span class="bound">v1</span> <span class="bound">v2</span><span class="main">}</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False card_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card E<span class="main">=</span>card <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> adjacent <span class="bound">v1</span> <span class="bound">v2</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">)</span><span class="main">`</span>E <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> adjacent <span class="bound">v1</span> <span class="bound">v2</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">)</span><span class="main">`</span>E <span class="main">⟹</span> <span class="bound">x</span><span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> adjacent <span class="bound">v1</span> <span class="bound">v2</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> adjacent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> adjacent <span class="bound">v1</span> <span class="bound">v2</span><span class="main">}</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">)</span><span class="main">`</span>E"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> adjacent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span><span class="main">)</span> E"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_image<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="MoreGraph-del_unEdge_valid'"><span class="command">lemma</span></span> del_unEdge_valid'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"valid_unSimpGraph <span class="free">G</span><span class="main">⟹</span>
    valid_unSimpGraph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">u</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"valid_unSimpGraph <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">u</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> valid_unSimpGraph_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> del_unEdge_valid<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unSimpGraph_axioms <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">u</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_unSimpGraph.no_multi<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unSimpGraph <span class="free">G</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> valid_unSimpGraph_axioms_def del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_unSimpGraph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">u</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_unSimpGraph_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> del_UnEdge_non_adj<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">∈</span>E <span class="main">⟹</span> <span class="main">¬</span>valid_unMultigraph.adjacent <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">u</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> E"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> ccontr<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph.adjacent <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">u</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> valid<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">u</span> <span class="free">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="keyword2"><span class="keyword">where</span></span> vw'u<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="skolem">w'</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="free">w</span> <span class="free">u</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ccontr <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph.adjacent_def<span class="main">[</span><span class="operator">OF</span> valid<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="skolem">w'</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">∉</span><span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span><span class="main">≠</span><span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="skolem">w'</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">∈</span>E"</span></span> <span class="keyword1"><span class="command">using</span></span> vw'u <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_multi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="skolem">w'</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> E›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> degree_adjacent<span class="main">:</span> <span class="quoted"><span class="quoted">"finite E <span class="main">⟹</span> degree <span class="free">v</span> <span class="free">G</span><span class="main">=</span>card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="free">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_unSimpGraph_axioms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">v</span> <span class="free">G</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">note</span></span> valid3<span class="main">=</span><span class="quoted"><span class="quoted">‹valid_unSimpGraph <span class="skolem">G</span>›</span></span>
  <span class="keyword1"><span class="command">hence</span></span> valid2<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_unSimpGraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">a</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="skolem">G</span> <span class="free">v</span> <span class="bound">a</span><span class="main">}</span><span class="main">=</span><span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">a</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="skolem">G</span> <span class="free">v</span> <span class="bound">a</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph.adjacent_def<span class="main">[</span><span class="operator">OF</span> valid2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">v</span> <span class="skolem">G</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">=</span> degree <span class="free">v</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0.hyps"</span> card.empty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="skolem">G</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card.empty <span class="keyword1"><span class="command">unfolding</span></span> degree_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> valid<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unSimpGraph <span class="skolem">G</span>›</span></span> valid_unSimpGraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> valid'<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unSimpGraph <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> del_unEdge_valid' <span class="quoted"><span class="quoted">‹valid_unSimpGraph <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> degree <span class="free">v</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">=</span> degree <span class="free">v</span> <span class="skolem">G</span>›</span></span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span>  del_edge_undirected_degree_plus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc_eq_plus1 diff_Suc_1 valid valid_unMultigraph.corres<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">v</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span> 
      <span class="main">=</span> card <span class="main">(</span>Collect <span class="main">(</span>valid_unMultigraph.adjacent <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc<span class="main">(</span>card <span class="main">(</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span>  
      <span class="free">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="skolem">G</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.adjacent_def<span class="main">[</span><span class="operator">OF</span> valid'<span class="main">]</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span> <span class="main">⊆</span> 
          <span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="skolem">G</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> del_unEdge_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph.adjacent_def<span class="main">[</span><span class="operator">OF</span> valid'<span class="main">]</span> 
          valid_unMultigraph.adjacent_def<span class="main">[</span><span class="operator">OF</span> valid<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="skolem">G</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph.adjacent_def<span class="main">[</span><span class="operator">OF</span> valid<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>
          <span class="main">⊆</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="skolem">G</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="skolem">G</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>
          <span class="main">⊆</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> del_unEdge_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph.adjacent_def<span class="main">[</span><span class="operator">OF</span> valid'<span class="main">]</span> 
          valid_unMultigraph.adjacent_def<span class="main">[</span><span class="operator">OF</span> valid<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>
          <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="skolem">G</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">∉</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> valid_unSimpGraph.del_UnEdge_non_adj<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unSimpGraph <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> valid_unMultigraph.adjacent <span class="skolem">G</span> <span class="free">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.adjacent_finite<span class="main">[</span><span class="operator">OF</span> valid <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_insert_right card_insert_disjoint finite_Un sup_bot_right<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> degree <span class="free">v</span> <span class="main">(</span>del_unEdge <span class="free">v</span> <span class="skolem">w</span> <span class="skolem">u</span> <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="KoenigsbergBridge">
<div class="head">
<h1>Theory KoenigsbergBridge</h1>
</div>
<pre class="source"><span class="comment1">(*
Title:KoenigsbergBridge.thy
Author:Wenda Li
*)</span>

<span class="keyword1"><span class="command">theory</span></span> KoenigsbergBridge <span class="keyword2"><span class="keyword">imports</span></span> <a href="#MoreGraph">MoreGraph</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Definition of Eulerian trails and circuits›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> <span class="entity">is_Eulerian_trail</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span><span class="main">⇒</span><span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> path<span class="main">⇒</span><span class="tfree">'v</span><span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_Eulerian_trail</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">≡</span> is_trail <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">∧</span> edges <span class="main">(</span>rem_unPath <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> <span class="entity">is_Eulerian_circuit</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> path <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_Eulerian_circuit</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>is_Eulerian_trail <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Necessary conditions for Eulerian trails and circuits›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> euclerian_rev<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_Eulerian_trail <span class="free">v'</span> <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="free">v</span><span class="main">=</span>is_Eulerian_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="free">v'</span> <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="free">v</span><span class="main">=</span>is_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_trail_rev<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>rem_unPath <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>edges <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath_graph<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_Eulerian_trail_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*Necessary conditions for Eulerian circuits*)</span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> euclerian_cycle_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_Eulerian_circuit <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> even <span class="main">(</span>degree <span class="bound">v</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> cycle<span class="main">:</span><span class="quoted"><span class="quoted">"is_Eulerian_circuit <span class="skolem">v</span> <span class="skolem">ps</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>rem_unPath <span class="skolem">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_Eulerian_circuit_def is_Eulerian_trail_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>rem_unPath <span class="skolem">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rem_unPath <span class="skolem">ps</span> <span class="free">G</span> <span class="main">=</span> <span class="free">G</span> <span class="main">⦇</span>edges<span class="main">:=</span><span class="main">{}</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> odd_nodes_no_edge<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="skolem">v'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹is_Eulerian_circuit <span class="skolem">v</span> <span class="skolem">ps</span> <span class="skolem">v'</span>›</span></span> is_Eulerian_circuit_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>num_of_odd_nodes <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cycle is_Eulerian_circuit_def
        is_Eulerian_trail_def rem_UnPath_cycle<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>odd_nodes_set <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*Necessary conditions for Eulerian trails*)</span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> euclerian_path_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_Eulerian_trail <span class="free">v</span> <span class="free">ps</span> <span class="free">v'</span>"</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> even <span class="main">(</span>degree <span class="bound">v</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>num_of_odd_nodes <span class="free">G</span> <span class="main">=</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> path<span class="main">:</span><span class="quoted"><span class="quoted">"is_Eulerian_trail <span class="skolem">v</span> <span class="skolem">ps</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>rem_unPath <span class="skolem">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span>  is_Eulerian_trail_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>rem_unPath <span class="skolem">ps</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span>nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rem_unPath <span class="skolem">ps</span> <span class="free">G</span> <span class="main">=</span> <span class="free">G</span> <span class="main">⦇</span>edges<span class="main">:=</span><span class="main">{}</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> odd_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> odd_nodes_no_edge<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="skolem">v'</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">v</span> <span class="skolem">ps</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_Eulerian_trail_def path<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> num_of_odd_nodes <span class="free">G</span>
          <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rem_UnPath_even True <span class="quoted"><span class="quoted">‹finite V›</span></span> <span class="quoted"><span class="quoted">‹finite E›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">≠</span><span class="skolem">v'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> odd_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>odd_nodes_set <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="skolem">v</span> <span class="skolem">ps</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_Eulerian_trail_def path<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>rem_unPath <span class="skolem">ps</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> num_of_odd_nodes <span class="free">G</span>
          <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> odd <span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rem_UnPath_odd False <span class="quoted"><span class="quoted">‹finite V›</span></span> <span class="quoted"><span class="quoted">‹finite E›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">≠</span><span class="skolem">v'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> odd_nodes_if<span class="main">:</span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> odd <span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">-</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> odd_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> odd_nodes_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> odd_nodes_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>odd_nodes_set <span class="free">G</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="skolem">v'</span><span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> euclerian_cycle_ex is_Eulerian_circuit_def path<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Specific case of the Konigsberg Bridge Problem›</span></span>

<span class="comment1">(*to denote the four landmasses*)</span>
<span class="keyword1"><span class="command">datatype</span></span> kon_node <span class="main">=</span> a <span class="main">|</span> b <span class="main">|</span> c <span class="main">|</span> d

<span class="comment1">(*to denote the seven bridges*)</span>
<span class="keyword1"><span class="command">datatype</span></span> kon_bridge <span class="main">=</span> ab1 <span class="main">|</span> ab2 <span class="main">|</span> ac1 <span class="main">|</span> ac2 <span class="main">|</span> ad1 <span class="main">|</span> bd1 <span class="main">|</span> cd1

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">kon_graph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>kon_node<span class="main">,</span>kon_bridge<span class="main">)</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">kon_graph</span><span class="main">≡</span><span class="main">⦇</span>nodes<span class="main">=</span><span class="main">{</span>a<span class="main">,</span>b<span class="main">,</span>c<span class="main">,</span>d<span class="main">}</span><span class="main">,</span>
              edges<span class="main">=</span><span class="main">{</span><span class="main">(</span>a<span class="main">,</span>ab1<span class="main">,</span>b<span class="main">)</span><span class="main">,</span> <span class="main">(</span>b<span class="main">,</span>ab1<span class="main">,</span>a<span class="main">)</span><span class="main">,</span>
                     <span class="main">(</span>a<span class="main">,</span>ab2<span class="main">,</span>b<span class="main">)</span><span class="main">,</span> <span class="main">(</span>b<span class="main">,</span>ab2<span class="main">,</span>a<span class="main">)</span><span class="main">,</span>
                     <span class="main">(</span>a<span class="main">,</span>ac1<span class="main">,</span>c<span class="main">)</span><span class="main">,</span> <span class="main">(</span>c<span class="main">,</span>ac1<span class="main">,</span>a<span class="main">)</span><span class="main">,</span>
                     <span class="main">(</span>a<span class="main">,</span>ac2<span class="main">,</span>c<span class="main">)</span><span class="main">,</span> <span class="main">(</span>c<span class="main">,</span>ac2<span class="main">,</span>a<span class="main">)</span><span class="main">,</span>
                     <span class="main">(</span>a<span class="main">,</span>ad1<span class="main">,</span>d<span class="main">)</span><span class="main">,</span> <span class="main">(</span>d<span class="main">,</span>ad1<span class="main">,</span>a<span class="main">)</span><span class="main">,</span>
                     <span class="main">(</span>b<span class="main">,</span>bd1<span class="main">,</span>d<span class="main">)</span><span class="main">,</span> <span class="main">(</span>d<span class="main">,</span>bd1<span class="main">,</span>b<span class="main">)</span><span class="main">,</span>
                     <span class="main">(</span>c<span class="main">,</span>cd1<span class="main">,</span>d<span class="main">)</span><span class="main">,</span> <span class="main">(</span>d<span class="main">,</span>cd1<span class="main">,</span>c<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> kon_node <span class="main">::</span> <span class="quoted">enum</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"enum_class.enum <span class="main">=</span><span class="main">[</span>a<span class="main">,</span>b<span class="main">,</span>c<span class="main">,</span>d<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"enum_class.enum_all <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> a <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> b <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> c <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> d"</span></span>
<span class="keyword1"><span class="command">definition</span></span>   <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"enum_class.enum_ex <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> a <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> b <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> c <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> d"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> kon_bridge <span class="main">::</span> <span class="quoted">enum</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"enum_class.enum <span class="main">=</span><span class="main">[</span>ab1<span class="main">,</span>ab2<span class="main">,</span>ac1<span class="main">,</span>ac2<span class="main">,</span>ad1<span class="main">,</span>cd1<span class="main">,</span>bd1<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"enum_class.enum_all <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> ab1 <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> ab2 <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> ac1 <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> ac2 <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> ad1  <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> bd1
    <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> cd1"</span></span>
<span class="keyword1"><span class="command">definition</span></span>   <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"enum_class.enum_ex <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span>  <span class="free"><span class="bound"><span class="entity">P</span></span></span> ab1 <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> ab2 <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> ac1 <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> ac2 <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> ad1  <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> bd1
    <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> cd1"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>   kon_graph<span class="main">:</span> valid_unMultigraph <span class="quoted">kon_graph</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> edges kon_graph <span class="main">⊆</span> nodes kon_graph"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> snd <span class="main">`</span> edges kon_graph <span class="main">⊆</span> nodes kon_graph"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span> <span class="bound">u'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">u'</span><span class="main">)</span> <span class="main">∈</span> edges kon_graph<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> edges kon_graph<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">w</span> <span class="bound">u'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">u'</span><span class="main">)</span> <span class="main">∈</span> edges kon_graph<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> edges kon_graph<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∉</span> edges kon_graph"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∉</span> edges kon_graph"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*The specific case of the Konigsberg Bridge Problem does not have a solution*)</span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>kon_graph.is_Eulerian_trail <span class="free">v1</span> <span class="free">p</span> <span class="free">v2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"kon_graph.is_Eulerian_trail  <span class="free">v1</span> <span class="free">p</span> <span class="free">v2</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes kon_graph<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_code<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges kon_graph<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_code<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> contra<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>nodes kon_graph<span class="main">.</span> even <span class="main">(</span>degree <span class="bound">v</span> kon_graph<span class="main">)</span><span class="main">)</span> <span class="main">∨</span><span class="main">(</span>num_of_odd_nodes kon_graph <span class="main">=</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kon_graph.euclerian_path_ex<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree a kon_graph<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree b kon_graph<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree c kon_graph<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree d kon_graph<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>num_of_odd_nodes kon_graph <span class="main">=</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>nodes kon_graph<span class="main">.</span> even <span class="main">(</span>degree <span class="bound">v</span> kon_graph<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> contra <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Sufficient conditions for Eulerian trails and circuits›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> eulerian_cons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail <span class="main">(</span>del_unEdge <span class="free">v0</span> <span class="free">w</span> <span class="free">v1</span> <span class="free">G</span><span class="main">)</span> <span class="free">v1</span> <span class="free">ps</span> <span class="free">v2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v0</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">∈</span> E"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_Eulerian_trail <span class="free">v0</span> <span class="main">(</span><span class="main">(</span><span class="free">v0</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">#</span><span class="free">ps</span><span class="main">)</span> <span class="free">v2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> valid<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="free">v0</span> <span class="free">w</span> <span class="free">v1</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  valid_unMultigraph_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> distinct<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="main">(</span>del_unEdge <span class="free">v0</span> <span class="free">w</span> <span class="free">v1</span> <span class="free">G</span><span class="main">)</span> <span class="free">v1</span> <span class="free">ps</span> <span class="free">v2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph.is_Eulerian_trail_def<span class="main">[</span><span class="operator">OF</span> valid<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps</span> <span class="main">⊆</span> edges <span class="main">(</span>del_unEdge <span class="free">v0</span> <span class="free">w</span> <span class="free">v1</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.path_in_edges<span class="main">[</span><span class="operator">OF</span> valid<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v0</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">∉</span>edges <span class="main">(</span>del_unEdge <span class="free">v0</span> <span class="free">w</span> <span class="free">v1</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v0</span><span class="main">)</span><span class="main">∉</span>edges <span class="main">(</span>del_unEdge <span class="free">v0</span> <span class="free">w</span> <span class="free">v1</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v0</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">∉</span>set <span class="free">ps</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v0</span><span class="main">)</span><span class="main">∉</span>set <span class="free">ps</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="free">v1</span> <span class="free">ps</span> <span class="free">v2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distinct_path_intro<span class="main">[</span><span class="operator">OF</span> distinct<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_trail <span class="free">v0</span> <span class="main">(</span><span class="main">(</span><span class="free">v0</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">#</span><span class="free">ps</span><span class="main">)</span> <span class="free">v2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">v0</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">∈</span> E›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>rem_unPath <span class="free">ps</span> <span class="main">(</span>del_unEdge <span class="free">v0</span> <span class="free">w</span> <span class="free">v1</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span><span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph.is_Eulerian_trail_def<span class="main">[</span><span class="operator">OF</span> valid<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>rem_unPath <span class="main">(</span><span class="main">(</span><span class="free">v0</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1</span><span class="main">)</span><span class="main">#</span><span class="free">ps</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_Eulerian_trail_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> eulerian_cons'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail <span class="main">(</span>del_unEdge <span class="free">v2</span> <span class="free">w</span> <span class="free">v3</span> <span class="free">G</span><span class="main">)</span> <span class="free">v1</span> <span class="free">ps</span> <span class="free">v2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v3</span><span class="main">)</span><span class="main">∈</span> E"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_Eulerian_trail <span class="free">v1</span> <span class="main">(</span><span class="free">ps</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v3</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="free">v3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> valid<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="free">v3</span> <span class="free">w</span> <span class="free">v2</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_axioms del_unEdge_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"del_unEdge <span class="free">v2</span> <span class="free">w</span> <span class="free">v3</span> <span class="free">G</span><span class="main">=</span>del_unEdge <span class="free">v3</span> <span class="free">w</span> <span class="free">v2</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> delete_edge_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail <span class="main">(</span>del_unEdge <span class="free">v3</span> <span class="free">w</span> <span class="free">v2</span> <span class="free">G</span><span class="main">)</span> <span class="free">v2</span>
        <span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span> <span class="free">v1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms valid_unMultigraph.euclerian_rev<span class="main">[</span><span class="operator">OF</span> valid<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_Eulerian_trail <span class="free">v3</span> <span class="main">(</span><span class="main">(</span><span class="free">v3</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="free">v1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eulerian_cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> corres<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_Eulerian_trail <span class="free">v1</span> <span class="main">(</span>rev_path<span class="main">(</span><span class="main">(</span><span class="free">v3</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">v3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> euclerian_rev <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rev_path<span class="main">(</span><span class="main">(</span><span class="free">v3</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rev_path<span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v3</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rev_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rev_path<span class="main">(</span><span class="main">(</span><span class="free">v3</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>rev_path <span class="free">ps</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="free">ps</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v3</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="KoenigsbergBridge-eulerian_split"><span class="command">lemma</span></span> eulerian_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">G1</span> <span class="main">∩</span> nodes <span class="free">G2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G1</span> <span class="main">∩</span> edges <span class="free">G2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">G1</span>"</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="free">G2</span>"</span></span>
    <span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail  <span class="free">G1</span> <span class="free">v1</span> <span class="free">ps1</span> <span class="free">v1'</span>"</span></span>
    <span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail  <span class="free">G2</span> <span class="free">v2</span> <span class="free">ps2</span> <span class="free">v2'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail <span class="main">⦇</span>nodes<span class="main">=</span>nodes <span class="free">G1</span> <span class="main">∪</span> nodes <span class="free">G2</span><span class="main">,</span>
          edges<span class="main">=</span>edges <span class="free">G1</span> <span class="main">∪</span> edges <span class="free">G2</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1'</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="free">v1</span> <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span> <span class="free">v2'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="free">G1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G1</span>›</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G2</span>›</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">=</span><span class="main">⦇</span>nodes<span class="main">=</span>nodes <span class="free">G1</span> <span class="main">∪</span> nodes <span class="free">G2</span><span class="main">,</span> edges<span class="main">=</span>edges <span class="free">G1</span> <span class="main">∪</span> edges <span class="free">G2</span>
      <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1'</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v1'</span><span class="main">∈</span>nodes <span class="free">G1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹valid_graph <span class="free">G1</span>›</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> valid_graph.is_path_memb
        valid_unMultigraph.is_trail_intro valid_unMultigraph.is_Eulerian_trail_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v2</span><span class="main">∈</span>nodes <span class="free">G2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹valid_graph <span class="free">G2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> valid_graph.is_path_memb
        valid_unMultigraph.is_trail_intro valid_unMultigraph.is_Eulerian_trail_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ba</span> <span class="main">∈</span> nodes <span class="free">G1</span>›</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">aa</span><span class="main">,</span> <span class="skolem">ab</span><span class="main">,</span> <span class="skolem">ba</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G1</span>›</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">aa</span> <span class="skolem">ab</span> <span class="skolem">ba</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹valid_graph <span class="free">G1</span>›</span></span> valid_graph.E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">⦇</span>nodes<span class="main">=</span>nodes <span class="free">G1</span> <span class="main">∪</span> nodes <span class="free">G2</span><span class="main">,</span> edges<span class="main">=</span>edges <span class="free">G1</span> <span class="main">∪</span> edges <span class="free">G2</span> <span class="main">∪</span>
                   <span class="main">{</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1'</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>
      valid_unMultigraph.corres<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G1</span>›</span></span><span class="main">]</span>
      valid_unMultigraph.no_id<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G1</span>›</span></span><span class="main">]</span>
      valid_unMultigraph.corres<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G2</span>›</span></span><span class="main">]</span>
      valid_unMultigraph.no_id<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G2</span>›</span></span><span class="main">]</span>
      valid_graph.E_validD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹valid_graph <span class="free"><span class="free">G1</span></span>›</span></span></span><span class="main">]</span>
      valid_graph.E_validD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹valid_graph <span class="free"><span class="free">G2</span></span>›</span></span></span><span class="main">]</span>
      <span class="quoted"><span class="quoted">‹nodes <span class="free">G1</span> <span class="main">∩</span> nodes <span class="free">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> valid'<span class="main">:</span><span class="quoted"><span class="quoted">"valid_graph <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="skolem">G</span> <span class="free">v1</span> <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span><span class="main">)</span> <span class="free">v2'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> ps1_G<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="skolem">G</span> <span class="free">v1</span> <span class="free">ps1</span> <span class="free">v1'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="free">G1</span> <span class="free">v1</span> <span class="free">ps1</span> <span class="free">v1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_unMultigraph.is_Eulerian_trail_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G1</span> <span class="main">⊆</span> edges <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G UnI1 Un_assoc select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subrelI<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">G1</span> <span class="main">⊆</span> nodes <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G inf_sup_absorb le_iff_inf select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> distinct_path_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G1</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G1</span>›</span></span> valid<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> ps2_G<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="skolem">G</span> <span class="free">v2</span> <span class="free">ps2</span> <span class="free">v2'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_trail <span class="free">G2</span> <span class="free">v2</span> <span class="free">ps2</span> <span class="free">v2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_unMultigraph.is_Eulerian_trail_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G2</span> <span class="main">⊆</span> edges <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G inf_sup_ord<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> le_supE select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">G2</span> <span class="main">⊆</span> nodes <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G inf_sup_ord<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> distinct_path_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G2</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G2</span>›</span></span> valid<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G</span> <span class="free">v1</span> <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span><span class="main">)</span> <span class="free">v2'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path  <span class="skolem">G</span> <span class="free">v1</span> <span class="free">ps1</span> <span class="free">v1'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ps1_G valid valid_unMultigraph.is_trail_intro<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="skolem">G</span> <span class="free">v2</span> <span class="free">ps2</span> <span class="free">v2'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ps2_G valid valid_unMultigraph.is_trail_intro<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> valid_graph.is_path_split'<span class="main">[</span><span class="operator">OF</span> valid'<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">v1</span></span> <span class="quoted"><span class="free">ps1</span></span> <span class="quoted"><span class="free">v1'</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">v2</span></span> <span class="quoted"><span class="free">ps2</span></span> <span class="quoted"><span class="free">v2'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ps1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ps1_G valid valid_unMultigraph.is_trail_path<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ps2</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ps2_G valid valid_unMultigraph.is_trail_path<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps1</span> <span class="main">∩</span> set <span class="free">ps2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps1</span> <span class="main">⊆</span>edges <span class="free">G1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_Eulerian_trail_def
                    valid_unMultigraph.path_in_edges<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps2</span> <span class="main">⊆</span> edges <span class="free">G2</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_Eulerian_trail_def
                    valid_unMultigraph.path_in_edges<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹edges <span class="free">G1</span> <span class="main">∩</span> edges <span class="free">G2</span><span class="main">=</span><span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∉</span>edges <span class="free">G1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v2</span> <span class="main">∈</span> nodes <span class="free">G2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_graph <span class="free">G1</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff  all_not_in_conv assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_graph.E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∉</span>set <span class="free">ps1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> subsetD valid_unMultigraph.path_in_edges
                valid_unMultigraph.is_Eulerian_trail_def <span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∉</span>edges <span class="free">G2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v1'</span> <span class="main">∈</span> nodes <span class="free">G1</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_graph <span class="free">G2</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal valid_graph.E_validD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">∉</span>set <span class="free">ps2</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span>  assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> in_mono valid_unMultigraph.path_in_edges
                valid_unMultigraph.is_Eulerian_trail_def <span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> distinct_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps1</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="free">ps1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ps1_G valid valid_unMultigraph.is_trail_path<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev_path <span class="free">ps2</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="free">G2</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_trail_rev
                valid_unMultigraph.is_Eulerian_trail_def valid_unMultigraph.path_in_edges<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps1</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="free">ps2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms
              valid_unMultigraph.path_in_edges<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G1</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">v1</span></span> <span class="quoted"><span class="free">ps1</span></span> <span class="quoted"><span class="free">v1'</span></span><span class="main">]</span>
              valid_unMultigraph.path_in_edges<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G2</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">v2</span></span> <span class="quoted"><span class="free">ps2</span></span> <span class="quoted"><span class="free">v2'</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph.is_Eulerian_trail_def<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G1</span>›</span></span><span class="main">]</span>
              valid_unMultigraph.is_Eulerian_trail_def<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="free">G2</span>›</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps2</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="free">ps2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ps2_G valid valid_unMultigraph.is_trail_path<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev_path <span class="free">ps1</span><span class="main">)</span> <span class="main">⊆</span>edges <span class="free">G1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_Eulerian_trail_def
                valid_unMultigraph.path_in_edges valid_unMultigraph.euclerian_rev<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps2</span> <span class="main">∩</span> set <span class="main">(</span>rev_path <span class="free">ps1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> distinct_append distinct_rev_path ps1_G ps2_G rev_path_append
              rev_path_double valid valid_unMultigraph.is_trail_path<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1'</span><span class="main">)</span><span class="main">∉</span>set <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1'</span><span class="main">)</span><span class="main">∉</span>edges <span class="free">G1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v2</span> <span class="main">∈</span> nodes <span class="free">G2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_graph <span class="free">G1</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff  all_not_in_conv assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_graph.E_validD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1'</span><span class="main">)</span><span class="main">∉</span>set <span class="free">ps1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> split_list valid_unMultigraph.is_trail_split'
                    valid_unMultigraph.is_Eulerian_trail_def<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1'</span><span class="main">)</span><span class="main">∉</span>edges <span class="free">G2</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v1'</span> <span class="main">∈</span> nodes <span class="free">G1</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_graph <span class="free">G2</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntI assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> empty_iff valid_graph.E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1'</span><span class="main">)</span><span class="main">∉</span>set <span class="free">ps2</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> in_mono  valid_unMultigraph.path_in_edges
                    valid_unMultigraph.is_Eulerian_trail_def<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1'</span><span class="main">)</span><span class="main">≠</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v1'</span> <span class="main">∈</span> nodes <span class="free">G1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v2</span> <span class="main">∈</span> nodes <span class="free">G2</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntI Pair_inject  assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> bex_empty<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rev_path_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.is_trail_path<span class="main">[</span><span class="operator">OF</span> valid<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>rem_unPath <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span><span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>rem_unPath <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span><span class="main">=</span>edges <span class="skolem">G</span> <span class="main">-</span>
           <span class="main">(</span>set <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath_edges<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>edges <span class="skolem">G</span> <span class="main">-</span> <span class="main">(</span>set <span class="free">ps1</span> <span class="main">∪</span> set <span class="free">ps2</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps2</span><span class="main">)</span>
                 <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1'</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rev_path_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>rem_unPath <span class="main">(</span><span class="free">ps1</span><span class="main">@</span><span class="main">(</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">#</span><span class="free">ps2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> edges <span class="skolem">G</span> <span class="main">-</span> <span class="main">(</span>set <span class="free">ps1</span> <span class="main">∪</span>
                    set <span class="free">ps2</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps2</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">v1'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">v2</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v1'</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>rem_unPath <span class="free">ps1</span> <span class="free">G1</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_Eulerian_trail_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G1</span> <span class="main">-</span> <span class="main">(</span>set <span class="free">ps1</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps1</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath_edges<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>rem_unPath <span class="free">ps2</span> <span class="free">G2</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> valid_unMultigraph.is_Eulerian_trail_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G2</span> <span class="main">-</span> <span class="main">(</span>set <span class="free">ps2</span> <span class="main">∪</span> set <span class="main">(</span>rev_path <span class="free">ps2</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rem_unPath_edges<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G valid valid_unMultigraph.is_Eulerian_trail_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unMultigraph<span class="main">)</span> eulerian_sufficient<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="quoted"><span class="quoted">"connected"</span></span> <span class="quoted"><span class="quoted">"V<span class="main">≠</span><span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span><span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span>V<span class="main">.</span><span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> odd<span class="main">(</span>degree <span class="bound">v</span> <span class="free">G</span><span class="main">)</span><span class="main">∧</span>odd<span class="main">(</span>degree <span class="bound">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">v</span><span class="main">≠</span><span class="bound">v'</span><span class="main">)</span><span class="main">∧</span>is_Eulerian_trail <span class="bound">v</span> <span class="bound">ps</span> <span class="bound">v'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="free">G</span><span class="main">=</span><span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span><span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> is_Eulerian_circuit <span class="bound">v</span> <span class="bound">ps</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite E›</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span> valid_unMultigraph_axioms  <span class="quoted"><span class="quoted">‹V<span class="main">≠</span><span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹connected›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card E"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="skolem">G</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">∈</span>nodes <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">n1</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span><span class="main">∈</span>nodes <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">≠</span><span class="skolem">n2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def odd_nodes_set_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">S</span><span class="main">.</span> card <span class="bound">S</span><span class="main">=</span><span class="numeral">2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n1</span> <span class="bound">n2</span><span class="main">.</span> <span class="bound">n1</span><span class="main">∈</span><span class="bound">S</span><span class="main">∧</span><span class="bound">n2</span><span class="main">∈</span><span class="bound">S</span><span class="main">∧</span><span class="bound">n1</span><span class="main">≠</span><span class="bound">n2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_eq_0_iff equals0I even_card' even_numeral zero_neq_numeral<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> nodes <span class="skolem">G</span><span class="main">.</span> odd <span class="main">(</span>degree <span class="bound">v</span> <span class="skolem">G</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> nodes <span class="skolem">G</span><span class="main">.</span> odd <span class="main">(</span>degree <span class="bound">v</span> <span class="skolem">G</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">≠</span><span class="skolem">t2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹num_of_odd_nodes <span class="skolem">G</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def odd_nodes_set_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> that mem_Collect_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> even_except_two<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G</span><span class="main">⟹</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">n1</span> <span class="main">⟹</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">n2</span> <span class="main">⟹</span> even<span class="main">(</span>degree <span class="bound">n</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> nodes <span class="skolem">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">n1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">n2</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span> odd_nodes_set <span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> nodes <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹odd <span class="main">(</span>degree <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> mem_Collect_eq odd_nodes_set_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">∈</span> odd_nodes_set <span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> mem_Collect_eq n1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> odd_nodes_set_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">∈</span> odd_nodes_set <span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n2<span class="main">(</span>1<span class="main">)</span> n2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">n2</span><span class="main">}</span><span class="main">⊆</span> odd_nodes_set <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card<span class="main">{</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">n2</span><span class="main">}</span> <span class="main">≥</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span><span class="main">≠</span><span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≠</span><span class="skolem">n1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≠</span><span class="skolem">n2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>odd_nodes_set <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>odd_nodes_set <span class="skolem">G</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> card_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"odd_nodes_set <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹num_of_odd_nodes <span class="skolem">G</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="skolem">G</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="skolem">n1</span><span class="main">}</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> degree_def empty_iff finite.emptyI odd_card<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span><span class="skolem">n2</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>nodes <span class="skolem">G</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span>nodes <span class="skolem">G</span><span class="main">.</span><span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> odd <span class="main">(</span>degree <span class="bound">v</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∧</span> odd <span class="main">(</span>degree <span class="bound">v'</span> <span class="skolem">G</span><span class="main">)</span>  <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="bound">v'</span>
      <span class="main">∧</span> valid_unMultigraph.is_Eulerian_trail <span class="skolem">G</span> <span class="bound">v</span> <span class="bound">ps</span> <span class="bound">v'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span><span class="skolem">n2</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> conneted'<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">=</span> <span class="skolem">n2</span>›</span></span>
          <span class="quoted"><span class="quoted">‹num_of_odd_nodes <span class="skolem">G</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> del_UnEdge_odd_odd n1<span class="main">(</span>2<span class="main">)</span> n2<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">n2</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span><span class="main">}</span> <span class="main">⊂</span> edges <span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Diff_iff Diff_subset <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">=</span> <span class="skolem">n2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> psubset_card_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">n2</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> del_unEdge_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> del_UnEdge_node empty_iff n1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_unMultigraph.is_Eulerian_circuit
          <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="bound">v</span> <span class="bound">ps</span> <span class="bound">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less.hyps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"del_unEdge <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="skolem"><span class="skolem">G</span></span>"</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eulerian_cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">=</span> <span class="skolem">n2</span>›</span></span>  <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> del_UnEdge_node n1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
          valid_unMultigraph.eulerian_cons valid_unMultigraph.is_Eulerian_circuit_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span><span class="skolem">n2</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> not_conneted<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span>valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> valid0<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> del_unEdge_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> valid0'<span class="main">:</span><span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> all_even<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">.</span> even<span class="main">(</span>degree <span class="bound">n</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">n1</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">=</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> n1
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_unMultigraph.corres<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">n2</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">=</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> n2
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_unMultigraph.corres<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">n1</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">n2</span> <span class="main">⟹</span>
              even <span class="main">(</span>degree <span class="bound">n</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.degree_frame<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span><span class="main">,</span>
              <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">n1</span></span> <span class="quoted"><span class="skolem">n2</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> even_except_two
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> del_unEdge_def empty_iff insert_iff
              select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">=</span> <span class="skolem">n2</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n2</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> valid_unMultigraph.corres<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G1</span></span> <span class="skolem"><span class="skolem">G2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          G1_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">ps</span> <span class="skolem">n1</span><span class="main">}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> G1_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>
            <span class="main">∧</span> <span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span> <span class="main">∧</span> <span class="bound">n'</span><span class="main">∈</span>nodes <span class="skolem">G1</span><span class="main">}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> G2_nodes<span class="main">:</span><span class="quoted"><span class="quoted">"nodes <span class="skolem">G2</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">ps</span> <span class="skolem">n2</span><span class="main">}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> G2_edges<span class="main">:</span><span class="quoted"><span class="quoted">"edges <span class="skolem">G2</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span>
            <span class="main">∧</span> <span class="bound">n'</span><span class="main">∈</span>nodes <span class="skolem">G2</span><span class="main">}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> G1_G2_edges_union<span class="main">:</span><span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span> <span class="main">=</span> edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span> <span class="main">∩</span> edges <span class="skolem">G2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> G1_G2_nodes_union<span class="main">:</span><span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">∪</span> nodes <span class="skolem">G2</span><span class="main">=</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="skolem">G1</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="skolem">G2</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="skolem">G1</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="skolem">G2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.connectivity_split<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹valid_unMultigraph.connected <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">⊂</span> edges <span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n2</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>edges <span class="skolem">G1</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G1_G2_edges_union
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> inf_sup_absorb less_infI2 psubset_card_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="skolem">G1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> G1_G2_edges_union <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">⊂</span> edges <span class="skolem">G</span>›</span></span> finite_Un less_imp_le rev_finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">⊆</span> nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_nodes_union Un_upper1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="skolem">G1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span> del_UnEdge_node rev_finite_subset  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">∈</span> nodes <span class="skolem">G1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span><span class="main">∈</span>nodes <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="skolem">n1</span> <span class="main">[]</span> <span class="skolem">n1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> valid0' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_graph.is_path_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> G1_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="skolem">G1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="skolem">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G2</span>›</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span><span class="main">.</span> degree <span class="bound">n</span> <span class="skolem">G1</span> <span class="main">=</span> degree <span class="bound">n</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sub_graph_degree_frame<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G2</span></span> <span class="quoted"><span class="skolem">G1</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_edges_union <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span><span class="main">.</span> even<span class="main">(</span>degree <span class="bound">n</span> <span class="skolem">G1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_even
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_nodes_union Un_iff<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def odd_nodes_set_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> Collect_empty_eq card_eq_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>nodes <span class="skolem">G1</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_unMultigraph.is_Eulerian_circuit <span class="skolem">G1</span> <span class="bound">v</span> <span class="bound">ps</span> <span class="bound">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less.hyps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G1</span></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G1</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph.connected <span class="skolem">G1</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps1<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail <span class="skolem">G1</span> <span class="skolem">n1</span> <span class="skolem">ps1</span> <span class="skolem">n1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span><span class="main">∈</span>nodes <span class="skolem">G1</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G1</span>›</span></span> valid_unMultigraph.is_Eulerian_circuit_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>edges <span class="skolem">G2</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> G1_G2_edges_union <span class="quoted"><span class="quoted">‹edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">⊂</span> edges <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> inf_sup_ord<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> le_less_trans psubset_card_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="skolem">G2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> G1_G2_edges_union <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">⊂</span> edges <span class="skolem">G</span>›</span></span> finite_Un less_imp_le rev_finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G2</span> <span class="main">⊆</span> nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_nodes_union Un_upper2<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="skolem">G2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span>  del_UnEdge_node rev_finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">∈</span> nodes <span class="skolem">G2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n2</span><span class="main">∈</span>nodes <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="skolem">n2</span> <span class="main">[]</span> <span class="skolem">n2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> valid0' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_graph.is_path_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> G2_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="skolem">G1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G1</span>›</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span><span class="main">.</span> degree <span class="bound">n</span> <span class="skolem">G2</span> <span class="main">=</span> degree <span class="bound">n</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> sub_graph_degree_frame<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G1</span></span> <span class="quoted"><span class="skolem">G2</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_edges_union <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> inf_commute sup_commute<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span><span class="main">.</span> even<span class="main">(</span>degree <span class="bound">n</span> <span class="skolem">G2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_even
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_nodes_union Un_iff<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def odd_nodes_set_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> Collect_empty_eq card_eq_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>nodes <span class="skolem">G2</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_unMultigraph.is_Eulerian_circuit <span class="skolem">G2</span> <span class="bound">v</span> <span class="bound">ps</span> <span class="bound">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less.hyps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G2</span></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph.connected <span class="skolem">G2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps2<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail <span class="skolem">G2</span> <span class="skolem">n2</span> <span class="skolem">ps2</span> <span class="skolem">n2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n2</span><span class="main">∈</span>nodes <span class="skolem">G2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G2</span>›</span></span> valid_unMultigraph.is_Eulerian_circuit_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="skolem">G1</span> <span class="main">∪</span> nodes <span class="skolem">G2</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span><span class="main">,</span>
          <span class="main">(</span><span class="skolem">n2</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span><span class="main">=</span><span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">n2</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>edges <span class="skolem">G</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n2</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>   <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">=</span>nodes <span class="skolem">G</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">,</span> edges <span class="main">=</span>
              edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">n2</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span><span class="main">=</span><span class="skolem">G</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="skolem">G1</span> <span class="main">∪</span> nodes <span class="skolem">G2</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span> <span class="main">∪</span>
              <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">n2</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span><span class="main">=</span><span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span><span class="main">,</span>edges
              <span class="main">=</span> edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">n2</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">n2</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_edges_union G1_G2_nodes_union<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="skolem">G1</span> <span class="main">∪</span> nodes <span class="skolem">G2</span><span class="main">,</span>
          edges <span class="main">=</span> edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">n2</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="skolem">n1</span> <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ps2</span><span class="main">)</span> <span class="skolem">n2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eulerian_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G1</span></span> <span class="quoted"><span class="skolem">G2</span></span> <span class="quoted"><span class="skolem">n1</span></span> <span class="quoted"><span class="skolem">ps1</span></span> <span class="quoted"><span class="skolem">n1</span></span> <span class="quoted"><span class="skolem">n2</span></span> <span class="quoted"><span class="skolem">ps2</span></span> <span class="quoted"><span class="skolem">n2</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹edges <span class="skolem">G1</span> <span class="main">∩</span> edges <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G1</span>›</span></span>
          <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G2</span>›</span></span> ps1 ps2<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> n1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">≠</span><span class="skolem">n2</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>nodes <span class="skolem">G</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span>nodes <span class="skolem">G</span><span class="main">.</span><span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> odd <span class="main">(</span>degree <span class="bound">v</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∧</span> odd <span class="main">(</span>degree <span class="bound">v'</span> <span class="skolem">G</span><span class="main">)</span>
      <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="bound">v'</span> <span class="main">∧</span> valid_unMultigraph.is_Eulerian_trail <span class="skolem">G</span> <span class="bound">v</span> <span class="bound">ps</span> <span class="bound">v'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≠</span> <span class="skolem">n2</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> connected'<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">∈</span> nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_UnEdge_node n1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> even_n1<span class="main">:</span><span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">n1</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.del_UnEdge_even<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹odd <span class="main">(</span>degree <span class="skolem">n1</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> odd_n2<span class="main">:</span><span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">n2</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.degree_frame<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="main">,</span>
          <span class="operator">of</span> <span class="quoted"><span class="skolem">n2</span></span> <span class="quoted"><span class="skolem">n1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff insert_iff n2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> even_except_two<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_graph <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> valid_graph.E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_unMultigraph.no_id<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> odd_v'<span class="main">:</span><span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">v'</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.del_UnEdge_even'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> two_odds<span class="main">:</span><span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_graph <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹num_of_odd_nodes <span class="skolem">G</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span>
          del_UnEdge_odd_even even_except_two n1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_graph.E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> valid0<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> del_unEdge_valid <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" edges <span class="skolem">G</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span> <span class="main">⊂</span> edges <span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> psubset_card_mono select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> finite_Diff select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span> select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> del_UnEdge_node empty_iff n1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">s</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">t</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> s_ps_t<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="skolem">s</span> <span class="skolem">ps</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>   connected' less.hyps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>del_unEdge <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="skolem"><span class="skolem">G</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">=</span><span class="skolem">n2</span><span class="main">∧</span><span class="skolem">t</span><span class="main">=</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="skolem">s</span><span class="main">=</span><span class="skolem">v'</span><span class="main">∧</span><span class="skolem">t</span><span class="main">=</span><span class="skolem">n2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> odd_n2 odd_v' two_odds <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> del_UnEdge_node empty_iff even_except_two even_n1 insert_iff
          valid_unMultigraph.degree_frame<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">n2</span><span class="main">⟹</span><span class="skolem">t</span><span class="main">=</span><span class="skolem">v'</span><span class="main">⟹</span><span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> n1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
          s_ps_t valid0 valid_unMultigraph.euclerian_rev valid_unMultigraph.eulerian_cons<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">v'</span><span class="main">⟹</span><span class="skolem">t</span><span class="main">=</span><span class="skolem">n2</span><span class="main">⟹</span><span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> n1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
          s_ps_t valid_unMultigraph.eulerian_cons<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">≠</span><span class="skolem">n2</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> not_conneted<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span>valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>  valid_unMultigraph.corres<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> valid0<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> del_unEdge_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> valid0'<span class="main">:</span><span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> even_n1<span class="main">:</span><span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">n1</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.del_UnEdge_even<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="main">]</span> n1
        <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> odd_n2<span class="main">:</span><span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">n2</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> n2 valid_unMultigraph.degree_frame<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n2</span></span> <span class="quoted"><span class="skolem">n1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">≠</span><span class="skolem">n1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.no_id<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> odd_v'<span class="main">:</span><span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">v'</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span>   even_except_two<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
          valid_graph.E_validD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_graph <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span><span class="main">]</span>
          valid_unMultigraph.del_UnEdge_even'<span class="main">[</span><span class="operator">OF</span>  <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> even_except_two'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">⟹</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">n2</span>
          <span class="main">⟹</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v'</span><span class="main">⟹</span> even<span class="main">(</span>degree <span class="bound">n</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> del_UnEdge_node<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">n1</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">]</span> even_except_two valid_unMultigraph.degree_frame<span class="main">[</span><span class="operator">OF</span>
          <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">n1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G1</span></span> <span class="skolem"><span class="skolem">G2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          G1_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">ps</span> <span class="skolem">n1</span><span class="main">}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> G1_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span>
            <span class="main">∧</span> <span class="bound">n'</span><span class="main">∈</span>nodes <span class="skolem">G1</span><span class="main">}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> G2_nodes<span class="main">:</span><span class="quoted"><span class="quoted">"nodes <span class="skolem">G2</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">ps</span> <span class="skolem">v'</span><span class="main">}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> G2_edges<span class="main">:</span><span class="quoted"><span class="quoted">"edges <span class="skolem">G2</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span>
            <span class="main">∧</span> <span class="bound">n'</span><span class="main">∈</span>nodes <span class="skolem">G2</span><span class="main">}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> G1_G2_edges_union<span class="main">:</span><span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span> <span class="main">=</span> edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G1</span> <span class="main">∩</span> edges <span class="skolem">G2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> G1_G2_nodes_union<span class="main">:</span><span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">∪</span> nodes <span class="skolem">G2</span><span class="main">=</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="skolem">G1</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="skolem">G2</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="skolem">G1</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="skolem">G2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.connectivity_split<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹valid_unMultigraph.connected <span class="skolem">G</span>›</span></span> not_conneted <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> extend_distinct_path
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v'</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹num_of_odd_nodes <span class="skolem">G</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span>
              <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_graph <span class="skolem">G</span>›</span></span> del_UnEdge_even_odd delete_edge_sym even_except_two
              <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
              n1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_graph.E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_unMultigraph.no_id<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_unMultigraph.is_trail <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="skolem">n2</span> <span class="bound">ps</span> <span class="skolem">v'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.path_between_odds<span class="main">[</span><span class="operator">OF</span> valid0<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n2</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">,</span><span class="operator">OF</span> odd_n2 odd_v'<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span><span class="main">≠</span><span class="skolem">n2</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_graph.is_path <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="skolem">n2</span> <span class="bound">ps</span> <span class="skolem">v'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid0 valid_unMultigraph.is_trail_intro<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> G2_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="skolem">v'</span> <span class="main">[]</span> <span class="skolem">v'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_graph <span class="skolem">G</span>›</span></span> del_UnEdge_node
                valid0' valid_graph.E_validD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_graph.is_path_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> G2_nodes mem_Collect_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> edges_subset<span class="main">:</span><span class="quoted"><span class="quoted">"edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">⊂</span> edges <span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v'</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>edges <span class="skolem">G1</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_edges_union inf_sup_absorb <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span>  less_infI2 psubset_card_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="skolem">G1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> G1_G2_edges_union edges_subset finite_Un finite_subset
          <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span>  less_imp_le<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="skolem">G1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> G1_G2_nodes_union  <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> finite_Un select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">∈</span>nodes <span class="skolem">G1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph.is_path <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="skolem">n1</span> <span class="main">[]</span> <span class="skolem">n1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> del_UnEdge_node n1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid0' valid_graph.is_path_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> G1_nodes mem_Collect_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="skolem">G1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span><span class="main">.</span> even<span class="main">(</span>degree <span class="bound">n</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> even_except_two' odd_v' odd_n2 <span class="quoted"><span class="quoted">‹<span class="skolem">n2</span><span class="main">∈</span>nodes <span class="skolem">G2</span>›</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
              <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span><span class="main">∈</span>nodes <span class="skolem">G2</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> G1_G2_nodes_union Un_iff disjoint_iff_not_equal<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="skolem">G2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G2</span>›</span></span> valid_unMultigraph_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G1</span><span class="main">.</span> even<span class="main">(</span>degree <span class="bound">n</span> <span class="skolem">G1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> sub_graph_degree_frame<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G2</span></span> <span class="quoted"><span class="skolem">G1</span></span> <span class="quoted"><span class="quoted">"del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_edges_union <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def odd_nodes_set_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> card_eq_0_iff empty_Collect_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps1<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail <span class="skolem">G1</span> <span class="skolem">n1</span> <span class="skolem">ps1</span> <span class="skolem">n1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G1</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph.connected <span class="skolem">G1</span>›</span></span> less.hyps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G1</span></span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_unMultigraph.is_Eulerian_circuit_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>edges <span class="skolem">G2</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_edges_union <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> edges_subset inf_sup_absorb less_infI2
          psubset_card_mono sup_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="skolem">G2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> G1_G2_edges_union edges_subset finite_Un <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> less_le
          rev_finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="skolem">G2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> G1_G2_nodes_union del_UnEdge_node le_sup_iff <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span>
          rev_finite_subset subsetI<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span><span class="main">∈</span>nodes <span class="skolem">G2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span><span class="main">.</span> <span class="bound">n</span><span class="main">∉</span><span class="main">{</span><span class="skolem">n2</span><span class="main">,</span><span class="skolem">v'</span><span class="main">}</span><span class="main">⟶</span>even<span class="main">(</span>degree <span class="bound">n</span> <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> even_except_two'
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> G1_G2_nodes_union Un_iff insert_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="skolem">G1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G1</span>›</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span><span class="main">.</span> <span class="bound">n</span><span class="main">∉</span><span class="main">{</span><span class="skolem">n2</span><span class="main">,</span><span class="skolem">v'</span><span class="main">}</span><span class="main">⟶</span>even<span class="main">(</span>degree <span class="bound">n</span> <span class="skolem">G2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> sub_graph_degree_frame<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G1</span></span> <span class="quoted"><span class="skolem">G2</span></span> <span class="quoted"><span class="quoted">"del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_edges_union Int_commute Un_commute <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G2</span><span class="main">.</span> <span class="bound">n</span><span class="main">∉</span><span class="main">{</span><span class="skolem">n2</span><span class="main">,</span><span class="skolem">v'</span><span class="main">}</span><span class="main">⟶</span><span class="bound">n</span><span class="main">∉</span><span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> nodes <span class="skolem">G2</span><span class="main">.</span> odd <span class="main">(</span>degree <span class="bound">v</span> <span class="skolem">G2</span><span class="main">)</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">n2</span> <span class="skolem">G2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> sub_graph_degree_frame<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G1</span></span> <span class="quoted"><span class="skolem">G2</span></span> <span class="quoted"><span class="quoted">"del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> G1_G2_edges_union <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
              <span class="quoted"><span class="quoted">‹valid_graph <span class="skolem">G1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n2</span> <span class="main">∈</span> nodes <span class="skolem">G2</span>›</span></span> inf_assoc inf_bot_right inf_sup_absorb
               odd_n2 sup_bot_right sup_commute<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> nodes <span class="skolem">G2</span><span class="main">.</span> odd <span class="main">(</span>degree <span class="bound">v</span> <span class="skolem">G2</span><span class="main">)</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n2</span> <span class="main">∈</span> nodes <span class="skolem">G2</span>›</span></span> mem_Collect_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd<span class="main">(</span>degree <span class="skolem">v'</span> <span class="skolem">G2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> sub_graph_degree_frame<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G1</span></span> <span class="quoted"><span class="skolem">G2</span></span> <span class="quoted"><span class="quoted">"del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_edges_union Int_commute Un_commute <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
              <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">∈</span> nodes <span class="skolem">G2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_graph <span class="skolem">G1</span>›</span></span> odd_v'<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> nodes <span class="skolem">G2</span><span class="main">.</span> odd <span class="main">(</span>degree <span class="bound">v</span> <span class="skolem">G2</span><span class="main">)</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Collect_conj_eq Collect_mem_eq Int_Collect <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">∈</span> nodes <span class="skolem">G2</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> nodes <span class="skolem">G2</span><span class="main">.</span> odd <span class="main">(</span>degree <span class="bound">v</span> <span class="skolem">G2</span><span class="main">)</span><span class="main">}</span><span class="main">=</span><span class="main">{</span><span class="skolem">n2</span><span class="main">,</span><span class="skolem">v'</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">G2</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span><span class="main">≠</span><span class="skolem">n2</span>›</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">s</span> <span class="skolem">G2</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span>nodes <span class="skolem">G2</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">t</span> <span class="skolem">G2</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> s_ps2_t<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail <span class="skolem">G2</span> <span class="skolem">s</span> <span class="skolem">ps2</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G2</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph.connected <span class="skolem">G2</span>›</span></span> less.hyps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G2</span></span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="skolem">G1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G1</span>›</span></span> valid_unMultigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">=</span><span class="skolem">n2</span><span class="main">∧</span><span class="skolem">t</span><span class="main">=</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="skolem">s</span><span class="main">=</span><span class="skolem">v'</span><span class="main">∧</span><span class="skolem">t</span><span class="main">=</span><span class="skolem">n2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> odd_n2 odd_v' even_except_two'
          sub_graph_degree_frame<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G1</span></span> <span class="quoted"><span class="skolem">G2</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_edges_union G1_G2_nodes_union UnI1 <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> inf_commute
          sup.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> merge_G1_G2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="skolem">G1</span> <span class="main">∪</span> nodes <span class="skolem">G2</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span> <span class="main">∪</span>
          <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">v'</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span><span class="main">=</span><span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">v'</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>edges <span class="skolem">G</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v'</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">=</span>nodes <span class="skolem">G</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">,</span> edges <span class="main">=</span>
              edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span><span class="main">=</span><span class="skolem">G</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="skolem">G1</span> <span class="main">∪</span> nodes <span class="skolem">G2</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="skolem">G1</span> <span class="main">∪</span> edges <span class="skolem">G2</span> <span class="main">∪</span>
              <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">v'</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span><span class="main">=</span><span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">,</span>edges
              <span class="main">=</span> edges <span class="main">(</span>del_unEdge <span class="skolem">n1</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G1_G2_edges_union G1_G2_nodes_union<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">n2</span><span class="main">⟹</span><span class="skolem">t</span><span class="main">=</span><span class="skolem">v'</span><span class="main">⟹</span><span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eulerian_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G1</span></span> <span class="quoted"><span class="skolem">G2</span></span> <span class="quoted"><span class="skolem">n1</span></span> <span class="quoted"><span class="skolem">ps1</span></span> <span class="quoted"><span class="skolem">n1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev_path <span class="skolem">ps2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">n2</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> merge_G1_G2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹edges <span class="skolem">G1</span> <span class="main">∩</span> edges <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
            <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G1</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G2</span>›</span></span> n1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ps1 s_ps2_t
            valid_unMultigraph.euclerian_rev<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">v'</span><span class="main">⟹</span><span class="skolem">t</span><span class="main">=</span><span class="skolem">n2</span><span class="main">⟹</span><span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eulerian_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G1</span></span> <span class="quoted"><span class="skolem">G2</span></span> <span class="quoted"><span class="skolem">n1</span></span> <span class="quoted"><span class="skolem">ps1</span></span> <span class="quoted"><span class="skolem">n1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">ps2</span></span> <span class="quoted"><span class="skolem">n2</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> merge_G1_G2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹edges <span class="skolem">G1</span> <span class="main">∩</span> edges <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G1</span> <span class="main">∩</span> nodes <span class="skolem">G2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G1</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G2</span>›</span></span> n1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ps1 s_ps2_t<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>nodes <span class="skolem">G</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span>nodes <span class="skolem">G</span><span class="main">.</span><span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> odd <span class="main">(</span>degree <span class="bound">v</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∧</span> odd <span class="main">(</span>degree <span class="bound">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="bound">v'</span>
      <span class="main">∧</span> valid_unMultigraph.is_Eulerian_trail <span class="skolem">G</span> <span class="bound">v</span> <span class="bound">ps</span> <span class="bound">v'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="skolem">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>nodes <span class="skolem">G</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_unMultigraph.is_Eulerian_circuit <span class="skolem">G</span> <span class="bound">v</span> <span class="bound">ps</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span><span class="main">=</span><span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>nodes <span class="skolem">G</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" card <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G</span><span class="main">=</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> nodes <span class="skolem">G</span>›</span></span>  card_Suc_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nodes <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> empty_iff insert_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G</span><span class="main">=</span><span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"edges <span class="skolem">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">e3</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span><span class="skolem">e2</span><span class="main">,</span><span class="skolem">e3</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ex_in_conv prod_cases3<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span><span class="main">=</span><span class="skolem">e3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G</span><span class="main">=</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> append_Nil2 valid_unMultigraph.is_trail_rev
                valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> singletonE
                valid_unMultigraph.is_trail_split valid_unMultigraph.singleton_distinct_path<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> valid_unMultigraph.no_id<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_circuit <span class="skolem">G</span> <span class="skolem">v</span> <span class="main">[]</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span>›</span></span> insert_subset <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> rem_unPath.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
            subsetI valid_unMultigraph.is_trail.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
            valid_unMultigraph.is_Eulerian_circuit_def
            valid_unMultigraph.is_Eulerian_trail_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_unMultigraph.is_Eulerian_circuit <span class="skolem">G</span> <span class="skolem">v</span> <span class="bound">ps</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>nodes <span class="skolem">G</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="skolem">G</span><span class="main">≠</span><span class="main">{}</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_eq_0_iff <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span> <span class="main">≥</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_add add_2_eq_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G</span><span class="main">.</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> card_eq_SucD<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> pre<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span> <span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="skolem">G</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span>  ps<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> valid_graph.is_path <span class="skolem">G</span> <span class="skolem">v</span> <span class="skolem">ps</span> <span class="bound">v'</span> <span class="main">∧</span> <span class="skolem">ps</span><span class="main">≠</span>Nil"</span></span>
            <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> nodes <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
              <span class="quoted"><span class="quoted">‹valid_unMultigraph.connected <span class="skolem">G</span>›</span></span> valid_unMultigraph.connected_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v0</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ps</span><span class="main">=</span>Cons <span class="main">(</span><span class="skolem">v0</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span> <span class="bound">ps'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neq_Nil_conv prod_cases3<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span><span class="main">=</span><span class="skolem">v</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> ps valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ps</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v0</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">#</span> <span class="bound">ps'</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> ps
              valid_graph.is_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pre<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> all_even<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>nodes <span class="skolem">G</span><span class="main">.</span> even<span class="main">(</span>degree <span class="bound">x</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹num_of_odd_nodes <span class="skolem">G</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> num_of_odd_nodes_def odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> odd_v<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">v</span> <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> nodes <span class="skolem">G</span>›</span></span> all_even valid_unMultigraph.del_UnEdge_even<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> odd_nodes_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> odd_v'<span class="main">:</span>  <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">v'</span> <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph.del_UnEdge_even'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span><span class="main">]</span>
            all_even  valid_graph.E_validD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span><span class="main">]</span>
            <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> valid_unMultigraph_def odd_nodes_set_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> valid_unMulti<span class="main">:</span><span class="quoted"><span class="quoted">"valid_unMultigraph <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> del_unEdge_valid <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> valid_graph<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_unMultigraph_def del_undirected
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> delete_edge_valid<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> fin_E'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>edges <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite<span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> fin_V'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite<span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> less_card<span class="main">:</span><span class="quoted"><span class="quoted">"card<span class="main">(</span>edges <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span><span class="main">&lt;</span>card<span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> del_unEdge_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_insert2 card_Diff2_less <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
          select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_unMultigraph.corres<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_of_odd_nodes <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹num_of_odd_nodes <span class="skolem">G</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> nodes <span class="skolem">G</span>›</span></span> all_even
          del_UnEdge_even_even<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>  <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span><span class="main">]</span> valid_graph.E_validD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span>  valid_unMultigraph_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_unMultigraph.connected <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
          <span class="quoted"><span class="quoted">‹valid_unMultigraph.connected <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> all_even valid_unMultigraph.del_unEdge_even_connectivity<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes<span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> nodes <span class="skolem">G</span>›</span></span> del_UnEdge_node emptyE<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          n1_n2<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">n2</span><span class="main">∈</span>nodes <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">n1</span> <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="skolem">n2</span> <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">≠</span><span class="skolem">n2</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>
          ps_eulerian<span class="main">:</span>
          <span class="quoted"><span class="quoted">"valid_unMultigraph.is_Eulerian_trail <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="skolem">n1</span> <span class="skolem">ps</span> <span class="skolem">n2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹num_of_odd_nodes <span class="main">(</span>del_unEdge <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">v'</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> less.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">=</span><span class="skolem">v</span><span class="main">⟹</span><span class="skolem">n2</span><span class="main">=</span><span class="skolem">v'</span><span class="main">⟹</span>valid_unMultigraph.is_Eulerian_circuit <span class="skolem">G</span> <span class="skolem">v</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="skolem">v'</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ps_eulerian
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> delete_edge_sym <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span>
          valid_unMultigraph.corres valid_unMultigraph.eulerian_cons'
          valid_unMultigraph.is_Eulerian_circuit_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">=</span><span class="skolem">v'</span><span class="main">⟹</span><span class="skolem">n2</span><span class="main">=</span><span class="skolem">v</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_unMultigraph.is_Eulerian_circuit <span class="skolem">G</span> <span class="skolem">v</span> <span class="bound">ps</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> edges <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> ps_eulerian
          valid_unMultigraph.eulerian_cons valid_unMultigraph.is_Eulerian_circuit_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n1</span><span class="main">=</span><span class="skolem">v</span><span class="main">∧</span><span class="skolem">n2</span><span class="main">=</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="skolem">n2</span><span class="main">=</span><span class="skolem">v</span><span class="main">∧</span><span class="skolem">n1</span><span class="main">=</span><span class="skolem">v'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> all_even del_UnEdge_node insert_iff <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹valid_unMultigraph <span class="skolem">G</span>›</span></span> n1_n2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n1_n2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> n1_n2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> n1_n2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> n1_n2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> singletonE
          valid_unMultigraph.degree_frame<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> valid_unMultigraph.is_Eulerian_circuit <span class="skolem">G</span> <span class="skolem">v</span> <span class="bound">ps</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FriendshipTheory">
<div class="head">
<h1>Theory FriendshipTheory</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: FriendshipTheory.thy
Author:Wenda Li
*)</span>

<span class="keyword1"><span class="command">theory</span></span> FriendshipTheory 
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#MoreGraph">MoreGraph</a>  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*Proofs in this section are the common steps for both combinatorial and algebraic proofs for the
Friendship Theorem*)</span>
<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Common steps›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> <span class="entity">non_adj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">non_adj</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">∈</span>V <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">∈</span>V <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">∧</span> <span class="main">¬</span>adjacent <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> no_quad<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">u</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">v</span><span class="main">≠</span><span class="bound">u</span> <span class="main">⟹</span> <span class="main">∃!</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="bound">v</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="bound">u</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v1</span> <span class="bound">v2</span> <span class="bound">v3</span> <span class="bound">v4</span><span class="main">.</span> <span class="bound">v2</span><span class="main">≠</span><span class="bound">v4</span> <span class="main">∧</span> <span class="bound">v1</span><span class="main">≠</span><span class="bound">v3</span> <span class="main">∧</span> adjacent <span class="bound">v1</span> <span class="bound">v2</span> <span class="main">∧</span> adjacent <span class="bound">v2</span> <span class="bound">v3</span> <span class="main">∧</span> adjacent <span class="bound">v3</span> <span class="bound">v4</span> 
      <span class="main">∧</span> adjacent <span class="bound">v4</span> <span class="bound">v1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v1</span> <span class="bound">v2</span> <span class="bound">v3</span> <span class="bound">v4</span><span class="main">.</span> <span class="bound">v2</span><span class="main">≠</span><span class="bound">v4</span>  <span class="main">∧</span> <span class="bound">v1</span><span class="main">≠</span><span class="bound">v3</span> <span class="main">∧</span> adjacent <span class="bound">v1</span> <span class="bound">v2</span> <span class="main">∧</span> adjacent <span class="bound">v2</span> <span class="bound">v3</span> <span class="main">∧</span> adjacent <span class="bound">v3</span> <span class="bound">v4</span> <span class="main">∧</span> adjacent <span class="bound">v4</span> <span class="bound">v1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="skolem"><span class="skolem">v4</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">≠</span><span class="skolem">v4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v3</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">v2</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">v3</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v3</span> <span class="skolem">v4</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v4</span> <span class="skolem">v1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="skolem">v3</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span> <span class="quoted"><span class="skolem">v3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v1</span> <span class="skolem">v2</span>›</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v2</span> <span class="skolem">v3</span>›</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v3</span> <span class="skolem">v4</span>›</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v4</span> <span class="skolem">v1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="skolem">v4</span>›</span></span> 
      adjacent_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="FriendshipTheory-even_card_set"><span class="command">lemma</span></span> even_card_set<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span><span class="main">≠</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">=</span><span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>card <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span>"</span></span>  <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">=</span><span class="main">{}</span><span class="main">⟹</span><span class="var">?case</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">≠</span><span class="main">{}</span><span class="main">⟹</span><span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span><span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">=</span><span class="skolem">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="free">f</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span><span class="main">&lt;</span>card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_insert <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> card_Diff2_less<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">B</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span><span class="main">≠</span><span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span><span class="main">∈</span><span class="skolem">B</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span><span class="main">∉</span><span class="skolem">B</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span><span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> less.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span><span class="main">∈</span><span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B DiffI <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">y</span> <span class="main">∉</span> <span class="skolem">B</span>›</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span><span class="main">=</span><span class="skolem">x</span> <span class="main">⟹</span> False"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B Diff_iff Diff_insert2 <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">B</span>›</span></span> singleton_iff<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span><span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">⟹</span> False"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B Diff_iff <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">B</span>›</span></span> insertCI less.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>card <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> less.hyps<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="free">f</span> <span class="skolem">x</span><span class="main">}</span><span class="main">⊆</span><span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">x</span><span class="main">∈</span><span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> card_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Diff_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> even_degree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> friend_assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">u</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">v</span><span class="main">≠</span><span class="bound">u</span> <span class="main">⟹</span> <span class="main">∃!</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="bound">v</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="bound">u</span> <span class="bound">n</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> even<span class="main">(</span>degree <span class="bound">v</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>V"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">⟶</span><span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span><span class="main">⟶</span>adjacent <span class="bound">n</span> <span class="bound">v'</span> <span class="main">∧</span> adjacent <span class="skolem">v</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span>  <span class="bound">n</span><span class="main">∈</span>V <span class="main">⟶</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> adjacent <span class="bound">n</span> <span class="bound">v'</span> <span class="main">∧</span> adjacent <span class="skolem">v</span> <span class="bound">v'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">v'</span><span class="main">.</span> adjacent <span class="skolem">n</span> <span class="bound">v'</span> <span class="main">∧</span> adjacent <span class="skolem">v</span> <span class="bound">v'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">∈</span>V›</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> non_adj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> adjacent <span class="skolem">n</span> <span class="bound">v'</span> <span class="main">∧</span> adjacent <span class="skolem">v</span> <span class="bound">v'</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> f_ex<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">⟶</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span> <span class="main">⟶</span>  adjacent <span class="bound">n</span> <span class="bound">v'</span> <span class="main">∧</span> adjacent <span class="skolem">v</span> <span class="bound">v'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">≠</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">=</span><span class="bound">x</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> f_ex<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v</span> <span class="skolem">x</span>›</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> adjacent_no_loop f mem_Collect_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> f_ex<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v</span> <span class="skolem">x</span>›</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> adjacent_no_loop f<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">=</span><span class="skolem">x</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">≠</span><span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>  
            <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> f_ex<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> adjacent_no_loop calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> f mem_Collect_eq<span class="main">)</span> 
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> f_ex<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adjacent_V<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> adjacent_sym calculation f<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">x</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> f_ex<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v</span> <span class="skolem">x</span>›</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> adjacent_no_loop f<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="skolem">f</span> <span class="skolem">x</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>›</span></span> adjacent_no_loop mem_Collect_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
            <span class="keyword1"><span class="command">using</span></span> no_quad<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">≠</span><span class="skolem">x</span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adjacent_finite assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> even_card_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>degree <span class="skolem">v</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> degree_adjacent<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> degree_two_windmill<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> friend_assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">u</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">v</span><span class="main">≠</span><span class="bound">u</span> <span class="main">⟹</span> <span class="main">∃!</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="bound">v</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="bound">u</span> <span class="bound">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">≥</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">⟷</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">n</span><span class="main">≠</span><span class="bound">v</span> <span class="main">⟶</span> adjacent <span class="bound">v</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span> "</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">v</span> <span class="free">G</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_adjacent<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> v1v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span> <span class="main">=</span> insert <span class="skolem">v1</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="numeral">2</span>›</span></span> card_Suc_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span>insert <span class="skolem">v2</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> card_Suc_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span> <span class="main">=</span> insert <span class="skolem">v1</span> <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">∉</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span> <span class="quoted"><span class="skolem">v2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">v2</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">v1</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> adjacent_sym insertI1 mem_Collect_eq v1v2<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v1</span> <span class="skolem">n</span>›</span></span> adjacent_no_loop<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v1v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v1</span> <span class="skolem">n</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> v1v2_adj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>V"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">v</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff adjacent_sym insertI1 mem_Collect_eq v1v2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">v</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">v</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_empty_eq <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> V›</span></span> adjacent_V<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> all_not_in_conv insertCI v1v2<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="skolem">v1</span> <span class="main">∨</span> <span class="skolem">y</span><span class="main">=</span><span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v1v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnI1 UnI2 adjacent_sym mem_Collect_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">v2</span><span class="main">,</span><span class="skolem">v</span><span class="main">}</span><span class="main">=</span><span class="main">{}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⟶</span> adjacent <span class="bound">v</span> <span class="bound">n</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">v2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> v1_adj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v2</span><span class="main">,</span> <span class="skolem">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">v</span>"</span></span><span class="main">)</span> 
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True adjacent_sym insertI1 insert_commute mem_Collect_eq v1v2<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∉</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffI False <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">v2</span>›</span></span> empty_iff insert_iff v1_adj<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> V›</span></span> v1v2_adj<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v</span><span class="main">}</span><span class="main">=</span><span class="main">{}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⟶</span> adjacent <span class="bound">v</span> <span class="bound">n</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">v1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> v2_adj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">v</span>"</span></span><span class="main">)</span> 
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True adjacent_sym insertI1 mem_Collect_eq v1v2<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∉</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffI False <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">v1</span>›</span></span> empty_iff insert_iff v2_adj<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> V›</span></span> v1v2_adj<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">v2</span><span class="main">,</span><span class="skolem">v</span><span class="main">}</span><span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v</span><span class="main">}</span><span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span>False"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v2</span><span class="main">,</span> <span class="skolem">v</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v2</span><span class="main">,</span> <span class="skolem">v</span><span class="main">}</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span> <span class="main">⟹</span> False"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">a</span> <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span>›</span></span> adjacent_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD2 <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> b doubleton_eq_iff insertI1<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">v</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> adjacent_sym inf_sup_aci<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> insertI1 insert_is_Un mem_Collect_eq 
              v1v2<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v</span> <span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> insertI1 mem_Collect_eq v1v2<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_quad<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">]</span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span><span class="main">⟹</span>False"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD1 adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD1 adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">a</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">b</span> <span class="skolem">c</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> v1v2_adj<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">⟹</span> False"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">c</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">b</span> <span class="skolem">c</span>›</span></span> adjacent_sym<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">b</span> <span class="skolem">v2</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Diff_iff adjacent_sym b mem_Collect_eq<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v1</span> <span class="skolem">v2</span>›</span></span> adjacent_sym<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">v2</span>"</span></span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">a</span> <span class="skolem">c</span>›</span></span> adjacent_sym<span class="main">)</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">v</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adjacent_sym insert_iff mem_Collect_eq v1v2<span class="main">)</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">v</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> adjacent_sym v1v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Diff_iff a mem_Collect_eq<span class="main">)</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span> <span class="quoted"><span class="skolem">v2</span></span><span class="main">]</span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v2</span>›</span></span> adjacent_V<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD2 b insertI1<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_quad<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span> <span class="main">⟹</span> False"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">c</span> <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adjacent_sym mem_Collect_eq<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">a</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">a</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Diff_iff a mem_Collect_eq<span class="main">)</span> 
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v1</span> <span class="skolem">v2</span>›</span></span> adjacent_sym<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="skolem">v1</span>"</span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">v1</span>"</span></span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">b</span> <span class="skolem">c</span>›</span></span> adjacent_sym<span class="main">)</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">v</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adjacent_sym insert_iff mem_Collect_eq v1v2<span class="main">)</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">v</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> adjacent_sym v1v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff b mem_Collect_eq<span class="main">)</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span> <span class="quoted"><span class="skolem">v2</span></span><span class="main">]</span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v2</span>›</span></span> adjacent_V<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD2 a insertI1<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_quad<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⟶</span> adjacent <span class="bound">v</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⟶</span> adjacent <span class="bound">v</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">v</span> <span class="main">⟶</span> adjacent <span class="skolem">v</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>V"</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"V<span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span><span class="main">≤</span>card V›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"V <span class="main">=</span> insert <span class="skolem">v</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  mk_disjoint_insert<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span><span class="main">≤</span>card V›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_leE card.infinite not_one_le_zero numeral_Bit0 numeral_One<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">≤</span>card <span class="skolem">S</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span><span class="main">≤</span>card V›</span></span>  card.insert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>  finite_insert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">∈</span><span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">∉</span><span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span><span class="main">∈</span><span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹V<span class="main">=</span>insert <span class="skolem">v</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adjacent_V<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">v2</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v</span> <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">v1</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">∈</span> V›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">v1</span> <span class="free">G</span><span class="main">≠</span><span class="numeral">2</span> <span class="main">⟹</span> False"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">v1</span> <span class="free">G</span><span class="main">≠</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span><span class="main">≠</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> degree_adjacent<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">v2</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹ adjacent <span class="skolem">v1</span> <span class="skolem">v2</span> ›</span></span> <span class="quoted"><span class="quoted">‹ <span class="skolem">v1</span> <span class="main">∈</span> V ›</span></span> <span class="quoted"><span class="quoted">‹ <span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v</span> ›</span></span> adjacent_sym bot_least insert_subset 
          mem_Collect_eq v<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v</span> <span class="skolem">v2</span>›</span></span> adjacent_no_loop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">v2</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">≥</span><span class="numeral">2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> adjacent_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">≥</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span><span class="main">≠</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">∉</span><span class="main">{</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">v2</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">v2</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">≠</span> <span class="numeral">2</span>›</span></span> subsetI subset_antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">v3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v3</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v3</span> <span class="main">∉</span> <span class="main">{</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">}</span>›</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> adjacent_sym calculation insertCI<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v</span> <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v</span> <span class="skolem">v2</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v1</span> <span class="skolem">v2</span>›</span></span> adjacent_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v3</span> <span class="main">∉</span> <span class="main">{</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">}</span>›</span></span> insert_subset subset_insertI<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_quad<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span><span class="main">∈</span>V›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> regular<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> friend_assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">u</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">v</span><span class="main">≠</span><span class="bound">u</span> <span class="main">⟹</span> <span class="main">∃!</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="bound">v</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="bound">u</span> <span class="bound">n</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="bound">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"non_adj <span class="skolem">v</span> <span class="skolem">u</span>"</span></span>  
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v_adj</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_adj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v_adj</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u_adj</span></span> <span class="keyword2"><span class="keyword">where</span></span> u_adj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u_adj</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">u</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">⟶</span><span class="bound">n</span><span class="main">≠</span><span class="skolem">u</span><span class="main">⟶</span>adjacent <span class="bound">n</span> <span class="bound">v'</span> <span class="main">∧</span> adjacent <span class="skolem">u</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span>  <span class="bound">n</span><span class="main">∈</span>V <span class="main">⟶</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">u</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> adjacent <span class="bound">n</span> <span class="bound">v'</span> <span class="main">∧</span> adjacent <span class="skolem">u</span> <span class="bound">v'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> 
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">v'</span><span class="main">.</span> adjacent <span class="skolem">n</span> <span class="bound">v'</span> <span class="main">∧</span> adjacent <span class="skolem">u</span> <span class="bound">v'</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">v</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> non_adj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> adjacent <span class="skolem">n</span> <span class="bound">v'</span> <span class="main">∧</span> adjacent <span class="skolem">u</span> <span class="bound">v'</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> f_ex<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">⟶</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">u</span> <span class="main">⟶</span>  adjacent <span class="bound">n</span> <span class="bound">v'</span> <span class="main">∧</span> adjacent <span class="skolem">u</span> <span class="bound">v'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v_adj_u</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_adj_u<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v_adj_u</span><span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> <span class="skolem">v_adj</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">u_adj</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u_adj adjacent_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">v_adj</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v_adj adjacent_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">v_adj_u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v_adj_u adjacent_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="skolem">v_adj</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">v_adj</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">v_adj</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">v_adj</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">v_adj</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">f</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">v_adj</span>›</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mem_Collect_eq v_adj<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">v</span> <span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">v_adj</span>›</span></span> mem_Collect_eq non_adj_def v_adj<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">x</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> f_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> adjacent_sym <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">v</span> <span class="skolem">u</span>›</span></span> non_adj_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">v_adj</span>›</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mem_Collect_eq v_adj<span class="main">)</span> 
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≠</span><span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">v</span> <span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">v_adj</span>›</span></span> mem_Collect_eq non_adj_def v_adj<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">y</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> f_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∧</span> adjacent <span class="skolem">v</span> <span class="skolem">x</span> <span class="main">∧</span> adjacent <span class="skolem">x</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> adjacent <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">y</span> 
            <span class="main">∧</span> adjacent <span class="skolem">y</span> <span class="skolem">v</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">v_adj</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="skolem">v_adj</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">f</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≠</span><span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">x</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>›</span></span> v_adj adjacent_sym <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_quad<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">v_adj</span> <span class="main">=</span>card <span class="skolem">v_adj_u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_image v_adj_u<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v_adj_u</span> <span class="main">⊆</span> <span class="skolem">u_adj</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">v_adj_u</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">v_adj</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">v'</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">∈</span> V <span class="main">⟶</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">u</span> <span class="main">⟶</span> adjacent <span class="skolem">y</span> <span class="bound">v'</span> <span class="main">∧</span> adjacent <span class="skolem">u</span> <span class="bound">v'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f image_def v_adj_u <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> V <span class="main">⟶</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">u</span> <span class="main">⟶</span> adjacent <span class="skolem">y</span> <span class="skolem">x</span> <span class="main">∧</span> adjacent <span class="skolem">u</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> f_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">v_adj</span>›</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mem_Collect_eq v_adj<span class="main">)</span> 
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≠</span><span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">v</span> <span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">v_adj</span>›</span></span> mem_Collect_eq non_adj_def v_adj<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">u</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">u_adj</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_adj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">v_adj</span><span class="main">=</span>degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_adjacent<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> v_adj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">u_adj</span><span class="main">=</span>degree <span class="skolem">u</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_adjacent<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> u_adj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">v</span> <span class="free">G</span> <span class="main">≤</span> degree <span class="skolem">u</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">u_adj</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">f</span> <span class="skolem">v_adj</span>›</span></span> card_inj_on_le v_adj_u<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> non_adj_degree<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> non_adj <span class="bound">v</span> <span class="bound">u</span> <span class="main">⟹</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> degree <span class="bound">u</span> <span class="free">G</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adjacent_sym antisym non_adj_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="numeral">3</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="numeral">3</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">,</span><span class="skolem">v3</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">≠</span><span class="skolem">v3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v3</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">S1</span></span> <span class="keyword2"><span class="keyword">where</span></span> VS1<span class="main">:</span><span class="quoted"><span class="quoted">"V <span class="main">=</span> insert <span class="skolem">v1</span> <span class="skolem">S1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">∉</span> <span class="skolem">S1</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">S1</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> card_Suc_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted">V</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹card V<span class="main">=</span><span class="numeral">3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">S2</span></span> <span class="keyword2"><span class="keyword">where</span></span> S1S2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">S1</span> <span class="main">=</span> insert <span class="skolem">v2</span> <span class="skolem">S2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">∉</span> <span class="skolem">S2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">S2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> card_Suc_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S1</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S2</span><span class="main">=</span><span class="main">{</span><span class="skolem">v3</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> card_Suc_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S2</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">,</span><span class="skolem">v3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> VS1 S1S2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">≠</span><span class="skolem">v3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v3</span>"</span></span><span class="keyword1"><span class="command">using</span></span> VS1 S1S2 <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span><span class="main">∉</span><span class="skolem">S1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span><span class="main">∉</span><span class="skolem">S2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S2</span><span class="main">=</span><span class="main">{</span><span class="skolem">v3</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">n</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span> <span class="quoted"><span class="skolem">v2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹V <span class="main">=</span> <span class="main">{</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">,</span> <span class="skolem">v3</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v2</span>›</span></span> insertI1 insertI2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">v3</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹V <span class="main">=</span> <span class="main">{</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">,</span> <span class="skolem">v3</span><span class="main">}</span>›</span></span> adjacent_V<span class="main">(</span>2<span class="main">)</span> adjacent_no_loop 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> empty_iff insertE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v3</span> <span class="skolem">n'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v2</span></span> <span class="quoted"><span class="skolem">v3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹V <span class="main">=</span> <span class="main">{</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">,</span> <span class="skolem">v3</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="skolem">v3</span>›</span></span> insertI1 insertI2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">=</span><span class="skolem">v1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹V <span class="main">=</span> <span class="main">{</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">,</span> <span class="skolem">v3</span><span class="main">}</span>›</span></span> adjacent_V<span class="main">(</span>2<span class="main">)</span> adjacent_no_loop
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> empty_iff insertE<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">v2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">v3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v3</span> <span class="skolem">v1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> adjacent_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">v1</span> <span class="free">G</span><span class="main">=</span><span class="numeral">2</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">∉</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v1</span> <span class="skolem">v2</span>›</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v3</span> <span class="skolem">v1</span>›</span></span> adjacent_sym 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> adjacent_no_loop<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="main">{</span><span class="skolem">v2</span><span class="main">,</span><span class="skolem">v3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">,</span><span class="skolem">v3</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> degree_adjacent<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span><span class="main">≠</span><span class="skolem">v3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">v2</span> <span class="free">G</span><span class="main">=</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">∉</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v1</span> <span class="skolem">v2</span>›</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v2</span> <span class="skolem">v3</span>›</span></span> adjacent_sym 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> adjacent_no_loop<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">,</span><span class="skolem">v3</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> degree_adjacent<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v2</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">v3</span> <span class="free">G</span><span class="main">=</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v3</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v3</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">∉</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v3</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v3</span> <span class="skolem">v1</span>›</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v2</span> <span class="skolem">v3</span>›</span></span> adjacent_sym 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> adjacent_no_loop<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v3</span> <span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">,</span><span class="skolem">v3</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> degree_adjacent<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v3</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">,</span><span class="skolem">v3</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="numeral">2</span> <span class="main">⟹</span> False"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="numeral">2</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">S1</span></span> <span class="keyword2"><span class="keyword">where</span></span> VS1<span class="main">:</span><span class="quoted"><span class="quoted">"V <span class="main">=</span> insert <span class="skolem">v1</span> <span class="skolem">S1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">∉</span> <span class="skolem">S1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">S1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> card_Suc_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted">V</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹card V<span class="main">=</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S1</span><span class="main">=</span><span class="main">{</span><span class="skolem">v2</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> card_Suc_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> VS1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span><span class="main">∉</span><span class="skolem">S1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S1</span><span class="main">=</span><span class="main">{</span><span class="skolem">v2</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">v3</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">v3</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span> <span class="quoted"><span class="skolem">v2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">≠</span><span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adjacent_no_loop<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">∉</span>V"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">v1</span> <span class="skolem">v3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="main">1</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_eq_SucD<span class="main">[</span><span class="operator">of</span> <span class="quoted">V</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"E<span class="main">=</span><span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"E<span class="main">≠</span><span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">)</span><span class="main">∈</span>E"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="skolem">v1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span><span class="main">=</span><span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">}</span>›</span></span> E_validD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_id x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">v1</span> <span class="free">G</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹V<span class="main">=</span><span class="main">{</span><span class="skolem">v1</span><span class="main">}</span>›</span></span><span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"V<span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card V <span class="main">≥</span><span class="numeral">4</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> non_adj <span class="bound">v</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> non_adj <span class="bound">v</span> <span class="bound">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">≥</span><span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> non_non_adj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">v</span><span class="main">∉</span>V <span class="main">∨</span> <span class="bound">u</span><span class="main">∉</span>V <span class="main">∨</span> <span class="bound">v</span><span class="main">=</span><span class="bound">u</span> <span class="main">∨</span> adjacent <span class="bound">v</span> <span class="bound">u</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> non_adj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="skolem"><span class="skolem">v4</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v4</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v4</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">≠</span><span class="skolem">v3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">≠</span><span class="skolem">v4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">≠</span><span class="skolem">v4</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"V <span class="main">=</span> insert <span class="skolem">v1</span> <span class="skolem">B1</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">∉</span> <span class="skolem">B1</span>"</span></span>  <span class="quoted"><span class="quoted">"card <span class="skolem">B1</span> <span class="main">≥</span><span class="numeral">3</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card V<span class="main">≥</span><span class="numeral">4</span>›</span></span> card_le_Suc_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted">V</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B1</span> <span class="main">=</span> insert <span class="skolem">v2</span> <span class="skolem">B2</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">∉</span> <span class="skolem">B2</span>"</span></span>  <span class="quoted"><span class="quoted">"card <span class="skolem">B2</span> <span class="main">≥</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> card_le_Suc_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="skolem">B1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="skolem"><span class="skolem">B3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B2</span><span class="main">=</span> insert <span class="skolem">v3</span> <span class="skolem">B3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">∉</span><span class="skolem">B3</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B3</span><span class="main">≥</span><span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> card_le_Suc_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">B2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v4</span></span> <span class="skolem"><span class="skolem">B4</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B3</span><span class="main">=</span>insert <span class="skolem">v4</span> <span class="skolem">B4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v4</span><span class="main">∉</span><span class="skolem">B4</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> card_le_Suc_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">B3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹V <span class="main">=</span> insert <span class="skolem">v1</span> <span class="skolem">B1</span>›</span></span> insert_subset order_refl<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">∈</span>V"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B1</span> <span class="main">=</span> insert <span class="skolem">v2</span> <span class="skolem">B2</span>›</span></span> <span class="quoted"><span class="quoted">‹V <span class="main">=</span> insert <span class="skolem">v1</span> <span class="skolem">B1</span>›</span></span> insert_subset subset_insertI<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">∈</span>V"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B1</span> <span class="main">=</span> insert <span class="skolem">v2</span> <span class="skolem">B2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B2</span> <span class="main">=</span> insert <span class="skolem">v3</span> <span class="skolem">B3</span>›</span></span> <span class="quoted"><span class="quoted">‹V <span class="main">=</span> insert <span class="skolem">v1</span> <span class="skolem">B1</span>›</span></span> insert_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v4</span><span class="main">∈</span>V"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B1</span> <span class="main">=</span> insert <span class="skolem">v2</span> <span class="skolem">B2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B2</span> <span class="main">=</span> insert <span class="skolem">v3</span> <span class="skolem">B3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B3</span> <span class="main">=</span> insert <span class="skolem">v4</span> <span class="skolem">B4</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹V <span class="main">=</span> insert <span class="skolem">v1</span> <span class="skolem">B1</span>›</span></span> insert_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B1</span> <span class="main">=</span> insert <span class="skolem">v2</span> <span class="skolem">B2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">∉</span> <span class="skolem">B1</span>›</span></span> insertI1<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v3</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B1</span> <span class="main">=</span> insert <span class="skolem">v2</span> <span class="skolem">B2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B2</span> <span class="main">=</span> insert <span class="skolem">v3</span> <span class="skolem">B3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">∉</span> <span class="skolem">B1</span>›</span></span> insert_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v4</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B1</span> <span class="main">=</span> insert <span class="skolem">v2</span> <span class="skolem">B2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B2</span> <span class="main">=</span> insert <span class="skolem">v3</span> <span class="skolem">B3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B3</span> <span class="main">=</span> insert <span class="skolem">v4</span> <span class="skolem">B4</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">∉</span> <span class="skolem">B1</span>›</span></span> 
              insert_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">≠</span><span class="skolem">v3</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B2</span> <span class="main">=</span> insert <span class="skolem">v3</span> <span class="skolem">B3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">∉</span> <span class="skolem">B2</span>›</span></span> insertI1<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">≠</span><span class="skolem">v4</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B2</span> <span class="main">=</span> insert <span class="skolem">v3</span> <span class="skolem">B3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B3</span> <span class="main">=</span> insert <span class="skolem">v4</span> <span class="skolem">B4</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">∉</span> <span class="skolem">B2</span>›</span></span> insert_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">≠</span><span class="skolem">v4</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B3</span> <span class="main">=</span> insert <span class="skolem">v4</span> <span class="skolem">B4</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v3</span> <span class="main">∉</span> <span class="skolem">B3</span>›</span></span> insertI1<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> non_non_adj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v2</span> <span class="skolem">v3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> non_non_adj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">∈</span> V›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="skolem">v3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v3</span> <span class="main">∈</span> V›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v3</span> <span class="skolem">v4</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> non_non_adj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v3</span> <span class="main">∈</span> V›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v3</span> <span class="main">≠</span> <span class="skolem">v4</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v4</span> <span class="main">∈</span> V›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v4</span> <span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> non_non_adj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">∈</span> V›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v4</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v4</span> <span class="main">∈</span> V›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_quad<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="skolem">v4</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">≥</span><span class="numeral">4</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> non_adj <span class="bound">v</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> non_adj <span class="bound">v</span> <span class="bound">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">≥</span><span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"non_adj <span class="skolem">v</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">u</span> <span class="skolem">w</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> unique<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="skolem">u</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="bound">n</span><span class="main">=</span><span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> non_adj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>V"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">v</span> <span class="main">⟹</span> degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">u</span> <span class="main">⟹</span> degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> non_adj_degree <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">v</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="skolem">v</span> <span class="main">⟹</span> <span class="skolem">n</span><span class="main">≠</span><span class="skolem">u</span> <span class="main">⟹</span> <span class="skolem">n</span><span class="main">≠</span><span class="skolem">w</span> <span class="main">⟹</span> degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="skolem">w</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"non_adj <span class="skolem">v</span> <span class="skolem">n</span> <span class="main">⟹</span> degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> non_adj_degree<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"non_adj <span class="skolem">u</span> <span class="skolem">n</span> <span class="main">⟹</span> degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">v</span> <span class="skolem">u</span>›</span></span> non_adj_degree<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>non_adj <span class="skolem">u</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">¬</span>non_adj <span class="skolem">v</span> <span class="skolem">n</span> <span class="main">⟹</span> degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> V›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">w</span>›</span></span> <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">v</span> <span class="skolem">u</span>›</span></span> non_adj_def unique<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">w</span> <span class="main">⟹</span> degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">w</span>"</span></span> 
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">n</span><span class="main">≠</span><span class="bound">v</span> <span class="main">⟶</span> adjacent <span class="bound">v</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card V<span class="main">≥</span><span class="numeral">4</span>›</span></span> degree_two_windmill assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> friend_assm
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span><span class="main">≠</span><span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"non_adj <span class="skolem">w</span> <span class="skolem">w1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">∈</span>V›</span></span> non_adj_def<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span><span class="main">=</span><span class="skolem">v</span> <span class="main">⟹</span> degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">w</span>›</span></span> <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">w</span> <span class="skolem">w1</span>›</span></span> non_adj_degree<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span><span class="main">=</span><span class="skolem">u</span> <span class="main">⟹</span> degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="skolem">u</span> <span class="skolem">w</span>›</span></span> <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">w</span> <span class="skolem">w1</span>›</span></span> adjacent_sym non_adj_def<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span><span class="main">≠</span><span class="skolem">u</span> <span class="main">⟹</span> <span class="skolem">w1</span><span class="main">≠</span><span class="skolem">v</span> <span class="main">⟹</span> degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">w</span>›</span></span> <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">v</span> <span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹non_adj <span class="skolem">w</span> <span class="skolem">w1</span>›</span></span> non_adj_def non_adj_degree unique<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">n</span> <span class="free">G</span> <span class="main">=</span> degree <span class="skolem">v</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="comment1">(*In this section, combinatorial proofs for the Friendship Theorem differ from the algebraic ones.
The main difference between these two approaches is that combinatorial proofs show Lemma 
exist_degree_two by counting the number of paths while algebraic proofs show it by computing
the eigenvalue of adjacency matrices.*)</span>
<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Exclusive steps for combinatorial proofs›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> <span class="entity">adj_path</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> list <span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">adj_path</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">[]</span> <span class="main">=</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">∈</span>V<span class="main">)</span>"</span></span> 
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">adj_path</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">us</span></span></span><span class="main">)</span><span class="main">=</span> <span class="main">(</span>adjacent <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> <span class="free">adj_path</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">us</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> adj_path_butlast<span class="main">:</span>
  <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="free">ps</span> <span class="main">⟹</span> adj_path <span class="free">v</span> <span class="main">(</span>butlast <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> adj_path_V<span class="main">:</span>
  <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="free">ps</span> <span class="main">⟹</span> set <span class="free">ps</span> <span class="main">⊆</span> V"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> adj_path_V'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="free">ps</span> <span class="main">⟹</span> <span class="free">v</span><span class="main">∈</span> V"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> adj_path_app<span class="main">:</span>
  <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="free">ps</span> <span class="main">⟹</span> <span class="free">ps</span><span class="main">≠</span><span class="main">[]</span> <span class="main">⟹</span> adjacent <span class="main">(</span>last <span class="free">ps</span><span class="main">)</span> <span class="free">u</span> <span class="main">⟹</span> adj_path <span class="free">v</span> <span class="main">(</span><span class="free">ps</span><span class="main">@</span><span class="main">[</span><span class="free">u</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> adj_path_app'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="main">[</span><span class="free">q</span><span class="main">]</span> <span class="main">)</span> <span class="main">⟹</span> <span class="free">ps</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> adjacent <span class="main">(</span>last <span class="free">ps</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FriendshipTheory-card_partition'"><span class="command">lemma</span></span> card_partition'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">v</span> <span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v1</span> <span class="bound">v2</span><span class="main">.</span> <span class="bound">v1</span><span class="main">≠</span><span class="bound">v2</span> <span class="main">⟶</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">v2</span> <span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="bound">v</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⟹</span> card <span class="bound">C</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">C</span><span class="main">=</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> imageE<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C1</span> <span class="bound">C2</span><span class="main">.</span> <span class="bound">C1</span> <span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>  <span class="main">⟹</span> <span class="bound">C2</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">C1</span> <span class="main">≠</span> <span class="bound">C2</span> 
      <span class="main">⟹</span> <span class="bound">C1</span> <span class="main">∩</span> <span class="bound">C2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">C2</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">≠</span> <span class="skolem">C2</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C1</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>›</span></span> imageE<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C2</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C2</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>›</span></span> imageE<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C1</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C1</span> <span class="main">≠</span> <span class="skolem">C2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C2</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>›</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">∩</span> <span class="skolem">C2</span> <span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C1</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C2</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="skolem">v2</span> <span class="bound">n</span><span class="main">}</span>›</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
    assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> card_eq_0_iff finite_UN_I less_nat_zero_code<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" card <span class="free">A</span> <span class="main">=</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">v1</span> <span class="bound">v2</span><span class="main">.</span> <span class="bound">v1</span><span class="main">≠</span><span class="bound">v2</span> <span class="main">⟶</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">v2</span> <span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="main">{}</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> card.empty inf.idem less_le<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_image<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> card_partition<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> path_count<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k_adj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V <span class="main">⟹</span> card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="bound">v</span> <span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span><span class="main">=</span><span class="free">l</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span><span class="main">=</span><span class="free">k</span><span class="main">^</span><span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat.induct<span class="main">)</span>  
  <span class="keyword3"><span class="command">case</span></span> zero
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span><span class="main">=</span><span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">∈</span>V›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ext</span></span> <span class="keyword2"><span class="keyword">where</span></span> ext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ext</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">ps</span> <span class="bound">ps'</span><span class="main">.</span>  <span class="bound">ps'</span><span class="main">≠</span><span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>butlast <span class="bound">ps'</span><span class="main">=</span><span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span><span class="main">.</span> card <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span> <span class="main">=</span> <span class="free">k</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">ps</span><span class="main">=</span><span class="main">[]</span> <span class="keyword1">then</span> adjacent <span class="free">v</span> <span class="bound">n</span> <span class="keyword1">else</span> adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">qs</span> <span class="main">=</span> <span class="free">k</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> qs k_adj<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">∈</span>V›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span> <span class="main">∈</span> V"</span></span> <span class="keyword1"><span class="command">using</span></span> adj_path_V <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False <span class="quoted"><span class="quoted">‹adj_path <span class="free">v</span> <span class="skolem">ps</span>›</span></span> last_in_set subsetD<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> k_adj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span>"</span></span><span class="main">]</span> False qs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">app</span></span> <span class="keyword2"><span class="keyword">where</span></span> app<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">app</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">ps</span><span class="main">@</span><span class="main">[</span><span class="bound">q</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">app</span> <span class="main">`</span> <span class="skolem">qs</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">ps</span> <span class="bound">ps'</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> <span class="bound">xs</span><span class="main">∈</span> <span class="skolem">app</span> <span class="main">`</span> <span class="skolem">qs</span> <span class="main">⟹</span> <span class="bound">xs</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">ps</span> <span class="bound">ps'</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">∈</span> <span class="skolem">app</span> <span class="main">`</span> <span class="skolem">qs</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">∈</span> <span class="skolem">qs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">app</span> <span class="skolem">q</span><span class="main">=</span><span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imageE<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"adjacent <span class="free">v</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">=</span><span class="skolem">ps</span><span class="main">@</span><span class="main">[</span><span class="skolem">q</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qs app True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="skolem">xs</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True adj_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> adj_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append_Nil<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span><span class="main">=</span><span class="skolem">ps</span><span class="main">@</span><span class="main">[</span><span class="skolem">q</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>              
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ext</span> <span class="skolem">ps</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ext <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span><span class="main">=</span><span class="skolem">ps</span><span class="main">@</span><span class="main">[</span><span class="skolem">q</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">∈</span> <span class="skolem">app</span> <span class="main">`</span> <span class="skolem">qs</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">∈</span> <span class="skolem">qs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">app</span> <span class="skolem">q</span><span class="main">=</span><span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imageE<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qs app False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">@</span><span class="main">[</span><span class="skolem">q</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹adj_path <span class="free">v</span> <span class="skolem">ps</span>›</span></span> False adj_path_app <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">app</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">xs</span>›</span></span> app<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">xs</span><span class="main">=</span><span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">app</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">xs</span>›</span></span> app butlast_snoc<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ext</span> <span class="skolem">ps</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False butlast.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ext<span class="main">)</span> 
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> <span class="bound">xs</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">ps</span> <span class="bound">ps'</span><span class="main">}</span> <span class="main">⟹</span> <span class="bound">xs</span><span class="main">∈</span> <span class="skolem">app</span> <span class="main">`</span> <span class="skolem">qs</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="free">v</span> <span class="bound">n</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">ps</span> <span class="bound">ps'</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">=</span><span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="skolem">app</span> <span class="main">`</span> <span class="skolem">qs</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> True app <span class="quoted"><span class="quoted">‹<span class="skolem">qs</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="free">v</span> <span class="bound">n</span><span class="main">}</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  adj_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append_butlast_last_id append_self_conv2 image_iff 
                  mem_Collect_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">ps</span> <span class="bound">ps'</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">=</span><span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">=</span><span class="skolem">ps</span><span class="main">@</span><span class="main">[</span><span class="skolem">q</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adj_path <span class="free">v</span> <span class="skolem">xs</span>›</span></span> False adj_path_app' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="skolem">app</span> <span class="main">`</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qs 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> full_types<span class="main"><span class="main">)</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">ps</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">q</span><span class="main">]</span>›</span></span> app imageI mem_Collect_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">app</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> app <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">=</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹card <span class="skolem">qs</span> <span class="main">=</span> <span class="free">k</span>›</span></span> card_image<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps1</span> <span class="bound">ps2</span><span class="main">.</span> <span class="bound">ps1</span><span class="main">≠</span><span class="bound">ps2</span> <span class="main">⟶</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps2</span> <span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_ge_0_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="bound">v</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> 
      <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> card <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> card_partition'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">ext</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span>
      <span class="main">=</span><span class="main">(</span><span class="main">⋃</span><span class="bound">ps</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span> <span class="main">⟹</span> 
          <span class="bound">xs</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">ps</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">xs</span> <span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> adj_path_butlast length_butlast mem_Collect_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">ps</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adj_path <span class="free">v</span> <span class="skolem">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>›</span></span> UN_iff  ext length_greater_0_conv 
              mem_Collect_eq 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span> <span class="main">.</span> <span class="bound">xs</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">ps</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span>
          <span class="bound">xs</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">ps</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span><span class="main">=</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="free">v</span> <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ext</span> <span class="skolem">ys</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span><span class="main">=</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ext</span> <span class="skolem">ys</span> <span class="skolem">xs</span>›</span></span> ext mem_Collect_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> adj_path <span class="free">v</span> <span class="bound">ps</span><span class="main">}</span> <span class="main">=</span> <span class="free">k</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> total_v_num<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> friend_assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">u</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">v</span><span class="main">≠</span><span class="bound">u</span> <span class="main">⟹</span> <span class="main">∃!</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="bound">v</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="bound">u</span> <span class="bound">n</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span> <span class="free">k</span><span class="main">*</span><span class="free">k</span> <span class="main">-</span> <span class="free">k</span> <span class="main">+</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> k_adj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V<span class="main">⟹</span>card <span class="main">(</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="bound">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">=</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> degree_adjacent<span class="main">)</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹V<span class="main">≠</span><span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2_eq_v</span></span> <span class="keyword2"><span class="keyword">where</span></span> l2_eq_v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l2_eq_v</span><span class="main">=</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span><span class="main">=</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="skolem">v</span> <span class="bound">ps</span> <span class="main">∧</span> last <span class="bound">ps</span><span class="main">=</span><span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">l2_eq_v</span><span class="main">=</span><span class="free">k</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hds</span></span> <span class="keyword2"><span class="keyword">where</span></span> hds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">hds</span><span class="main">=</span> hd<span class="main">`</span> <span class="skolem">l2_eq_v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hds</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">hds</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> 
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">hds</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">ps</span><span class="main">=</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="skolem">v</span> <span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span><span class="main">=</span><span class="skolem">v</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> hds l2_eq_v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v</span> <span class="skolem">x</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> adj_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> length_0_conv neq_Nil_conv 
                  zero_neq_numeral<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">hds</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span><span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">v</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">ps</span><span class="main">=</span><span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="skolem">v</span> <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span><span class="main">=</span><span class="skolem">v</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>›</span></span> adjacent_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">hds</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> hds image_eqI l2_eq_v mem_Collect_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hds</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on hd <span class="skolem">l2_eq_v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">l2_eq_v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">l2_eq_v</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span> <span class="main">=</span> hd <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">x</span><span class="main">=</span>last <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">y</span><span class="main">=</span><span class="numeral">2</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> l2_eq_v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">!</span><span class="main">1</span><span class="main">=</span><span class="skolem">y</span><span class="main">!</span><span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> last_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> last_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">!</span><span class="main">0</span><span class="main">=</span><span class="skolem">y</span><span class="main">!</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹hd <span class="skolem">x</span><span class="main">=</span>hd <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">y</span><span class="main">=</span><span class="numeral">2</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> hd_conv_nth length_greater_0_conv<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">y</span><span class="main">=</span><span class="numeral">2</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span>  nth_equalityI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def less_2_cases<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">l2_eq_v</span><span class="main">=</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k_adj<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">∈</span>V›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_image<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2_neq_v</span></span> <span class="keyword2"><span class="keyword">where</span></span> l2_neq_v<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">l2_neq_v</span><span class="main">=</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span><span class="main">=</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="skolem">v</span> <span class="bound">ps</span> <span class="main">∧</span> last <span class="bound">ps</span><span class="main">≠</span><span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">l2_neq_v</span> <span class="main">=</span> <span class="free">k</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2_v</span></span> <span class="keyword2"><span class="keyword">where</span></span> l2_v<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">l2_v</span><span class="main">=</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span><span class="main">=</span><span class="numeral">2</span><span class="main">∧</span> adj_path <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">l2_v</span><span class="main">=</span><span class="free">k</span><span class="main">*</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_count<span class="main">[</span><span class="operator">OF</span> k_adj<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="free">k</span>›</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">∈</span>V›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">l2_v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite mult_is_0 neq0_conv<span class="main">)</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2_v</span><span class="main">=</span><span class="skolem">l2_neq_v</span> <span class="main">∪</span> <span class="skolem">l2_eq_v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l2_v l2_neq_v l2_eq_v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2_neq_v</span> <span class="main">∩</span> <span class="skolem">l2_eq_v</span> <span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l2_neq_v l2_eq_v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">l2_neq_v</span> <span class="main">=</span> card <span class="skolem">l2_v</span> <span class="main">-</span> card <span class="skolem">l2_eq_v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute Nat.add_0_right Un_commute card_Diff_subset_Int card_Un_Int
                  card_gt_0_iff diff_add_inverse finite_Diff finite_Un inf_sup_absorb
                  less_nat_zero_code<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">l2_neq_v</span> <span class="main">=</span> <span class="free">k</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">l2_eq_v</span><span class="main">=</span><span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">l2_v</span><span class="main">=</span><span class="free">k</span><span class="main">*</span><span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw last <span class="skolem">l2_neq_v</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">∧</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">`</span> <span class="skolem">l2_neq_v</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">∧</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span> last<span class="main">`</span> <span class="skolem">l2_neq_v</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">∧</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> 
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>last<span class="main">`</span> <span class="skolem">l2_neq_v</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>  <span class="quoted"><span class="quoted">"adj_path <span class="skolem">v</span> <span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span><span class="main">=</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span><span class="main">≠</span><span class="skolem">v</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> l2_neq_v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span><span class="main">∈</span>V"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> adj_path_V last_in_set length_0_conv rev_subsetD 
                  zero_neq_numeral<span class="main">)</span> 
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> V <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹last <span class="skolem">ps</span><span class="main">=</span><span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹last <span class="skolem">ps</span><span class="main">≠</span><span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">∧</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span><span class="main">}</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main">∈</span> last<span class="main">`</span> <span class="skolem">l2_neq_v</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> V<span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">v</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">∈</span>V›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="skolem">v</span> <span class="main">[</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adjacent_sym<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span><span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">]</span><span class="main">∈</span><span class="skolem">l2_neq_v</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> l2_neq_v x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> last<span class="main">`</span> <span class="skolem">l2_neq_v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imageI last.simps not_Cons_self2<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on last <span class="skolem">l2_neq_v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">l2_neq_v</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">l2_neq_v</span>"</span></span>  <span class="quoted"><span class="quoted">"last <span class="skolem">x</span> <span class="main">=</span> last <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="skolem">v</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">x</span><span class="main">≠</span><span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">y</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="skolem">v</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">y</span><span class="main">≠</span><span class="skolem">v</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> l2_neq_v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">[</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">[</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">]</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">l</span><span class="main">=</span><span class="numeral">2</span>"</span></span>
                <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h1</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="skolem">h1</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">t</span><span class="main">=</span><span class="main">1</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">l</span><span class="main">=</span><span class="numeral">2</span>›</span></span> Suc_length_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="main">[</span><span class="skolem">h2</span><span class="main">]</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> Suc_length_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h1</span> <span class="bound">h2</span><span class="main">.</span> <span class="skolem">l</span><span class="main">=</span><span class="main">[</span><span class="bound">h1</span><span class="main">,</span><span class="bound">h2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">=</span><span class="skolem">h1</span><span class="main">#</span><span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">=</span><span class="main">[</span><span class="skolem">h2</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">y</span><span class="main">=</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span><span class="main">≠</span><span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span><span class="main">≠</span><span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹last <span class="skolem">x</span><span class="main">≠</span><span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹last <span class="skolem">y</span><span class="main">≠</span><span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v</span> <span class="skolem">x1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">x2</span> <span class="skolem">x1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span><span class="main">∈</span>V"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adj_path <span class="skolem">v</span> <span class="skolem">x</span>›</span></span> x adjacent_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v</span> <span class="skolem">y1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">y2</span> <span class="skolem">y1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span><span class="main">∈</span>V"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adj_path <span class="skolem">v</span> <span class="skolem">y</span>›</span></span> y adjacent_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="skolem">y1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> friend_assm <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">∈</span>V›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹last <span class="skolem">x</span> <span class="main">=</span> last <span class="skolem">y</span>›</span></span> last_ConsL last_ConsR not_Cons_self2 x y<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x y <span class="quoted"><span class="quoted">‹last <span class="skolem">x</span> <span class="main">=</span> last <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">l2_neq_v</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">∧</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">∧</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span><span class="main">}</span><span class="main">=</span><span class="free">k</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card V <span class="main">=</span> card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V<span class="main">∧</span><span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span><span class="main">}</span> <span class="main">+</span> card <span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"V<span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">∧</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">∈</span>V›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>V <span class="main">∧</span> <span class="bound">n</span><span class="main">≠</span><span class="skolem">v</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span> card_Un_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> V<span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span><span class="main">]</span> finite_Un
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card V <span class="main">=</span> <span class="free">k</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">k</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FriendshipTheory-rotate_eq"><span class="command">lemma</span></span> rotate_eq<span class="main">:</span><span class="quoted"><span class="quoted">"rotate1 <span class="free">xs</span><span class="main">=</span>rotate1 <span class="free">ys</span> <span class="main">⟹</span> <span class="free">xs</span><span class="main">=</span><span class="free">ys</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rotate1_is_Nil_conv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">n</span> <span class="skolem">ns</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rotate1_is_Nil_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?case</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> butlast_snoc last_snoc list.exhaust rotate1.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1" id="FriendshipTheory-rotate_diff"><span class="command">lemma</span></span> rotate_diff<span class="main">:</span><span class="quoted"><span class="quoted">"rotate <span class="free">m</span> <span class="free">xs</span><span class="main">=</span>rotate <span class="free">n</span> <span class="free">xs</span> <span class="main">⟹</span>rotate <span class="main">(</span><span class="free">m</span><span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span><span class="var">?case</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat.exhaust<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rotate <span class="skolem">m'</span> <span class="free">xs</span> <span class="main">=</span> rotate <span class="skolem">n'</span> <span class="free">xs</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rotate <span class="main">(</span>Suc <span class="skolem">m'</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> rotate <span class="skolem">n</span> <span class="free">xs</span>›</span></span> rotate_eq rotate_Suc 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rotate <span class="main">(</span><span class="skolem">m'</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps<span class="main">)</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">m'</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m'</span><span class="main">-</span><span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n' diff_Suc_Suc<span class="main">)</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> 
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> exist_degree_two<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> friend_assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">u</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">v</span><span class="main">≠</span><span class="bound">u</span> <span class="main">⟹</span> <span class="main">∃!</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="bound">v</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="bound">u</span> <span class="bound">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">≥</span><span class="numeral">2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V <span class="main">⟹</span> degree <span class="bound">v</span> <span class="free">G</span><span class="main">≠</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_adj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V<span class="main">⟹</span> card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="bound">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> regular<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> degree_adjacent<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card V<span class="main">≥</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> degree_two_windmill<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="skolem">v1</span> <span class="skolem">v3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> friend_assm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span><span class="main">∈</span>V›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span><span class="main">∈</span>V›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span><span class="main">≠</span><span class="skolem">v2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adjacent_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite E›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="skolem">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k_adj<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span><span class="main">∈</span>V›</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> even_degree<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">∈</span> V›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> degree_adjacent k_adj<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≠</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≠</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≠</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V <span class="main">⟹</span> degree <span class="bound">v</span> <span class="free">G</span><span class="main">≠</span><span class="numeral">2</span>›</span></span> degree_adjacent k_adj 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">∈</span> V›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>  
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> T<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">T</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="bound">l</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> T_count<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">::</span>nat<span class="main">.</span> card <span class="main">(</span><span class="skolem">T</span> <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">k</span><span class="main">-</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">^</span><span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_partition'
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ext</span></span> <span class="keyword2"><span class="keyword">where</span></span> ext<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ext</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span> <span class="bound">ps</span><span class="main">.</span> adj_path <span class="bound">v</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> hd <span class="bound">ps</span><span class="main">=</span><span class="bound">v</span> <span class="main">∧</span> length <span class="bound">ps</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> card <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">v</span> <span class="bound">ps</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">^</span><span class="skolem">l</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> V"</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span><span class="main">∈</span>tl <span class="main">`</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span> <span class="main">⟹</span>  <span class="bound">ps</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span><span class="main">=</span><span class="skolem">l</span> <span class="main">∧</span> adj_path <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> tl <span class="main">`</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="skolem">v</span> <span class="main">(</span>tl <span class="skolem">ps'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">ps'</span><span class="main">=</span><span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps'</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span>tl <span class="skolem">ps'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="skolem">v</span> <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span><span class="main">=</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span><span class="main">=</span><span class="skolem">l</span> <span class="main">∧</span> adj_path <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span><span class="main">=</span><span class="skolem">l</span> <span class="main">∧</span> adj_path <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span> <span class="main">⟹</span> <span class="bound">ps</span><span class="main">∈</span> tl <span class="main">`</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">∧</span> adj_path <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span><span class="main">=</span><span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="skolem">v</span> <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span><span class="main">=</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="skolem">v</span> <span class="main">(</span>tl <span class="skolem">ps'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">ps'</span><span class="main">=</span><span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps'</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> tl <span class="main">`</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ps'</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">ps</span>›</span></span> ext imageI mem_Collect_eq list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tl <span class="main">`</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span><span class="main">=</span><span class="skolem">l</span> <span class="main">∧</span> adj_path <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on tl <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def 
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Collect <span class="main">(</span><span class="skolem">ext</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Collect <span class="main">(</span><span class="skolem">ext</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"tl <span class="skolem">x</span> <span class="main">=</span> tl <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">=</span>hd <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≠</span><span class="main">[]</span>"</span></span><span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹tl <span class="skolem">x</span><span class="main">=</span> tl <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> list.exhaust<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span><span class="main">=</span><span class="skolem">l</span> <span class="main">∧</span> adj_path <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">^</span><span class="skolem">l</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> path_count<span class="main">[</span><span class="operator">OF</span> k_adj<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span>  <span class="quoted"><span class="quoted">‹<span class="numeral">4</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> V›</span></span> assms<span class="main">(</span>3<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" card <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">v</span> <span class="bound">ps</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">^</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_image<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v1</span> <span class="bound">v2</span><span class="main">.</span> <span class="bound">v1</span> <span class="main">≠</span> <span class="bound">v2</span> <span class="main">⟶</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">v1</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">v2</span> <span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">=</span><span class="skolem">T</span> <span class="skolem">l</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">ps</span><span class="main">∈</span><span class="skolem">T</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="skolem">v</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">∈</span><span class="skolem">T</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span><span class="main">∈</span><span class="skolem">T</span> <span class="skolem">l</span> <span class="main">⟹</span> <span class="bound">ps</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">∈</span><span class="skolem">T</span> <span class="skolem">l</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span>hd <span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>V"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> adj_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> adjacent_V<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">v</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> card V <span class="main">*</span> <span class="skolem">k</span><span class="main">^</span><span class="skolem">l</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> card_partition'<span class="main">[</span><span class="operator">of</span> <span class="quoted">V</span> <span class="quoted"><span class="skolem">ext</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">^</span><span class="skolem">l</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹ <span class="numeral">4</span> <span class="main">≤</span> <span class="skolem">k</span> ›</span></span> assms<span class="main">(</span>3<span class="main">)</span> mult.commute nat_one_le_power
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> total_v_num<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> k_adj degree_adjacent <span class="quoted"><span class="quoted">‹finite E›</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span> 
          <span class="quoted"><span class="quoted">‹card V<span class="main">≥</span><span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">4</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> card_gt_0_iff
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">^</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="bound">l</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> 
      <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C_star</span></span> <span class="keyword2"><span class="keyword">where</span></span> C_star<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">C_star</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="bound">l</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">::</span>nat<span class="main">.</span> card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="bound">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">*</span> card <span class="main">(</span><span class="skolem">C_star</span> <span class="bound">l</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">T</span> <span class="bound">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">(</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span>
          <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">=</span>hd <span class="bound">ps</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> 
          adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">≠</span>hd <span class="bound">ps</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span>
          <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">=</span>hd <span class="bound">ps</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> 
          adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">≠</span>hd <span class="bound">ps</span><span class="main">}</span> <span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">(</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">T</span> <span class="main">(</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">T</span> <span class="main">(</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T_count<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite<span class="main">)</span> 
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> 
          <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">=</span>hd <span class="bound">ps</span><span class="main">}</span> <span class="main">+</span> card <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> 
          adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">≠</span>hd <span class="bound">ps</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> card_Un_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> adjacent 
          <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span> <span class="main">=</span> hd <span class="bound">ps</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> 
          <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span> <span class="main">≠</span> hd <span class="bound">ps</span><span class="main">}</span>"</span></span><span class="main">]</span> finite_Un
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> 
          <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">=</span>hd <span class="bound">ps</span><span class="main">}</span><span class="main">=</span><span class="skolem">k</span> <span class="main">*</span> card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ext</span></span> <span class="keyword2"><span class="keyword">where</span></span> ext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ext</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">ps</span> <span class="bound">ps'</span><span class="main">.</span>  <span class="bound">ps'</span><span class="main">≠</span><span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>butlast <span class="bound">ps'</span><span class="main">=</span><span class="bound">ps</span><span class="main">)</span> 
              <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps'</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span><span class="main">∈</span><span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span><span class="main">.</span> card <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> 
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">∈</span><span class="skolem">C_star</span> <span class="skolem">l</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span> <span class="main">=</span> hd <span class="skolem">ps</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> C_star <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">qs</span><span class="main">=</span><span class="main">{</span><span class="bound">v</span><span class="main">.</span> adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="bound">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">app</span></span> <span class="keyword2"><span class="keyword">where</span></span> app<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">app</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">ps</span><span class="main">@</span><span class="main">[</span><span class="bound">v</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">app</span> <span class="main">`</span> <span class="skolem">qs</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">ps</span> <span class="bound">ps'</span><span class="main">}</span>"</span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">app</span><span class="main">`</span><span class="skolem">qs</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">ps</span> <span class="bound">ps'</span><span class="main">}</span>"</span></span> 
                    <span class="keyword1"><span class="command">proof</span></span> 
                      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">app</span> <span class="main">`</span> <span class="skolem">qs</span>"</span></span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">ps</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qs app <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tl <span class="skolem">ps</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> adj_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> adj_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                          adjacent_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append_Nil list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> hd_append snoc_eq_iff_butlast 
                          tl_append2<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>›</span></span> adj_path_app hd_append
                          last_tl list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tl_append2<span class="main">)</span>
                      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ext</span> <span class="skolem">ps</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> snoc_eq_iff_butlast<span class="main">)</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">⟹</span> <span class="bound">x</span><span class="main">∈</span> <span class="skolem">app</span><span class="main">`</span><span class="skolem">qs</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">ps</span> <span class="bound">ps'</span><span class="main">}</span>"</span></span> 
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">x</span><span class="main">=</span><span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span><span class="main">=</span><span class="main">1</span>"</span></span><span class="main">)</span>
                          <span class="keyword3"><span class="command">case</span></span> True
                          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹butlast <span class="skolem">x</span><span class="main">=</span><span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">x1</span><span class="main">#</span><span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1</span><span class="main">=</span><span class="main">1</span>"</span></span> 
                            <span class="keyword1"><span class="command">using</span></span> Suc_length_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">=</span><span class="main">[</span><span class="skolem">x2</span><span class="main">]</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> Suc_length_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">[</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="skolem">x1</span><span class="main">#</span><span class="skolem">t1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t1</span><span class="main">=</span><span class="main">[</span><span class="skolem">x2</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span>
                             <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹butlast <span class="skolem">x</span><span class="main">=</span><span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">next</span></span>
                          <span class="keyword3"><span class="command">case</span></span> False
                          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"tl <span class="skolem">ps</span><span class="main">≠</span><span class="main">[]</span>"</span></span> 
                            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span>›</span></span> add_0_iff add_diff_cancel_left' 
                              length_0_conv length_tl add.commute<span class="main">)</span>
                          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span> <span class="main">@</span> <span class="main">[</span>last <span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹butlast <span class="skolem">x</span><span class="main">=</span><span class="skolem">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id calculation list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tl_append2<span class="main">)</span>
                          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                            <span class="keyword1"><span class="command">using</span></span> adj_path_app'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"tl <span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">x</span>"</span></span><span class="main">]</span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹tl <span class="skolem">ps</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> last_tl<span class="main">)</span>
                        <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">app</span> <span class="main">`</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> app qs 
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹butlast <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> append_butlast_last_id mem_Collect_eq 
                          rev_image_eqI<span class="main">)</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">app</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> app <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span><span class="main">∈</span>V"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span>›</span></span>  <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>›</span></span> adj_path_V 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹last <span class="skolem">ps</span> <span class="main">=</span> hd <span class="skolem">ps</span>›</span></span> adj_path.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> last_in_set last_tl subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">qs</span><span class="main">=</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qs k_adj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="skolem">ps</span> <span class="bound">ps'</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_image<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C_star</span> <span class="skolem">l</span> <span class="main">⊆</span> <span class="skolem">T</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_star T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">^</span> <span class="skolem">l</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T_count<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite<span class="main">)</span> 
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_subset<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps1</span> <span class="bound">ps2</span><span class="main">.</span> <span class="bound">ps1</span> <span class="main">≠</span> <span class="bound">ps2</span> <span class="main">⟶</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps1</span> <span class="bound">ps'</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps2</span> <span class="bound">ps'</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">ps</span><span class="main">∈</span><span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> 
              <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">=</span>hd <span class="bound">ps</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">ps</span><span class="main">∈</span><span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> 
                  <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">=</span>hd <span class="bound">ps</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> 
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">ps</span><span class="main">∈</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">.</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">∈</span><span class="skolem">C_star</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ext</span> <span class="skolem">ps</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span> <span class="main">=</span> hd <span class="skolem">ps</span>"</span></span> 
                      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"butlast <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> C_star ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ butlast <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">ps</span> ›</span></span> <span class="quoted"><span class="quoted">‹ length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span> ›</span></span> length_butlast <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">≥</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> adj_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append_butlast_last_id 
                          append_eq_Cons_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> adj_path_app' append_butlast_last_id<span class="main">)</span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹butlast <span class="skolem">x</span><span class="main">=</span><span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹last <span class="skolem">ps</span><span class="main">=</span>hd <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹butlast <span class="skolem">x</span><span class="main">=</span><span class="skolem">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ps</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span>›</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>  <span class="operator">auto</span>
                      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> adjacent_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> hd <span class="skolem">x</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹butlast <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹last <span class="skolem">ps</span> <span class="main">=</span> hd <span class="skolem">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> adjacent_no_loop 
                      butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> calculation<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> last_ConsL neq_Nil_conv<span class="main">)</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span> 
                      <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> hd <span class="skolem">x</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> 
                  <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">=</span>hd <span class="bound">ps</span><span class="main">}</span> <span class="main">⟹</span>  
                  <span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">ps</span><span class="main">∈</span><span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> 
                      <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">=</span>hd <span class="bound">ps</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">=</span>hd <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span>butlast <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">∈</span><span class="skolem">C_star</span> <span class="skolem">l</span>"</span></span> 
                    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ps <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">ps</span><span class="main">=</span>hd <span class="skolem">x</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> ps <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span>›</span></span> 
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹ adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> ›</span></span> adjacent_no_loop 
                          append_Nil append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hd_append2<span class="main">)</span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adj_path_butlast 
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span> butlast_tl ps<span class="main">)</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span> <span class="main">=</span> hd <span class="skolem">ps</span>"</span></span> 
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹hd <span class="skolem">ps</span> <span class="main">=</span> hd <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> hd <span class="skolem">x</span>›</span></span> ps<span class="main">)</span>
                      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> C_star <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ext</span> <span class="skolem">ps</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ext 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span>›</span></span> 
                      <span class="quoted"><span class="quoted">‹last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> hd <span class="skolem">x</span>›</span></span> adjacent_no_loop butlast.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ps<span class="main">)</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">ps</span><span class="main">∈</span><span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">ps'</span><span class="main">.</span> <span class="skolem">ext</span> <span class="bound">ps</span> <span class="bound">ps'</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> card_partition'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">C_star</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="skolem">ext</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> 
          adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">≠</span>hd <span class="bound">ps</span><span class="main">}</span><span class="main">=</span>card <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">app</span></span> <span class="keyword2"><span class="keyword">where</span></span> app<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">app</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span><span class="main">@</span><span class="main">[</span><span class="keyword1">SOME</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="bound">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">app</span><span class="main">`</span><span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> 
              adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">≠</span>hd <span class="bound">ps</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> 
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">app</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span> <span class="main">≠</span> hd <span class="skolem">ps</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">app</span> <span class="skolem">ps</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> T C_star <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span><span class="main">∈</span>V"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> adj_path_V<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>›</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ps</span></span><span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="bound">n</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> adj_path_V'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹last <span class="skolem">ps</span><span class="main">≠</span>hd <span class="skolem">ps</span>›</span></span>  
                  friend_assm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"last <span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">ps</span>"</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> app <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="skolem">app</span> <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> someI_ex <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">=</span>hd <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="skolem">app</span> <span class="skolem">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ps</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span>›</span></span> app
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ps</span></span><span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="skolem">app</span> <span class="skolem">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ps</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span>›</span></span> app <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span><span class="main">=</span>last <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ps</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span>›</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹last <span class="skolem">ps</span> <span class="main">≠</span> hd <span class="skolem">ps</span>›</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> last_ConsL last_tl neq_Nil_conv<span class="main">)</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span><span class="main">≠</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹last <span class="skolem">ps</span> <span class="main">≠</span> hd <span class="skolem">ps</span>›</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1_left gen_length_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> gen_length_def list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                      last_ConsL length_Suc_conv neq_Nil_conv<span class="main">)</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"tl <span class="skolem">ps</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ps</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span>›</span></span> 
                    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> length_Suc_conv<span class="main">)</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span> <span class="main">@</span> <span class="main">[</span>last <span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span>  adj_path_app<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">ps</span><span class="main">)</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"last <span class="skolem">x</span>"</span></span><span class="main">]</span>  
                      <span class="quoted"><span class="quoted">‹adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>›</span></span>  
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tl <span class="skolem">ps</span> <span class="main">@</span> <span class="main">[</span>last <span class="skolem">x</span><span class="main">]</span><span class="main">=</span>tl <span class="skolem">x</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="skolem">app</span> <span class="skolem">ps</span>›</span></span> app
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹ last <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="main">(</span>last <span class="skolem">ps</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> ›</span></span> 
                      <span class="quoted"><span class="quoted">‹ tl <span class="skolem">ps</span> <span class="main">≠</span> <span class="main">[]</span> ›</span></span> list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tl_append2<span class="main">)</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹hd <span class="skolem">x</span><span class="main">=</span>hd <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹hd <span class="skolem">x</span><span class="main">=</span>hd <span class="skolem">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="main">(</span>hd <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>›</span></span> adjacent_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> hd <span class="skolem">x</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹last <span class="skolem">ps</span> <span class="main">≠</span> hd <span class="skolem">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹hd <span class="skolem">x</span><span class="main">=</span>hd <span class="skolem">ps</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">app</span> <span class="skolem">ps</span>›</span></span> app butlast_snoc<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> 
                  <span class="main">∧</span> last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> hd <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> 
              adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">≠</span>hd <span class="bound">ps</span><span class="main">}</span><span class="main">⟹</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">app</span><span class="main">`</span><span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> 
                  adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">≠</span>hd <span class="bound">ps</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span>"</span></span>
                  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">≠</span>hd <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">x</span><span class="main">∈</span><span class="skolem">T</span> <span class="skolem">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="skolem">l</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="numeral">2</span>›</span></span> length_butlast <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">=</span>hd <span class="skolem">x</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span>›</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> calculation diff_add_inverse 
                      diff_cancel2 hd_append length_butlast add.commute num.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                      one_eq_numeral_iff<span class="main">)</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>tl <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj_path_butlast butlast_tl<span class="main">)</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">≠</span>hd <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">=</span>hd <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> T C_star <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">app</span> <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">=</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> app 
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">∈</span>V"</span></span> 
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">≥</span><span class="numeral">3</span>"</span></span><span class="main">)</span>
                      <span class="keyword3"><span class="command">case</span></span> True
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
                          <span class="keyword3"><span class="command">case</span></span> Nil
                          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">next</span></span>
                          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x1</span> <span class="skolem">t1</span><span class="main">)</span>
                          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1</span><span class="main">&lt;</span><span class="numeral">3</span> <span class="main">⟹</span><span class="var">?case</span>"</span></span> 
                            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1</span><span class="main">&lt;</span><span class="numeral">3</span>"</span></span>
                              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">x1</span> <span class="main">#</span> <span class="skolem">t1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">=</span><span class="skolem">x2</span><span class="main">#</span><span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">t2</span><span class="main">=</span><span class="main">1</span>"</span></span> 
                                <span class="keyword1"><span class="command">using</span></span> Suc_length_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">=</span><span class="main">[</span><span class="skolem">x3</span><span class="main">]</span>"</span></span>
                                <span class="keyword1"><span class="command">using</span></span>  Suc_length_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">t2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">=</span><span class="main">[</span><span class="skolem">x2</span><span class="main">,</span><span class="skolem">x3</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t1</span><span class="main">=</span><span class="skolem">x2</span><span class="main">#</span><span class="skolem">t2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t2</span><span class="main">=</span><span class="main">[</span><span class="skolem">x3</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                            <span class="keyword1"><span class="command">qed</span></span>
                          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1</span><span class="main">≥</span><span class="numeral">3</span><span class="main">⟹</span><span class="var">?case</span>"</span></span>
                            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1</span><span class="main">≥</span><span class="numeral">3</span>"</span></span>
                              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">t1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">t1</span><span class="main">)</span>"</span></span> 
                                <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
                                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> in_set_butlastD last.simps last_in_set 
                                  length_butlast length_greater_0_conv length_pos_if_in_set 
                                  length_tl list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
                            <span class="keyword1"><span class="command">qed</span></span>
                          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
                        <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> adj_path_V<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">case</span></span> False
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">[</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">]</span>"</span></span> 
                        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">x1</span><span class="main">#</span><span class="skolem">t1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">t1</span><span class="main">=</span><span class="main">1</span>"</span></span> 
                            <span class="keyword1"><span class="command">using</span></span> Suc_length_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">=</span><span class="main">[</span><span class="skolem">x2</span><span class="main">]</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span>  Suc_length_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">[</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="skolem">x1</span><span class="main">#</span><span class="skolem">t1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t1</span><span class="main">=</span><span class="main">[</span><span class="skolem">x2</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">=</span>hd <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> adj_path_V'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">=</span>hd <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span>›</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span>›</span></span> adjacent_no_loop append_butlast_last_id 
                      butlast.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hd_append<span class="main">)</span>
                  <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">using</span></span> adj_path_V'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">≠</span>hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">≠</span>hd <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">=</span>hd <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="main">(</span>last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="main">(</span>hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> friend_assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">≥</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> adj_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append_Nil 
                      append_butlast_last_id<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> adj_path_app' append_butlast_last_id<span class="main">)</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">=</span>hd <span class="skolem">x</span>›</span></span> adjacent_sym
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="main">(</span>last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span> 
                      <span class="main">∧</span> adjacent <span class="main">(</span>hd <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> last <span class="skolem">x</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> some1_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> 
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">x</span><span class="main">]</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="main">(</span>last <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span>›</span></span> adjacent_no_loop 
                      append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> app <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">app</span><span class="main">`</span><span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_iff<span class="main">)</span>  
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">app</span><span class="main">`</span><span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span><span class="main">=</span><span class="main">{</span><span class="bound">ps</span><span class="main">.</span> length <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">+</span><span class="numeral">2</span> <span class="main">∧</span> adj_path <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>tl <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> 
              adjacent <span class="main">(</span>last <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>hd <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="bound">ps</span><span class="main">)</span><span class="main">≠</span>hd <span class="bound">ps</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">app</span> <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> app <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_image<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">::</span>nat<span class="main">.</span> card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="bound">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C_star</span> <span class="skolem">l</span> <span class="main">⊆</span> <span class="skolem">T</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_star T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T_count <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span><span class="main">=</span>card<span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">-</span> card<span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_Diff_subset rev_finite_subset<span class="main">)</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="skolem">k</span><span class="main">*</span>card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>card <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">-</span> card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">l</span><span class="main">::</span>nat<span class="main">.</span> card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="bound">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">*</span> card <span class="main">(</span><span class="skolem">C_star</span> <span class="bound">l</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">T</span> <span class="bound">l</span> <span class="main">-</span> <span class="skolem">C_star</span> <span class="bound">l</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="skolem">k</span><span class="main">*</span>card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">-</span> card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">≥</span> card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C_star</span> <span class="skolem">l</span> <span class="main">⊆</span> <span class="skolem">T</span> <span class="skolem">l</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_mono<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="skolem">k</span><span class="main">*</span>card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">-</span> card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">≥</span> card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C_star</span> <span class="skolem">l</span> <span class="main">⊆</span> <span class="skolem">T</span> <span class="skolem">l</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span>card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">≥</span> card <span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">*</span>card<span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span><span class="main">+</span>card<span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoid_mult_class.mult.left_neutral diff_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">*</span>card<span class="main">(</span><span class="skolem">C_star</span> <span class="skolem">l</span><span class="main">)</span><span class="main">+</span>card<span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> card<span class="main">(</span><span class="skolem">T</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">&gt;=</span><span class="numeral">4</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_mult_self3 mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">k</span><span class="main">-</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">^</span><span class="skolem">l</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T_count <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">^</span><span class="skolem">l</span>  <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span><span class="skolem">k</span><span class="main">-</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">=</span><span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_mult_distrib nat_mult_1<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">1</span><span class="main">*</span><span class="skolem">k</span><span class="main">^</span><span class="skolem">l</span>  <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_mult_right_eq mod_mult_self1 add.commute mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="skolem">k</span><span class="main">^</span><span class="skolem">l</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="skolem">l</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">1</span><span class="main">^</span><span class="skolem">l</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_add_self2 add.commute power_mod<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">1</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">4</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_numeral add_One_commute eq_iff le_diff_conv numeral_le_iff  
      one_le_numeral one_plus_BitM prime_factor_nat semiring_norm<span class="main"><span class="main">(</span></span>69<span class="main"><span class="main">)</span></span> semiring_norm<span class="main"><span class="main">(</span></span>71<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> p_minus_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">=</span><span class="skolem">p</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_inverse add.commute not_less_iff_gr_or_eq prime_nat_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">::</span>nat<span class="main">.</span> card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="bound">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">p</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">l</span><span class="main">::</span>nat<span class="main">.</span> card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="bound">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">1</span>›</span></span> mod_mod_cancel<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>›</span></span><span class="main">]</span>
      <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_if prime_gt_1_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> * <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_diff_assoc2 add_le_cancel_right diff_diff_left one_add_one p_minus_1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> * <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> prime_ge_2_nat <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> closure1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">⟹</span> rotate1 <span class="bound">x</span> <span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> C p_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="main">(</span>rotate1 <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>hd <span class="main">(</span>rotate1 <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="main">(</span>rotate1 <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>hd <span class="main">(</span>rotate1 <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>adjacent <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹ adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> ›</span></span> adjacent_no_loop append_Nil list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span>
                  hd_append2 last_snoc list.exhaust rotate1_hd_tl<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>True"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span> 
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  adj_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> adjacent_no_loop append1_eq_conv append_Nil 
                  append_butlast_last_id list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> list.exhaust<span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="main">(</span>rotate1 <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>tl <span class="main">(</span>rotate1 <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span>hd <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span><span class="main">=</span>tl <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"adj_path <span class="skolem">y</span> <span class="skolem">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>last <span class="skolem">ys</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span><span class="main">≠</span><span class="main">[]</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> hd <span class="skolem">x</span>›</span></span> 
                  <span class="quoted"><span class="quoted">‹<span class="skolem">ys</span> <span class="main">=</span> tl <span class="skolem">x</span>›</span></span> adjacent_no_loop list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> last.simps last_tl list.exhaust
                  <span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="quoted"><span class="quoted">‹adjacent <span class="main">(</span>last <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ys</span> <span class="main">=</span> tl <span class="skolem">x</span>›</span></span> adjacent_no_loop list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span>
                  last_ConsL neq_Nil_conv<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="main">(</span>rotate1 <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>tl <span class="main">(</span>rotate1 <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span>adj_path <span class="main">(</span>hd <span class="main">(</span><span class="skolem">ys</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>tl <span class="main">(</span><span class="skolem">ys</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≠</span><span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">=</span>hd <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ys</span><span class="main">=</span>tl <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rotate1_hd_tl<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>adj_path <span class="main">(</span>hd <span class="skolem">ys</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">ys</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> hd_append tl_append2<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>True"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> adj_path_app<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹adj_path <span class="skolem">y</span> <span class="skolem">ys</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ys</span><span class="main">≠</span><span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹adjacent <span class="main">(</span>last <span class="skolem">ys</span><span class="main">)</span> <span class="skolem">y</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ys</span><span class="main">≠</span><span class="main">[]</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append_Cons list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> list.exhaust<span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>rotate1 <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rotate1 <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C p_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> closure<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">⟹</span> rotate <span class="bound">n</span> <span class="bound">x</span> <span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rotate <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> One_nat_def closure1<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span><span class="skolem">p</span><span class="main">.</span> rotate <span class="bound">n</span> <span class="bound">x</span><span class="main">=</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">p</span> <span class="keyword1">dvd</span> card <span class="main">{</span><span class="bound">y</span><span class="main">.</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span><span class="skolem">p</span><span class="main">.</span> rotate <span class="bound">n</span> <span class="bound">x</span><span class="main">=</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>  
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C p_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span><span class="skolem">p</span><span class="main">.</span> rotate <span class="bound">n</span> <span class="skolem">x</span><span class="main">=</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span><span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> rotate <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span><span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n1</span> <span class="bound">n2</span><span class="main">.</span> <span class="bound">n1</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span> <span class="main">⟹</span> <span class="bound">n2</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span> <span class="main">⟹</span> <span class="bound">n1</span><span class="main">≠</span><span class="bound">n2</span> <span class="main">⟹</span> rotate <span class="bound">n1</span> <span class="skolem">x</span><span class="main">≠</span>rotate <span class="bound">n2</span> <span class="skolem">x</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> 
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n1</span> <span class="skolem">n2</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">≠</span> <span class="skolem">n2</span>"</span></span> <span class="quoted"><span class="quoted">"rotate <span class="skolem">n1</span> <span class="skolem">x</span> <span class="main">=</span> rotate <span class="skolem">n2</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n1</span> <span class="skolem">n2</span>  
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"rotate <span class="skolem">n1</span> <span class="skolem">x</span> <span class="main">=</span> rotate <span class="skolem">n2</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">&gt;</span><span class="skolem">n2</span>"</span></span>
                <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">*</span><span class="main">(</span><span class="skolem">n1</span><span class="main">-</span><span class="skolem">n2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">p</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">-</span><span class="skolem">n2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">-</span><span class="skolem">n2</span><span class="main">&lt;</span><span class="skolem">p</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n2</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span><span class="main">&gt;</span><span class="skolem">n2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="skolem">n2</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff'' coprime_commute <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="skolem">n2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_solve_coprime_nat<span class="main">)</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="skolem">n2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> prime_gt_1_nat <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_def <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_0 mult_0 neq0_conv zero_neq_one<span class="main">)</span> 
                    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rotate <span class="main">(</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">n1</span><span class="main">)</span> <span class="skolem">x</span><span class="main">=</span>rotate <span class="main">(</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">n2</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rotate <span class="skolem">n1</span> <span class="skolem">x</span><span class="main">=</span>rotate <span class="skolem">n2</span> <span class="skolem">x</span>›</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute rotate_rotate<span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rotate <span class="main">(</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">n1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">*</span><span class="skolem">n2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">=</span> <span class="skolem">x</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> rotate_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rotate <span class="main">(</span><span class="skolem">s</span><span class="main">*</span><span class="main">(</span><span class="skolem">n1</span><span class="main">-</span><span class="skolem">n2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_mult_distrib mult.commute<span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rotate <span class="main">1</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">*</span><span class="main">(</span><span class="skolem">n1</span><span class="main">-</span><span class="skolem">n2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">p</span><span class="main">=</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>›</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rotate_conv_mod<span class="main">)</span> 
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rotate1 <span class="skolem">x</span><span class="main">=</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">=</span>hd <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>›</span></span> 
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">≥</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> prime_ge_2_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tl <span class="skolem">x</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>hd <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>tl <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_Cons_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>tl <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>hd <span class="skolem">x</span><span class="main">]</span><span class="main">=</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>hd <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>tl <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rotate1 <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_eq_appendI rotate1.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">≠</span>hd <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adj_path <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>›</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">≥</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> prime_ge_2_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"tl <span class="skolem">x</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"adjacent <span class="main">(</span>hd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>hd <span class="main">(</span>tl <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust<span class="main">)</span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adjacent_no_loop<span class="main">)</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span> 
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n1</span> <span class="main">≠</span> <span class="skolem">n2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n2</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹rotate <span class="skolem">n1</span> <span class="skolem">x</span> <span class="main">=</span> rotate <span class="skolem">n2</span> <span class="skolem">x</span>›</span></span> 
                  less_linear<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> rotate <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span><span class="skolem">p</span><span class="main">.</span> rotate <span class="bound">n</span> <span class="skolem">x</span><span class="main">=</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span><span class="main">=</span>card <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_image<span class="main">)</span> 
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span><span class="skolem">p</span><span class="main">.</span> rotate <span class="bound">n</span> <span class="skolem">x</span><span class="main">=</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span><span class="main">=</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> card <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span><span class="skolem">p</span><span class="main">.</span> rotate <span class="bound">n</span> <span class="skolem">x</span><span class="main">=</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">//</span> <span class="skolem">r</span><span class="main">.</span> <span class="skolem">p</span> <span class="keyword1">dvd</span> card <span class="bound">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> quotient_def Image_def r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">⊆</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">×</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> 
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">r</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> snd <span class="skolem">x</span><span class="main">=</span>rotate <span class="bound">n</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">x</span><span class="main">=</span>rotate <span class="skolem">n</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closure <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span>fst <span class="skolem">x</span><span class="main">,</span>snd <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">r</span>›</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">×</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">x</span><span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SigmaI<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">r</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> 
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rotate <span class="main">0</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closure <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span>rotate <span class="main">0</span> <span class="skolem">x</span><span class="main">)</span><span class="main">∈</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">)</span>›</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rotate <span class="main">0</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">∈</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> refl_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sym_def 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">r</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C p_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span><span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"rotate <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">∈</span><span class="skolem">r</span>›</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closure<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span><span class="main">⟹</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">r</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rotate <span class="skolem">n</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">∈</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹refl_on <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span> refl_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">∈</span><span class="skolem">r</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rotate <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rotate <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> rotate <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>rotate <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rotate <span class="skolem">n</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rotate <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>rotate <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span><span class="main">=</span>rotate <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">n</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> rotate_rotate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>rotate <span class="skolem">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">&lt;</span><span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span>rotate <span class="main">0</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">-</span><span class="skolem">n</span><span class="main">&lt;</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">&lt;</span><span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">∈</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">∈</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trans <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">r</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C p_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">&lt;</span><span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span><span class="main">&lt;</span><span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span>rotate <span class="skolem">n1</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span>rotate <span class="skolem">n2</span> <span class="skolem">y</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> r <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">∈</span><span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">∈</span><span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span>rotate <span class="main">(</span><span class="skolem">n2</span><span class="main">+</span><span class="skolem">n1</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rotate_rotate<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span>rotate <span class="main">(</span><span class="main">(</span><span class="skolem">n2</span><span class="main">+</span><span class="skolem">n1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span><span class="main">=</span><span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rotate_conv_mod<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n2</span><span class="main">+</span><span class="skolem">n1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> mod_less_divisor prime_gt_0_nat<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">∈</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>›</span></span> card_eq_0_iff mod_0 zero_neq_one<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equiv_imp_dvd_card equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_eq_mod_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_unSimpGraph<span class="main">)</span> friendship_thm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> friend_assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">u</span><span class="main">∈</span>V <span class="main">⟹</span> <span class="bound">v</span><span class="main">≠</span><span class="bound">u</span> <span class="main">⟹</span> <span class="main">∃!</span> <span class="bound">n</span><span class="main">.</span> adjacent <span class="bound">v</span> <span class="bound">n</span> <span class="main">∧</span> adjacent <span class="bound">u</span> <span class="bound">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">n</span><span class="main">≠</span><span class="bound">v</span> <span class="main">⟶</span> adjacent <span class="bound">v</span> <span class="bound">n</span>"</span></span>    
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_not_in_conv card_seteq empty_subsetI le0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="main">1</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">=</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"V<span class="main">=</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> card_eq_SucD<span class="main">[</span><span class="operator">of</span> <span class="quoted">V</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">n</span><span class="main">=</span><span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>V<span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⟶</span> adjacent <span class="bound">v</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">≥</span><span class="numeral">2</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card V<span class="main">≥</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> degree <span class="bound">v</span> <span class="free">G</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exist_degree_two<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">]</span> <span class="quoted"><span class="quoted">‹finite V›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> degree_two_windmill<span class="main">[</span><span class="operator">OF</span> friend_assm<span class="main">]</span> <span class="quoted"><span class="quoted">‹card V<span class="main">≥</span><span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹finite V›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>