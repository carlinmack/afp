<div id="BinomialHeap">
<div class="head">
<h1>Theory BinomialHeap</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Binomial Heaps"</span></span>

<span class="keyword1"><span class="command">theory</span></span> BinomialHeap
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> BinomialHeapStruc_loc
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Datatype Definition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Binomial heaps are lists of binomial trees.›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialTree <span class="main">=</span> 
  Node <span class="main">(</span><span class="free"><span class="entity">val</span></span><span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'e</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">prio</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linorder"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">rank</span></span><span class="main">:</span> <span class="quoted">nat</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">children</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialTree list"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialQueue_inv <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialTree list"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Combine two binomial trees (of rank $r$) to one (of rank $r+1$).›</span></span>
<span class="keyword1"><span class="command">fun</span></span>  <span class="entity">link</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialTree <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialTree <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialTree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">link</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">ts1</span></span></span><span class="main">)</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">ts2</span></span></span><span class="main">)</span> <span class="main">=</span> 
   <span class="main">(</span><span class="keyword1">if</span>  <span class="free"><span class="bound"><span class="entity">a1</span></span></span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">a2</span></span></span> 
     <span class="keyword1">then</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">ts2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ts1</span></span></span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">ts1</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ts2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Abstraction to Multiset"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Return a multiset with all (element, priority) pairs from a queue.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tree_to_multiset</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialTree <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> multiset"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">queue_to_multiset</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialQueue_inv <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> multiset"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tree_to_multiset</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">#}</span> <span class="main">+</span> <span class="free">queue_to_multiset</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">queue_to_multiset</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{#}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">queue_to_multiset</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">tree_to_multiset</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">+</span> <span class="free">queue_to_multiset</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span> 


<span class="keyword1" id="BinomialHeap-qtmset_append_union"><span class="command">lemma</span></span> qtmset_append_union<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span><span class="free">q</span> <span class="main">@</span> <span class="free">q'</span><span class="main">)</span> <span class="main">=</span> 
  queue_to_multiset <span class="free">q</span> <span class="main">+</span> queue_to_multiset <span class="free">q'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_ac<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinomialHeap-qtmset_rev"><span class="command">lemma</span></span> qtmset_rev<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>rev <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_ac<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Invariant"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We first formulate the invariant for single binomial trees,
  and then extend the invariant to binomial heaps (lists of binomial trees).
  The invariant for trees claims that a tree labeled rank $0$ has no children,
  and a tree labeled rank $r+1$ is the result of a link operation of
  two rank $r$ trees.
›</span></span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">tree_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialTree <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tree_invar</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">tree_invar</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">∃</span> <span class="bound">e1</span> <span class="bound">a1</span> <span class="bound">ts1</span> <span class="bound">e2</span> <span class="bound">a2</span> <span class="bound">ts2</span><span class="main">.</span> 
    <span class="free">tree_invar</span> <span class="main">(</span>Node <span class="bound">e1</span> <span class="bound">a1</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">ts1</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="free">tree_invar</span> <span class="main">(</span>Node <span class="bound">e2</span> <span class="bound">a2</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">ts2</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="bound">e1</span> <span class="bound">a1</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="bound">e2</span> <span class="bound">a2</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">ts2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> rank <span class="bound">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A queue satisfies the invariant, iff all trees inside the queue satisfy 
  the invariant, and the queue contains only trees of distinct rank and 
  is ordered by rank›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First part: All trees of the queue satisfy the tree invariant:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">queue_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialQueue_inv <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">queue_invar</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">.</span> tree_invar <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Second part: Trees have distinct rank, and are ordered by 
  ascending rank:›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rank_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialQueue_inv <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rank_invar</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rank_invar</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rank_invar</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">&lt;</span> rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">∧</span> <span class="free">rank_invar</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BinomialHeap-queue_invar_simps"><span class="command">lemma</span></span> queue_invar_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"queue_invar <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span><span class="free">t</span><span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">⟷</span> tree_invar <span class="free">t</span> <span class="main">∧</span> queue_invar <span class="free">q</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span><span class="free">q</span><span class="main">@</span><span class="free">q'</span><span class="main">)</span> <span class="main">⟷</span> queue_invar <span class="free">q</span> <span class="main">∧</span> queue_invar <span class="free">q'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> queue_invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Invariant for binomial queues:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">==</span> queue_invar <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> rank_invar <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1" id="BinomialHeap-mset_link"><span class="command">lemma</span></span> mset_link<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tree_to_multiset <span class="main">(</span>link <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">=</span> <span class="main">(</span>tree_to_multiset <span class="free">t1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>tree_to_multiset <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_ac<span class="main">)</span>

<span class="keyword1" id="BinomialHeap-link_tree_invar"><span class="command">lemma</span></span> link_tree_invar<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tree_invar <span class="free">t1</span><span class="main">;</span> tree_invar <span class="free">t2</span><span class="main">;</span> rank <span class="free">t1</span> <span class="main">=</span> rank <span class="free">t2</span><span class="main">⟧</span> <span class="main">⟹</span> tree_invar <span class="main">(</span>link <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="BinomialHeap-invar_children"><span class="command">lemma</span></span> invar_children<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span><span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialTree<span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> queue_invar_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    O<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_invar.simps<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> O<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> O<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> queue_invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> O<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> O<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> queue_invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> O<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a1</span><span class="main">≤</span><span class="skolem">a2</span> 
    <span class="keyword1">then</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span> 
    <span class="keyword1">else</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> case1 case2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> queue_invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-invar_children'"><span class="command">lemma</span></span> invar_children'<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>children <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_children<span class="main">)</span>


<span class="keyword1" id="BinomialHeap-rank_link"><span class="command">lemma</span></span> rank_link<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">t</span> <span class="main">=</span> rank <span class="free">t'</span> <span class="main">⟹</span> rank <span class="main">(</span>link <span class="free">t</span> <span class="free">t'</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">t</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t'</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinomialHeap-rank_invar_not_empty_hd"><span class="command">lemma</span></span> rank_invar_not_empty_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span><span class="main">;</span> <span class="free">bq</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> 
  rank <span class="free">t</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="free">bq</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinomialHeap-rank_invar_to_set"><span class="command">lemma</span></span> rank_invar_to_set<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> 
  <span class="main">∀</span> <span class="bound">t'</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">.</span> rank <span class="free">t</span> <span class="main">&lt;</span> rank <span class="bound">t'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> nat_less_le rank_invar.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> set_ConsD xt1<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinomialHeap-set_to_rank_invar"><span class="command">lemma</span></span> set_to_rank_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span> <span class="bound">t'</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">.</span> rank <span class="free">t</span> <span class="main">&lt;</span> rank <span class="bound">t'</span><span class="main">;</span> rank_invar <span class="free">bq</span><span class="main">⟧</span> 
  <span class="main">⟹</span>  rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hd_in_set list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rank_invar.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="BinomialHeap-rank_invar_hd_cons"><span class="command">lemma</span></span> rank_invar_hd_cons<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rank_invar <span class="free">bq</span><span class="main">;</span> rank <span class="free">t</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="free">bq</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinomialHeap-rank_invar_cons"><span class="command">lemma</span></span> rank_invar_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> rank_invar <span class="free">bq</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="BinomialHeap-invar_cons_up"><span class="command">lemma</span></span> invar_cons_up<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span><span class="main">;</span> rank <span class="free">t'</span> <span class="main">&lt;</span> rank <span class="free">t</span><span class="main">;</span> tree_invar <span class="free">t'</span><span class="main">⟧</span> <span class="main">⟹</span> invar <span class="main">(</span><span class="free">t'</span> <span class="main">#</span> <span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span> 

<span class="keyword1" id="BinomialHeap-invar_cons_down"><span class="command">lemma</span></span> invar_cons_down<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> invar <span class="free">bq</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="BinomialHeap-invar_app_single"><span class="command">lemma</span></span> invar_app_single<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>invar <span class="free">bq</span><span class="main">;</span> <span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&lt;</span> rank <span class="free">t'</span><span class="main">;</span> tree_invar <span class="free">t'</span><span class="main">⟧</span> 
   <span class="main">⟹</span> invar <span class="main">(</span><span class="free">bq</span> <span class="main">@</span> <span class="main">[</span><span class="free">t'</span><span class="main">]</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bq</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹invar <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">bq</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invar_cons_down<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span><span class="skolem">bq</span> <span class="main">@</span> <span class="main">[</span><span class="free">t'</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Heap Ordering"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">heap_ordered</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialTree <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_ordered</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_mset<span class="main">(</span>queue_to_multiset <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> snd <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The invariant for trees implies heap order.›</span></span>
<span class="keyword1" id="BinomialHeap-tree_invar_heap_ordered"><span class="command">lemma</span></span> tree_invar_heap_ordered<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"heap_ordered <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">nat</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">nat</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      O<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t1</span>"</span></span>  <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> link <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> t1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> t2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_invar.simps<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> O<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span>  <span class="skolem">a1</span><span class="main">≤</span><span class="skolem">a2</span> 
      <span class="keyword1">then</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t2</span> <span class="main">#</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t1</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> O<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> t1<span class="main">]</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> O<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> t2<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Height and Length"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Although complexity of HOL-functions cannot be expressed within 
  HOL, we can express the height and length of a binomial heap.
  By showing that both, height and length, are logarithmic in the number 
  of contained elements, we give strong evidence that our functions have
  logarithmic complexity in the number of elements.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Height of a tree and queue›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">height_tree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span><span class="main">)</span> BinomialTree <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="entity">height_queue</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span><span class="main">)</span> BinomialQueue_inv <span class="main">⇒</span> nat"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">height_tree</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">height_queue</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">height_queue</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">height_queue</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>Suc <span class="main">(</span><span class="free">height_tree</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">height_queue</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BinomialHeap-link_length"><span class="command">lemma</span></span> link_length<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>tree_to_multiset <span class="main">(</span>link <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  size <span class="main">(</span>tree_to_multiset <span class="free">t1</span><span class="main">)</span> <span class="main">+</span> size <span class="main">(</span>tree_to_multiset <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinomialHeap-tree_rank_estimate"><span class="command">lemma</span></span> tree_rank_estimate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span> <span class="main">⟹</span> 
    size <span class="main">(</span>tree_to_multiset <span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="keyword2"><span class="keyword">where</span></span> link<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> link_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span><span class="main">]</span>
    Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv1<span class="main">]</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv2<span class="main">]</span> link
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-tree_rank_height"><span class="command">lemma</span></span> tree_rank_height<span class="main">:</span>
  <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span> <span class="main">⟹</span> height_tree <span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="keyword2"><span class="keyword">where</span></span> link<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> link Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv1<span class="main">]</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv2<span class="main">]</span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A binomial tree of height $h$ contains exactly $2^{h}$ elements›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> tree_height_estimate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span> <span class="main">⟹</span> size <span class="main">(</span>tree_to_multiset <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>height_tree <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> tree_rank_estimate<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> tree_rank_height<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*lemma size_mset_tree_Node: "tree_invar (Node e a r ts) ⟹ 
  size (tree_to_multiset (Node e a r ts)) = (2::nat)^r"
  apply(induct r arbitrary: e a ts, simp)
proof -
  case goal1
  from goal1(2) obtain e1 a1 ts1 e2 a2 ts2 where link:
    "(Node e a (Suc r) ts) = link (Node e1 a1 r ts1) (Node e2 a2 r ts2)"
    and inv1: "tree_invar (Node e1 a1 r ts1) "
    and inv2: "tree_invar (Node e2 a2 r ts2)" by simp blast
  from link_length[of "(Node e1 a1 r ts1)" "(Node e2 a2 r ts2)"]
    goal1(1)[OF inv1] goal1(1)[OF inv2] link
  show ?case by simp
qed*)</span>

<span class="keyword1" id="BinomialHeap-size_mset_tree"><span class="command">lemma</span></span> size_mset_tree<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span> <span class="main">⟹</span> 
  size <span class="main">(</span>tree_to_multiset <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>rank <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_rank_estimate BinomialTree.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 


<span class="keyword1" id="BinomialHeap-invar_butlast"><span class="command">lemma</span></span> invar_butlast<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span><span class="free">bq</span> <span class="main">@</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span> invar <span class="free">bq</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">bq</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="BinomialHeap-invar_last_max"><span class="command">lemma</span></span> invar_last_max<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span><span class="free">bq</span> <span class="main">@</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&lt;</span> rank <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">bq</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="BinomialHeap-invar_length"><span class="command">lemma</span></span> invar_length<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">bq</span> <span class="main">⟹</span> length <span class="free">bq</span> <span class="main">≤</span> Suc <span class="main">(</span>rank <span class="main">(</span>last <span class="free">bq</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">xxs</span> <span class="skolem">xx</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> snoc.hyps<span class="main">[</span><span class="operator">OF</span> invar_butlast<span class="main"><span class="main">[</span></span><span class="operator">OF</span> snoc.prems<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
      IH<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">≤</span> Suc <span class="main">(</span>rank <span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> invar_last_max<span class="main">[</span><span class="operator">OF</span> snoc.prems<span class="main">]</span> last_in_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>rank <span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> rank <span class="main">(</span>last <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-size_queue_sum_list"><span class="command">lemma</span></span> size_queue_sum_list<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"size <span class="main">(</span>queue_to_multiset <span class="free">bq</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span>size <span class="main">∘</span> tree_to_multiset<span class="main">)</span> <span class="free">bq</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A binomial heap of length $l$ contains at least $2^l - 1$ elements. 
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> queue_length_estimate_lower<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"invar <span class="free">bq</span> <span class="main">⟹</span> <span class="main">(</span>size <span class="main">(</span>queue_to_multiset <span class="free">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="free">bq</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> snoc.hyps<span class="main">[</span><span class="operator">OF</span> invar_butlast<span class="main"><span class="main">[</span></span><span class="operator">OF</span> snoc.prems<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">xs</span> <span class="main">≤</span> Suc <span class="main">(</span>size <span class="main">(</span>queue_to_multiset <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> size_q<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"size <span class="main">(</span>queue_to_multiset <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    size <span class="main">(</span>queue_to_multiset <span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> size <span class="main">(</span>tree_to_multiset <span class="skolem">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> size_queue_sum_list<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> 
  <span class="keyword1"><span class="command">from</span></span> snoc.prems <span class="keyword1"><span class="command">have</span></span> inv_x<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>tree_to_multiset <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> rank <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> size_mset_tree<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 
    eq<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>queue_to_multiset <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
         size <span class="main">(</span>queue_to_multiset <span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>rank <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> invar_length<span class="main">[</span><span class="operator">OF</span> snoc.prems<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">≤</span> rank <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> snd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> length <span class="skolem">xs</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> rank <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>size <span class="main">(</span>queue_to_multiset <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">xs</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> snd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> 
    Suc <span class="main">(</span>size <span class="main">(</span>queue_to_multiset <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> rank <span class="skolem">x</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Operations›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Empty"</span></span>
<span class="keyword1" id="BinomialHeap-empty_correct"><span class="command">lemma</span></span> empty_correct<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"invar Nil"</span></span>
  <span class="quoted"><span class="quoted">"queue_to_multiset Nil <span class="main">=</span> <span class="main">{#}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The empty multiset is represented by exactly the empty queue›</span></span>
<span class="keyword1" id="BinomialHeap-empty_iff"><span class="command">lemma</span></span> empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">=</span>Nil <span class="main">⟷</span> queue_to_multiset <span class="free">t</span> <span class="main">=</span> <span class="main">{#}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Insert"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Inserts a binomial tree into a binomial queue, such that the queue 
  does not contain two trees of same rank.›</span></span>
<span class="keyword1"><span class="command">fun</span></span>  <span class="entity">ins</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialTree <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialQueue_inv <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialQueue_inv"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ins</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ins</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> 
    <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> 
    <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> 
            <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">ins</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span>       
            <span class="keyword1">else</span> <span class="free">ins</span> <span class="main">(</span>link <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Inserts an element with priority into the queue.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">insert</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'e</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>linorder <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialQueue_inv <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialQueue_inv"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">insert</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">=</span> ins <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span>"</span></span>

<span class="keyword1" id="BinomialHeap-ins_mset"><span class="command">lemma</span></span> ins_mset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tree_invar <span class="free">t</span><span class="main">;</span> queue_invar <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> queue_to_multiset <span class="main">(</span>ins <span class="free">t</span> <span class="free">q</span><span class="main">)</span> 
   <span class="main">=</span> tree_to_multiset <span class="free">t</span> <span class="main">+</span> queue_to_multiset <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> union_ac link_tree_invar<span class="main">)</span>

<span class="keyword1" id="BinomialHeap-insert_mset"><span class="command">lemma</span></span> insert_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span> <span class="main">⟹</span>
  queue_to_multiset <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ins_mset union_ac insert_def<span class="main">)</span>

<span class="keyword1" id="BinomialHeap-ins_queue_invar"><span class="command">lemma</span></span> ins_queue_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tree_invar <span class="free">t</span><span class="main">;</span> queue_invar <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>ins <span class="free">t</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> iv <span class="main">=</span> Cons.hyps
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t</span> <span class="main">=</span> rank <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> True
    <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> 
      inv_a<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inv_q<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="skolem">q</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> inv_link <span class="main">=</span> link_tree_invar<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹tree_invar <span class="skolem">t</span>›</span></span> inv_a True<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> iv<span class="main">[</span><span class="operator">OF</span> inv_link inv_q<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="BinomialHeap-insert_queue_invar"><span class="command">lemma</span></span> insert_queue_invar<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ins_queue_invar<span class="main">[</span><span class="operator">OF</span> inv assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-rank_ins"><span class="command">lemma</span></span>  rank_ins<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> 
  <span class="main">(</span>rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="free">t'</span> <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> rank <span class="free">t</span><span class="main">)</span> <span class="main">∨</span> 
  <span class="main">(</span>rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="free">t'</span> <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> rank <span class="free">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_link<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">bq</span> <span class="skolem">t</span> <span class="skolem">t'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>link <span class="skolem">t'</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> rank <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_link<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">t'</span> <span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span>rank_invar <span class="main">(</span><span class="bound">t</span> <span class="main">#</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">;</span> rank <span class="bound">t'</span> <span class="main">=</span> rank <span class="bound">t</span><span class="main">⟧</span>
      <span class="main">⟹</span> rank <span class="bound">t</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="main">(</span>link <span class="bound">t'</span> <span class="bound">t</span><span class="main">)</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>link <span class="skolem">t'</span> <span class="skolem">t</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="main">(</span>link <span class="main">(</span>link <span class="skolem">t'</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank <span class="skolem">a</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="skolem">a</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="main">(</span>link <span class="main">(</span>link <span class="skolem">t'</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_link<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-rank_ins2"><span class="command">lemma</span></span> rank_ins2<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="free">bq</span> <span class="main">⟹</span> 
  rank <span class="free">t</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="free">t</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
  <span class="main">(</span>rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="free">t</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank <span class="main">(</span>hd <span class="free">bq</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bq</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">bq</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>link <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> rank <span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_link<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> prems r <span class="keyword2"><span class="keyword">and</span></span> prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>link <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-rank_invar_ins"><span class="command">lemma</span></span> rank_invar_ins<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="free">bq</span> <span class="main">⟹</span> rank_invar <span class="main">(</span>ins <span class="free">t</span> <span class="free">bq</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">bq</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="main">(</span>ins <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> prems <span class="keyword1"><span class="command">have</span></span> hd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">a</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="skolem">bq</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span>rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank <span class="main">(</span>hd <span class="skolem">bq</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">bq</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_ins2 rank_invar_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="skolem">a</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span>rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank <span class="main">(</span>hd <span class="skolem">bq</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">bq</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword2"><span class="keyword">and</span></span> inv <span class="keyword2"><span class="keyword">and</span></span> hd <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_hd_cons<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">bq</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword2"><span class="keyword">and</span></span> prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>link <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-rank_invar_insert"><span class="command">lemma</span></span> rank_invar_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="free">bq</span> <span class="main">⟹</span> rank_invar <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">bq</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_ins insert_def<span class="main">)</span>

<span class="keyword1" id="BinomialHeap-insert_correct"><span class="command">lemma</span></span> insert_correct<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"invar <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> insert_queue_invar<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> rank_invar_insert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> insert_mset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> I
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Meld"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Melds two queues.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">meld</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialQueue_inv <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialQueue_inv
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialQueue_inv"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">meld</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">meld</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">meld</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> 
       <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">meld</span> <span class="free"><span class="bound"><span class="entity">bq1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">else</span> <span class="main">(</span>
         <span class="keyword1">if</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">&lt;</span> rank <span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">)</span>
            <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">meld</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span>
            <span class="keyword1">else</span> ins <span class="main">(</span>link <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">meld</span> <span class="free"><span class="bound"><span class="entity">bq1</span></span></span> <span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span>
       <span class="main">)</span>
    <span class="main">)</span>"</span></span>

<span class="keyword1" id="BinomialHeap-meld_queue_invar"><span class="command">lemma</span></span> meld_queue_invar<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>queue_invar <span class="free">q</span><span class="main">;</span> queue_invar <span class="free">q'</span><span class="main">⟧</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> meld.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t1</span> <span class="skolem">bq1</span> <span class="skolem">t2</span> <span class="skolem">bq2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>lt<span class="main">)</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t1</span> <span class="main">&lt;</span> rank <span class="skolem">t2</span>"</span></span> <span class="main">|</span> <span class="main">(</span>gt<span class="main">)</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t1</span> <span class="main">&gt;</span> rank <span class="skolem">t2</span>"</span></span> <span class="main">|</span> <span class="main">(</span>eq<span class="main">)</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t1</span> <span class="main">=</span> rank <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> lt
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_bq1<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="skolem">bq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_t1<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> lt inv_bq1 3<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> inv_t1 lt
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> gt
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_bq2<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="skolem">bq2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> gt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rank <span class="skolem">t1</span> <span class="main">&lt;</span> rank <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this gt 3<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> inv_bq2<span class="main">]</span> inv_t2 gt
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> eq
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_bq1<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="skolem">bq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_t1<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_bq2<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="skolem">bq2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> inv_link <span class="main">=</span> link_tree_invar<span class="main">[</span><span class="operator">OF</span> inv_t1 inv_t2 eq<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rank <span class="skolem">t1</span> <span class="main">&lt;</span> rank <span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">note</span></span> inv_meld <span class="main">=</span> 3<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> * inv_bq1 inv_bq2<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> ins_queue_invar<span class="main">[</span><span class="operator">OF</span> inv_link inv_meld<span class="main">]</span> *
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-rank_ins_min"><span class="command">lemma</span></span> rank_ins_min<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="free">bq</span> <span class="main">⟹</span> 
  rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="free">t</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> min <span class="main">(</span>rank <span class="free">t</span><span class="main">)</span> <span class="main">(</span>rank <span class="main">(</span>hd <span class="free">bq</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">bq</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> prems <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>link <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> rank <span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_link<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword2"><span class="keyword">and</span></span> inv <span class="keyword2"><span class="keyword">and</span></span> prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>link <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-rank_invar_meld_strong"><span class="command">lemma</span></span> rank_invar_meld_strong<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rank_invar <span class="free">bq1</span><span class="main">;</span> rank_invar <span class="free">bq2</span><span class="main">⟧</span> <span class="main">⟹</span> rank_invar <span class="main">(</span>meld <span class="free">bq1</span> <span class="free">bq2</span><span class="main">)</span> <span class="main">∧</span> 
  rank <span class="main">(</span>hd <span class="main">(</span>meld <span class="free">bq1</span> <span class="free">bq2</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> min <span class="main">(</span>rank <span class="main">(</span>hd <span class="free">bq1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rank <span class="main">(</span>hd <span class="free">bq2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq1</span></span> <span class="quoted"><span class="free">bq2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> meld.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t1</span> <span class="skolem">bq1</span> <span class="skolem">t2</span> <span class="skolem">bq2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="skolem">bq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq1</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="skolem">bq2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq2</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  
  <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword2"><span class="keyword">and</span></span> inv2 <span class="keyword2"><span class="keyword">and</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq2</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?meld</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="main">(</span>meld <span class="main">(</span><span class="skolem">t1</span> <span class="main">#</span> <span class="skolem">bq1</span><span class="main">)</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="var">?t</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="var">?bq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_not_empty_hd<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword1"><span class="command">have</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="var">?meld</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="var">?meld</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?meld</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_hd_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="comment1">― ‹analog›</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?meld</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t1</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="main">(</span>meld <span class="skolem">bq1</span> <span class="main">(</span><span class="skolem">t2</span> <span class="main">#</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 2
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="var">?t</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="var">?bq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_not_empty_hd<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword1"><span class="command">have</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="var">?meld</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="var">?meld</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?meld</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_hd_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_ins<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 4 <span class="comment1">(* Ab hier wirds hässlich *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">=</span> rank <span class="skolem">t2</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_link<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"meld <span class="skolem">bq1</span> <span class="main">[]</span> <span class="main">=</span> <span class="skolem">bq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    
    <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword2"><span class="keyword">and</span></span> inv2 <span class="keyword2"><span class="keyword">and</span></span> prems
    <span class="keyword1"><span class="command">have</span></span> mm<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="main">(</span>rank <span class="main">(</span>hd <span class="skolem">bq1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rank <span class="main">(</span>hd <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>meld <span class="skolem">bq1</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rank_invar <span class="main">(</span><span class="skolem">t1</span> <span class="main">#</span> <span class="skolem">bq1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">t1</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="skolem">bq1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_not_empty_hd<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="skolem">bq1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rank_invar <span class="main">(</span><span class="skolem">t2</span> <span class="main">#</span> <span class="skolem">bq2</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq2</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="skolem">bq2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_not_empty_hd<span class="main">)</span>
    
    <span class="keyword1"><span class="command">from</span></span> inv1 r r1 rank_ins_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">bq1</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> abc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">t2</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="skolem">bq1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> inv2 r r2 rank_ins_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">bq2</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> abc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq2</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">t2</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> r1 r2 mm <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">bq1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="skolem">bq2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="main">(</span>meld <span class="skolem">bq1</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹rank_invar <span class="main">(</span>meld <span class="skolem">bq1</span> <span class="skolem">bq2</span><span class="main">)</span>›</span></span> 
      r rank_ins_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"meld <span class="skolem">bq1</span> <span class="skolem">bq2</span>"</span></span> <span class="quoted"><span class="quoted">"link <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">bq1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="skolem">bq2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> 
      rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">(</span>meld <span class="skolem">bq1</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">thm</span></span> rank_ins_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"meld <span class="skolem">bq1</span> <span class="skolem">bq2</span>"</span></span> <span class="quoted"><span class="quoted">"link <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">with</span></span> inv1 <span class="keyword2"><span class="keyword">and</span></span> inv2 <span class="keyword2"><span class="keyword">and</span></span> r m r1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-rank_invar_meld"><span class="command">lemma</span></span> rank_invar_meld<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rank_invar <span class="free">bq1</span><span class="main">;</span> rank_invar <span class="free">bq2</span><span class="main">⟧</span> <span class="main">⟹</span> rank_invar <span class="main">(</span>meld <span class="free">bq1</span> <span class="free">bq2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rank_invar_meld_strong<span class="main">)</span>

<span class="keyword1" id="BinomialHeap-meld_mset"><span class="command">lemma</span></span> meld_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>queue_invar <span class="free">q</span><span class="main">;</span> queue_invar <span class="free">q'</span><span class="main">⟧</span> <span class="main">⟹</span> 
  queue_to_multiset <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span> <span class="main">=</span> 
  queue_to_multiset <span class="free">q</span> <span class="main">+</span> queue_to_multiset <span class="free">q'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> meld.induct<span class="main">)</span>
  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> link_tree_invar meld_queue_invar ins_mset union_ac<span class="main">)</span>

<span class="keyword1" id="BinomialHeap-meld_correct"><span class="command">lemma</span></span> meld_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"invar <span class="free">q'</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"invar <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">+</span> queue_to_multiset <span class="free">q'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> meld_queue_invar rank_invar_meld meld_mset<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Find Minimal Element"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finds the tree containing the minimal element.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">getMinTree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialQueue_inv <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialTree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">getMinTree</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">getMinTree</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> prio <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> prio <span class="main">(</span><span class="free">getMinTree</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> 
     <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">getMinTree</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="BinomialHeap-mintree_exists"><span class="command">lemma</span></span> mintree_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bq</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>getMinTree <span class="free">bq</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons _ <span class="skolem">bq</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-treehead_in_multiset"><span class="command">lemma</span></span> treehead_in_multiset<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">bq</span> <span class="main">⟹</span> <span class="main">(</span>val <span class="free">t</span><span class="main">,</span> prio <span class="free">t</span><span class="main">)</span> <span class="main">∈#</span> queue_to_multiset <span class="free">bq</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 

<span class="keyword1" id="BinomialHeap-heap_ordered_single"><span class="command">lemma</span></span> heap_ordered_single<span class="main">:</span> 
<span class="quoted"><span class="quoted">"heap_ordered <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_mset <span class="main">(</span>tree_to_multiset <span class="free">t</span><span class="main">)</span><span class="main">.</span> prio <span class="free">t</span> <span class="main">≤</span> snd <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BinomialHeap-getMinTree_cons"><span class="command">lemma</span></span> getMinTree_cons<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"prio <span class="main">(</span>getMinTree <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> prio <span class="main">(</span>getMinTree <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> getMinTree.induct<span class="main">)</span> <span class="operator">simp_all</span> 

<span class="keyword1" id="BinomialHeap-getMinTree_min_tree"><span class="command">lemma</span></span> getMinTree_min_tree<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">bq</span>  <span class="main">⟹</span> prio <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="main">≤</span> prio <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> getMinTree.induct<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>   
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">ta</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ta</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> getMinTree_cons prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> set_ConsD xt1<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-getMinTree_min_prio"><span class="command">lemma</span></span> getMinTree_min_prio<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">bq</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set_mset <span class="main">(</span>queue_to_multiset <span class="free">bq</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prio <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="main">≤</span> snd <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bq</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">t</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">.</span> <span class="main">(</span><span class="free">y</span> <span class="main">∈</span> set_mset <span class="main">(</span><span class="main">(</span>tree_to_multiset <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bq</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set_mset <span class="main">(</span>tree_to_multiset <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> O<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> set <span class="free">bq</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set_mset <span class="main">(</span>tree_to_multiset <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">ts</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">r</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> O assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> queue_invar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tree_invar_heap_ordered<span class="main">[</span><span class="operator">OF</span> inv<span class="main">]</span> heap_ordered.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">]</span> O
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prio <span class="skolem">t</span> <span class="main">≤</span> snd <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> getMinTree_min_tree<span class="main">[</span><span class="operator">OF</span> O<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finds the minimal Element in the queue.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">findMin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialQueue_inv <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">findMin</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">min</span> <span class="main">=</span> getMinTree <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>val <span class="bound">min</span><span class="main">,</span> prio <span class="bound">min</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BinomialHeap-findMin_correct"><span class="command">lemma</span></span> findMin_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> Nil"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"findMin <span class="free">q</span> <span class="main">∈#</span> queue_to_multiset <span class="free">q</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>queue_to_multiset <span class="free">q</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> snd <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> NE <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span> <span class="main">∈</span> set <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mintree_exists<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"findMin <span class="free">q</span> <span class="main">∈#</span> queue_to_multiset <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> treehead_in_multiset Let_def findMin_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>queue_to_multiset <span class="free">q</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> snd <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> I<span class="main">[</span><span class="operator">unfolded</span> invar_def<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> getMinTree_min_prio Let_def findMin_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Delete Minimal Element"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Removes the first tree, which has the priority $a$ within his root.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">remove1Prio</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialQueue_inv <span class="main">⇒</span>
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialQueue_inv"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">remove1Prio</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">remove1Prio</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">remove1Prio</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Returns the queue without the minimal element.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deleteMin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialQueue_inv <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialQueue_inv"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deleteMin</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">min</span> <span class="main">=</span> getMinTree <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="keyword1">in</span> 
                    meld <span class="main">(</span>rev <span class="main">(</span>children <span class="bound">min</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">(</span>remove1Prio <span class="main">(</span>prio <span class="bound">min</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BinomialHeap-queue_invar_rev"><span class="command">lemma</span></span> queue_invar_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>rev <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> queue_invar_def<span class="main">)</span>

<span class="keyword1" id="BinomialHeap-queue_invar_remove1"><span class="command">lemma</span></span> queue_invar_remove1<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>remove1 <span class="free">t</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> queue_invar_def<span class="main">)</span>

<span class="keyword1" id="BinomialHeap-qtm_in_set_subset"><span class="command">lemma</span></span> qtm_in_set_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">q</span> <span class="main">⟹</span> 
  tree_to_multiset <span class="free">t</span> <span class="main">⊆#</span> queue_to_multiset <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> t_in_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="skolem">q</span> <span class="main">⊆#</span> queue_to_multiset <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> subset_mset.order_trans<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> t_in_q<span class="main"><span class="main">]</span></span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="BinomialHeap-remove1_mset"><span class="command">lemma</span></span> remove1_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">q</span> <span class="main">⟹</span> 
  queue_to_multiset <span class="main">(</span>remove1 <span class="free">t</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> 
  queue_to_multiset <span class="free">q</span> <span class="main">-</span> tree_to_multiset <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qtm_in_set_subset<span class="main">)</span>

<span class="keyword1" id="BinomialHeap-remove1Prio_remove1"><span class="command">lemma</span></span> remove1Prio_remove1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"remove1Prio <span class="main">(</span>prio <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span><span class="main">)</span> <span class="free">bq</span> <span class="main">=</span> remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">note</span></span> iv <span class="main">=</span> Cons
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> getMinTree <span class="main">(</span><span class="skolem">t</span> <span class="main">#</span> <span class="skolem">bq</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> iv <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> down<span class="main">:</span> <span class="quoted"><span class="quoted">"getMinTree <span class="main">(</span><span class="skolem">t</span> <span class="main">#</span> <span class="skolem">bq</span><span class="main">)</span> <span class="main">=</span> getMinTree <span class="skolem">bq</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">bq</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> getMinTree.induct<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ne False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prio <span class="skolem">t</span> <span class="main">≠</span> prio <span class="main">(</span>getMinTree <span class="skolem">bq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">bq</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> getMinTree.induct<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> down iv False ne <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="BinomialHeap-deleteMin_queue_invar"><span class="command">lemma</span></span> deleteMin_queue_invar<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> INV<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> Nil"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Cons
  <span class="keyword1"><span class="command">from</span></span> NE <span class="keyword2"><span class="keyword">and</span></span> mintree_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> INV 
  <span class="keyword1"><span class="command">have</span></span> inv_min<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> queue_invar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> inv_children <span class="main">=</span> invar_children'<span class="main">[</span><span class="operator">OF</span> inv_min<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_rev <span class="main">=</span> queue_invar_rev<span class="main">[</span><span class="operator">OF</span> inv_children<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_rem <span class="main">=</span> queue_invar_remove1<span class="main">[</span><span class="operator">OF</span> INV<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> meld_queue_invar<span class="main">[</span><span class="operator">OF</span> inv_rev inv_rem<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-children_rank_less"><span class="command">lemma</span></span> children_rank_less<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t'</span> <span class="main">∈</span> set <span class="main">(</span>children <span class="free">t</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t'</span> <span class="main">&lt;</span> rank <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">nat</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">nat</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      O<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_invar.simps<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> ch_id<span class="main">:</span> <span class="quoted"><span class="quoted">"children <span class="skolem">t</span> <span class="main">=</span> 
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span> <span class="keyword1">then</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">#</span><span class="skolem">ts1</span> 
       <span class="keyword1">else</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">#</span><span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">from</span></span> O Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts1</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span>  p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t'</span><span class="main">∈</span>set <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t'</span> <span class="main">&lt;</span> Suc <span class="skolem">nat</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> O Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts2</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t'</span><span class="main">∈</span>set <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t'</span> <span class="main">&lt;</span> Suc <span class="skolem">nat</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>3<span class="main">)</span> p1 p2 ch_id <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-strong_rev_children"><span class="command">lemma</span></span> strong_rev_children<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">(</span>children <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">nat</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span>rev <span class="main">(</span>children <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> rank_invar <span class="main">(</span>rev <span class="main">(</span>children <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="skolem">nat</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      O<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_invar.simps<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> ch_id<span class="main">:</span> <span class="quoted"><span class="quoted">"children <span class="skolem">t</span> <span class="main">=</span> 
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span> <span class="keyword1">then</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">#</span><span class="skolem">ts1</span> 
       <span class="keyword1">else</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">#</span><span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">from</span></span> O Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> rev_ts1<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="skolem">ts1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> O children_rank_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="main">(</span>rev <span class="skolem">ts1</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&lt;</span> rank <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> O rev_ts1 invar_app_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ts1</span>"</span></span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">from</span></span> O Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> rev_ts2<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> O children_rank_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="main">(</span>rev <span class="skolem">ts2</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&lt;</span> rank <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> O rev_ts2 invar_app_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="skolem">ts2</span>"</span></span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">from</span></span> p1 p2 ch_id <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-first_less"><span class="command">lemma</span></span> first_less<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">t'</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">.</span> rank <span class="free">t</span> <span class="main">&lt;</span> rank <span class="bound">t'</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> order_le_less rank_invar.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> set_ConsD xt1<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinomialHeap-strong_remove1"><span class="command">lemma</span></span> strong_remove1<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">bq</span> <span class="main">⟹</span> invar <span class="main">(</span>remove1 <span class="free">t</span> <span class="free">bq</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bq</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invar_cons_down<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invar_cons_down<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> si1<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> invar <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"remove1 <span class="skolem">t</span> <span class="skolem">bq</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">with</span></span> si1 Cons<span class="main">(</span>2<span class="main">)</span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Cons'<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">aa</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Cons first_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bq</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">.</span> rank <span class="skolem">a</span> <span class="main">&lt;</span> rank <span class="bound">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> notin_set_remove1 invar_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">with</span></span> Cons' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="skolem">a</span> <span class="main">&lt;</span> rank <span class="skolem">aa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> si1 Cons<span class="main">(</span>2<span class="main">)</span> False Cons' invar_cons_up<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">theorem</span></span> deleteMin_invar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invar <span class="free">bq</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">bq</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>deleteMin <span class="free">bq</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>deleteMin <span class="free">bq</span><span class="main">)</span> <span class="main">=</span> 
    invar <span class="main">(</span>meld <span class="main">(</span>rev <span class="main">(</span>children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms mintree_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bq</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> ti<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def Let_def queue_invar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> strong_rev_children<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">bq</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">(</span>children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> strong_remove1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bq</span>"</span></span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">bq</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> meld_correct<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="main">(</span>children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span>"</span></span><span class="main">]</span> m1 m2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>meld <span class="main">(</span>rev <span class="main">(</span>children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-children_mset"><span class="command">lemma</span></span> children_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>children <span class="free">t</span><span class="main">)</span> <span class="main">=</span> 
  tree_to_multiset <span class="free">t</span> <span class="main">-</span> <span class="main">{#</span> <span class="main">(</span>val <span class="free">t</span><span class="main">,</span> prio <span class="free">t</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">nat</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-deleteMin_mset"><span class="command">lemma</span></span> deleteMin_mset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> Nil"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">-</span> <span class="main">{#</span> <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms mintree_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">q</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> min_in_q<span class="main">:</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span> <span class="main">∈</span> set <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_min<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> queue_invar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> q_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> inv_children <span class="main">=</span> invar_children'<span class="main">[</span><span class="operator">OF</span> inv_min<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_rev <span class="main">=</span> queue_invar_rev<span class="main">[</span><span class="operator">OF</span> inv_children<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_rem <span class="main">=</span> queue_invar_remove1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> m_meld <span class="main">=</span> meld_mset<span class="main">[</span><span class="operator">OF</span> inv_rev inv_rem<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> m_rem <span class="main">=</span> remove1_mset<span class="main">[</span><span class="operator">OF</span> min_in_q<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> m_rev <span class="main">=</span> qtmset_rev<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"children <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> m_children <span class="main">=</span> children_mset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> min_subset_q <span class="main">=</span> qtm_in_set_subset<span class="main">[</span><span class="operator">OF</span> min_in_q<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?MT</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tree_to_multiset <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> q_ne <span class="keyword1"><span class="command">have</span></span> head_subset_min<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>val <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span><span class="main">,</span> prio <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span> <span class="main">⊆#</span> <span class="var">?MT</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span>"</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?MT</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tree_to_multiset <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> m_meld m_rem m_rev m_children 
    multiset_diff_union_assoc<span class="main">[</span><span class="operator">OF</span> head_subset_min<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">-</span> <span class="var">?MT</span>"</span></span><span class="main">]</span>
    mset_subset_eq_multiset_union_diff_commute<span class="main">[</span><span class="operator">OF</span> min_subset_q<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?MT</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_def union_ac Let_def findMin_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinomialHeap-deleteMin_correct"><span class="command">lemma</span></span> deleteMin_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> INV<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> Nil"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"invar <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">-</span> <span class="main">{#</span> <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deleteMin_invar deleteMin_mset INV NE
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> BinomialHeapStruc<span class="main">:</span> BinomialHeapStruc_loc <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Hiding the Invariant"</span></span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Datatype"</span></span>
<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BinomialHeap <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">q</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BinomialHeapStruc.BinomialQueue_inv<span class="main">.</span> BinomialHeapStruc.invar <span class="bound">q</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Nil"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinomialHeap-Rep_BinomialHeap_invar"><span class="command">lemma</span></span> Rep_BinomialHeap_invar<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"BinomialHeapStruc.invar <span class="main">(</span>Rep_BinomialHeap <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_BinomialHeap
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"BinomialHeapStruc.invar <span class="free">q</span> <span class="main">⟹</span> Rep_BinomialHeap <span class="main">(</span>Abs_BinomialHeap <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Abs_BinomialHeap_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstype</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_BinomialHeap <span class="main">(</span>Rep_BinomialHeap <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_BinomialHeap_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> BinomialHeap_loc
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Operations"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">to_mset</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">==</span> BinomialHeapStruc.queue_to_multiset <span class="main">(</span>Rep_BinomialHeap <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">empty</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">empty</span> <span class="main">==</span> Abs_BinomialHeap Nil"</span></span> 
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_BinomialHeap empty <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> empty_def<span class="main">)</span> <span class="operator">simp</span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">isEmpty</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">==</span> Rep_BinomialHeap <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> Nil"</span></span>
  <span class="keyword1" id="BinomialHeap-empty_rep"><span class="command">lemma</span></span> empty_rep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span>empty <span class="main">⟷</span> Rep_BinomialHeap <span class="free">q</span> <span class="main">=</span> Nil"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Rep_BinomialHeap_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="BinomialHeap-isEmpty_correct"><span class="command">lemma</span></span> isEmpty_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"isEmpty <span class="free">q</span> <span class="main">⟷</span> <span class="free">q</span><span class="main">=</span>empty"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_rep isEmpty_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">definition</span></span> 
    <span class="entity">insert</span> 
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'e</span>  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BinomialHeap <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BinomialHeap"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">insert</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">==</span> 
            Abs_BinomialHeap <span class="main">(</span>BinomialHeapStruc.insert <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Rep_BinomialHeap <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span><span class="main">]</span><span class="main">:</span> 
    <span class="quoted"><span class="quoted">"Rep_BinomialHeap <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> 
    <span class="main">=</span> BinomialHeapStruc.insert <span class="free">e</span> <span class="free">a</span> <span class="main">(</span>Rep_BinomialHeap <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_def BinomialHeapStruc.insert_correct<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">findMin</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">==</span> BinomialHeapStruc.findMin <span class="main">(</span>Rep_BinomialHeap <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">deleteMin</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">==</span> 
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span>empty <span class="keyword1">then</span> empty 
    <span class="keyword1">else</span> Abs_BinomialHeap <span class="main">(</span>BinomialHeapStruc.deleteMin <span class="main">(</span>Rep_BinomialHeap <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    In this lemma, we do not use equality, but case-distinction for checking 
    non-emptyness. That prevents the code generator from introducing
    an equality-class parameter for the entry type <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'a›</span></span></span></span>.
›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_BinomialHeap <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>Rep_BinomialHeap <span class="free">q</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">[]</span> <span class="main">|</span>
     <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> BinomialHeapStruc.deleteMin <span class="main">(</span>Rep_BinomialHeap <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Rep_BinomialHeap <span class="free">q</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nil<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_def BinomialHeapStruc.deleteMin_correct 
      BinomialHeapStruc.empty_iff empty_rep Nil<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_BinomialHeap <span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> NE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_def BinomialHeapStruc.deleteMin_correct 
        BinomialHeapStruc.empty_iff empty_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">(*
  lemma [code abstract]: "Rep_BinomialHeap (deleteMin q) =
    (if (Rep_BinomialHeap q = []) then [] 
     else BinomialHeapStruc.deleteMin (Rep_BinomialHeap q))"
    by (auto simp add: deleteMin_def BinomialHeapStruc.deleteMin_correct 
      BinomialHeapStruc.empty_iff empty_rep)
      *)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">meld</span> <span class="free"><span class="bound"><span class="entity">q1</span></span></span> <span class="free"><span class="bound"><span class="entity">q2</span></span></span> <span class="main">==</span> 
    Abs_BinomialHeap <span class="main">(</span>BinomialHeapStruc.meld <span class="main">(</span>Rep_BinomialHeap <span class="free"><span class="bound"><span class="entity">q1</span></span></span><span class="main">)</span> 
                                             <span class="main">(</span>Rep_BinomialHeap <span class="free"><span class="bound"><span class="entity">q2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"Rep_BinomialHeap <span class="main">(</span>meld <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> 
    <span class="main">=</span> BinomialHeapStruc.meld <span class="main">(</span>Rep_BinomialHeap <span class="free">q1</span><span class="main">)</span> <span class="main">(</span>Rep_BinomialHeap <span class="free">q2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> meld_def BinomialHeapStruc.meld_correct<span class="main">)</span>


  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Correctness"</span></span>

  <span class="keyword1" id="BinomialHeap-empty_correct"><span class="command">lemma</span></span> empty_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"to_mset <span class="free">q</span> <span class="main">=</span> <span class="main">{#}</span> <span class="main">⟷</span> <span class="free">q</span><span class="main">=</span>empty"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_mset_def BinomialHeapStruc.empty_iff empty_rep<span class="main">)</span>

  <span class="keyword1" id="BinomialHeap-to_mset_of_empty"><span class="command">lemma</span></span> to_mset_of_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"to_mset empty <span class="main">=</span> <span class="main">{#}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_correct<span class="main">)</span>

  <span class="keyword1" id="BinomialHeap-insert_correct"><span class="command">lemma</span></span> insert_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"to_mset <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> to_mset <span class="free">q</span> <span class="main">+</span> <span class="main">{#</span><span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> insert_def to_mset_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BinomialHeapStruc.insert_correct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="BinomialHeap-findMin_correct"><span class="command">lemma</span></span> findMin_correct<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span>empty"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> 
    <span class="quoted"><span class="quoted">"findMin <span class="free">q</span> <span class="main">∈#</span> to_mset <span class="free">q</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>to_mset <span class="free">q</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> snd <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> findMin_def to_mset_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_rep BinomialHeapStruc.findMin_correct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="BinomialHeap-deleteMin_correct"><span class="command">lemma</span></span> deleteMin_correct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span>empty"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_mset <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span> <span class="main">=</span> to_mset <span class="free">q</span> <span class="main">-</span> <span class="main">{#</span> findMin <span class="free">q</span> <span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> findMin_def deleteMin_def to_mset_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_rep BinomialHeapStruc.deleteMin_correct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="BinomialHeap-meld_correct"><span class="command">lemma</span></span> meld_correct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_mset <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span> <span class="main">=</span> to_mset <span class="free">q</span> <span class="main">+</span> to_mset <span class="free">q'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> to_mset_def meld_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BinomialHeapStruc.meld_correct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Correctness lemmas to be used with simplifier›</span></span>
  <span class="keyword1"><span class="command">lemmas</span></span> correct <span class="main">=</span> empty_correct deleteMin_correct meld_correct

  <span class="keyword2"><span class="keyword">end</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> BinomialHeap<span class="main">:</span> BinomialHeap_loc <span class="keyword1"><span class="command">.</span></span>
  

  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Documentation"</span></span>

<span class="comment1">(*#DOC
  fun [no_spec] BinomialHeap.to_mset
    Abstraction to multiset.

  fun BinomialHeap.empty
    The empty heap. ($O(1)$)

  fun BinomialHeap.isEmpty
    Checks whether heap is empty. Mainly used to work around 
    code-generation issues. ($O(1)$)

  fun BinomialHeap.insert
    Inserts element ($O(\log(n))$)

  fun BinomialHeap.findMin
    Returns a minimal element ($O(\log(n))$)

  fun BinomialHeap.deleteMin
    Deletes {\em the} element that is returned by {\em find\_min}

  fun [long_type] BinomialHeap.meld
    Melds two heaps ($O(\log(n+m))$)

*)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> <span class="quoted"><span class="quoted">"BinomialHeap.to_mset"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}\\
        Abstraction to multiset.\\


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> <span class="quoted"><span class="quoted">"BinomialHeap.empty"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}\\
        The empty heap. ($O(1)$)\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>BinomialHeap.empty_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] BinomialHeap.empty_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> <span class="quoted"><span class="quoted">"BinomialHeap.isEmpty"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}\\
        Checks whether heap is empty. Mainly used to work around
    code-generation issues. ($O(1)$)\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>BinomialHeap.isEmpty_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] BinomialHeap.isEmpty_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> <span class="quoted"><span class="quoted">"BinomialHeap.insert"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}\\
        Inserts element ($O(\log(n))$)\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>BinomialHeap.insert_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] BinomialHeap.insert_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> <span class="quoted"><span class="quoted">"BinomialHeap.findMin"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}\\
        Returns a minimal element ($O(\log(n))$)\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>BinomialHeap.findMin_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] BinomialHeap.findMin_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> <span class="quoted"><span class="quoted">"BinomialHeap.deleteMin"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}\\
        Deletes {\em the} element that is returned by {\em find\_min}\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>BinomialHeap.deleteMin_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] BinomialHeap.deleteMin_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"BinomialHeap.meld"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> [display] <span class="quoted"><span class="quoted">"BinomialHeap.meld"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
        Melds two heaps ($O(\log(n+m))$)\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>BinomialHeap.meld_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] BinomialHeap.meld_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

›</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SkewBinomialHeap">
<div class="head">
<h1>Theory SkewBinomialHeap</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Skew Binomial Heaps"</span></span>

<span class="keyword1"><span class="command">theory</span></span> SkewBinomialHeap
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Skew Binomial Queues as specified by Brodal and Okasaki \cite{BrOk96}
  are a data structure for priority queues with worst case O(1) {\em findMin}, 
  {\em insert}, and {\em meld} operations, and worst-case logarithmic 
  {\em deleteMin} operation.
  They are derived from priority queues in three steps:
    \begin{enumerate}
      \item Skew binomial trees are used to eliminate the possibility of 
            cascading links during insert operations. This reduces the complexity
            of an insert operation to $O(1)$.
      \item The current minimal element is cached. This approach, known as 
            {\em global root}, reduces the cost of a {\em findMin}-operation to
            O(1).
      \item By allowing skew binomial queues to contain skew binomial queues,
            the cost for meld-operations is reduced to $O(1)$. This approach
            is known as {\em data-structural bootstrapping}.
    \end{enumerate}

  In this theory, we combine Steps~2 and 3, i.e. we first implement skew binomial
  queues, and then bootstrap them. The bootstrapping implicitly introduces a 
  global root, such that we also get a constant time findMin operation.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> SkewBinomialHeapStruc_loc
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Datatype"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialTree <span class="main">=</span> 
  Node <span class="main">(</span><span class="free"><span class="entity">val</span></span><span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'e</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">prio</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linorder"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">rank</span></span><span class="main">:</span> <span class="quoted">nat</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">children</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialTree list"</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialTree list"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Abstraction to Multisets"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Returns a multiset with all (element, priority) pairs from a queue›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tree_to_multiset</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialTree <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> multiset"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">queue_to_multiset</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> multiset"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tree_to_multiset</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">#}</span> <span class="main">+</span> <span class="free">queue_to_multiset</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">queue_to_multiset</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{#}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">queue_to_multiset</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">tree_to_multiset</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">+</span> <span class="free">queue_to_multiset</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-ttm_children"><span class="command">lemma</span></span> ttm_children<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_to_multiset <span class="free">t</span> <span class="main">=</span> 
  <span class="main">{#</span><span class="main">(</span>val <span class="free">t</span><span class="main">,</span>prio <span class="free">t</span><span class="main">)</span><span class="main">#}</span> <span class="main">+</span> queue_to_multiset <span class="main">(</span>children <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(*lemma qtm_cons[simp]: "queue_to_multiset (t#q)
  = queue_to_multiset q + tree_to_multiset t"
  apply(induct q arbitrary: t)
  apply simp
  apply(auto simp add: union_ac)
done*)</span>

<span class="keyword1" id="SkewBinomialHeap-qtm_conc"><span class="command">lemma</span></span> qtm_conc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span><span class="free">q</span><span class="main">@</span><span class="free">q'</span><span class="main">)</span> 
  <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">+</span> queue_to_multiset <span class="free">q'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_ac<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Invariant"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Link two trees of rank $r$ to a new tree of rank $r+1$›</span></span>
<span class="keyword1"><span class="command">fun</span></span>  <span class="entity">link</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialTree <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialTree <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialTree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">link</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">ts1</span></span></span><span class="main">)</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">ts2</span></span></span><span class="main">)</span> <span class="main">=</span> 
   <span class="main">(</span><span class="keyword1">if</span>  <span class="free"><span class="bound"><span class="entity">a1</span></span></span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">a2</span></span></span> 
     <span class="keyword1">then</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">ts2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ts1</span></span></span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">ts1</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ts2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Link two trees of rank $r$ and a new element to a new tree of 
  rank $r+1$›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">skewlink</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'e</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>linorder <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialTree <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialTree <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialTree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">skewlink</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span>
  <span class="keyword1">then</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">]</span><span class="main">)</span>
  <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> 
   <span class="keyword1">then</span> 
    Node <span class="main">(</span>val <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>  <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>  <span class="main">(</span>Suc <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">[]</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> children <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>
   <span class="keyword1">else</span> 
    Node <span class="main">(</span>val <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">[]</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> children <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The invariant for trees claims that a tree labeled rank $0$ has no children, 
  and a tree labeled rank $r + 1$ is the result of an ordinary link or 
  a skew link of two trees with rank $r$.›</span></span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">tree_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialTree <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tree_invar</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">tree_invar</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">e1</span> <span class="bound">a1</span> <span class="bound">ts1</span> <span class="bound">e2</span> <span class="bound">a2</span> <span class="bound">ts2</span> <span class="bound">e'</span> <span class="bound">a'</span><span class="main">.</span> 
  <span class="free">tree_invar</span> <span class="main">(</span>Node <span class="bound">e1</span> <span class="bound">a1</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">ts1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">tree_invar</span> <span class="main">(</span>Node <span class="bound">e2</span> <span class="bound">a2</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">ts2</span><span class="main">)</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="bound">e1</span> <span class="bound">a1</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="bound">e2</span> <span class="bound">a2</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">ts2</span><span class="main">)</span> <span class="main">∨</span> 
   <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> skewlink <span class="bound">e'</span> <span class="bound">a'</span> <span class="main">(</span>Node <span class="bound">e1</span> <span class="bound">a1</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="bound">e2</span> <span class="bound">a2</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">ts2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure rank"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A heap satisfies the invariant, if all contained trees satisfy the 
  invariant, the ranks of the trees in the heap are distinct, except that the
  first two trees may have same rank, and the ranks are ordered in ascending 
  order.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First part: All trees inside the queue satisfy the invariant.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">queue_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">queue_invar</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">.</span> tree_invar <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-queue_invar_simps"><span class="command">lemma</span></span> queue_invar_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"queue_invar <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span><span class="free">t</span><span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">⟷</span> tree_invar <span class="free">t</span> <span class="main">∧</span> queue_invar <span class="free">q</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span><span class="free">q</span><span class="main">@</span><span class="free">q'</span><span class="main">)</span> <span class="main">⟷</span> queue_invar <span class="free">q</span> <span class="main">∧</span> queue_invar <span class="free">q'</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span> <span class="main">⟹</span> <span class="free">t</span><span class="main">∈</span>set <span class="free">q</span> <span class="main">⟹</span> tree_invar <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> queue_invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Second part: The ranks of the trees in the heap are distinct, 
  except that the first two trees may have same rank, and the ranks are 
  ordered in ascending order.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For tail of queue›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rank_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rank_invar</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rank_invar</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rank_invar</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">&lt;</span> rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">∧</span> <span class="free">rank_invar</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For whole queue: First two elements may have same rank›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rank_skew_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rank_skew_invar</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rank_skew_invar</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rank_skew_invar</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">∧</span> rank_invar <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tail_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tail_invar</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">=</span> <span class="main">(</span>queue_invar <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">∧</span> rank_invar <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">=</span> <span class="main">(</span>queue_invar <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">∧</span> rank_skew_invar <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-invar_empty"><span class="command">lemma</span></span> invar_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"invar <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"tail_invar <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def tail_invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="SkewBinomialHeap-invar_tail_invar"><span class="command">lemma</span></span> invar_tail_invar<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> tail_invar <span class="free">bq</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def tail_invar_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="SkewBinomialHeap-link_mset"><span class="command">lemma</span></span> link_mset<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tree_to_multiset <span class="main">(</span>link <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> 
                  <span class="main">=</span> tree_to_multiset <span class="free">t1</span> <span class="main">+</span>tree_to_multiset <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>union_ac<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-link_tree_invar"><span class="command">lemma</span></span> link_tree_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tree_invar <span class="free">t1</span><span class="main">;</span> tree_invar <span class="free">t2</span><span class="main">;</span> rank <span class="free">t1</span> <span class="main">=</span> rank <span class="free">t2</span><span class="main">⟧</span> <span class="main">⟹</span>
  tree_invar <span class="main">(</span>link <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-skewlink_mset"><span class="command">lemma</span></span> skewlink_mset<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tree_to_multiset <span class="main">(</span>skewlink <span class="free">e</span> <span class="free">a</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> 
  <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">#}</span> <span class="main">+</span>  tree_to_multiset <span class="free">t1</span> <span class="main">+</span> tree_to_multiset <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>union_ac<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-skewlink_tree_invar"><span class="command">lemma</span></span> skewlink_tree_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tree_invar <span class="free">t1</span><span class="main">;</span> tree_invar <span class="free">t2</span><span class="main">;</span> rank <span class="free">t1</span> <span class="main">=</span> rank <span class="free">t2</span><span class="main">⟧</span> <span class="main">⟹</span> 
  tree_invar <span class="main">(</span>skewlink <span class="free">e</span> <span class="free">a</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>


<span class="keyword1" id="SkewBinomialHeap-rank_link"><span class="command">lemma</span></span> rank_link<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">t</span> <span class="main">=</span> rank <span class="free">t'</span> <span class="main">⟹</span> rank <span class="main">(</span>link <span class="free">t</span> <span class="free">t'</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">t</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t'</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-rank_skew_rank_invar"><span class="command">lemma</span></span> rank_skew_rank_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_skew_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> rank_invar <span class="free">bq</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="SkewBinomialHeap-rank_invar_rank_skew"><span class="command">lemma</span></span> rank_invar_rank_skew<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rank_invar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank_skew_invar <span class="free">q</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons _ <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-rank_invar_cons_up"><span class="command">lemma</span></span> rank_invar_cons_up<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span><span class="main">;</span> rank <span class="free">t'</span> <span class="main">&lt;</span> rank <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> rank_invar <span class="main">(</span><span class="free">t'</span> <span class="main">#</span> <span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  

<span class="keyword1" id="SkewBinomialHeap-rank_skew_cons_up"><span class="command">lemma</span></span> rank_skew_cons_up<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span><span class="main">;</span> rank <span class="free">t'</span> <span class="main">≤</span> rank <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> rank_skew_invar <span class="main">(</span><span class="free">t'</span> <span class="main">#</span> <span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SkewBinomialHeap-rank_invar_cons_down"><span class="command">lemma</span></span> rank_invar_cons_down<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> rank_invar <span class="free">bq</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="SkewBinomialHeap-rank_invar_hd_cons"><span class="command">lemma</span></span> rank_invar_hd_cons<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rank_invar <span class="free">bq</span><span class="main">;</span> rank <span class="free">t</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="free">bq</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="SkewBinomialHeap-tail_invar_cons_up"><span class="command">lemma</span></span> tail_invar_cons_up<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tail_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span><span class="main">;</span> rank <span class="free">t'</span> <span class="main">&lt;</span> rank <span class="free">t</span><span class="main">;</span> tree_invar <span class="free">t'</span><span class="main">⟧</span> 
  <span class="main">⟹</span> tail_invar <span class="main">(</span><span class="free">t'</span> <span class="main">#</span> <span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> tail_invar_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-tail_invar_cons_up_invar"><span class="command">lemma</span></span> tail_invar_cons_up_invar<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tail_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span><span class="main">;</span> rank <span class="free">t'</span> <span class="main">≤</span> rank <span class="free">t</span><span class="main">;</span> tree_invar <span class="free">t'</span><span class="main">⟧</span> <span class="main">⟹</span> invar <span class="main">(</span><span class="free">t'</span> <span class="main">#</span> <span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def tail_invar_def<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-tail_invar_cons_down"><span class="command">lemma</span></span> tail_invar_cons_down<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"tail_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> tail_invar <span class="free">bq</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> tail_invar_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="SkewBinomialHeap-tail_invar_app_single"><span class="command">lemma</span></span> tail_invar_app_single<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tail_invar <span class="free">bq</span><span class="main">;</span> <span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&lt;</span> rank <span class="free">t'</span><span class="main">;</span> tree_invar <span class="free">t'</span><span class="main">⟧</span> 
    <span class="main">⟹</span> tail_invar <span class="main">(</span><span class="free">bq</span> <span class="main">@</span> <span class="main">[</span><span class="free">t'</span><span class="main">]</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_invar_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bq</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹tail_invar <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">bq</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail_invar <span class="skolem">bq</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tail_invar_cons_down<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail_invar <span class="main">(</span><span class="skolem">bq</span> <span class="main">@</span> <span class="main">[</span><span class="free">t'</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_invar_cons_up tail_invar_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-invar_app_single"><span class="command">lemma</span></span> invar_app_single<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>invar <span class="free">bq</span><span class="main">;</span> <span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&lt;</span> rank <span class="free">t'</span><span class="main">;</span> tree_invar <span class="free">t'</span><span class="main">⟧</span> 
   <span class="main">⟹</span> invar <span class="main">(</span><span class="free">bq</span> <span class="main">@</span> <span class="main">[</span><span class="free">t'</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bq</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Cons'<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">ta</span> <span class="skolem">qa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"tail_invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invar_tail_invar<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="skolem">bq</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&lt;</span> rank <span class="free">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> a1 a2 Cons<span class="main">(</span>4<span class="main">)</span> tail_invar_app_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t'</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail_invar <span class="main">(</span><span class="skolem">bq</span> <span class="main">@</span> <span class="main">[</span><span class="free">t'</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Cons Cons' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_invar_cons_up_invar invar_def tail_invar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-invar_children"><span class="command">lemma</span></span> invar_children<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span><span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialTree<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span>  
    inv_t1<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    inv_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    link_or_skew<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> 
       <span class="main">=</span> skewlink <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_invar.simps<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv_t1<span class="main">]</span> inv_t2 
  <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv_t2<span class="main">]</span> inv_t1 
  <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span> 
      <span class="keyword1">then</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span> 
      <span class="keyword1">else</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> case1 case2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> link_or_skew 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span> <span class="main">=</span> 
      skewlink <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">a1</span> <span class="main">∧</span> <span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">a2</span>
      <span class="keyword1">then</span> <span class="main">[</span><span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">]</span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span> 
        <span class="keyword1">then</span> <span class="main">(</span>Node <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span>
        <span class="keyword1">else</span> <span class="main">(</span>Node <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> case1 case2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Heap Order"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">heap_ordered</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialTree <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_ordered</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> 
   <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_mset <span class="main">(</span>queue_to_multiset <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> snd <span class="bound">x</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The invariant for trees implies heap order.›</span></span>
<span class="keyword1" id="SkewBinomialHeap-tree_invar_heap_ordered"><span class="command">lemma</span></span> tree_invar_heap_ordered<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialTree"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"heap_ordered <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">nat</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">nat</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      inv_t1<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      inv_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      link_or_skew<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> link <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">∨</span> <span class="skolem">t</span> <span class="main">=</span> skewlink <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      eq_t1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      eq_t2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_invar.simps<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">note</span></span> heap_t1 <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv_t1 eq_t1<span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> heap_t2 <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv_t2 eq_t2<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> link_or_skew heap_t1 heap_t2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> link <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(***********************************************************)</span>



<span class="comment1">(***********************************************************)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Height and Length"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Although complexity of HOL-functions cannot be expressed within 
  HOL, we can express the height and length of a binomial heap.
  By showing that both, height and length, are logarithmic in the number 
  of contained elements, we give strong evidence that our functions have
  logarithmic complexity in the number of elements.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Height of a tree and queue›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">height_tree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span><span class="main">)</span> SkewBinomialTree <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="entity">height_queue</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span><span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> nat"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">height_tree</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">height_queue</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">height_queue</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">height_queue</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>Suc <span class="main">(</span><span class="free">height_tree</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">height_queue</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-link_length"><span class="command">lemma</span></span> link_length<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>tree_to_multiset <span class="main">(</span>link <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  size <span class="main">(</span>tree_to_multiset <span class="free">t1</span><span class="main">)</span> <span class="main">+</span> size <span class="main">(</span>tree_to_multiset <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-tree_rank_estimate_upper"><span class="command">lemma</span></span> tree_rank_estimate_upper<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span> <span class="main">⟹</span> 
   size <span class="main">(</span>tree_to_multiset <span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="free">r</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    link<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">∨</span>
       <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> skewlink <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">note</span></span> iv1 <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv1<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> iv2 <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv2<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> link Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> iv1 iv2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> link.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> iv1 iv2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> skewlink.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-tree_rank_estimate_lower"><span class="command">lemma</span></span> tree_rank_estimate_lower<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span> <span class="main">⟹</span> 
   size <span class="main">(</span>tree_to_multiset <span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    link<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">∨</span>
       <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> skewlink <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">note</span></span> iv1 <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv1<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> iv2 <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv2<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> link Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> iv1 iv2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> link.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> iv1 iv2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> skewlink.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="SkewBinomialHeap-tree_rank_height"><span class="command">lemma</span></span> tree_rank_height<span class="main">:</span>
  <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span> <span class="main">⟹</span> height_tree <span class="main">(</span>Node <span class="free">e</span> <span class="free">a</span> <span class="free">r</span> <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    link<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">∨</span>
       <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> skewlink <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">note</span></span> iv1 <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv1<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> iv2 <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv2<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> link <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="skolem">ts</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">r</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">r</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> iv1 iv2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">using</span></span> iv1 iv2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">a1</span> <span class="main">∧</span> <span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">a2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> height_tree.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> iv1 iv2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span>"</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> iv1 iv2 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> tree_invar.simps link.simps<span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> iv1 iv2 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> tree_invar.simps link.simps<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A skew binomial tree of height $h$ contains at most  $2^{h+1} - 1$
  elements›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> tree_height_estimate_upper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span> <span class="main">⟹</span> 
  size <span class="main">(</span>tree_to_multiset <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="main">(</span>height_tree <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> tree_rank_estimate_upper<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> tree_rank_height<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A skew binomial tree of height $h$ contains at least  $2^{h}$ elements›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> tree_height_estimate_lower<span class="main">:</span>
  <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span> <span class="main">⟹</span> size <span class="main">(</span>tree_to_multiset <span class="free">t</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>height_tree <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> tree_rank_estimate_lower<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> tree_rank_height<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="SkewBinomialHeap-size_mset_tree_upper"><span class="command">lemma</span></span> size_mset_tree_upper<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span> <span class="main">⟹</span> 
  size <span class="main">(</span>tree_to_multiset <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="main">(</span>rank <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_rank_estimate_upper SkewBinomialTree.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 

<span class="keyword1" id="SkewBinomialHeap-size_mset_tree_lower"><span class="command">lemma</span></span> size_mset_tree_lower<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span> <span class="main">⟹</span> 
  size <span class="main">(</span>tree_to_multiset <span class="free">t</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>rank <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_rank_estimate_lower SkewBinomialTree.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 


<span class="keyword1" id="SkewBinomialHeap-invar_butlast"><span class="command">lemma</span></span> invar_butlast<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span><span class="free">bq</span> <span class="main">@</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span> invar <span class="free">bq</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">bq</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="SkewBinomialHeap-invar_last_max"><span class="command">lemma</span></span> invar_last_max<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"invar <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">b'</span><span class="main">#</span><span class="free">bq</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">b'</span><span class="main">#</span><span class="free">bq</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&lt;</span> rank <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">bq</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SkewBinomialHeap-invar_last_max'"><span class="command">lemma</span></span> invar_last_max'<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">b'</span><span class="main">#</span><span class="free">bq</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span> rank <span class="free">b</span> <span class="main">≤</span> rank <span class="free">b'</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SkewBinomialHeap-invar_length"><span class="command">lemma</span></span> invar_length<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">bq</span> <span class="main">⟹</span> length <span class="free">bq</span> <span class="main">≤</span> Suc <span class="main">(</span>Suc <span class="main">(</span>rank <span class="main">(</span>last <span class="free">bq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">xxs</span> <span class="skolem">xx</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">note</span></span> Cons' <span class="main">=</span> Cons
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xx</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> snoc.prems Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">xxxs</span> <span class="skolem">xxx</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> snoc.hyps<span class="main">[</span><span class="operator">OF</span> invar_butlast<span class="main"><span class="main">[</span></span><span class="operator">OF</span> snoc.prems<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
        IH<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">≤</span> Suc <span class="main">(</span>Suc <span class="main">(</span>rank <span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> invar_last_max<span class="main">[</span><span class="operator">OF</span> snoc.prems<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Cons' Cons<span class="main"><span class="main">]</span></span><span class="main">]</span> 
                invar_last_max'<span class="main">[</span><span class="operator">OF</span> snoc.prems<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Cons' Cons<span class="main"><span class="main">]</span></span><span class="main">]</span> 
                last_in_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span> Cons <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>rank <span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> rank <span class="main">(</span>last <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-size_queue_sum_list"><span class="command">lemma</span></span> size_queue_sum_list<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"size <span class="main">(</span>queue_to_multiset <span class="free">bq</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span>size <span class="main">∘</span> tree_to_multiset<span class="main">)</span> <span class="free">bq</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A skew binomial heap of length $l$ contains at least $2^{l-1} - 1$ elements. 
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> queue_length_estimate_lower<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"invar <span class="free">bq</span> <span class="main">⟹</span> <span class="main">(</span>size <span class="main">(</span>queue_to_multiset <span class="free">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="free">bq</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">xx</span> <span class="skolem">xxs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> snoc.hyps<span class="main">[</span><span class="operator">OF</span> invar_butlast<span class="main"><span class="main">[</span></span><span class="operator">OF</span> snoc.prems<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>size <span class="main">(</span>queue_to_multiset <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> size_q<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"size <span class="main">(</span>queue_to_multiset <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      size <span class="main">(</span>queue_to_multiset <span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> size <span class="main">(</span>tree_to_multiset <span class="skolem">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> size_queue_sum_list<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> snoc.prems <span class="keyword1"><span class="command">have</span></span> inv_x<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> size_mset_tree_lower<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>rank <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> size <span class="main">(</span>tree_to_multiset <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
      eq<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>queue_to_multiset <span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>rank <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> 
      size <span class="main">(</span>queue_to_multiset <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> invar_length<span class="main">[</span><span class="operator">OF</span> snoc.prems<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">≤</span> <span class="main">(</span>rank <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> snd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span>rank <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> 
      Suc <span class="main">(</span>size <span class="main">(</span>queue_to_multiset <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> snd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> 
      Suc <span class="main">(</span>size <span class="main">(</span>queue_to_multiset <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> rank <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Operations"</span></span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Empty Tree"</span></span>
<span class="keyword1" id="SkewBinomialHeap-empty_correct"><span class="command">lemma</span></span> empty_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span>Nil <span class="main">⟷</span> queue_to_multiset <span class="free">q</span> <span class="main">=</span> <span class="main">{#}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Insert"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Inserts a tree into the queue, such that two trees of same rank get 
  linked and are recursively inserted. This is the same definition as for 
  binomial queues and is used for melding.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ins</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialTree <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ins</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ins</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> 
      <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> 
      <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">ins</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> 
        <span class="keyword1">else</span> <span class="free">ins</span> <span class="main">(</span>link <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Insert an element with priority into a queue using skewlinks.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">insert</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'e</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>linorder <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">insert</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">[]</span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">insert</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">[]</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">insert</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> rank <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≠</span> rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span> 
      <span class="keyword1">then</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span>
      <span class="keyword1">else</span> <span class="main">(</span>skewlink <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-ins_mset"><span class="command">lemma</span></span> ins_mset<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tree_invar <span class="free">t</span><span class="main">;</span> queue_invar <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span>
   queue_to_multiset <span class="main">(</span>ins <span class="free">t</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> tree_to_multiset <span class="free">t</span> <span class="main">+</span> queue_to_multiset <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> union_ac link_tree_invar<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-insert_mset"><span class="command">lemma</span></span> insert_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span> <span class="main">⟹</span> 
  queue_to_multiset <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> 
  queue_to_multiset <span class="free">q</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> insert.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_ac ttm_children<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-ins_queue_invar"><span class="command">lemma</span></span> ins_queue_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tree_invar <span class="free">t</span><span class="main">;</span> queue_invar <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>ins <span class="free">t</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">q</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">note</span></span> iv <span class="main">=</span> Cons<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t</span> <span class="main">&lt;</span> rank <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t</span> <span class="main">=</span> rank <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> iv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
    <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_a<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_q<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> inv_link <span class="main">=</span> link_tree_invar<span class="main">[</span><span class="operator">OF</span> prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inv_a prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> iv<span class="main">[</span><span class="operator">OF</span> inv_link inv_q<span class="main">]</span> prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-insert_queue_invar"><span class="command">lemma</span></span> insert_queue_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> insert.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">t'</span> <span class="skolem">bq</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t</span> <span class="main">=</span> rank <span class="skolem">t'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> inv_t<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> inv_t'<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3 skewlink_tree_invar<span class="main">[</span><span class="operator">OF</span> inv_t inv_t' True<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-rank_ins2"><span class="command">lemma</span></span> rank_ins2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"rank_invar <span class="free">bq</span> <span class="main">⟹</span> 
    rank <span class="free">t</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="free">t</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∨</span> <span class="main">(</span>rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="free">t</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank <span class="main">(</span>hd <span class="free">bq</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bq</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">bq</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>link <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> rank <span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_link<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword2"><span class="keyword">and</span></span> prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>link <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-insert_rank_invar"><span class="command">lemma</span></span> insert_rank_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_skew_invar <span class="free">q</span> <span class="main">⟹</span> rank_skew_invar <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="skolem">q'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rank_skew_invar <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">#</span> <span class="skolem">q'</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rank_skew_invar <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gr0I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t'</span> <span class="skolem">q''</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rank_skew_invar <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">#</span> <span class="skolem">q'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">#</span> <span class="skolem">q''</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rank_skew_invar <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t</span> <span class="main">=</span> rank <span class="skolem">t'</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gr0I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> skewlink.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
      <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
      <span class="keyword1"><span class="command">with</span></span> rank_invar_cons_down<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_invar <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">q''</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">t''</span> <span class="skolem">q'''</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t'</span> <span class="main">&lt;</span> rank <span class="skolem">t''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>skewlink <span class="free">e</span> <span class="free">a</span> <span class="skolem">t</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">≤</span> rank <span class="skolem">t''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> prems Cons rank_skew_cons_up<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'''</span>"</span></span> <span class="quoted"><span class="quoted">"skewlink <span class="free">e</span> <span class="free">a</span> <span class="skolem">t</span> <span class="skolem">t'</span>"</span></span><span class="main">]</span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-insert_invar"><span class="command">lemma</span></span> insert_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span> <span class="main">⟹</span> invar <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def
  <span class="keyword1"><span class="command">using</span></span> insert_queue_invar<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> insert_rank_invar<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> insert_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"invar <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">+</span> <span class="main">{#</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> insert_mset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> insert_invar<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> I
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"meld"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Remove duplicate tree ranks by inserting the first tree of the 
  queue into the rest of the queue.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">uniqify</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uniqify</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">uniqify</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span> ins <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Meld two uniquified queues using the same definition as for 
  binomial queues.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">meldUniq</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span>
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">meldUniq</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">meldUniq</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">meldUniq</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> rank <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">&lt;</span> rank <span class="free"><span class="bound"><span class="entity">t2</span></span></span> 
       <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">meldUniq</span> <span class="free"><span class="bound"><span class="entity">bq1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> rank <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">&lt;</span> rank <span class="free"><span class="bound"><span class="entity">t1</span></span></span>
              <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">meldUniq</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span>
              <span class="keyword1">else</span> ins <span class="main">(</span>link <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">meldUniq</span> <span class="free"><span class="bound"><span class="entity">bq1</span></span></span> <span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Meld two queues using above functions.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">meld</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> 
      <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">meld</span> <span class="free"><span class="bound"><span class="entity">bq1</span></span></span> <span class="free"><span class="bound"><span class="entity">bq2</span></span></span> <span class="main">=</span> meldUniq <span class="main">(</span>uniqify <span class="free"><span class="bound"><span class="entity">bq1</span></span></span><span class="main">)</span> <span class="main">(</span>uniqify <span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-invar_uniqify"><span class="command">lemma</span></span> invar_uniqify<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>uniqify <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ins_queue_invar<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-invar_meldUniq"><span class="command">lemma</span></span> invar_meldUniq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>queue_invar <span class="free">q</span><span class="main">;</span> queue_invar <span class="free">q'</span><span class="main">⟧</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>meldUniq <span class="free">q</span> <span class="free">q'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> meldUniq.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t1</span> <span class="skolem">bq1</span> <span class="skolem">t2</span> <span class="skolem">bq2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>lt<span class="main">)</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t1</span> <span class="main">&lt;</span> rank <span class="skolem">t2</span>"</span></span> <span class="main">|</span> <span class="main">(</span>gt<span class="main">)</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t1</span> <span class="main">&gt;</span> rank <span class="skolem">t2</span>"</span></span> <span class="main">|</span> <span class="main">(</span>eq<span class="main">)</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t1</span> <span class="main">=</span> rank <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> t1t2<span class="main">:</span> lt
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_bq1<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="skolem">bq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_t1<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> t1t2 inv_bq1 3<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> inv_t1 t1t2
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> t1t2<span class="main">:</span> gt
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_bq2<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="skolem">bq2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> t1t2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rank <span class="skolem">t1</span> <span class="main">&lt;</span> rank <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> this t1t2 3<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> inv_bq2<span class="main">]</span> inv_t2 t1t2
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> t1t2<span class="main">:</span> eq
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_bq1<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="skolem">bq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_t1<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_bq2<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="skolem">bq2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> inv_link <span class="main">=</span> link_tree_invar<span class="main">[</span><span class="operator">OF</span> inv_t1 inv_t2 t1t2<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> t1t2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rank <span class="skolem">t1</span> <span class="main">&lt;</span> rank <span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> inv_meld <span class="main">=</span> 3<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this inv_bq1 inv_bq2<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> ins_queue_invar<span class="main">[</span><span class="operator">OF</span> inv_link inv_meld<span class="main">]</span> t1t2
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="SkewBinomialHeap-meld_queue_invar"><span class="command">lemma</span></span> meld_queue_invar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> inv_uniq_q <span class="main">=</span> invar_uniqify<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">note</span></span> inv_uniq_q' <span class="main">=</span> invar_uniqify<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_meldUniq <span class="main">=</span> invar_meldUniq<span class="main">[</span><span class="operator">OF</span> inv_uniq_q inv_uniq_q'<span class="main">]</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> meld_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-uniqify_mset"><span class="command">lemma</span></span> uniqify_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span> <span class="main">⟹</span> queue_to_multiset <span class="free">q</span> <span class="main">=</span> queue_to_multiset <span class="main">(</span>uniqify <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ins_mset<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-meldUniq_mset"><span class="command">lemma</span></span> meldUniq_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>queue_invar <span class="free">q</span><span class="main">;</span> queue_invar <span class="free">q'</span><span class="main">⟧</span> <span class="main">⟹</span> 
  queue_to_multiset <span class="main">(</span>meldUniq <span class="free">q</span> <span class="free">q'</span><span class="main">)</span> <span class="main">=</span> 
  queue_to_multiset <span class="free">q</span> <span class="main">+</span> queue_to_multiset <span class="free">q'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> meldUniq.induct<span class="main">)</span>
  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ins_mset link_tree_invar invar_meldUniq union_ac<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-meld_mset"><span class="command">lemma</span></span> meld_mset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> queue_invar <span class="free">q</span><span class="main">;</span> queue_invar <span class="free">q'</span> <span class="main">⟧</span> <span class="main">⟹</span>
  queue_to_multiset <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">+</span> queue_to_multiset <span class="free">q'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> meld_def meldUniq_mset invar_uniqify uniqify_mset<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Ins operation satisfies rank invariant, see binomial queues›</span></span>
<span class="keyword1" id="SkewBinomialHeap-rank_ins"><span class="command">lemma</span></span> rank_ins<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="free">bq</span> <span class="main">⟹</span> rank_invar <span class="main">(</span>ins <span class="free">t</span> <span class="free">bq</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bq</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
    <span class="keyword1"><span class="command">hence</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="main">(</span>ins <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> prems <span class="keyword1"><span class="command">have</span></span> hd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">a</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="skolem">bq</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">∨</span> <span class="main">(</span>rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank <span class="main">(</span>hd <span class="skolem">bq</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">bq</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rank_ins2 rank_invar_cons_down<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="skolem">a</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">(</span>rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank <span class="main">(</span>hd <span class="skolem">bq</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">bq</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword2"><span class="keyword">and</span></span> inv <span class="keyword2"><span class="keyword">and</span></span> hd <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_hd_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 2
    <span class="keyword1"><span class="command">hence</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword2"><span class="keyword">and</span></span> prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>link <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
     
<span class="keyword1" id="SkewBinomialHeap-rank_uniqify"><span class="command">lemma</span></span> rank_uniqify<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rank_skew_invar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank_invar <span class="main">(</span>uniqify <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> rank_skew_rank_invar<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span>"</span></span><span class="main">]</span> rank_ins<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main">]</span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-rank_ins_min"><span class="command">lemma</span></span> rank_ins_min<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="free">bq</span> <span class="main">⟹</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="free">t</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> min <span class="main">(</span>rank <span class="free">t</span><span class="main">)</span> <span class="main">(</span>rank <span class="main">(</span>hd <span class="free">bq</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bq</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
    <span class="keyword1"><span class="command">hence</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> prems <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>link <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> rank <span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_link<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword2"><span class="keyword">and</span></span> inv <span class="keyword2"><span class="keyword">and</span></span> prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>link <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-rank_invar_not_empty_hd"><span class="command">lemma</span></span> rank_invar_not_empty_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span><span class="main">;</span> <span class="free">bq</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> rank <span class="free">t</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="free">bq</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="SkewBinomialHeap-rank_invar_meldUniq_strong"><span class="command">lemma</span></span> rank_invar_meldUniq_strong<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rank_invar <span class="free">bq1</span><span class="main">;</span> rank_invar <span class="free">bq2</span><span class="main">⟧</span> <span class="main">⟹</span> 
    rank_invar <span class="main">(</span>meldUniq <span class="free">bq1</span> <span class="free">bq2</span><span class="main">)</span> 
    <span class="main">∧</span> rank <span class="main">(</span>hd <span class="main">(</span>meldUniq <span class="free">bq1</span> <span class="free">bq2</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> min <span class="main">(</span>rank <span class="main">(</span>hd <span class="free">bq1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rank <span class="main">(</span>hd <span class="free">bq2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq1</span></span> <span class="quoted"><span class="free">bq2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> meldUniq.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t1</span> <span class="skolem">bq1</span> <span class="skolem">t2</span> <span class="skolem">bq2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="skolem">bq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq1</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="skolem">bq2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq2</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  
  <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword2"><span class="keyword">and</span></span> inv2 <span class="keyword2"><span class="keyword">and</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq2</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?meldUniq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="main">(</span>meldUniq <span class="main">(</span><span class="skolem">t1</span> <span class="main">#</span> <span class="skolem">bq1</span><span class="main">)</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="var">?t</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="var">?bq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_not_empty_hd<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword1"><span class="command">have</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="var">?meldUniq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="var">?meldUniq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?meldUniq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_hd_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="comment1">― ‹analog›</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?meldUniq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rank <span class="skolem">t1</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="main">(</span>meldUniq <span class="skolem">bq1</span> <span class="main">(</span><span class="skolem">t2</span> <span class="main">#</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 2
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="var">?t</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="var">?bq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_not_empty_hd<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword1"><span class="command">have</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="var">?meldUniq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="var">?meldUniq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?meldUniq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?bq</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_hd_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_ins<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 4 <span class="comment1">(* Ab hier wirds hässlich *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">=</span> rank <span class="skolem">t2</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_link<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"meldUniq <span class="skolem">bq1</span> <span class="main">[]</span> <span class="main">=</span> <span class="skolem">bq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq1</span></span><span class="main">)</span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword2"><span class="keyword">and</span></span> inv2 <span class="keyword2"><span class="keyword">and</span></span> prems <span class="keyword1"><span class="command">have</span></span> 
      mm<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="main">(</span>rank <span class="main">(</span>hd <span class="skolem">bq1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rank <span class="main">(</span>hd <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>meldUniq <span class="skolem">bq1</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rank_invar <span class="main">(</span><span class="skolem">t1</span> <span class="main">#</span> <span class="skolem">bq1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">t1</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="skolem">bq1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_not_empty_hd<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="skolem">bq1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rank_invar <span class="main">(</span><span class="skolem">t2</span> <span class="main">#</span> <span class="skolem">bq2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq2</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="skolem">bq2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_invar_not_empty_hd<span class="main">)</span>
    
    <span class="keyword1"><span class="command">from</span></span> inv1 r r1 rank_ins_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">bq1</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
      abc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">t2</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="skolem">bq1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> inv2 r r2 rank_ins_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">bq2</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
      abc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq2</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> rank <span class="skolem">t2</span> <span class="main">≤</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
    <span class="keyword1"><span class="command">from</span></span> r1 r2 mm <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">bq1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="skolem">bq2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="main">(</span>meldUniq <span class="skolem">bq1</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹rank_invar <span class="main">(</span>meldUniq <span class="skolem">bq1</span> <span class="skolem">bq2</span><span class="main">)</span>›</span></span> r 
      rank_ins_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"meldUniq <span class="skolem">bq1</span> <span class="skolem">bq2</span>"</span></span> <span class="quoted"><span class="quoted">"link <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">bq1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="skolem">bq2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> 
      rank <span class="skolem">t2</span> <span class="main">&lt;</span> rank <span class="main">(</span>hd <span class="main">(</span>ins <span class="main">(</span>link <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">(</span>meldUniq <span class="skolem">bq1</span> <span class="skolem">bq2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> inv1 <span class="keyword2"><span class="keyword">and</span></span> inv2 <span class="keyword2"><span class="keyword">and</span></span> r m r1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-rank_meldUniq"><span class="command">lemma</span></span> rank_meldUniq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rank_invar <span class="free">bq1</span><span class="main">;</span> rank_invar <span class="free">bq2</span><span class="main">⟧</span> <span class="main">⟹</span> rank_invar <span class="main">(</span>meldUniq <span class="free">bq1</span> <span class="free">bq2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rank_invar_meldUniq_strong<span class="main">)</span>


<span class="keyword1" id="SkewBinomialHeap-rank_meld"><span class="command">lemma</span></span> rank_meld<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>rank_skew_invar <span class="free">q1</span><span class="main">;</span> rank_skew_invar <span class="free">q2</span><span class="main">⟧</span> <span class="main">⟹</span> rank_skew_invar <span class="main">(</span>meld <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> meld_def rank_meldUniq rank_uniqify rank_invar_rank_skew<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> meld_invar<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>invar <span class="free">bq1</span><span class="main">;</span> invar <span class="free">bq2</span><span class="main">⟧</span> 
  <span class="main">⟹</span> invar <span class="main">(</span>meld <span class="free">bq1</span> <span class="free">bq2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> meld_queue_invar rank_meld invar_def<span class="main">)</span>


<span class="keyword1"><span class="command">theorem</span></span> meld_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"invar <span class="free">q'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"invar <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">+</span> queue_to_multiset <span class="free">q'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> meld_invar<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">q'</span></span><span class="main">]</span> meld_mset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">q'</span></span><span class="main">]</span> I
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Find Minimal Element"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Find the tree containing the minimal element.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">getMinTree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialTree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">getMinTree</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">getMinTree</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> prio <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> prio <span class="main">(</span><span class="free">getMinTree</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span>
      <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="free">getMinTree</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Find the minimal Element in the queue.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">findMin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">findMin</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">min</span> <span class="main">=</span> getMinTree <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>val <span class="bound">min</span><span class="main">,</span> prio <span class="bound">min</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-mintree_exists"><span class="command">lemma</span></span> mintree_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bq</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>getMinTree <span class="free">bq</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons _ <span class="skolem">bq</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-treehead_in_multiset"><span class="command">lemma</span></span> treehead_in_multiset<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">bq</span> <span class="main">⟹</span> <span class="main">(</span>val <span class="free">t</span><span class="main">,</span> prio <span class="free">t</span><span class="main">)</span> <span class="main">∈#</span> <span class="main">(</span>queue_to_multiset <span class="free">bq</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-heap_ordered_single"><span class="command">lemma</span></span> heap_ordered_single<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"heap_ordered <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_mset <span class="main">(</span>tree_to_multiset <span class="free">t</span><span class="main">)</span><span class="main">.</span> prio <span class="free">t</span> <span class="main">≤</span> snd <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="SkewBinomialHeap-getMinTree_cons"><span class="command">lemma</span></span> getMinTree_cons<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"prio <span class="main">(</span>getMinTree <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> prio <span class="main">(</span>getMinTree <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> getMinTree.induct<span class="main">)</span> <span class="operator">simp_all</span> 

<span class="keyword1" id="SkewBinomialHeap-getMinTree_min_tree"><span class="command">lemma</span></span> getMinTree_min_tree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">bq</span>  <span class="main">⟹</span> prio <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="main">≤</span> prio <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> getMinTree.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-getMinTree_min_prio"><span class="command">lemma</span></span> getMinTree_min_prio<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">bq</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set_mset <span class="main">(</span>queue_to_multiset <span class="free">bq</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prio <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="main">≤</span> snd <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bq</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">.</span> <span class="main">(</span><span class="free">y</span> <span class="main">∈</span> set_mset <span class="main">(</span>tree_to_multiset <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bq</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set_mset <span class="main">(</span>tree_to_multiset <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bq</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> O<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> set <span class="free">bq</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set_mset <span class="main">(</span><span class="main">(</span>tree_to_multiset <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">ts</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">r</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> O assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> tree_invar_heap_ordered<span class="main">[</span><span class="operator">OF</span> inv<span class="main">]</span> heap_ordered.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">]</span> O
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prio <span class="skolem">t</span> <span class="main">≤</span> snd <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> getMinTree_min_tree<span class="main">[</span><span class="operator">OF</span> O<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-findMin_mset"><span class="command">lemma</span></span> findMin_mset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span>Nil"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"findMin <span class="free">q</span> <span class="main">∈#</span> queue_to_multiset <span class="free">q</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>queue_to_multiset <span class="free">q</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> snd <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> NE <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span> <span class="main">∈</span> set <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mintree_exists<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"findMin <span class="free">q</span> <span class="main">∈#</span> queue_to_multiset <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> treehead_in_multiset findMin_def Let_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>queue_to_multiset <span class="free">q</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> snd <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> getMinTree_min_prio findMin_def Let_def NE I<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">theorem</span></span> findMin_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span>Nil"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"findMin <span class="free">q</span> <span class="main">∈#</span> queue_to_multiset <span class="free">q</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>queue_to_multiset <span class="free">q</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> snd <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I NE findMin_mset
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Delete Minimal Element"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Insert the roots of a given queue into an other queue.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">insertList</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> 
   <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">insertList</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">tbq</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tbq</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">insertList</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tbq</span></span></span> <span class="main">=</span> <span class="free">insertList</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">(</span>insert <span class="main">(</span>val <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tbq</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Remove the first tree, which has the priority $a$ within his root.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">remove1Prio</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span>
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">remove1Prio</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">remove1Prio</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">remove1Prio</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-remove1Prio_remove1"><span class="command">lemma</span></span> remove1Prio_remove1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"remove1Prio <span class="main">(</span>prio <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span><span class="main">)</span> <span class="free">bq</span> <span class="main">=</span> remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">note</span></span> iv <span class="main">=</span> Cons
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> getMinTree <span class="main">(</span><span class="skolem">t</span> <span class="main">#</span> <span class="skolem">bq</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> iv <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bq</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> down<span class="main">:</span> <span class="quoted"><span class="quoted">"getMinTree <span class="main">(</span><span class="skolem">t</span> <span class="main">#</span> <span class="skolem">bq</span><span class="main">)</span> <span class="main">=</span> getMinTree <span class="skolem">bq</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">bq</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> getMinTree.induct<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ne False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prio <span class="skolem">t</span> <span class="main">≠</span> prio <span class="main">(</span>getMinTree <span class="skolem">bq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">bq</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> getMinTree.induct<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> down iv False ne <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Return the queue without the minimal element found by findMin›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deleteMin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> SkewBinomialQueue <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deleteMin</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">min</span> <span class="main">=</span> getMinTree <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="keyword1">in</span> insertList
    <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>children <span class="bound">min</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>meld <span class="main">(</span>rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>children <span class="bound">min</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
     <span class="main">(</span>remove1Prio <span class="main">(</span>prio <span class="bound">min</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-invar_rev"><span class="command">lemma</span></span> invar_rev<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span>rev <span class="free">q</span><span class="main">)</span> <span class="main">⟷</span> queue_invar <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> queue_invar_def<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="SkewBinomialHeap-invar_remove1"><span class="command">lemma</span></span> invar_remove1<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>remove1 <span class="free">t</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> queue_invar_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-mset_rev"><span class="command">lemma</span></span> mset_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>rev <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_ac<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-in_set_subset"><span class="command">lemma</span></span> in_set_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">q</span> <span class="main">⟹</span> tree_to_multiset <span class="free">t</span> <span class="main">⊆#</span> queue_to_multiset <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> t_in_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="skolem">q</span> <span class="main">⊆#</span> queue_to_multiset <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> subset_mset.order_trans<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> t_in_q<span class="main"><span class="main">]</span></span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-mset_remove1"><span class="command">lemma</span></span> mset_remove1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">q</span> <span class="main">⟹</span> 
  queue_to_multiset <span class="main">(</span>remove1 <span class="free">t</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> 
  queue_to_multiset <span class="free">q</span> <span class="main">-</span> tree_to_multiset <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_subset<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-invar_children'"><span class="command">lemma</span></span> invar_children'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span>children <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">nat</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">nat</span> <span class="skolem">list</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Node invar_children<span class="main">[</span><span class="operator">OF</span> inv<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-invar_filter"><span class="command">lemma</span></span> invar_filter<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>filter <span class="free">f</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> queue_invar_def<span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="SkewBinomialHeap-insertList_queue_invar"><span class="command">lemma</span></span> insertList_queue_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span> <span class="main">⟹</span> queue_invar <span class="main">(</span>insertList <span class="free">ts</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> inv_insert <span class="main">=</span> insert_queue_invar<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"val <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"prio <span class="skolem">a</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv_insert<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-deleteMin_queue_invar"><span class="command">lemma</span></span> deleteMin_queue_invar<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>queue_invar <span class="free">q</span><span class="main">;</span> queue_to_multiset <span class="free">q</span> <span class="main">≠</span> <span class="main">{#}</span><span class="main">⟧</span> <span class="main">⟹</span> 
  queue_invar <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> deleteMin_def Let_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
  <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> q_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>1<span class="main">)</span> mintree_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> inv_min<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> inv_rem <span class="main">=</span> invar_remove1<span class="main">[</span><span class="operator">OF</span> prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_children <span class="main">=</span> invar_children'<span class="main">[</span><span class="operator">OF</span> inv_min<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_filter <span class="main">=</span> invar_filter<span class="main">[</span><span class="operator">OF</span> inv_children<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_rev <span class="main">=</span> iffD2<span class="main">[</span><span class="operator">OF</span> invar_rev inv_filter<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_meld <span class="main">=</span> meld_queue_invar<span class="main">[</span><span class="operator">OF</span> inv_rev inv_rem<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_ins <span class="main">=</span> 
    insertList_queue_invar<span class="main">[</span><span class="operator">OF</span> inv_meld<span class="main">,</span> 
      <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">t</span><span class="main">←</span>children <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-mset_children"><span class="command">lemma</span></span> mset_children<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>children <span class="free">t</span><span class="main">)</span> <span class="main">=</span> 
  tree_to_multiset <span class="free">t</span> <span class="main">-</span> <span class="main">{#</span> <span class="main">(</span>val <span class="free">t</span><span class="main">,</span> prio <span class="free">t</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-mset_insertList"><span class="command">lemma</span></span> mset_insertList<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="free">ts</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> children <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">;</span> queue_invar <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> 
  queue_to_multiset <span class="main">(</span>insertList <span class="free">ts</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> 
  queue_to_multiset <span class="free">ts</span> <span class="main">+</span> queue_to_multiset <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ball_ts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="skolem">ts</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> children <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> inv_insert <span class="main">=</span> insert_queue_invar<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"val <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"prio <span class="skolem">a</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> iv <span class="main">=</span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ball_ts inv_insert<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> mset_a<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_to_multiset <span class="skolem">a</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span>val <span class="skolem">a</span><span class="main">,</span> prio <span class="skolem">a</span><span class="main">)</span><span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> insert_mset<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"val <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"prio <span class="skolem">a</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">with</span></span> mset_a iv <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
        
<span class="keyword1" id="SkewBinomialHeap-mset_filter"><span class="command">lemma</span></span> mset_filter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>queue_to_multiset <span class="main">[</span><span class="bound">t</span><span class="main">←</span><span class="free">q</span> <span class="main">.</span> rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">+</span>
  queue_to_multiset <span class="main">[</span><span class="bound">t</span><span class="main">←</span><span class="free">q</span> <span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span> <span class="main">=</span>
  queue_to_multiset <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_ac<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-deleteMin_mset"><span class="command">lemma</span></span> deleteMin_mset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"queue_invar <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="free">q</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">-</span> <span class="main">{#</span> <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> q_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> mintree_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> min_in_q<span class="main">:</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span> <span class="main">∈</span> set <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv_min<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> inv_rem <span class="main">=</span> invar_remove1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_children <span class="main">=</span> invar_children'<span class="main">[</span><span class="operator">OF</span> inv_min<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_filter <span class="main">=</span> invar_filter<span class="main">[</span><span class="operator">OF</span> inv_children<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_rev <span class="main">=</span> iffD2<span class="main">[</span><span class="operator">OF</span> invar_rev inv_filter<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> inv_meld <span class="main">=</span> meld_queue_invar<span class="main">[</span><span class="operator">OF</span> inv_rev inv_rem<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> mset_rem <span class="main">=</span> mset_remove1<span class="main">[</span><span class="operator">OF</span> min_in_q<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> mset_rev <span class="main">=</span> mset_rev<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">t</span><span class="main">←</span>children <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> mset_meld <span class="main">=</span> meld_mset<span class="main">[</span><span class="operator">OF</span> inv_rev inv_rem<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> mset_children <span class="main">=</span> mset_children<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">thm</span></span> mset_insertList<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">t</span><span class="main">←</span>children <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span> <span class="main">.</span>
             rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tree_invar <span class="skolem">t</span><span class="main">;</span> rank <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> children <span class="skolem">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> inv_children 
  <span class="keyword1"><span class="command">have</span></span> ball_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="main">[</span><span class="bound">t</span><span class="main">←</span>children <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span><span class="main">.</span> 
    rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> children <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> queue_invar_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> mset_insertList <span class="main">=</span> mset_insertList<span class="main">[</span><span class="operator">OF</span> ball_min inv_meld<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> mset_filter <span class="main">=</span> mset_filter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"children <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?MT</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tree_to_multiset <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> q_ne <span class="keyword1"><span class="command">have</span></span> head_subset_min<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="main">(</span>val <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span><span class="main">,</span> prio <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span> <span class="main">⊆#</span> <span class="var">?MT</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">q</span>"</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> min_subset_q <span class="main">=</span> in_set_subset<span class="main">[</span><span class="operator">OF</span> min_in_q<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> mset_insertList mset_meld mset_rev mset_rem mset_filter mset_children
    multiset_diff_union_assoc<span class="main">[</span><span class="operator">OF</span> head_subset_min<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">-</span> <span class="var">?MT</span>"</span></span><span class="main">]</span>
    mset_subset_eq_multiset_union_diff_commute<span class="main">[</span><span class="operator">OF</span> min_subset_q<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?MT</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_def Let_def union_ac findMin_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-rank_insertList"><span class="command">lemma</span></span> rank_insertList<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_skew_invar <span class="free">q</span> <span class="main">⟹</span> rank_skew_invar <span class="main">(</span>insertList <span class="free">ts</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_rank_invar<span class="main">)</span> 

<span class="keyword1" id="SkewBinomialHeap-insertList_invar"><span class="command">lemma</span></span> insertList_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span> <span class="main">⟹</span> invar <span class="main">(</span>insertList <span class="free">ts</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> insertList.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> insert_rank_invar<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"val <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"prio <span class="skolem">a</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_skew_invar <span class="main">(</span>insert <span class="main">(</span>val <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>prio <span class="skolem">a</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> insert_queue_invar<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"val <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"prio <span class="skolem">a</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"queue_invar <span class="main">(</span>insert <span class="main">(</span>val <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>prio <span class="skolem">a</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a1 a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>insert <span class="main">(</span>val <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>prio <span class="skolem">a</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="main">(</span>val <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>prio <span class="skolem">a</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-children_rank_less"><span class="command">lemma</span></span> children_rank_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t'</span> <span class="main">∈</span> set <span class="main">(</span>children <span class="free">t</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t'</span> <span class="main">&lt;</span> rank <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">nat</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">nat</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      O<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span> 
       <span class="main">∨</span> <span class="skolem">t</span> <span class="main">=</span> skewlink <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_invar.simps<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> ch_id<span class="main">:</span>
      <span class="quoted"><span class="quoted">"children <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span> <span class="keyword1">then</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">#</span><span class="skolem">ts1</span> 
                     <span class="keyword1">else</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">#</span><span class="skolem">ts2</span><span class="main">)</span> <span class="main">∨</span>
      children <span class="skolem">t</span> <span class="main">=</span> 
        <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">a1</span> <span class="main">∧</span> <span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">a2</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">]</span>
         <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span> <span class="keyword1">then</span> <span class="main">(</span>Node <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span>
         <span class="keyword1">else</span> <span class="main">(</span>Node <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> O Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts1</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span>  p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t'</span><span class="main">∈</span>set <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t'</span> <span class="main">&lt;</span> Suc <span class="skolem">nat</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> O Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts2</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t'</span><span class="main">∈</span>set <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t'</span> <span class="main">&lt;</span> Suc <span class="skolem">nat</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> O <span class="keyword1"><span class="command">have</span></span> 
      p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t'</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> 
                 rank <span class="bound">t'</span> <span class="main">&lt;</span> Suc <span class="skolem">nat</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> O Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts1</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> 
      p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t'</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">.</span> 
                 rank <span class="bound">t'</span> <span class="main">&lt;</span> Suc <span class="skolem">nat</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> O Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts2</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t'</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">.</span> 
                 rank <span class="bound">t'</span> <span class="main">&lt;</span> Suc <span class="skolem">nat</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>3<span class="main">)</span> p1 p2 p3 p4 p5 ch_id <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"children <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span> <span class="keyword1">then</span> Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span> <span class="main">#</span> <span class="skolem">ts1</span> 
                              <span class="keyword1">else</span> Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-strong_rev_children"><span class="command">lemma</span></span> strong_rev_children<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> children <span class="free">t</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">nat</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="skolem">nat</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">list</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">nat</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        O<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> 
        <span class="main">∨</span> <span class="skolem">t</span> <span class="main">=</span> skewlink <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_invar.simps<span class="main">)</span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">t</span> <span class="main">←</span> children <span class="skolem">t</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Suc'<span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ts1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">ts2</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        O<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> link <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span> 
        <span class="main">∨</span> <span class="skolem">t</span> <span class="main">=</span> skewlink <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tree_invar.simps<span class="main">)</span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> ch_id<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"children <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span> <span class="keyword1">then</span> 
          <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">#</span><span class="skolem">ts1</span> 
        <span class="keyword1">else</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">#</span><span class="skolem">ts2</span><span class="main">)</span> 
        <span class="main">∨</span> 
        children <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">a1</span> <span class="main">∧</span> <span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">a2</span> <span class="keyword1">then</span> 
          <span class="main">[</span><span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">]</span>
        <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span> <span class="keyword1">then</span> 
          <span class="main">(</span>Node <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span>
        <span class="keyword1">else</span> <span class="main">(</span>Node <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> O Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
        rev_ts1<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="skolem">ts1</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> O children_rank_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="skolem">ts1</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&lt;</span> rank <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> O rev_ts1 
        invar_app_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="skolem">ts1</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span>"</span></span> 
                                  <span class="quoted"><span class="quoted">"Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span>"</span></span><span class="main">]</span>  
      <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="skolem">ts1</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Suc' <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> O Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts2</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> rev_ts2<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="skolem">ts2</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> O children_rank_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="skolem">ts2</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
        rank <span class="bound">t</span> <span class="main">&lt;</span> rank <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> O rev_ts2 invar_app_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="skolem">ts2</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span>"</span></span> 
                                         <span class="quoted"><span class="quoted">"Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="skolem">ts2</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Suc' <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> O<span class="main">(</span>1-2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">)</span>
                                 <span class="main">[</span><span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> p1 <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev 
           <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> p2 <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev 
           <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> <span class="main">(</span><span class="main">(</span>Node <span class="skolem">e'</span> <span class="skolem">a'</span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> p1 p2 p3 p4 p5 ch_id <span class="keyword3"><span class="command">show</span></span> 
        <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span><span class="main">←</span>children <span class="skolem">t</span> <span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"children <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a1</span> <span class="main">≤</span> <span class="skolem">a2</span> <span class="keyword1">then</span> <span class="main">(</span>Node <span class="skolem">e2</span> <span class="skolem">a2</span> <span class="skolem">nat</span> <span class="skolem">ts2</span><span class="main">)</span><span class="main">#</span><span class="skolem">ts1</span> 
                                <span class="keyword1">else</span> <span class="main">(</span>Node <span class="skolem">e1</span> <span class="skolem">a1</span> <span class="skolem">nat</span> <span class="skolem">ts1</span><span class="main">)</span><span class="main">#</span><span class="skolem">ts2</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-first_less"><span class="command">lemma</span></span> first_less<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">t'</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">.</span> rank <span class="free">t</span> <span class="main">&lt;</span> rank <span class="bound">t'</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> List.set_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> insert_iff not_le_imp_less 
    not_less_iff_gr_or_eq order_less_le_trans rank_invar.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
    rank_invar_cons_down<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-first_less_eq"><span class="command">lemma</span></span> first_less_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"rank_skew_invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">t'</span> <span class="main">∈</span> set <span class="free">bq</span><span class="main">.</span> rank <span class="free">t</span> <span class="main">≤</span> rank <span class="bound">t'</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> List.set_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> insert_iff le_trans
    rank_invar_rank_skew rank_skew_invar.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rank_skew_rank_invar<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-remove1_tail_invar"><span class="command">lemma</span></span> remove1_tail_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"tail_invar <span class="free">bq</span> <span class="main">⟹</span> tail_invar <span class="main">(</span>remove1 <span class="free">t</span> <span class="free">bq</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bq</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail_invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tail_invar_cons_down<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail_invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tail_invar_cons_down<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> si1<span class="main">:</span> <span class="quoted"><span class="quoted">"tail_invar <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail_invar <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> tail_invar <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"remove1 <span class="skolem">t</span> <span class="skolem">bq</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">with</span></span> si1 Cons<span class="main">(</span>2<span class="main">)</span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Cons'<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">aa</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_invar_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> first_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bq</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">.</span> rank <span class="skolem">a</span> <span class="main">&lt;</span> rank <span class="bound">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> notin_set_remove1 tail_invar_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">with</span></span> Cons' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="skolem">a</span> <span class="main">&lt;</span> rank <span class="skolem">aa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> si1 Cons<span class="main">(</span>2<span class="main">)</span> False Cons' tail_invar_cons_up<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-invar_cons_down"><span class="command">lemma</span></span> invar_cons_down<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span><span class="free">t</span> <span class="main">#</span> <span class="free">bq</span><span class="main">)</span> <span class="main">⟹</span> invar <span class="free">bq</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rank_invar_rank_skew tail_invar_def 
    invar_def invar_tail_invar<span class="main">)</span> 

<span class="keyword1" id="SkewBinomialHeap-remove1_invar"><span class="command">lemma</span></span> remove1_invar<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">bq</span> <span class="main">⟹</span> invar <span class="main">(</span>remove1 <span class="free">t</span> <span class="free">bq</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bq</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bq</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invar_cons_down<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invar_cons_down<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> si1<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> invar <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"remove1 <span class="skolem">t</span> <span class="skolem">bq</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">with</span></span> si1 Cons<span class="main">(</span>2<span class="main">)</span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Cons'<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">aa</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ti<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> sbq<span class="main">:</span> <span class="quoted"><span class="quoted">"tail_invar <span class="skolem">bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> invar_tail_invar<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> srm<span class="main">:</span> <span class="quoted"><span class="quoted">"tail_invar <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> remove1_tail_invar<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> first_less_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bq</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="main">(</span>remove1 <span class="skolem">t</span> <span class="skolem">bq</span><span class="main">)</span><span class="main">.</span> rank <span class="skolem">a</span> <span class="main">≤</span> rank <span class="bound">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> notin_set_remove1 invar_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">with</span></span> Cons' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="skolem">a</span> <span class="main">≤</span> rank <span class="skolem">aa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> si1 Cons<span class="main">(</span>2<span class="main">)</span> False Cons' ti srm tail_invar_cons_up_invar<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main">]</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-deleteMin_invar"><span class="command">lemma</span></span> deleteMin_invar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invar <span class="free">bq</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">bq</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>deleteMin <span class="free">bq</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>deleteMin <span class="free">bq</span><span class="main">)</span> <span class="main">=</span> 
    invar <span class="main">(</span>insertList
    <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>meld <span class="main">(</span>rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms mintree_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bq</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> ti<span class="main">:</span> <span class="quoted"><span class="quoted">"tree_invar <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invar_def queue_invar_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> queue_invar_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> strong_rev_children<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">bq</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
    m1<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> remove1_invar<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bq</span>"</span></span> <span class="quoted"><span class="quoted">"getMinTree <span class="free">bq</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> meld_invar<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span>"</span></span> 
                     <span class="quoted"><span class="quoted">"remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span>"</span></span><span class="main">]</span> m1 m2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>meld <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span> <span class="main">←</span> children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span> 
                    <span class="main">(</span>remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> insertList_invar<span class="main">[</span><span class="operator">of</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>meld <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span><span class="main">←</span>children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span> 
           <span class="main">(</span>remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">t</span><span class="main">←</span>children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="main">.</span> rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span>"</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invar
   <span class="main">(</span>insertList
     <span class="main">[</span><span class="bound">t</span><span class="main">←</span>children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="main">.</span> rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span>
     <span class="main">(</span>meld <span class="main">(</span>rev <span class="main">[</span><span class="bound">t</span><span class="main">←</span>children <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> rank <span class="bound">t</span><span class="main">]</span><span class="main">)</span>
       <span class="main">(</span>remove1 <span class="main">(</span>getMinTree <span class="free">bq</span><span class="main">)</span> <span class="free">bq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 
  <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> deleteMin_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> Nil"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">-</span> <span class="main">{#</span>findMin <span class="free">q</span><span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> deleteMin_invar<span class="main"><span class="main">[</span></span><span class="operator">OF</span> I NE<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> deleteMin_mset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> I NE
  <span class="keyword1"><span class="command">unfolding</span></span> invar_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_correct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(*
fun foldt and foldq where
  "foldt f z (Node e a _ q) = f (foldq f z q) e a" |
  "foldq f z [] = z" |
  "foldq f z (t#q) = foldq f (foldt f z t) q"

lemma fold_plus:
  "foldt ((λm e a. m+{#(e,a)#})) zz t + z = foldt ((λm e a. m+{#(e,a)#})) (zz+z) t"
  "foldq ((λm e a. m+{#(e,a)#})) zz q + z = foldq ((λm e a. m+{#(e,a)#})) (zz+z) q"
  apply (induct t and q arbitrary: zz and zz 
    rule: tree_to_multiset_queue_to_multiset.induct)
  apply (auto simp add: union_ac)
  apply (subst union_ac, simp)
  done


lemma to_mset_fold:
  fixes t::"('e,'a::linorder) SkewBinomialTree" and
        q::"('e,'a) SkewBinomialQueue"
  shows
  "tree_to_multiset t = foldt (λm e a. m+{#(e,a)#}) {#} t"
  "queue_to_multiset q = foldq (λm e a. m+{#(e,a)#}) {#} q"
  apply (induct t and q rule: tree_to_multiset_queue_to_multiset.induct)
  apply (auto simp add: union_ac fold_plus)
  done
*)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span> <span class="main">=</span> insert.simps 

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> SkewBinomialHeapStruc<span class="main">:</span> SkewBinomialHeapStruc_loc <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Bootstrapping"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we implement datastructural bootstrapping, to
  reduce the complexity of meld-operations to $O(1)$.
  The bootstrapping also contains a {\em global root}, caching the
  minimal element of the queue, and thus also reducing the complexity of
  findMin-operations to $O(1)$.

  Bootstrapping adds one more level of recursion:
  An {\em element} is an entry and a priority queues of elements.

  In the original paper on skew binomial queues \cite{BrOk96}, higher order 
  functors and recursive structures are used to elegantly implement bootstrapped
  heaps on top of ordinary heaps. However, such concepts are not supported in
  Isabelle/HOL, nor in Standard ML. Hence we have to use the 
  ,,much less clean'' \cite{BrOk96} alternative:  
  We manually specialize the heap datastructure, and re-implement the functions
  on the specialized data structure.

  The correctness proofs are done by defining a mapping from teh specialized to 
  the original data structure, and reusing the correctness statements of the 
  original data structure.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Auxiliary"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We first have to state some auxiliary lemmas and functions, mainly
  about multisets.
›</span></span>
<span class="comment1">(* TODO: Some of these should be moved into the multiset library, they are
  marked by *MOVE* *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finding the preimage of an element›</span></span>
<span class="comment1">(*MOVE*)</span>
<span class="keyword1" id="SkewBinomialHeap-in_image_msetE"><span class="command">lemma</span></span> in_image_msetE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈#</span>image_mset <span class="free">f</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈#</span><span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Very special lemma for images multisets of pairs, where the second
  component is a function of the first component›</span></span>
<span class="keyword1" id="SkewBinomialHeap-mset_image_fst_dep_pair_diff_split"><span class="command">lemma</span></span> mset_image_fst_dep_pair_diff_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">∈#</span><span class="free">M</span> <span class="main">⟶</span> <span class="bound">a</span><span class="main">=</span><span class="free">f</span> <span class="bound">e</span><span class="main">)</span> <span class="main">⟹</span>
  image_mset fst <span class="main">(</span><span class="free">M</span> <span class="main">-</span> <span class="main">{#</span><span class="main">(</span><span class="free">e</span><span class="main">,</span> <span class="free">f</span> <span class="free">e</span><span class="main">)</span><span class="main">#}</span><span class="main">)</span> <span class="main">=</span> image_mset fst <span class="free">M</span> <span class="main">-</span> <span class="main">{#</span><span class="free">e</span><span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add <span class="skolem">x</span> <span class="skolem">M</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="skolem">e'</span><span class="main">,</span><span class="free">f</span> <span class="skolem">e'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">from</span></span> add.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈#</span> <span class="skolem">M</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> add.hyps <span class="keyword1"><span class="command">have</span></span> 
    IH<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset fst <span class="main">(</span><span class="skolem">M</span> <span class="main">-</span> <span class="main">{#</span><span class="main">(</span><span class="free">e</span><span class="main">,</span> <span class="free">f</span> <span class="free">e</span><span class="main">)</span><span class="main">#}</span><span class="main">)</span> <span class="main">=</span> image_mset fst <span class="skolem">M</span> <span class="main">-</span> <span class="main">{#</span><span class="free">e</span><span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">=</span><span class="skolem">e'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">locale</span></span> Bootstrapped
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Datatype"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We manually specialize the binomial tree to contain elements, that, in, 
  turn, may contain trees.
  Note that we specify nodes without explicit priority,
  as the priority is contained in the elements stored in the nodes.
›</span></span>


<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialTree <span class="main">=</span> 
  BsNode <span class="main">(</span><span class="free"><span class="entity">val</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewElem"</span></span><span class="main">)</span>
        <span class="main">(</span><span class="free"><span class="entity">rank</span></span><span class="main">:</span> <span class="quoted">nat</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">children</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialTree list"</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span>
<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewElem <span class="main">=</span>
  Element <span class="tfree"><span class="quoted"><span class="tfree">'e</span></span></span> <span class="main">(</span><span class="free"><span class="entity">eprio</span></span><span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialTree list"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewHeap <span class="main">=</span> <span class="quoted"><span class="quoted">"unit <span class="main">+</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewElem"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialTree list"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Specialization Boilerplate"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we re-define the functions
  on the specialized priority queues, and show there correctness.
  This is done by defining a mapping to original priority queues,
  and re-using the correctness lemmas proven there.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Mapping to original binomial trees and queues›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bsmapt</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bsmapt</span> <span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> SkewBinomialHeapStruc.Node <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>eprio <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>map <span class="free">bsmapt</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">bsmap</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bsmap</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">==</span> map bsmapt <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Invariant and mapping to multiset are defined via the mapping›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">==</span> SkewBinomialHeapStruc.invar <span class="main">(</span>bsmap <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">queue_to_multiset</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> 
  <span class="main">==</span> image_mset fst <span class="main">(</span>SkewBinomialHeapStruc.queue_to_multiset <span class="main">(</span>bsmap <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">tree_to_multiset</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>
  <span class="main">==</span> image_mset fst <span class="main">(</span>SkewBinomialHeapStruc.tree_to_multiset <span class="main">(</span>bsmapt <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">queue_to_multiset_aux</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> 
  <span class="main">==</span> <span class="main">(</span>SkewBinomialHeapStruc.queue_to_multiset <span class="main">(</span>bsmap <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now starts the re-implementation of the functions›</span></span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">prio</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialTree <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prio</span> <span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> eprio <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-proj_xlate"><span class="command">lemma</span></span> proj_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"val <span class="free">t</span> <span class="main">=</span> SkewBinomialHeapStruc.val <span class="main">(</span>bsmapt <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"prio <span class="free">t</span> <span class="main">=</span> SkewBinomialHeapStruc.prio <span class="main">(</span>bsmapt <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"rank <span class="free">t</span> <span class="main">=</span> SkewBinomialHeapStruc.rank <span class="main">(</span>bsmapt <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"bsmap <span class="main">(</span>children <span class="free">t</span><span class="main">)</span> <span class="main">=</span> SkewBinomialHeapStruc.children <span class="main">(</span>bsmapt <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"eprio <span class="main">(</span>SkewBinomialHeapStruc.val <span class="main">(</span>bsmapt <span class="free">t</span><span class="main">)</span><span class="main">)</span> 
   <span class="main">=</span> SkewBinomialHeapStruc.prio <span class="main">(</span>bsmapt <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">fun</span></span>  <span class="entity">link</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialTree 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialTree <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialTree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">link</span> <span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">ts1</span></span></span><span class="main">)</span> <span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">ts2</span></span></span><span class="main">)</span> <span class="main">=</span> 
   <span class="main">(</span><span class="keyword1">if</span>  eprio <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">≤</span>eprio <span class="free"><span class="bound"><span class="entity">e2</span></span></span> 
     <span class="keyword1">then</span> <span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">ts2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ts1</span></span></span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">ts1</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ts2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Link two trees of rank $r$ and a new element to a new tree of 
  rank $r+1$›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">skewlink</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewElem <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialTree <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialTree <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialTree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">skewlink</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> eprio <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≤</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∧</span> eprio <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≤</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span>
  <span class="keyword1">then</span> <span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>Suc <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">]</span><span class="main">)</span>
  <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> 
   <span class="keyword1">then</span> 
    BsNode <span class="main">(</span>val <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">0</span> <span class="main">[]</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> children <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>
   <span class="keyword1">else</span> 
    BsNode <span class="main">(</span>val <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">0</span> <span class="main">[]</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> children <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-link_xlate"><span class="command">lemma</span></span> link_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bsmapt <span class="main">(</span>link <span class="free">t</span> <span class="free">t'</span><span class="main">)</span> <span class="main">=</span> SkewBinomialHeapStruc.link <span class="main">(</span>bsmapt <span class="free">t</span><span class="main">)</span> <span class="main">(</span>bsmapt <span class="free">t'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"bsmapt <span class="main">(</span>skewlink <span class="free">e</span> <span class="free">t</span> <span class="free">t'</span><span class="main">)</span> <span class="main">=</span> 
     SkewBinomialHeapStruc.skewlink <span class="free">e</span> <span class="main">(</span>eprio <span class="free">e</span><span class="main">)</span> <span class="main">(</span>bsmapt <span class="free">t</span><span class="main">)</span> <span class="main">(</span>bsmapt <span class="free">t'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t'</span></span></span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ins</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialTree <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ins</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ins</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> 
      <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> 
      <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">ins</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> 
        <span class="keyword1">else</span> <span class="free">ins</span> <span class="main">(</span>link <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-ins_xlate"><span class="command">lemma</span></span> ins_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bsmap <span class="main">(</span>ins <span class="free">t</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> SkewBinomialHeapStruc.ins <span class="main">(</span>bsmapt <span class="free">t</span><span class="main">)</span> <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_xlate link_xlate<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Insert an element with priority into a queue using skewlinks.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">insert</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewElem <span class="main">⇒</span>
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">insert</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span>BsNode <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">0</span> <span class="main">[]</span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">insert</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span>BsNode <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">0</span> <span class="main">[]</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">insert</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> rank <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≠</span> rank <span class="free"><span class="bound"><span class="entity">t'</span></span></span> 
      <span class="keyword1">then</span> <span class="main">(</span>BsNode <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">0</span> <span class="main">[]</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span>
      <span class="keyword1">else</span> <span class="main">(</span>skewlink <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-insert_xlate"><span class="command">lemma</span></span> insert_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bsmap <span class="main">(</span>insert <span class="free">e</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> SkewBinomialHeapStruc.insert <span class="free">e</span> <span class="main">(</span>eprio <span class="free">e</span><span class="main">)</span> <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">q</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> insert.cases<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_xlate link_xlate SkewBinomialHeapStruc.insert.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-insert_correct"><span class="command">lemma</span></span> insert_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"invar <span class="main">(</span>insert <span class="free">e</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>insert <span class="free">e</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">+</span> <span class="main">{#</span><span class="main">(</span><span class="free">e</span><span class="main">)</span><span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I SkewBinomialHeapStruc.insert_correct insert_xlate<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">uniqify</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uniqify</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">uniqify</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span> ins <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">meldUniq</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span>
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">meldUniq</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">meldUniq</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">meldUniq</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> rank <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">&lt;</span> rank <span class="free"><span class="bound"><span class="entity">t2</span></span></span> 
       <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">meldUniq</span> <span class="free"><span class="bound"><span class="entity">bq1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> rank <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">&lt;</span> rank <span class="free"><span class="bound"><span class="entity">t1</span></span></span>
              <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">meldUniq</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span>
              <span class="keyword1">else</span> ins <span class="main">(</span>link <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">meldUniq</span> <span class="free"><span class="bound"><span class="entity">bq1</span></span></span> <span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">meld</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span> 
      <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">meld</span> <span class="free"><span class="bound"><span class="entity">bq1</span></span></span> <span class="free"><span class="bound"><span class="entity">bq2</span></span></span> <span class="main">=</span> meldUniq <span class="main">(</span>uniqify <span class="free"><span class="bound"><span class="entity">bq1</span></span></span><span class="main">)</span> <span class="main">(</span>uniqify <span class="free"><span class="bound"><span class="entity">bq2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-uniqify_xlate"><span class="command">lemma</span></span> uniqify_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bsmap <span class="main">(</span>uniqify <span class="free">q</span><span class="main">)</span> <span class="main">=</span> SkewBinomialHeapStruc.uniqify <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ins_xlate<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-meldUniq_xlate"><span class="command">lemma</span></span> meldUniq_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bsmap <span class="main">(</span>meldUniq <span class="free">q</span> <span class="free">q'</span><span class="main">)</span> <span class="main">=</span> SkewBinomialHeapStruc.meldUniq <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span> <span class="main">(</span>bsmap <span class="free">q'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> meldUniq.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> link_xlate proj_xlate uniqify_xlate ins_xlate<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-meld_xlate"><span class="command">lemma</span></span> meld_xlate<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"bsmap <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span> <span class="main">=</span> SkewBinomialHeapStruc.meld <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span> <span class="main">(</span>bsmap <span class="free">q'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> meld_def meldUniq_xlate uniqify_xlate 
           SkewBinomialHeapStruc.meld_def<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-meld_correct"><span class="command">lemma</span></span> meld_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"invar <span class="free">q'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"invar <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">+</span> queue_to_multiset <span class="free">q'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I SkewBinomialHeapStruc.meld_correct meld_xlate<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">insertList</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span> 
   <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">insertList</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">tbq</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">tbq</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">insertList</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tbq</span></span></span> <span class="main">=</span> <span class="free">insertList</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">(</span>insert <span class="main">(</span>val <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tbq</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">remove1Prio</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span>
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">remove1Prio</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">remove1Prio</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>prio <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">remove1Prio</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">getMinTree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialTree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">getMinTree</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">getMinTree</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> prio <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> prio <span class="main">(</span><span class="free">getMinTree</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span>
      <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="free">getMinTree</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">findMin</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewElem"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">findMin</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">=</span> val <span class="main">(</span>getMinTree <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deleteMin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialQueue <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> BsSkewBinomialQueue"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deleteMin</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">min</span> <span class="main">=</span> getMinTree <span class="free"><span class="bound"><span class="entity">bq</span></span></span> <span class="keyword1">in</span> insertList
    <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>children <span class="bound">min</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>meld <span class="main">(</span>rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> rank <span class="bound">t</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>children <span class="bound">min</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
     <span class="main">(</span>remove1Prio <span class="main">(</span>prio <span class="bound">min</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bq</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-insertList_xlate"><span class="command">lemma</span></span> insertList_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bsmap <span class="main">(</span>insertList <span class="free">q</span> <span class="free">q'</span><span class="main">)</span> 
  <span class="main">=</span> SkewBinomialHeapStruc.insertList <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span> <span class="main">(</span>bsmap <span class="free">q'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q'</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_xlate proj_xlate<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-remove1Prio_xlate"><span class="command">lemma</span></span> remove1Prio_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bsmap <span class="main">(</span>remove1Prio <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> SkewBinomialHeapStruc.remove1Prio <span class="free">a</span> <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_xlate<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-getMinTree_xlate"><span class="command">lemma</span></span> getMinTree_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">[]</span> <span class="main">⟹</span> bsmapt <span class="main">(</span>getMinTree <span class="free">q</span><span class="main">)</span> <span class="main">=</span> SkewBinomialHeapStruc.getMinTree <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">q</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_xlate<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-findMin_xlate"><span class="command">lemma</span></span> findMin_xlate<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">[]</span> <span class="main">⟹</span> findMin <span class="free">q</span> <span class="main">=</span> fst <span class="main">(</span>SkewBinomialHeapStruc.findMin <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> findMin_def SkewBinomialHeapStruc.findMin_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_xlate Let_def getMinTree_xlate<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-findMin_xlate_aux"><span class="command">lemma</span></span> findMin_xlate_aux<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">[]</span> <span class="main">⟹</span> <span class="main">(</span>findMin <span class="free">q</span><span class="main">,</span> eprio <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span>SkewBinomialHeapStruc.findMin <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> findMin_def SkewBinomialHeapStruc.findMin_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_xlate Let_def getMinTree_xlate<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">q</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_xlate<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="comment1">(* TODO: Also possible in generic formulation. Then a candidate for Misc.thy *)</span>
<span class="keyword1" id="SkewBinomialHeap-bsmap_filter_xlate"><span class="command">lemma</span></span> bsmap_filter_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bsmap <span class="main">[</span> <span class="bound">x</span><span class="main">←</span><span class="free">l</span> <span class="main">.</span> <span class="free">P</span> <span class="main">(</span>bsmapt <span class="bound">x</span><span class="main">)</span> <span class="main">]</span> <span class="main">=</span> <span class="main">[</span> <span class="bound">x</span> <span class="main">←</span> bsmap <span class="free">l</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="SkewBinomialHeap-bsmap_rev_xlate"><span class="command">lemma</span></span> bsmap_rev_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bsmap <span class="main">(</span>rev <span class="free">q</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="SkewBinomialHeap-deleteMin_xlate"><span class="command">lemma</span></span> deleteMin_xlate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">[]</span> <span class="main">⟹</span> bsmap <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span> <span class="main">=</span> SkewBinomialHeapStruc.deleteMin <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 
    deleteMin_def SkewBinomialHeapStruc.deleteMin_def
    proj_xlate getMinTree_xlate insertList_xlate meld_xlate remove1Prio_xlate
    Let_def bsmap_rev_xlate<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> bsmap_filter_xlate<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="SkewBinomialHeap-deleteMin_correct_aux"><span class="command">lemma</span></span> deleteMin_correct_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"invar <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_to_multiset_aux <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset_aux <span class="free">q</span> <span class="main">-</span> 
  <span class="main">{#</span> <span class="main">(</span>findMin <span class="free">q</span><span class="main">,</span> eprio <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
    I NE deleteMin_xlate findMin_xlate_aux 
    SkewBinomialHeapStruc.deleteMin_correct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="SkewBinomialHeap-bsmap_fs_dep"><span class="command">lemma</span></span> bsmap_fs_dep<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">∈#</span>SkewBinomialHeapStruc.tree_to_multiset <span class="main">(</span>bsmapt <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">=</span>eprio <span class="free">e</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">∈#</span>SkewBinomialHeapStruc.queue_to_multiset <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">=</span>eprio <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">thm</span></span> SkewBinomialHeapStruc.tree_to_multiset_queue_to_multiset.induct
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"bsmapt <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="quoted">"bsmap <span class="free">q</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">q</span></span>
    <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SkewBinomialHeapStruc.tree_to_multiset_queue_to_multiset.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="SkewBinomialHeap-bsmap_fs_depD"><span class="command">lemma</span></span> bsmap_fs_depD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">∈#</span>SkewBinomialHeapStruc.tree_to_multiset <span class="main">(</span>bsmapt <span class="free">t</span><span class="main">)</span> 
  <span class="main">⟹</span> <span class="free">e</span> <span class="main">∈#</span> tree_to_multiset <span class="free">t</span> <span class="main">∧</span> <span class="free">a</span><span class="main">=</span>eprio <span class="free">e</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">∈#</span>SkewBinomialHeapStruc.queue_to_multiset <span class="main">(</span>bsmap <span class="free">q</span><span class="main">)</span> 
  <span class="main">⟹</span> <span class="free">e</span> <span class="main">∈#</span> queue_to_multiset <span class="free">q</span> <span class="main">∧</span> <span class="free">a</span><span class="main">=</span>eprio <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> bsmap_fs_dep <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> image_eqI<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-findMin_correct_aux"><span class="command">lemma</span></span> findMin_correct_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>findMin <span class="free">q</span><span class="main">,</span> eprio <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈#</span> queue_to_multiset_aux <span class="free">q</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>queue_to_multiset_aux <span class="free">q</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>findMin <span class="free">q</span><span class="main">,</span>eprio <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> snd <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
    I NE findMin_xlate_aux 
    SkewBinomialHeapStruc.findMin_correct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-findMin_correct"><span class="command">lemma</span></span> findMin_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"findMin <span class="free">q</span> <span class="main">∈#</span> queue_to_multiset <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>queue_to_multiset <span class="free">q</span><span class="main">)</span><span class="main">.</span> eprio <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> eprio <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> findMin_correct_aux<span class="main">[</span><span class="operator">OF</span> I NE<span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> bsmap_fs_depD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> eprio <span class="skolem">a</span><span class="main">)</span> <span class="main">∈#</span> queue_to_multiset_aux <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> bsmap_fs_dep<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SkewBinomialHeap-deleteMin_correct"><span class="command">lemma</span></span> deleteMin_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"invar <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"queue_to_multiset <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span> <span class="main">=</span> queue_to_multiset <span class="free">q</span> <span class="main">-</span> 
  <span class="main">{#</span> findMin <span class="free">q</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deleteMin_correct_aux<span class="main">[</span><span class="operator">OF</span> I NE<span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mset_image_fst_dep_pair_diff_split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> bsmap_fs_dep<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">declare</span></span> insert.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Bootstrapping: Phase 1"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we define the ticked versions
  of the functions, as defined in \cite{BrOk96}.
  These functions work on elements, i.e. only on 
  heaps that contain at least one entry.
  Additionally, we define an invariant for elements, and
  a mapping to multisets of entries, and prove correct
  the ticked functions.
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">findMin'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">findMin'</span> <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">meld'</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewElem <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewElem <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewElem"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">meld'</span> <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">q1</span></span></span><span class="main">)</span> <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="free"><span class="bound"><span class="entity">q2</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="keyword1">then</span>
    Element <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="main">(</span>insert <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="free"><span class="bound"><span class="entity">q2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q1</span></span></span><span class="main">)</span>
   <span class="keyword1">else</span>
    Element <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="main">(</span>insert <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">q1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q2</span></span></span><span class="main">)</span>
  <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">insert'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">insert'</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> meld' <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">deleteMin'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deleteMin'</span> <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">case</span> <span class="main">(</span>findMin <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
      Element <span class="bound">ey</span> <span class="bound">ay</span> <span class="bound">q1</span> <span class="main">⇒</span>
        Element <span class="bound">ey</span> <span class="bound">ay</span> <span class="main">(</span>meld <span class="bound">q1</span> <span class="main">(</span>deleteMin <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>
  <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Size-function for termination proofs
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tree_level</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">queue_level</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tree_level</span> <span class="main">(</span>BsNode <span class="main">(</span>Element <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">qd</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> 
  max <span class="main">(</span>Suc <span class="main">(</span><span class="free">queue_level</span> <span class="free"><span class="bound"><span class="entity">qd</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">queue_level</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">queue_level</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">queue_level</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">tree_level</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">queue_level</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">level</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">level</span> <span class="main">(</span>Element <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>queue_level <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SkewBinomialHeap-level_m"><span class="command">lemma</span></span> level_m<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈#</span>tree_to_multiset <span class="free">t</span> <span class="main">⟹</span> level <span class="free">x</span> <span class="main">&lt;</span> Suc <span class="main">(</span>tree_level <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈#</span>queue_to_multiset <span class="free">q</span> <span class="main">⟹</span> level <span class="free">x</span> <span class="main">&lt;</span> Suc <span class="main">(</span>queue_level <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tree_level_queue_level.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_max_iff_disj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-level_measure"><span class="command">lemma</span></span> level_measure<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set_mset <span class="main">(</span>queue_to_multiset <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="main">(</span>Element <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">∈</span>measure level"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈#</span> <span class="main">(</span>queue_to_multiset <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="main">(</span>Element <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">∈</span>measure level"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> level_m <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> set_image_mset<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Invariant for elements
›</span></span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">elem_invar</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">elem_invar</span> <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈#</span> <span class="main">(</span>queue_to_multiset <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> eprio <span class="bound">x</span> <span class="main">∧</span> <span class="free">elem_invar</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> 
  invar <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>measure level<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> level_measure<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Abstraction to multisets
›</span></span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">elem_to_mset</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">elem_to_mset</span> <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">#}</span> 
  <span class="main">+</span> sum_mset <span class="main">(</span>image_mset <span class="free">elem_to_mset</span> <span class="main">(</span>queue_to_multiset <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>measure level<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> level_measure<span class="main">)</span>

<span class="keyword1" id="SkewBinomialHeap-insert_correct'"><span class="command">lemma</span></span> insert_correct'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"elem_invar <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"elem_invar <span class="main">(</span>insert' <span class="free">e</span> <span class="free">a</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"elem_to_mset <span class="main">(</span>insert' <span class="free">e</span> <span class="free">a</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> elem_to_mset <span class="free">x</span> <span class="main">+</span> <span class="main">{#</span><span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_correct union_ac<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-meld_correct'"><span class="command">lemma</span></span> meld_correct'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"elem_invar <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"elem_invar <span class="free">x'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"elem_invar <span class="main">(</span>meld' <span class="free">x</span> <span class="free">x'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"elem_to_mset <span class="main">(</span>meld' <span class="free">x</span> <span class="free">x'</span><span class="main">)</span> <span class="main">=</span> elem_to_mset <span class="free">x</span> <span class="main">+</span> elem_to_mset <span class="free">x'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x'</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_correct union_ac<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1" id="SkewBinomialHeap-findMin'_min"><span class="command">lemma</span></span> findMin'_min<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>elem_invar <span class="free">x</span><span class="main">;</span> <span class="free">y</span><span class="main">∈#</span>elem_to_mset <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> snd <span class="main">(</span>findMin' <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> snd <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="skolem">n</span><span class="main"><span class="main">≡</span></span><span class="quoted"><span class="quoted">"level <span class="free">x</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> full_nat_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">note</span></span> IH<span class="main">=</span><span class="quoted">"1.hyps"</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> _ refl<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> PREMS<span class="main">=</span><span class="quoted">"1.prems"</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span>Element <span class="skolem">e</span> <span class="skolem">a</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> PREMS<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">=</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∨</span> 
    <span class="free">y</span><span class="main">∈#</span>sum_mset <span class="main">(</span>image_mset elem_to_mset <span class="main">(</span>queue_to_multiset <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C1</span> <span class="main">∨</span> <span class="var">?C2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">=</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> PREMS <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?C2</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yx</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yx</span> <span class="main">∈#</span> queue_to_multiset <span class="skolem">q</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
      B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈#</span> elem_to_mset <span class="skolem">yx</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> in_image_msetE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
    <span class="keyword1"><span class="command">from</span></span> A PREMS <span class="keyword1"><span class="command">have</span></span> IYX<span class="main">:</span> <span class="quoted"><span class="quoted">"elem_invar <span class="skolem">yx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> PREMS<span class="main">(</span>1<span class="main">)</span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> eprio <span class="skolem">yx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>findMin' <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> snd <span class="main">(</span>findMin' <span class="skolem">yx</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">yx</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span>
    <span class="keyword1"><span class="command">from</span></span> IH<span class="main">[</span><span class="operator">OF</span> _ IYX B<span class="main">]</span> level_m<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>findMin' <span class="skolem">yx</span><span class="main">)</span> <span class="main">≤</span> snd <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="SkewBinomialHeap-findMin_correct'"><span class="command">lemma</span></span> findMin_correct'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"elem_invar <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"findMin' <span class="free">x</span> <span class="main">∈#</span> elem_to_mset <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>elem_to_mset <span class="free">x</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>findMin' <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> snd <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> findMin'_min<span class="main"><span class="main">[</span></span><span class="operator">OF</span> I<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-deleteMin_correct'"><span class="command">lemma</span></span> deleteMin_correct'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"elem_invar <span class="main">(</span>Element <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> NE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
    <span class="quoted"><span class="quoted">"elem_invar <span class="main">(</span>deleteMin' <span class="main">(</span>Element <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"elem_to_mset <span class="main">(</span>deleteMin' <span class="main">(</span>Element <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       elem_to_mset <span class="main">(</span>Element <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">-</span> <span class="main">{#</span> findMin' <span class="main">(</span>Element <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">#}</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> IQ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> findMin_correct<span class="main">[</span><span class="operator">OF</span> IQ NE<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    FMIQ<span class="main">:</span> <span class="quoted"><span class="quoted">"findMin <span class="free">q</span> <span class="main">∈#</span> queue_to_multiset <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    FMIN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈#</span><span class="main">(</span>queue_to_multiset <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span> eprio <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> eprio <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> set_image_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> FMIQ I <span class="keyword1"><span class="command">have</span></span> FMEI<span class="main">:</span> <span class="quoted"><span class="quoted">"elem_invar <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> FEI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈#</span><span class="main">(</span>queue_to_multiset <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span> elem_invar <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ey</span></span> <span class="skolem"><span class="skolem">ay</span></span> <span class="skolem"><span class="skolem">qy</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"findMin <span class="free">q</span> <span class="main">=</span> Element <span class="skolem">ey</span> <span class="skolem">ay</span> <span class="skolem">qy</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"findMin <span class="free">q</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> FMEI <span class="keyword1"><span class="command">have</span></span> 
    IQY<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="skolem">qy</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    AYMIN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> queue_to_multiset <span class="skolem">qy</span> <span class="main">⟹</span> <span class="skolem">ay</span> <span class="main">≤</span> eprio <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    QEI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> queue_to_multiset <span class="skolem">qy</span> <span class="main">⟹</span> elem_invar <span class="bound">x</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elem_invar <span class="main">(</span>deleteMin' <span class="main">(</span>Element <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AYMIN QEI FMIN FEI
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_correct meld_correct in_diff_count<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> FMIQ <span class="keyword1"><span class="command">have</span></span> 
    S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>queue_to_multiset <span class="free">q</span> <span class="main">-</span> <span class="main">{#</span>Element <span class="skolem">ey</span> <span class="skolem">ay</span> <span class="skolem">qy</span><span class="main">#}</span><span class="main">)</span> <span class="main">+</span> <span class="main">{#</span>Element <span class="skolem">ey</span> <span class="skolem">ay</span> <span class="skolem">qy</span><span class="main">#}</span> 
    <span class="main">=</span> queue_to_multiset <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elem_to_mset <span class="main">(</span>deleteMin' <span class="main">(</span>Element <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    elem_to_mset <span class="main">(</span>Element <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">-</span> <span class="main">{#</span> findMin' <span class="main">(</span>Element <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_correct meld_correct<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> S<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_ac<span class="main">)</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Bootstrapping: Phase 2"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this phase, we extend the ticked versions to also work with
  empty priority queues.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bs_empty</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs_empty</span> <span class="main">≡</span> Inl <span class="main">()</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">bs_findMin</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_findMin</span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> findMin' <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bs_meld</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewHeap <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewHeap <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewHeap"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_meld</span> <span class="main">(</span>Inl <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_meld</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Inl <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_meld</span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">x'</span></span></span><span class="main">)</span> <span class="main">=</span> Inr <span class="main">(</span>meld' <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">x'</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bs_meld <span class="free">x</span> <span class="main">(</span>Inl <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">bs_insert</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'e</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewHeap <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewHeap"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_insert</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Inl <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> Inr <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_insert</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> Inr <span class="main">(</span>insert' <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bs_deleteMin</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewHeap <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> BsSkewHeap"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_deleteMin</span> <span class="main">(</span>Inr <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Inl <span class="main">()</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_deleteMin</span> <span class="main">(</span>Inr <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Inr <span class="main">(</span>deleteMin' <span class="main">(</span>Element <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">bs_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewHeap <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_invar</span> <span class="main">(</span>Inl <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">⟷</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_invar</span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">⟷</span> elem_invar <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bs_invar bs_empty"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bs_empty_def<span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">bs_to_mset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewHeap <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">×</span><span class="tfree">'a</span><span class="main">)</span> multiset"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_to_mset</span> <span class="main">(</span>Inl <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{#}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bs_to_mset</span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> elem_to_mset <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> bs_empty_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span><span class="main">=</span>bs_empty <span class="main">⟷</span> bs_to_mset <span class="free">h</span> <span class="main">=</span> <span class="main">{#}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> bs_empty_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">h</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-bs_mset_of_empty"><span class="command">lemma</span></span> bs_mset_of_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bs_to_mset bs_empty <span class="main">=</span> <span class="main">{#}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bs_empty_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> bs_findMin_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"bs_invar <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span><span class="main">≠</span>bs_empty"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bs_findMin <span class="free">h</span> <span class="main">∈#</span> bs_to_mset <span class="free">h</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>bs_to_mset <span class="free">h</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>bs_findMin <span class="free">h</span><span class="main">)</span> <span class="main">≤</span> snd <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I NE
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">h</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bs_empty_def findMin_correct'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> bs_insert_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"bs_invar <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"bs_invar <span class="main">(</span>bs_insert <span class="free">e</span> <span class="free">a</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"bs_to_mset <span class="main">(</span>bs_insert <span class="free">e</span> <span class="free">a</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span><span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">#}</span> <span class="main">+</span> bs_to_mset <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">h</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> meld_correct'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> bs_meld_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"bs_invar <span class="free">h</span>"</span></span> <span class="quoted"><span class="quoted">"bs_invar <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"bs_invar <span class="main">(</span>bs_meld <span class="free">h</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"bs_to_mset <span class="main">(</span>bs_meld <span class="free">h</span> <span class="free">h'</span><span class="main">)</span> <span class="main">=</span> bs_to_mset <span class="free">h</span> <span class="main">+</span> bs_to_mset <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">h</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">h'</span></span></span></span></span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> meld_correct'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> bs_deleteMin_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"bs_invar <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> bs_empty"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"bs_invar <span class="main">(</span>bs_deleteMin <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"bs_to_mset <span class="main">(</span>bs_deleteMin <span class="free">h</span><span class="main">)</span> <span class="main">=</span> bs_to_mset <span class="free">h</span> <span class="main">-</span> <span class="main">{#</span>bs_findMin <span class="free">h</span><span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I NE
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">h</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bs_empty_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">b</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> list<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">list</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> elem_invar.simps deleteMin'.simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_correct'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> BsSkewBinomialHeapStruc<span class="main">:</span> Bootstrapped <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Hiding the Invariant"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Datatype"</span></span>
<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> SkewBinomialHeap <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">q</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> BsSkewBinomialHeapStruc.BsSkewHeap<span class="main">.</span> BsSkewBinomialHeapStruc.bs_invar <span class="bound">q</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"BsSkewBinomialHeapStruc.bs_empty"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SkewBinomialHeap-Rep_SkewBinomialHeap_invar"><span class="command">lemma</span></span> Rep_SkewBinomialHeap_invar<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"BsSkewBinomialHeapStruc.bs_invar <span class="main">(</span>Rep_SkewBinomialHeap <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_SkewBinomialHeap
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"BsSkewBinomialHeapStruc.bs_invar <span class="free">q</span> 
  <span class="main">⟹</span> Rep_SkewBinomialHeap <span class="main">(</span>Abs_SkewBinomialHeap <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Abs_SkewBinomialHeap_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstype</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_SkewBinomialHeap <span class="main">(</span>Rep_SkewBinomialHeap <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_SkewBinomialHeap_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> SkewBinomialHeap_loc
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Operations"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">to_mset</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> 
    <span class="main">==</span> BsSkewBinomialHeapStruc.bs_to_mset <span class="main">(</span>Rep_SkewBinomialHeap <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">empty</span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">empty</span> <span class="main">==</span> Abs_SkewBinomialHeap BsSkewBinomialHeapStruc.bs_empty"</span></span> 
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
    <span class="quoted"><span class="quoted">"Rep_SkewBinomialHeap empty <span class="main">=</span> BsSkewBinomialHeapStruc.bs_empty"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> empty_def<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">isEmpty</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">==</span> Rep_SkewBinomialHeap <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> BsSkewBinomialHeapStruc.bs_empty"</span></span>
  <span class="keyword1" id="SkewBinomialHeap-empty_rep"><span class="command">lemma</span></span> empty_rep<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span>empty <span class="main">⟷</span> Rep_SkewBinomialHeap <span class="free">q</span> <span class="main">=</span> BsSkewBinomialHeapStruc.bs_empty"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Rep_SkewBinomialHeap_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="SkewBinomialHeap-isEmpty_correct"><span class="command">lemma</span></span> isEmpty_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"isEmpty <span class="free">q</span> <span class="main">⟷</span> <span class="free">q</span><span class="main">=</span>empty"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_rep isEmpty_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">definition</span></span> 
    <span class="entity">insert</span> 
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'e</span>  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> SkewBinomialHeap 
        <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> SkewBinomialHeap"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">insert</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">==</span> 
            Abs_SkewBinomialHeap <span class="main">(</span>
              BsSkewBinomialHeapStruc.bs_insert <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Rep_SkewBinomialHeap <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span><span class="main">]</span><span class="main">:</span> 
    <span class="quoted"><span class="quoted">"Rep_SkewBinomialHeap <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> 
    <span class="main">=</span> BsSkewBinomialHeapStruc.bs_insert <span class="free">e</span> <span class="free">a</span> <span class="main">(</span>Rep_SkewBinomialHeap <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_def BsSkewBinomialHeapStruc.bs_insert_correct<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">findMin</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> 
    <span class="main">==</span> BsSkewBinomialHeapStruc.bs_findMin <span class="main">(</span>Rep_SkewBinomialHeap <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">deleteMin</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">==</span> 
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span>empty <span class="keyword1">then</span> empty 
    <span class="keyword1">else</span> Abs_SkewBinomialHeap <span class="main">(</span>
            BsSkewBinomialHeapStruc.bs_deleteMin <span class="main">(</span>Rep_SkewBinomialHeap <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We don't use equality here, to prevent the code-generator
    from introducing equality-class parameter for type <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'a›</span></span></span></span>.
    Instead we use a case-distinction to check for emptiness.
›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_SkewBinomialHeap <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>Rep_SkewBinomialHeap <span class="free">q</span><span class="main">)</span> <span class="keyword1">of</span> Inl <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> BsSkewBinomialHeapStruc.bs_empty <span class="main">|</span>
     <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> BsSkewBinomialHeapStruc.bs_deleteMin <span class="main">(</span>Rep_SkewBinomialHeap <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Rep_SkewBinomialHeap <span class="free">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Inl <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Rep_SkewBinomialHeap <span class="free">q</span><span class="main">)</span> <span class="main">=</span> BsSkewBinomialHeapStruc.bs_empty"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BsSkewBinomialHeapStruc.bs_empty_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_def 
        BsSkewBinomialHeapStruc.bs_deleteMin_correct 
        BsSkewBinomialHeapStruc.bs_empty_correct empty_rep <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Inr <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Rep_SkewBinomialHeap <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> BsSkewBinomialHeapStruc.bs_empty"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BsSkewBinomialHeapStruc.bs_empty_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inr<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> Inr<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deleteMin_def 
        BsSkewBinomialHeapStruc.bs_deleteMin_correct 
        BsSkewBinomialHeapStruc.bs_empty_correct empty_rep <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
  lemma [code abstract]: "Rep_SkewBinomialHeap (deleteMin q) =
    (if (Rep_SkewBinomialHeap q = BsSkewBinomialHeapStruc.bs_empty) then BsSkewBinomialHeapStruc.bs_empty 
     else BsSkewBinomialHeapStruc.bs_deleteMin (Rep_SkewBinomialHeap q))"
    by (auto simp add: deleteMin_def BsSkewBinomialHeapStruc.bs_deleteMin_correct 
      BsSkewBinomialHeapStruc.bs_empty_correct empty_rep)
*)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">meld</span> <span class="free"><span class="bound"><span class="entity">q1</span></span></span> <span class="free"><span class="bound"><span class="entity">q2</span></span></span> <span class="main">==</span> 
    Abs_SkewBinomialHeap <span class="main">(</span>BsSkewBinomialHeapStruc.bs_meld 
    <span class="main">(</span>Rep_SkewBinomialHeap <span class="free"><span class="bound"><span class="entity">q1</span></span></span><span class="main">)</span> <span class="main">(</span>Rep_SkewBinomialHeap <span class="free"><span class="bound"><span class="entity">q2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"Rep_SkewBinomialHeap <span class="main">(</span>meld <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> 
    <span class="main">=</span> BsSkewBinomialHeapStruc.bs_meld <span class="main">(</span>Rep_SkewBinomialHeap <span class="free">q1</span><span class="main">)</span> 
                                 <span class="main">(</span>Rep_SkewBinomialHeap <span class="free">q2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> meld_def BsSkewBinomialHeapStruc.bs_meld_correct<span class="main">)</span>

  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Correctness"</span></span>

  <span class="keyword1" id="SkewBinomialHeap-empty_correct"><span class="command">lemma</span></span> empty_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"to_mset <span class="free">q</span> <span class="main">=</span> <span class="main">{#}</span> <span class="main">⟷</span> <span class="free">q</span><span class="main">=</span>empty"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_mset_def BsSkewBinomialHeapStruc.bs_empty_correct empty_rep<span class="main">)</span>

  <span class="keyword1" id="SkewBinomialHeap-to_mset_of_empty"><span class="command">lemma</span></span> to_mset_of_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"to_mset empty <span class="main">=</span> <span class="main">{#}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_correct<span class="main">)</span>

  <span class="keyword1" id="SkewBinomialHeap-insert_correct"><span class="command">lemma</span></span> insert_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"to_mset <span class="main">(</span>insert <span class="free">e</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span>  to_mset <span class="free">q</span> <span class="main">+</span> <span class="main">{#</span><span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> insert_def to_mset_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BsSkewBinomialHeapStruc.bs_insert_correct union_ac<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="SkewBinomialHeap-findMin_correct"><span class="command">lemma</span></span> findMin_correct<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span>empty"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> 
    <span class="quoted"><span class="quoted">"findMin <span class="free">q</span> <span class="main">∈#</span> to_mset <span class="free">q</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>to_mset <span class="free">q</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>findMin <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> snd <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> findMin_def to_mset_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_rep BsSkewBinomialHeapStruc.bs_findMin_correct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="SkewBinomialHeap-deleteMin_correct"><span class="command">lemma</span></span> deleteMin_correct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span>empty"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_mset <span class="main">(</span>deleteMin <span class="free">q</span><span class="main">)</span> <span class="main">=</span> to_mset <span class="free">q</span> <span class="main">-</span> <span class="main">{#</span> findMin <span class="free">q</span> <span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> findMin_def deleteMin_def to_mset_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_rep BsSkewBinomialHeapStruc.bs_deleteMin_correct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="SkewBinomialHeap-meld_correct"><span class="command">lemma</span></span> meld_correct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_mset <span class="main">(</span>meld <span class="free">q</span> <span class="free">q'</span><span class="main">)</span> <span class="main">=</span> to_mset <span class="free">q</span> <span class="main">+</span> to_mset <span class="free">q'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> to_mset_def meld_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BsSkewBinomialHeapStruc.bs_meld_correct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Correctness lemmas to be used with simplifier›</span></span>
  <span class="keyword1"><span class="command">lemmas</span></span> correct <span class="main">=</span> empty_correct deleteMin_correct meld_correct

  <span class="keyword2"><span class="keyword">end</span></span>

  <span class="keyword1"><span class="command">interpretation</span></span> SkewBinomialHeap<span class="main">:</span> SkewBinomialHeap_loc <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Documentation"</span></span>

<span class="comment1">(*#DOC
  fun [no_spec] SkewBinomialHeap.to_mset
    Abstraction to multiset.

  fun SkewBinomialHeap.empty
    The empty heap. ($O(1)$)

  fun SkewBinomialHeap.isEmpty
    Checks whether heap is empty. Mainly used to work around 
    code-generation issues. ($O(1)$)

  fun [long_type] SkewBinomialHeap.insert
    Inserts element ($O(1)$)

  fun SkewBinomialHeap.findMin
    Returns a minimal element ($O(1)$)

  fun [long_type] SkewBinomialHeap.deleteMin
    Deletes {\em the} element that is returned by {\em find\_min}. $O(\log(n))$

  fun [long_type] SkewBinomialHeap.meld
    Melds two heaps ($O(1)$)

*)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
   \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> <span class="quoted"><span class="quoted">"SkewBinomialHeap.to_mset"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}\\
        Abstraction to multiset.\\


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> <span class="quoted"><span class="quoted">"SkewBinomialHeap.empty"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}\\
        The empty heap. ($O(1)$)\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SkewBinomialHeap.empty_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] SkewBinomialHeap.empty_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> <span class="quoted"><span class="quoted">"SkewBinomialHeap.isEmpty"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}\\
        Checks whether heap is empty. Mainly used to work around
    code-generation issues. ($O(1)$)\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SkewBinomialHeap.isEmpty_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] SkewBinomialHeap.isEmpty_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"SkewBinomialHeap.insert"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> [display] <span class="quoted"><span class="quoted">"SkewBinomialHeap.insert"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
        Inserts element ($O(1)$)\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SkewBinomialHeap.insert_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] SkewBinomialHeap.insert_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> <span class="quoted"><span class="quoted">"SkewBinomialHeap.findMin"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}\\
        Returns a minimal element ($O(1)$)\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SkewBinomialHeap.findMin_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] SkewBinomialHeap.findMin_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"SkewBinomialHeap.deleteMin"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> [display] <span class="quoted"><span class="quoted">"SkewBinomialHeap.deleteMin"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
        Deletes {\em the} element that is returned by {\em find\_min}. $O(\log(n))$\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SkewBinomialHeap.deleteMin_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] SkewBinomialHeap.deleteMin_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>


    \underline{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"SkewBinomialHeap.meld"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> [display] <span class="quoted"><span class="quoted">"SkewBinomialHeap.meld"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
        Melds two heaps ($O(1)$)\\
    {\bf Spec} <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SkewBinomialHeap.meld_correct›</span></span></span></span>:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] SkewBinomialHeap.meld_correct<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

›</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Test">
<div class="head">
<h1>Theory Test</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Test
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Numeral.html">HOL-Library.Code_Target_Numeral</a>"</span> <a href="BinomialHeap.html">BinomialHeap</a> <a href="SkewBinomialHeap.html">SkewBinomialHeap</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    This theory is included into teh session, in order to
    catch problems with code generation.
›</span></span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">sh_empty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unit <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>nat<span class="main">)</span> SkewBinomialHeap"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sh_empty</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> SkewBinomialHeap.empty"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">sh_findMin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>nat<span class="main">)</span> SkewBinomialHeap <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sh_findMin</span> <span class="main">≡</span> SkewBinomialHeap.findMin"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">sh_deleteMin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>nat<span class="main">)</span> SkewBinomialHeap <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>nat<span class="main">)</span> SkewBinomialHeap"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sh_deleteMin</span> <span class="main">≡</span> SkewBinomialHeap.deleteMin"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">sh_insert</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sh_insert</span> <span class="main">≡</span> SkewBinomialHeap.insert"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">sh_meld</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>nat<span class="main">)</span> SkewBinomialHeap <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sh_meld</span> <span class="main">≡</span> SkewBinomialHeap.meld"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bh_empty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unit <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>nat<span class="main">)</span> BinomialHeap"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bh_empty</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> BinomialHeap.empty"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bh_findMin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>nat<span class="main">)</span> BinomialHeap <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bh_findMin</span> <span class="main">≡</span> BinomialHeap.findMin"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bh_deleteMin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>nat<span class="main">)</span> BinomialHeap <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>nat<span class="main">)</span> BinomialHeap"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bh_deleteMin</span> <span class="main">≡</span> BinomialHeap.deleteMin"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bh_insert</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bh_insert</span> <span class="main">≡</span> BinomialHeap.insert"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bh_meld</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>nat<span class="main">)</span> BinomialHeap <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bh_meld</span> <span class="main">≡</span> BinomialHeap.meld"</span></span>

<span class="keyword1"><span class="command">export_code</span></span> 
  <span class="quoted"><span class="quoted">sh_empty</span></span>
  <span class="quoted"><span class="quoted">sh_findMin</span></span>
  <span class="quoted"><span class="quoted">sh_deleteMin</span></span>
  <span class="quoted"><span class="quoted">sh_insert</span></span>
  <span class="quoted"><span class="quoted">sh_meld</span></span>

  <span class="quoted"><span class="quoted">bh_empty</span></span>
  <span class="quoted"><span class="quoted">bh_findMin</span></span>
  <span class="quoted"><span class="quoted">bh_deleteMin</span></span>
  <span class="quoted"><span class="quoted">bh_insert</span></span>
  <span class="quoted"><span class="quoted">bh_meld</span></span>
  <span class="keyword2"><span class="keyword">in</span></span> Haskell
  <span class="keyword2"><span class="keyword">in</span></span> OCaml
  <span class="keyword2"><span class="keyword">in</span></span> SML

<span class="keyword1"><span class="command">ML_val</span></span> <span class="quoted">‹
  <span class="comment1">(* ** Binomial Heaps ** *)</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">q1</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">bh_insert</span><span class="antiquote">}</span></span></span> <span class="inner_quoted">"a"</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">nat_of_integer</span><span class="antiquote">}</span></span></span> <span class="inner_numeral">1</span><span class="main">)</span>
    <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">bh_insert</span><span class="antiquote">}</span></span></span> <span class="inner_quoted">"b"</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">nat_of_integer</span><span class="antiquote">}</span></span></span> <span class="inner_numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">bh_empty</span><span class="antiquote">}</span></span></span> <span class="main">(</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">q2</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">bh_insert</span><span class="antiquote">}</span></span></span> <span class="inner_quoted">"c"</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">nat_of_integer</span><span class="antiquote">}</span></span></span> <span class="inner_numeral">3</span><span class="main">)</span>
    <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">bh_insert</span><span class="antiquote">}</span></span></span> <span class="inner_quoted">"d"</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">nat_of_integer</span><span class="antiquote">}</span></span></span> <span class="inner_numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">bh_empty</span><span class="antiquote">}</span></span></span> <span class="main">(</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">q</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">bh_meld</span><span class="antiquote">}</span></span></span> <span class="entity">q1</span> <span class="entity">q2</span><span class="main">;</span>
  <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">bh_findMin</span><span class="antiquote">}</span></span></span> <span class="entity">q</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">q</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">bh_deleteMin</span><span class="antiquote">}</span></span></span> <span class="entity">q</span><span class="main">;</span>
  <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">bh_findMin</span><span class="antiquote">}</span></span></span> <span class="entity">q</span><span class="main">;</span>


  <span class="comment1">(* ** Skew Binomial Heaps ** *)</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">q1</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">sh_insert</span><span class="antiquote">}</span></span></span> <span class="inner_quoted">"a"</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">nat_of_integer</span><span class="antiquote">}</span></span></span> <span class="inner_numeral">1</span><span class="main">)</span>
    <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">sh_insert</span><span class="antiquote">}</span></span></span> <span class="inner_quoted">"b"</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">nat_of_integer</span><span class="antiquote">}</span></span></span> <span class="inner_numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">sh_empty</span><span class="antiquote">}</span></span></span> <span class="main">(</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">q2</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">sh_insert</span><span class="antiquote">}</span></span></span> <span class="inner_quoted">"c"</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">nat_of_integer</span><span class="antiquote">}</span></span></span> <span class="inner_numeral">3</span><span class="main">)</span>
    <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">sh_insert</span><span class="antiquote">}</span></span></span> <span class="inner_quoted">"d"</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">nat_of_integer</span><span class="antiquote">}</span></span></span> <span class="inner_numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">sh_empty</span><span class="antiquote">}</span></span></span> <span class="main">(</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">q</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">sh_meld</span><span class="antiquote">}</span></span></span> <span class="entity">q1</span> <span class="entity">q2</span><span class="main">;</span>
  <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">sh_findMin</span><span class="antiquote">}</span></span></span> <span class="entity">q</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">q</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">sh_deleteMin</span><span class="antiquote">}</span></span></span> <span class="entity">q</span><span class="main">;</span>
  <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">sh_findMin</span><span class="antiquote">}</span></span></span> <span class="entity">q</span><span class="main">;</span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>