<div id="Epistemic_Logic">
<div class="head">
<h1>Theory Epistemic_Logic</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:      Epistemic_Logic.thy
  Author:    Asta Halkjær From

  This work is a formalization of epistemic logic with countably many agents.
  It includes proofs of soundness and completeness for the axiom system K.
  The completeness proof is based on the textbook "Reasoning About Knowledge"
  by Fagin, Halpern, Moses and Vardi (MIT Press 1995).
  The extensions of system K (T, KB, K4, S4, S5) and their completeness proofs
  are based on the textbook "Modal Logic" by Blackburn, de Rijke and Venema
  (Cambridge University Press 2001).
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Epistemic_Logic <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Countable.html">HOL-Library.Countable</a>"</span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Syntax›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> id <span class="main">=</span> <span class="quoted">string</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'i</span> fm
  <span class="main">=</span> FF <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>⊥</b></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Pro <span class="quoted">id</span>
  <span class="main">|</span> Dis <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm›</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>∨</b></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 30<span class="main">)</span>
  <span class="main">|</span> Con <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm›</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>∧</b></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 35<span class="main">)</span>
  <span class="main">|</span> Imp <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm›</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>⟶</b></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 25<span class="main">)</span>
  <span class="main">|</span> K <span class="tfree"><span class="quoted"><span class="tfree">'i</span></span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">TT</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⊤</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">TT</span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Neg</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>¬</b></span> _"</span> <span class="main">[</span>40<span class="main">]</span> 40<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">Neg</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semantics›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke <span class="main">=</span> Kripke <span class="main">(</span><span class="free"><span class="entity">π</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'s</span> <span class="main">⇒</span> id <span class="main">⇒</span> bool›</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">𝒦</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'s</span> set›</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">semantics</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span>
  <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span> _ <span class="keyword1">⊨</span> _"</span> <span class="main">[</span>50<span class="main">,</span> 50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span><span class="main">)</span> <span class="main">=</span> False›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> Pro <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> π <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">⊨</span></span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="bound">t</span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹S5 Axioms›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">reflexive</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> 𝒦 <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">i</span> <span class="bound">s</span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">symmetric</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">symmetric</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">i</span> <span class="bound">s</span> <span class="main">⟷</span> <span class="bound">s</span> <span class="main">∈</span> 𝒦 <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">i</span> <span class="bound">t</span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">transitive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">transitive</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">i</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> 𝒦 <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">i</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∈</span> 𝒦 <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">i</span> <span class="bound">s</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">equivalence</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">equivalence</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> reflexive <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∧</span> symmetric <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∧</span> transitive <span class="free"><span class="bound"><span class="entity">M</span></span></span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-Imp_intro"><span class="command">lemma</span></span> Imp_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> distribution<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> K <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> K <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> K <span class="free">i</span> <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> K <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span><span class="main">.</span> <span class="free">M</span><span class="main">,</span> <span class="bound">t</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span><span class="main">.</span> <span class="free">M</span><span class="main">,</span> <span class="bound">t</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span><span class="main">.</span> <span class="free">M</span><span class="main">,</span> <span class="bound">t</span> <span class="main">⊨</span> <span class="free">q</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> K <span class="free">i</span> <span class="free">q</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> generalization<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke<span class="main">)</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> K <span class="free">i</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span><span class="main">.</span> <span class="free">M</span><span class="main">,</span> <span class="bound">t</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> K <span class="free">i</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> truth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹reflexive <span class="free">M</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">p</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> K <span class="free">i</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span><span class="main">.</span> <span class="free">M</span><span class="main">,</span> <span class="bound">t</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹reflexive <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reflexive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> pos_introspection<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="free">M</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span><span class="free">s</span> <span class="main">⊨</span> K <span class="free">i</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span><span class="main">.</span> <span class="free">M</span><span class="main">,</span> <span class="bound">t</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="bound">t</span><span class="main">.</span> <span class="free">M</span><span class="main">,</span> <span class="bound">u</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> transitive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span><span class="main">.</span> <span class="free">M</span><span class="main">,</span> <span class="bound">t</span> <span class="main">⊨</span> K <span class="free">i</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> K <span class="free">i</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> neg_introspection<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹symmetric <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="free">M</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="free">i</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span><span class="free">s</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="bound">t</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹symmetric <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="free">M</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> symmetric_def transitive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> 𝒦 <span class="free">M</span> <span class="free">i</span> <span class="free">s</span><span class="main">.</span> <span class="free">M</span><span class="main">,</span> <span class="bound">t</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="free">i</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> K <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="free">i</span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-ex_equiv_model"><span class="command">lemma</span></span> ex_equiv_model<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> reflexive <span class="bound">M</span> <span class="main">∧</span> symmetric <span class="bound">M</span> <span class="main">∧</span> transitive <span class="bound">M</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹reflexive <span class="main">(</span>Kripke undefined <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="bound">s</span><span class="main">.</span> <span class="main">{</span><span class="bound">s</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> reflexive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹symmetric <span class="main">(</span>Kripke undefined <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="bound">s</span><span class="main">.</span> <span class="main">{</span><span class="bound">s</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> symmetric_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="main">(</span>Kripke undefined <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="bound">s</span><span class="main">.</span> <span class="main">{</span><span class="bound">s</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> transitive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Normal Modal Logic›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">eval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>id <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'i</span> fm <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span> <span class="main">=</span> False›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span>Pro <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∨</span> <span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟶</span> <span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span>K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span>K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">tautology</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">g</span> <span class="bound">h</span><span class="main">.</span> eval <span class="bound">g</span> <span class="bound">h</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">AK</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span> fm <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _"</span> <span class="main">[</span>50<span class="main">,</span> 50<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    A1<span class="main">:</span> <span class="quoted"><span class="quoted">‹tautology <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="free">A</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
  <span class="main">|</span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span>K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
  <span class="main">|</span> Ax<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="free">A</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
  <span class="main">|</span> R1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="free">A</span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>›</span></span>
  <span class="main">|</span> R2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="free">A</span> <span class="main"><span class="free">⊢</span></span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1" id="Epistemic_Logic-eval_semantics"><span class="command">lemma</span></span> eval_semantics<span class="main">:</span> <span class="quoted"><span class="quoted">‹eval <span class="main">(</span><span class="free">pi</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> Kripke <span class="free">pi</span> <span class="free">r</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="bound">q</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>Kripke <span class="free">pi</span> <span class="free">r</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Epistemic_Logic-tautology"><span class="command">lemma</span></span> tautology<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹tautology <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="main">(</span><span class="skolem">g</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> Kripke <span class="skolem">g</span> <span class="skolem">r</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="bound">q</span><span class="main">)</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="skolem">r</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Kripke <span class="skolem">g</span> <span class="skolem">r</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="skolem">r</span>
    <span class="keyword1"><span class="command">using</span></span> eval_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kripke.collapse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> soundness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span> <span class="bound">p</span><span class="main">.</span> <span class="free">A</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">M</span> <span class="main">⟹</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="bound">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> AK.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms tautology<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Derived rules›</span></span>

<span class="keyword1" id="Epistemic_Logic-K_A2'"><span class="command">lemma</span></span> K_A2'<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>K <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> K <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> A2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">P</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">Q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">R</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main">(</span><span class="skolem">Q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">P</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">R</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> R1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-K_map"><span class="command">lemma</span></span> K_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> K <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> R2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>K <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> K_A2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> R1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-K_LK"><span class="command">lemma</span></span> K_LK<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>L <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="free">i</span> <span class="free">p</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">P</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">Q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">Q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="skolem">Q</span>
    <span class="keyword1"><span class="command">using</span></span> A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> K_map R1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">imply</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm list <span class="main">⇒</span> <span class="tfree">'i</span> fm <span class="main">⇒</span> <span class="tfree">'i</span> fm›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">imply</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">imply</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">imply</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-K_imply_head"><span class="command">lemma</span></span> K_imply_head<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tautology <span class="main">(</span>imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-K_imply_Cons"><span class="command">lemma</span></span> K_imply_Cons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">ps</span> <span class="free">q</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="free">q</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>imply <span class="free">ps</span> <span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> R1 assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-K_right_mp"><span class="command">lemma</span></span> K_right_mp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">ps</span> <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">ps</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">ps</span> <span class="free">q</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tautology <span class="main">(</span>imply <span class="free">ps</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">ps</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">ps</span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>imply <span class="free">ps</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">ps</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">ps</span> <span class="free">q</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms R1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-tautology_imply_superset"><span class="command">lemma</span></span> tautology_imply_superset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">ps</span> <span class="main">⊆</span> set <span class="free">qs</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tautology <span class="main">(</span>imply <span class="free">ps</span> <span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">qs</span> <span class="free">r</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> tautology <span class="main">(</span>imply <span class="free">ps</span> <span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">qs</span> <span class="free">r</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">(</span>imply <span class="free">ps</span> <span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">qs</span> <span class="free">r</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">(</span>imply <span class="free">ps</span> <span class="free">r</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">(</span>imply <span class="free">qs</span> <span class="free">r</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>np<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> <span class="main">¬</span> eval <span class="skolem">g</span> <span class="skolem">h</span> <span class="bound">p</span>›</span></span> <span class="main">|</span> <span class="main">(</span>r<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> eval <span class="skolem">g</span> <span class="skolem">h</span> <span class="bound">p</span>›</span></span> <span class="quoted"><span class="quoted">‹eval <span class="skolem">g</span> <span class="skolem">h</span> <span class="free">r</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> np
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="main">¬</span> eval <span class="skolem">g</span> <span class="skolem">h</span> <span class="bound">p</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">ps</span> <span class="main">⊆</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">(</span>imply <span class="free">qs</span> <span class="free">r</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">qs</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">(</span>imply <span class="free">qs</span> <span class="free">r</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> r
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">(</span>imply <span class="free">qs</span> <span class="free">r</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">qs</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">(</span>imply <span class="free">qs</span> <span class="free">r</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-K_imply_weaken"><span class="command">lemma</span></span> K_imply_weaken<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">ps</span> <span class="free">q</span>›</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">ps</span> <span class="main">⊆</span> set <span class="free">ps'</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">ps'</span> <span class="free">q</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tautology <span class="main">(</span>imply <span class="free">ps</span> <span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">ps'</span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">ps</span> <span class="main">⊆</span> set <span class="free">ps'</span>›</span></span> tautology_imply_superset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>imply <span class="free">ps</span> <span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">ps'</span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">ps</span> <span class="free">q</span>›</span></span> R1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-imply_append"><span class="command">lemma</span></span> imply_append<span class="main">:</span> <span class="quoted"><span class="quoted">‹imply <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">ps'</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> imply <span class="free">ps</span> <span class="main">(</span>imply <span class="free">ps'</span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Epistemic_Logic-K_ImpI"><span class="command">lemma</span></span> K_ImpI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="free">q</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">G</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">G</span> <span class="main">@</span> <span class="main">[</span><span class="free">p</span><span class="main">]</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">G</span> <span class="main">@</span> <span class="main">[</span><span class="free">p</span><span class="main">]</span><span class="main">)</span> <span class="free">q</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms K_imply_weaken <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">G</span> <span class="main">(</span>imply <span class="main">[</span><span class="free">p</span><span class="main">]</span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> imply_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-K_Boole"><span class="command">lemma</span></span> K_Boole<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">G</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">G</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms K_ImpI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tautology <span class="main">(</span>imply <span class="free">G</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">G</span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>imply <span class="free">G</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">G</span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> R1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-K_DisE"><span class="command">lemma</span></span> K_DisE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">q</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">G</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">G</span> <span class="free">r</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tautology <span class="main">(</span>imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="main">(</span><span class="free">q</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">G</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">G</span> <span class="free">r</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="main">(</span><span class="free">q</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">G</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="free">G</span> <span class="free">r</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms R1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-K_mp"><span class="command">lemma</span></span> K_mp<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> K_imply_head K_imply_weaken K_right_mp set_subset_Cons<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-K_swap"><span class="command">lemma</span></span> K_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">q</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">q</span> <span class="main">#</span> <span class="free">p</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms K_ImpI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imply.simps<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-K_DisL"><span class="command">lemma</span></span> K_DisL<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="free">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p'</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="free">q</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">p'</span><span class="main">)</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="free">q</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">p'</span><span class="main">)</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="free">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p'</span> <span class="main">#</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">p'</span><span class="main">)</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="free">q</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms K_swap K_imply_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">p'</span><span class="main">)</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">p'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> K_imply_head <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> K_DisE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-K_distrib_K_imp"><span class="command">lemma</span></span> K_distrib_K_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> K <span class="free">i</span> <span class="main">(</span>imply <span class="free">G</span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span>map <span class="main">(</span>K <span class="free">i</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>K <span class="free">i</span> <span class="main">(</span>imply <span class="free">G</span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="main">(</span>map <span class="main">(</span>K <span class="free">i</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>K <span class="free">i</span> <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> K <span class="free">i</span> <span class="main">(</span>imply <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="main">(</span>imply <span class="skolem">G</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span>K <span class="free">i</span> <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> K <span class="free">i</span> <span class="main">(</span>imply <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="main">(</span>imply <span class="skolem">G</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span>
        <span class="main">(</span>K <span class="free">i</span> <span class="main">(</span>imply <span class="skolem">G</span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="main">(</span>map <span class="main">(</span>K <span class="free">i</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span>
        <span class="main">(</span>K <span class="free">i</span> <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> K <span class="free">i</span> <span class="main">(</span>imply <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="main">(</span>map <span class="main">(</span>K <span class="free">i</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>K <span class="free">i</span> <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> K <span class="free">i</span> <span class="main">(</span>imply <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="main">(</span>map <span class="main">(</span>K <span class="free">i</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons R1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span>K <span class="free">i</span> <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> K <span class="free">i</span> <span class="main">(</span>imply <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="main">(</span>map <span class="main">(</span>K <span class="free">i</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span>
        <span class="main">(</span>K <span class="free">i</span> <span class="main">(</span>imply <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="main">(</span>map <span class="main">(</span>K <span class="free">i</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span>K <span class="free">i</span> <span class="main">(</span>imply <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> imply <span class="main">(</span>map <span class="main">(</span>K <span class="free">i</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> R1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms R1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Consistent sets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">consistent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span> fm <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span> fm set <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">consistent</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∄</span><span class="bound">S'</span><span class="main">.</span> set <span class="bound">S'</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⊢</span> imply <span class="bound">S'</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-inconsistent_subset"><span class="command">lemma</span></span> inconsistent_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">V'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">V'</span> <span class="main">⊆</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">V'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V'</span></span> <span class="keyword2"><span class="keyword">where</span></span> V'<span class="main">:</span> <span class="quoted"><span class="quoted">‹set <span class="skolem">V'</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">{</span><span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> set <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="skolem">V'</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="skolem">V'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> K_imply_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹removeAll <span class="free">p</span> <span class="skolem">V'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="skolem">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="var">?S</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="var">?S</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> * K_imply_weaken <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="var">?S</span> <span class="main">⊆</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> V'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset_conv set_removeAll<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-consistent_deriv"><span class="command">lemma</span></span> consistent_deriv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> R1 consistent_def imply.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inconsistent_subset<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-consistent_consequent"><span class="command">lemma</span></span> consistent_consequent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="free">q</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">V'</span><span class="main">.</span> set <span class="bound">V'</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="bound">V'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> consistent_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_subset list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">V'</span><span class="main">.</span> set <span class="bound">V'</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">q</span> <span class="main">#</span> <span class="bound">V'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span> K_imply_head K_right_mp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imply.simps<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> inconsistent_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-consistent_consequent'"><span class="command">lemma</span></span> consistent_consequent'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹tautology <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="free">q</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms consistent_consequent A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Epistemic_Logic-consistent_disjuncts"><span class="command">lemma</span></span> consistent_disjuncts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">q</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="main">∨</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="free">q</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?thesis</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="free">q</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="skolem"><span class="skolem">T'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    S'<span class="main">:</span> <span class="quoted"><span class="quoted">‹set <span class="skolem">S'</span> <span class="main">⊆</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="skolem">S'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    T'<span class="main">:</span> <span class="quoted"><span class="quoted">‹set <span class="skolem">T'</span> <span class="main">⊆</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">q</span> <span class="main">#</span> <span class="skolem">T'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> inconsistent_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">from</span></span> S' <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="skolem">S'</span> <span class="main">@</span> <span class="skolem">T'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> K_imply_weaken Un_upper1 append_Cons set_append<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> T' <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">q</span> <span class="main">#</span> <span class="skolem">S'</span> <span class="main">@</span> <span class="skolem">T'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> K_imply_head K_right_mp R1 imply.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> imply_append<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">q</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">S'</span> <span class="main">@</span> <span class="skolem">T'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> K_DisL <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="skolem">S'</span> <span class="main">@</span> <span class="skolem">T'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> S'<span class="main">(</span>1<span class="main">)</span> T'<span class="main">(</span>1<span class="main">)</span> p q <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">q</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> consistent_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_subset_iff insert_subset list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> set_append<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="skolem">S'</span> <span class="main">@</span> <span class="skolem">T'</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> T'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-exists_finite_inconsistent"><span class="command">lemma</span></span> exists_finite_inconsistent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">W</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">W</span> <span class="main">⊆</span> <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">∉</span> <span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">W</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="keyword2"><span class="keyword">where</span></span> W'<span class="main">:</span> <span class="quoted"><span class="quoted">‹set <span class="skolem">W'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="skolem">W'</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹removeAll <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="skolem">W'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> set <span class="var">?S</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">using</span></span> W'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>set <span class="var">?S</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> set <span class="var">?S</span> <span class="main">⊆</span> <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> W'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">∉</span> set <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-inconsistent_imply"><span class="command">lemma</span></span> inconsistent_imply<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> set <span class="free">G</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">G</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms K_Boole K_imply_weaken <span class="keyword1"><span class="command">unfolding</span></span> consistent_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_is_Un list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-consistent_axioms"><span class="command">lemma</span></span> consistent_axioms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span> <span class="bound">p</span><span class="main">.</span> <span class="free">A</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">M</span> <span class="main">⟹</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="bound">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="free">P</span> <span class="bound">M</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">{}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?thesis</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span><span class="main">,</span> <span class="skolem">s</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">using</span></span> soundness assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> semantics.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Maximal consistent sets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">maximal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span> fm <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span> fm set <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">maximal</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="main">¬</span> consistent <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> deriv_in_maximal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms R1 inconsistent_subset <span class="keyword1"><span class="command">unfolding</span></span> consistent_def maximal_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imply.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> exactly_one_in_maximal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟷</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">∉</span> <span class="free">V</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">∉</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms K_mp <span class="keyword1"><span class="command">unfolding</span></span> consistent_def maximal_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_subsetI insert_subset list.set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">∉</span> <span class="free">V</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms deriv_in_maximal <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="main">∨</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms consistent_disjuncts <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">∉</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> consequent_in_maximal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">V'</span><span class="main">.</span> set <span class="bound">V'</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main">#</span> <span class="bound">V'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> consistent_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_subset list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">V'</span><span class="main">.</span> set <span class="bound">V'</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="free">q</span> <span class="main">#</span> <span class="bound">V'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> K_mp K_ImpI K_imply_weaken K_right_mp set_subset_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="free">q</span><span class="main">}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> inconsistent_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ax_in_maximal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms deriv_in_maximal Ax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lindenbaum extension›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fm <span class="main">::</span> <span class="main">(</span><span class="quoted">countable</span><span class="main">)</span> <span class="quoted">countable</span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">countable_datatype</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">extend</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span> fm <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span> fm set <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'i</span> fm<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'i</span> fm set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> consistent <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>
     <span class="keyword1">then</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
     <span class="keyword1">else</span> <span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Extend</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span> fm <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span> fm set <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'i</span> fm<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span> fm set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">Extend</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> extend <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-Extend_subset"><span class="command">lemma</span></span> Extend_subset<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> Extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Extend_def <span class="keyword1"><span class="command">using</span></span> Union_upper extend.simps<span class="main">(</span>1<span class="main">)</span> range_eqI
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Epistemic_Logic-extend_bound"><span class="command">lemma</span></span> extend_bound<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">≤</span> <span class="free">m</span><span class="main">.</span> extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span> <span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atMost_Suc<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-consistent_extend"><span class="command">lemma</span></span> consistent_extend<span class="main">:</span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">S</span> <span class="main">⟹</span> consistent <span class="free">A</span> <span class="main">(</span>extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Epistemic_Logic-UN_finite_bound"><span class="command">lemma</span></span> UN_finite_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">m</span> <span class="main">::</span> nat<span class="main">.</span> <span class="free">A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">≤</span> <span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="skolem">m'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">m'</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Epistemic_Logic-consistent_Extend"><span class="command">lemma</span></span> consistent_Extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">S</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span>Extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Extend_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="skolem">S'</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">.</span> extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> UN_finite_bound <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.finite_set<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">S'</span> <span class="main">⊆</span> extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span> <span class="skolem">m</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> extend_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span>extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span> <span class="skolem">m</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms consistent_extend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="skolem">S'</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-Extend_maximal"><span class="command">lemma</span></span> Extend_maximal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹surj <span class="free">f</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="main">(</span>Extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> maximal <span class="free">A</span> <span class="main">(</span>Extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> Extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> Extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">using</span></span> assms consistent_Extend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹surj <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> surj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> Extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Extend_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span> <span class="skolem">k</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span> <span class="skolem">k</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> Extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Extend_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> Extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> Extend <span class="free">A</span> <span class="free">S</span> <span class="free">f</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-maximal_extension"><span class="command">lemma</span></span> maximal_extension<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">V</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> fm set›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">W</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">W</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Extend <span class="free">A</span> <span class="free">V</span> from_nat›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">⊆</span> <span class="var">?W</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Extend_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="var">?W</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms consistent_Extend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="var">?W</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Extend_maximal surj_from_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-ex_mcs"><span class="command">lemma</span></span> ex_mcs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span> <span class="bound">p</span><span class="main">.</span> <span class="free">A</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">M</span> <span class="main">⟹</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="bound">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="free">P</span> <span class="bound">M</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">V</span><span class="main">.</span> consistent <span class="free">A</span> <span class="bound">V</span> <span class="main">∧</span> maximal <span class="free">A</span> <span class="bound">V</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Extend <span class="free">A</span> <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">}</span> from_nat›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms consistent_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> consistent_deriv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> consistent_Extend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Extend_maximal surj_from_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?V</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">V</span><span class="main">.</span> consistent <span class="free">A</span> <span class="bound">V</span> <span class="main">∧</span> maximal <span class="free">A</span> <span class="bound">V</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Model existence›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'i</span> s_max <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm set›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> s_max <span class="main">⇒</span> id <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">pi</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> Pro <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">partition</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm set <span class="main">⇒</span> <span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'i</span> fm set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">partition</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">p</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">}</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">reach</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span> fm <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'i</span> s_max <span class="main">⇒</span> <span class="tfree">'i</span> s_max set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">reach</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">W</span><span class="main">.</span> partition <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⊆</span> <span class="bound">W</span> <span class="main">∧</span> consistent <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">W</span> <span class="main">∧</span> maximal <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">W</span><span class="main">}</span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-truth_lemma"><span class="command">lemma</span></span> truth_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> fm›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">p</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟷</span> Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟷</span> Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> FF
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI iffI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="hidden">❙</span><b>⊥</b></span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> K_imply_head <span class="keyword1"><span class="command">unfolding</span></span> consistent_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum insert_subset list.set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> K_Boole inconsistent_subset consistent_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pro <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI iffI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> Pro <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> Pro <span class="skolem">i</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> exactly_one_in_maximal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> Pro <span class="skolem">i</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> Pro <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> exactly_one_in_maximal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> maximal_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dis <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">⟶</span> Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∨</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> consistent_disjuncts <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">∨</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Dis <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">⟶</span> Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">q</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> consistent_consequent' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Dis <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> exactly_one_in_maximal Dis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Con <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">⟶</span> Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> consistent_consequent' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Con <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">⟶</span> Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">q</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> consistent_consequent' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∨</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">q</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> consistent_disjuncts <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">∨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Con <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> exactly_one_in_maximal Con <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">⟶</span> Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">q</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> consistent_consequent' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∨</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> consistent_disjuncts <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">∨</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">⟶</span> Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">q</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">V</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> consistent_consequent' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> exactly_one_in_maximal Imp <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>K <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹K <span class="skolem">i</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">⟶</span> Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> K <span class="skolem">i</span> <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> K <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span> K <span class="skolem">i</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> K <span class="skolem">i</span> <span class="skolem">p</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> partition <span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> partition <span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> partition <span class="skolem">V</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="skolem">W</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">W</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">W</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> maximal_extension <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">W</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> K <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> reach <span class="free">A</span> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> W <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="skolem">i</span> <span class="skolem">p</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> K <span class="skolem">i</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> W<span class="main">:</span>
      <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">W</span> <span class="main">⊆</span> <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> partition <span class="skolem">V</span> <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">W</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">W</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">W</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> exists_finite_inconsistent <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">‹set <span class="skolem">L</span> <span class="main">=</span> <span class="skolem">W</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">W</span>›</span></span> finite_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="skolem">L</span> <span class="skolem">p</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> W<span class="main">(</span>4<span class="main">)</span> inconsistent_imply <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> K <span class="skolem">i</span> <span class="main">(</span>imply <span class="skolem">L</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> R2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span>map <span class="main">(</span>K <span class="skolem">i</span><span class="main">)</span> <span class="skolem">L</span><span class="main">)</span> <span class="main">(</span>K <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> K_distrib_K_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹imply <span class="main">(</span>map <span class="main">(</span>K <span class="skolem">i</span><span class="main">)</span> <span class="skolem">L</span><span class="main">)</span> <span class="main">(</span>K <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> deriv_in_maximal K.prems<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹K <span class="skolem">i</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> L W<span class="main">(</span>1-2<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">L</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">W</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">L</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹K <span class="skolem">i</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹imply <span class="main">(</span>map <span class="main">(</span>K <span class="skolem">i</span><span class="main">)</span> <span class="skolem">L</span><span class="main">)</span> <span class="main">(</span>K <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> consequent_in_maximal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> exactly_one_in_maximal calculation<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> semantics.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span> 5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">⟶</span> Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="skolem">i</span> <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="skolem">V</span>›</span></span> calculation<span class="main">(</span>2<span class="main">)</span> exactly_one_in_maximal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-canonical_model"><span class="command">lemma</span></span> canonical_model<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">S</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">≡</span> Extend <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">S</span><span class="main">)</span> from_nat›</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span> <span class="main">≡</span> Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">M</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="bound">p</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">S</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> V_def <span class="keyword1"><span class="command">using</span></span> consistent_Extend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> V_def <span class="keyword1"><span class="command">using</span></span> Extend_maximal surj_from_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="free">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> V_def <span class="keyword1"><span class="command">using</span></span> Extend_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">using</span></span> truth_lemma <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">M</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="bound">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="keyword1" id="Epistemic_Logic-imply_completeness"><span class="command">lemma</span></span> imply_completeness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> fm set<span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span>
    list_all <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="bound">q</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> imply <span class="free">G</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> K_Boole<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Extend <span class="free">A</span> <span class="var">?S</span> from_nat›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="free">A</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">A</span> <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span> K_imply_weaken <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="bound">p</span><span class="main">)</span> <span class="free">G</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">using</span></span> canonical_model <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> completeness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">,</span> <span class="tfree">'i</span> fm set<span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms imply_completeness<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">[]</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹System K›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SystemK</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub></span> _"</span> <span class="main">[</span>50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>K</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-soundness"><span class="command">lemma</span></span> soundness<span class="hidden">⇩</span><sub>K</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">valid<span class="hidden">⇩</span><sub>K</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> nat s_max<span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> main<span class="hidden">⇩</span><sub>K</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>K</sub> <span class="free">p</span> <span class="main">⟷</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>K</sub> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">with</span></span> completeness <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">with</span></span> soundness<span class="hidden">⇩</span><sub>K</sub> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>K</sub> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>K</sub> <span class="free">p</span> <span class="main">⟶</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>K</sub> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub></span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> main<span class="hidden">⇩</span><sub>K</sub> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> soundness<span class="hidden">⇩</span><sub>K</sub> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹System T›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Also known as System M›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">AxT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">AxT</span> <span class="main">(</span>K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SystemT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>T</sub></span> _"</span> <span class="main">[</span>50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>T</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> AxT <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-soundness_AxT"><span class="command">lemma</span></span> soundness_AxT<span class="main">:</span> <span class="quoted"><span class="quoted">‹AxT <span class="free">p</span> <span class="main">⟹</span> reflexive <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> AxT.induct<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> truth<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-soundness"><span class="command">lemma</span></span> soundness<span class="hidden">⇩</span><sub>T</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>T</sub></span> <span class="free">p</span> <span class="main">⟹</span> reflexive <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness soundness_AxT <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>T</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">V</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> fm set<span class="main">.</span> consistent AxT <span class="bound">V</span> <span class="main">∧</span> maximal AxT <span class="bound">V</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> ex_mcs<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted">AxT</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted">reflexive</span><span class="main">]</span> soundness_AxT ex_equiv_model <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">pi<span class="hidden">⇩</span><sub>T</sub></span> <span class="main">≡</span> pi <span class="keyword1">o</span> Rep_mcs<span class="hidden">⇩</span><sub>T</sub>›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">reach<span class="hidden">⇩</span><sub>T</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> Abs_mcs<span class="hidden">⇩</span><sub>T</sub> <span class="main">`</span> <span class="main">(</span>reach AxT <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Rep_mcs<span class="hidden">⇩</span><sub>T</sub> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>T</sub>_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent AxT <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxT <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Kripke pi <span class="main">(</span>reach AxT<span class="main">)</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>T</sub> reach<span class="hidden">⇩</span><sub>T</sub><span class="main">,</span> Abs_mcs<span class="hidden">⇩</span><sub>T</sub> <span class="free">V</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_mcs<span class="hidden">⇩</span><sub>T</sub>_inverse<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-AxT_reflexive"><span class="command">lemma</span></span> AxT_reflexive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> AxT <span class="bound">p</span> <span class="main">⟹</span> <span class="free">A</span> <span class="bound">p</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">∈</span> reach <span class="free">A</span> <span class="free">i</span> <span class="free">V</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>K <span class="free">i</span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">using</span></span> assms ax_in_maximal AxT.intros <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">‹K <span class="free">i</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">using</span></span> that assms consequent_in_maximal <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>T</sub>_reflexive<span class="main">:</span> <span class="quoted"><span class="quoted">‹reflexive <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>T</sub> reach<span class="hidden">⇩</span><sub>T</sub><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reflexive_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> <span class="main">::</span> countable›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>T</sub>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>T</sub> <span class="skolem">V</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent AxT <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxT <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>T</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?V</span> <span class="main">∈</span> reach AxT <span class="skolem">i</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> AxT_reflexive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> reach<span class="hidden">⇩</span><sub>T</sub> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>T</sub>_inverse <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>T</sub> reach<span class="hidden">⇩</span><sub>T</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-imply_completeness_T"><span class="command">lemma</span></span> imply_completeness_T<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> mcs<span class="hidden">⇩</span><sub>T</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span>
    reflexive <span class="bound">M</span> <span class="main">⟶</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="bound">q</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹AxT <span class="main">⊢</span> imply <span class="free">G</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> K_Boole<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> AxT <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Extend AxT <span class="var">?S</span> from_nat›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach AxT<span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V<span class="hidden">⇩</span><sub>T</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Abs_mcs<span class="hidden">⇩</span><sub>T</sub> <span class="var">?V</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M<span class="hidden">⇩</span><sub>T</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Kripke pi<span class="hidden">⇩</span><sub>T</sub> reach<span class="hidden">⇩</span><sub>T</sub>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent AxT <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> AxT <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span> K_imply_weaken <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="bound">p</span><span class="main">)</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent AxT <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxT <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> canonical_model <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>T</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>T</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?M<span class="hidden">⇩</span><sub>T</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>T</sub></span> <span class="main">⊨</span> <span class="bound">p</span><span class="main">)</span> <span class="free">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent AxT <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxT <span class="var">?V</span>›</span></span> mcs<span class="hidden">⇩</span><sub>T</sub>_equiv <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹reflexive <span class="var">?M<span class="hidden">⇩</span><sub>T</sub></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> mcs<span class="hidden">⇩</span><sub>T</sub>_reflexive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>T</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>T</sub></span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>T</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>T</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-completeness"><span class="command">lemma</span></span> completeness<span class="hidden">⇩</span><sub>T</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> mcs<span class="hidden">⇩</span><sub>T</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> reflexive <span class="bound">M</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>T</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms imply_completeness_T<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">[]</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">valid<span class="hidden">⇩</span><sub>T</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> nat mcs<span class="hidden">⇩</span><sub>T</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> reflexive <span class="bound">M</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> main<span class="hidden">⇩</span><sub>T</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>T</sub> <span class="free">p</span> <span class="main">⟷</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>T</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness<span class="hidden">⇩</span><sub>T</sub> completeness<span class="hidden">⇩</span><sub>T</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹reflexive <span class="free">M</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>T</sub> <span class="free">p</span> <span class="main">⟶</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms soundness<span class="hidden">⇩</span><sub>T</sub> completeness<span class="hidden">⇩</span><sub>T</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹System KB›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">AxB</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">AxB</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>L <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SystemKB</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span> _"</span> <span class="main">[</span>50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> AxB <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-soundness_AxB"><span class="command">lemma</span></span> soundness_AxB<span class="main">:</span> <span class="quoted"><span class="quoted">‹AxB <span class="free">p</span> <span class="main">⟹</span> symmetric <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> AxB.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Epistemic_Logic-soundness"><span class="command">lemma</span></span> soundness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="free">p</span> <span class="main">⟹</span> symmetric <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness soundness_AxB <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">V</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> fm set<span class="main">.</span> consistent AxB <span class="bound">V</span> <span class="main">∧</span> maximal AxB <span class="bound">V</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> ex_mcs<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted">AxB</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted">symmetric</span><span class="main">]</span> soundness_AxB ex_equiv_model <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="main">≡</span> pi <span class="keyword1">o</span> Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub>›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> Abs_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="main">`</span> <span class="main">(</span>reach AxB <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub>_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent AxB <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxB <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Kripke pi <span class="main">(</span>reach AxB<span class="main">)</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">,</span> Abs_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="free">V</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub>_inverse<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-AxB_symmetric"><span class="command">lemma</span></span> AxB_symmetric<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> AxB <span class="bound">p</span> <span class="main">⟹</span> <span class="free">A</span> <span class="bound">p</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">W</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">W</span> <span class="main">∈</span> reach <span class="free">A</span> <span class="free">i</span> <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">∈</span> reach <span class="free">A</span> <span class="free">i</span> <span class="free">W</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> K <span class="free">i</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟶</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹K <span class="free">i</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> exactly_one_in_maximal <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹K <span class="free">i</span> <span class="main">(</span>L <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> ax_in_maximal AxB.intros consequent_in_maximal <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹L <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="free">W</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">W</span> <span class="main">∈</span> reach <span class="free">A</span> <span class="free">i</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="free">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="free">W</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4-5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> K_LK consistent_consequent maximal_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹K <span class="free">i</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="free">W</span>›</span></span> assms<span class="main">(</span>4-5<span class="main">)</span> exactly_one_in_maximal <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹partition <span class="free">W</span> <span class="free">i</span> <span class="main">⊆</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-AxB_symmetric'"><span class="command">lemma</span></span> AxB_symmetric'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> AxB <span class="bound">p</span> <span class="main">⟹</span> <span class="free">A</span> <span class="bound">p</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">W</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">W</span> <span class="main">∈</span> reach <span class="free">A</span> <span class="free">i</span> <span class="free">V</span> <span class="main">⟷</span> <span class="free">V</span> <span class="main">∈</span> reach <span class="free">A</span> <span class="free">i</span> <span class="free">W</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms AxB_symmetric<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> W<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">W</span></span><span class="main">]</span> AxB_symmetric<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> W<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">V</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub>_symmetric<span class="main">:</span> <span class="quoted"><span class="quoted">‹symmetric <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> <span class="main">::</span> countable›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="skolem">V</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="skolem">W</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent AxB <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxB <span class="var">?V</span>›</span></span>
    <span class="quoted"><span class="quoted">‹consistent AxB <span class="var">?W</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxB <span class="var">?W</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?V</span> <span class="main">∈</span> reach AxB <span class="skolem">i</span> <span class="var">?W</span> <span class="main">⟷</span> <span class="var">?W</span> <span class="main">∈</span> reach AxB <span class="skolem">i</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> AxB_symmetric <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="skolem">i</span> <span class="skolem">W</span> <span class="main">⟷</span> <span class="skolem">W</span> <span class="main">∈</span> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Abs_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub>_inverse Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub>_inverse image_iff mem_Collect_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">W</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">V</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">W</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-imply_completeness_KB"><span class="command">lemma</span></span> imply_completeness_KB<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">,</span> <span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span>
    symmetric <span class="bound">M</span> <span class="main">⟶</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="bound">q</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹AxB <span class="main">⊢</span> imply <span class="free">G</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> K_Boole<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> AxB <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Extend AxB <span class="var">?S</span> from_nat›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach AxB<span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Abs_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="var">?V</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Kripke pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent AxB <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> AxB <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span> K_imply_weaken <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="bound">p</span><span class="main">)</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent AxB <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxB <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> canonical_model <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="main">⊨</span> <span class="bound">p</span><span class="main">)</span> <span class="free">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent AxB <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxB <span class="var">?V</span>›</span></span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub>_equiv <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹symmetric <span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub>_symmetric <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-completeness"><span class="command">lemma</span></span> completeness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> symmetric <span class="bound">M</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms imply_completeness_KB<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">[]</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">valid<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> nat mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> symmetric <span class="bound">M</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> main<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="free">p</span> <span class="main">⟷</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> completeness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹symmetric <span class="free">M</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="free">p</span> <span class="main">⟶</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms soundness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> completeness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>B</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹System K4›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">Ax4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">Ax4</span> <span class="main">(</span>K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SystemK4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span> _"</span> <span class="main">[</span>50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> Ax4 <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-soundness_Ax4"><span class="command">lemma</span></span> soundness_Ax4<span class="main">:</span> <span class="quoted"><span class="quoted">‹Ax4 <span class="free">p</span> <span class="main">⟹</span> transitive <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ax4.induct<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> pos_introspection<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-soundness"><span class="command">lemma</span></span> soundness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="free">p</span> <span class="main">⟹</span> transitive <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness soundness_Ax4 <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">V</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> fm set<span class="main">.</span> consistent Ax4 <span class="bound">V</span> <span class="main">∧</span> maximal Ax4 <span class="bound">V</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> ex_mcs<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted">Ax4</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted">transitive</span><span class="main">]</span> soundness_Ax4 ex_equiv_model <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="main">≡</span> pi <span class="keyword1">o</span> Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub>›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> Abs_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="main">`</span> <span class="main">(</span>reach Ax4 <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub>_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent Ax4 <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal Ax4 <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Kripke pi <span class="main">(</span>reach Ax4<span class="main">)</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">,</span> Abs_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="free">V</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub>_inverse<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-Ax4_transitive"><span class="command">lemma</span></span> Ax4_transitive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> Ax4 <span class="bound">p</span> <span class="main">⟹</span> <span class="free">A</span> <span class="bound">p</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">A</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="free">A</span> <span class="free">V</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">W</span> <span class="main">∈</span> reach <span class="free">A</span> <span class="free">i</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">∈</span> reach <span class="free">A</span> <span class="free">i</span> <span class="free">W</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">∈</span> reach <span class="free">A</span> <span class="free">i</span> <span class="free">V</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>K <span class="free">i</span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="main">(</span>K <span class="free">i</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> ax_in_maximal Ax4.intros <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹K <span class="free">i</span> <span class="main">(</span>K <span class="free">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">‹K <span class="free">i</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">using</span></span> that assms<span class="main">(</span>2-3<span class="main">)</span> consequent_in_maximal <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub>_transitive<span class="main">:</span> <span class="quoted"><span class="quoted">‹transitive <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> transitive_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> <span class="main">::</span> countable›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="skolem">V</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="skolem">W</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="skolem">U</span>›</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">W</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?W</span> <span class="main">∈</span> reach Ax4 <span class="skolem">i</span> <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">∈</span> reach Ax4 <span class="skolem">i</span> <span class="var">?W</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Abs_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub>_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent Ax4 <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal Ax4 <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">∈</span> reach Ax4 <span class="skolem">i</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ax4_transitive<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="var">?V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub>_inverse <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-imply_completeness_K4"><span class="command">lemma</span></span> imply_completeness_K4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">,</span> <span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span>
    transitive <span class="bound">M</span> <span class="main">⟶</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="bound">q</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹Ax4 <span class="main">⊢</span> imply <span class="free">G</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> K_Boole<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Ax4 <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Extend Ax4 <span class="var">?S</span> from_nat›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach Ax4<span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Abs_mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="var">?V</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Kripke pi<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent Ax4 <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Ax4 <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span> K_imply_weaken <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="bound">p</span><span class="main">)</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹consistent Ax4 <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal Ax4 <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> canonical_model <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊨</span> <span class="bound">p</span><span class="main">)</span> <span class="free">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent Ax4 <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal Ax4 <span class="var">?V</span>›</span></span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub>_equiv <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub>_transitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-completeness"><span class="command">lemma</span></span> completeness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> transitive <span class="bound">M</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms imply_completeness_K4<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">[]</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">valid<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> nat mcs<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> transitive <span class="bound">M</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> main<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="free">p</span> <span class="main">⟷</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> completeness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="free">M</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="free">p</span> <span class="main">⟶</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms soundness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> completeness<span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>4</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹System S4›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Or</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">⊕</span>›</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⊕</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">x</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">x</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SystemS4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span> _"</span> <span class="main">[</span>50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> AxT <span class="main">⊕</span> Ax4 <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-soundness_AxT4"><span class="command">lemma</span></span> soundness_AxT4<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="free">p</span> <span class="main">⟹</span> reflexive <span class="free">M</span> <span class="main">∧</span> transitive <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness_AxT soundness_Ax4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Epistemic_Logic-soundness"><span class="command">lemma</span></span> soundness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="free">p</span> <span class="main">⟹</span> reflexive <span class="free">M</span> <span class="main">∧</span> transitive <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness soundness_AxT4 <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="main">=</span>
  <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">V</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> fm set<span class="main">.</span> consistent <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="bound">V</span> <span class="main">∧</span> maximal <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="bound">V</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> ex_mcs<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹AxT <span class="main">⊕</span> Ax4›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">M</span><span class="main">.</span> reflexive <span class="bound">M</span> <span class="main">∧</span> transitive <span class="bound">M</span>›</span></span><span class="main">]</span>
    soundness_AxT4 ex_equiv_model <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="main">≡</span> pi <span class="keyword1">o</span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> Abs_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="main">`</span> <span class="main">(</span>reach <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Kripke pi <span class="main">(</span>reach <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">,</span> Abs_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="free">V</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>_inverse<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>_reflexive<span class="main">:</span> <span class="quoted"><span class="quoted">‹reflexive <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reflexive_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> <span class="main">::</span> countable›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="skolem">V</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?V</span> <span class="main">∈</span> reach <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="skolem">i</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> AxT_reflexive<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="var">?V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>_inverse <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>_transitive<span class="main">:</span> <span class="quoted"><span class="quoted">‹transitive <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> transitive_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> <span class="main">::</span> countable›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="skolem">V</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="skolem">W</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="skolem">U</span>›</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">W</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?W</span> <span class="main">∈</span> reach <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="skolem">i</span> <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">∈</span> reach <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="skolem">i</span> <span class="var">?W</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Abs_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">∈</span> reach <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="skolem">i</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ax4_transitive<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="var">?V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>_inverse <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-imply_completeness_S4"><span class="command">lemma</span></span> imply_completeness_S4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">,</span> <span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span>
    reflexive <span class="bound">M</span> <span class="main">⟶</span> transitive <span class="bound">M</span> <span class="main">⟶</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="bound">q</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹AxT <span class="main">⊕</span> Ax4 <span class="main">⊢</span> imply <span class="free">G</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> K_Boole<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> AxT <span class="main">⊕</span> Ax4 <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Extend <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="var">?S</span> from_nat›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Abs_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="var">?V</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> AxT <span class="main">⊕</span> Ax4 <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span> K_imply_weaken <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="bound">p</span><span class="main">)</span> <span class="free">G</span>›</span></span>
    <span class="quoted"><span class="quoted">‹consistent <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> canonical_model <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊨</span> <span class="bound">p</span><span class="main">)</span> <span class="free">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="main">(</span>AxT <span class="main">⊕</span> Ax4<span class="main">)</span> <span class="var">?V</span>›</span></span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>_equiv
    <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹reflexive <span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>_reflexive mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub>_transitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-completeness"><span class="command">lemma</span></span> completeness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span>
      reflexive <span class="bound">M</span> <span class="main">⟶</span> transitive <span class="bound">M</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms imply_completeness_S4<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">[]</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">valid<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> nat mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span>
    reflexive <span class="bound">M</span> <span class="main">⟶</span> transitive <span class="bound">M</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> main<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="free">p</span> <span class="main">⟷</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> completeness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹reflexive <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹transitive <span class="free">M</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="free">p</span> <span class="main">⟶</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms soundness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> completeness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>4</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹System S5›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">AxTB4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">AxTB4</span> <span class="main">≡</span> AxT <span class="main">⊕</span> AxB <span class="main">⊕</span> Ax4›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SystemS5</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> _"</span> <span class="main">[</span>50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> AxTB4 <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-soundness_AxTB4"><span class="command">lemma</span></span> soundness_AxTB4<span class="main">:</span> <span class="quoted"><span class="quoted">‹AxTB4 <span class="free">p</span> <span class="main">⟹</span> equivalence <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness_AxT soundness_AxB soundness_Ax4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Epistemic_Logic-soundness"><span class="command">lemma</span></span> soundness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="free">p</span> <span class="main">⟹</span> equivalence <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness soundness_AxTB4 <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="main">=</span>
  <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">V</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> fm set<span class="main">.</span> consistent AxTB4 <span class="bound">V</span> <span class="main">∧</span> maximal AxTB4 <span class="bound">V</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> ex_mcs<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted">AxTB4</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted">equivalence</span><span class="main">]</span> soundness_AxTB4 ex_equiv_model <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="main">≡</span> pi <span class="keyword1">o</span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> Abs_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="main">`</span> <span class="main">(</span>reach AxTB4 <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistent AxTB4 <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxTB4 <span class="free">V</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Kripke pi <span class="main">(</span>reach AxTB4<span class="main">)</span><span class="main">,</span> <span class="free">V</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">,</span> Abs_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="free">V</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_inverse<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_reflexive<span class="main">:</span> <span class="quoted"><span class="quoted">‹reflexive <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reflexive_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> <span class="main">::</span> countable›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="skolem">V</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent AxTB4 <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxTB4 <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?V</span> <span class="main">∈</span> reach AxTB4 <span class="skolem">i</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> AxT_reflexive<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="var">?V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_inverse <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_symmetric<span class="main">:</span> <span class="quoted"><span class="quoted">‹symmetric <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> <span class="main">::</span> countable›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="skolem">V</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="skolem">W</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent AxTB4 <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxTB4 <span class="var">?V</span>›</span></span>
    <span class="quoted"><span class="quoted">‹consistent AxTB4 <span class="var">?W</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxTB4 <span class="var">?W</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?V</span> <span class="main">∈</span> reach AxTB4 <span class="skolem">i</span> <span class="var">?W</span> <span class="main">⟷</span> <span class="var">?W</span> <span class="main">∈</span> reach AxTB4 <span class="skolem">i</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> AxB_symmetric'<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="var">?V</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> W<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="var">?W</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="skolem">i</span> <span class="skolem">W</span> <span class="main">⟷</span> <span class="skolem">W</span> <span class="main">∈</span> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_iff <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_cases Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_inverse
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">W</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">V</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">W</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-mcs"><span class="command">lemma</span></span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_transitive<span class="main">:</span> <span class="quoted"><span class="quoted">‹transitive <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> transitive_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> <span class="main">::</span> countable›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="skolem">V</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="skolem">W</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="skolem">U</span>›</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">W</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?W</span> <span class="main">∈</span> reach AxTB4 <span class="skolem">i</span> <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">∈</span> reach AxTB4 <span class="skolem">i</span> <span class="var">?W</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Abs_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent AxTB4 <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxTB4 <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">∈</span> reach AxTB4 <span class="skolem">i</span> <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ax4_transitive<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="var">?V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_inverse <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> 𝒦 <span class="main">(</span>Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">V</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-imply_completeness_S5"><span class="command">lemma</span></span> imply_completeness_S5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">,</span> <span class="tfree">'i</span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span>
    equivalence <span class="bound">M</span> <span class="main">⟶</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="bound">q</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹AxTB4 <span class="main">⊢</span> imply <span class="free">G</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> K_Boole<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> AxTB4 <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Extend AxTB4 <span class="var">?S</span> from_nat›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Kripke pi <span class="main">(</span>reach AxTB4<span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Abs_mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="var">?V</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Kripke pi<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> reach<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistent AxTB4 <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> AxTB4 <span class="main">⊢</span> imply <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span> K_imply_weaken <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?M</span><span class="main">,</span> <span class="var">?V</span> <span class="main">⊨</span> <span class="bound">p</span><span class="main">)</span> <span class="free">G</span>›</span></span>
    <span class="quoted"><span class="quoted">‹consistent AxTB4 <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxTB4 <span class="var">?V</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> canonical_model <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="main">⊨</span> <span class="bound">p</span><span class="main">)</span> <span class="free">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent AxTB4 <span class="var">?V</span>›</span></span> <span class="quoted"><span class="quoted">‹maximal AxTB4 <span class="var">?V</span>›</span></span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_equiv
    <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹equivalence <span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_reflexive mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_symmetric mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>_transitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span><span class="main">,</span> <span class="var">?V<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-completeness"><span class="command">lemma</span></span> completeness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> equivalence <span class="bound">M</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms imply_completeness_S5<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹<span class="main">[]</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">valid<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> nat mcs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">)</span> kripke<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> equivalence <span class="bound">M</span> <span class="main">⟶</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> main<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub><span class="main">:</span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="free">p</span> <span class="main">⟷</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> completeness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹equivalence <span class="free">M</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="free">p</span> <span class="main">⟶</span> <span class="free">M</span><span class="main">,</span> <span class="free">s</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms soundness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> completeness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Traditional formulation›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">SystemS5'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>''</span> _"</span> <span class="main">[</span>50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  A1'<span class="main">:</span> <span class="quoted"><span class="quoted">‹tautology <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
<span class="main">|</span> A2'<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span></span> <span class="main">(</span>K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> AT'<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span></span> <span class="main">(</span>K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> A5'<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span></span> <span class="main">(</span>L <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>L <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> R1'<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>›</span></span>
<span class="main">|</span> R2'<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span></span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1" id="Epistemic_Logic-S5'_trans"><span class="command">lemma</span></span> S5'_trans<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main">(</span><span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">r</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">r</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1'<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-S5'_L"><span class="command">lemma</span></span> S5'_L<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> L <span class="free">i</span> <span class="free">p</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>K <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> AT' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="main">(</span><span class="skolem">P</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">Q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">Q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">P</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm›</span></span>
    <span class="keyword1"><span class="command">using</span></span> A1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> R1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-S5'_B"><span class="command">lemma</span></span> S5'_B<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="main">(</span>L <span class="free">i</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> A5' S5'_L R1' S5'_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Epistemic_Logic-S5'_KL"><span class="command">lemma</span></span> S5'_KL<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> L <span class="free">i</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AT' R1' S5'_L S5'_trans<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-S5'_map_K"><span class="command">lemma</span></span> S5'_map_K<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> K <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> R2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>K <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> A2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> R1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-S5'_map_L"><span class="command">lemma</span></span> S5'_map_L<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>L <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> L <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> R1' S5'_map_K S5'_trans<span class="main">)</span>

<span class="keyword1" id="Epistemic_Logic-S5'_L_dual"><span class="command">lemma</span></span> S5'_L_dual<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> L <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">p</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1'<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>K <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S5'_map_K<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="main">(</span><span class="skolem">P</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">Q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">P</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">Q</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1'<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> R1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-S5'_4"><span class="command">lemma</span></span> S5'_4<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>L <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="main">(</span>L <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> A5' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="main">(</span><span class="skolem">P</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">Q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">Q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">P</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm›</span></span>
    <span class="keyword1"><span class="command">using</span></span> A1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> K <span class="free">i</span> <span class="main">(</span>L <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> L <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> R1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>L <span class="free">i</span> <span class="main">(</span>K <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> L <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1'<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>L <span class="free">i</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> L <span class="free">i</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> R1' S5'_map_K S5'_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>L <span class="free">i</span> <span class="main">(</span>K <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="free">i</span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> S5'_L_dual R1' S5'_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A2' R1' R2' S5'_B S5'_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Epistemic_Logic-S5_S5'"><span class="command">lemma</span></span> S5_S5'<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="free">p</span> <span class="main">⟹</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> AK.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>A2 <span class="skolem">i</span> <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span>K <span class="skolem">i</span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="skolem">i</span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> K <span class="skolem">i</span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> A2' <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">(</span><span class="main">(</span><span class="skolem">P</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">Q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">R</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="main">(</span><span class="skolem">Q</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">P</span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A1'<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> R1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> AT' S5'_B S5'_4
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ax4.cases AxB.cases AxT.cases<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">meson</span> SystemS5'.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Epistemic_Logic-S5'_S5"><span class="command">lemma</span></span> S5'_S5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">)</span> fm›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="free">p</span> <span class="main">⟹</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub></span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SystemS5'.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AT' <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ax AxT.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>A5' <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> completeness<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> neg_introspection <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">meson</span> AK.intros K_A2'<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">theorem</span></span> main<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">‹valid<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> <span class="free">p</span> <span class="main">⟷</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub>'</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> main<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>5</sub> S5_S5' S5'_S5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Acknowledgements›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The formalization is inspired by Berghofer's formalization of Henkin-style completeness.

  <span class="antiquoted"><span class="antiquoted">▪</span></span> Stefan Berghofer:
  First-Order Logic According to Fitting.
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://www.isa-afp.org/entries/FOL-Fitting.shtml›</span></span>
›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>